(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{42928:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var a=s(95155),n=s(12115),l=s(20063),c=s(1026),r=s(27702),i=s(97003),o=s(33789),d=s(90235),m=s(83209),h=s(67812),x=s(67001),u=s(54679),p=s(47507),j=s(54664),g=s(59034),f=s(25016);let v=n.forwardRef((e,t)=>{let{className:s,children:n,...l}=e;return(0,a.jsxs)(g.bL,{ref:t,className:(0,f.cn)("relative overflow-hidden",s),...l,children:[(0,a.jsx)(g.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,a.jsx)(N,{}),(0,a.jsx)(g.OK,{})]})});v.displayName=g.bL.displayName;let N=n.forwardRef((e,t)=>{let{className:s,orientation:n="vertical",...l}=e;return(0,a.jsx)(g.VM,{ref:t,orientation:n,className:(0,f.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,a.jsx)(g.lr,{className:"relative flex-1 rounded-full bg-border"})})});N.displayName=g.VM.displayName;var b=s(89715),y=s(65229),w=s(6191),A=s(86651),P=s(10512),C=s(20508),S=s(53409),T=s(69141),E=s(7125),I=s(71360),k=s(78519),F=s(35597),D=s(52508),O=s(6132),M=s(76577);let _=0,U=new Map,B=e=>{if(U.has(e))return;let t=setTimeout(()=>{U.delete(e),$({type:"REMOVE_TOAST",toastId:e})},1e6);U.set(e,t)},q=[],L={toasts:[]};function $(e){L=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?B(s):e.toasts.forEach(e=>{B(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(L,e),q.forEach(e=>{e(L)})}function V(e){let{...t}=e,s=(_=(_+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>$({type:"DISMISS_TOAST",toastId:s});return $({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>$({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function z(e){let{htmlContent:t,thermalContent:s,isThermalPrinter:l=!1,onPrintSuccess:c,onPrintError:r}=e,[o,d]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),{toast:x}=function(){let[e,t]=n.useState(L);return n.useEffect(()=>(q.push(t),()=>{let e=q.indexOf(t);e>-1&&q.splice(e,1)}),[e]),{...e,toast:V,dismiss:e=>$({type:"DISMISS_TOAST",toastId:e})}}(),u=async()=>{if(console.log("PrintButton: handlePrint called."),console.log("PrintButton: htmlContent =",t?"present":"absent"),console.log("PrintButton: thermalContent =",s?"present":"absent"),console.log("PrintButton: isThermalPrinter =",l),!t&&!s)return void x({title:"No Content to Print",description:"Please provide HTML or thermal content to print.",variant:"destructive"});h(!0);try{await (0,M.G)({htmlContent:t,thermalContent:s,isThermalPrinter:l}),x({title:"Print Job Sent",description:"Your document has been sent to the printer."}),null==c||c()}catch(e){x({title:"Printing Failed",description:e.message||"An unknown error occurred while sending the print job.",variant:"destructive"}),null==r||r(e)}finally{h(!1)}};return(0,a.jsx)(i.$,{onClick:u,disabled:m||!t&&!s,children:m?"Printing...":"Print Document"})}let J=e=>fetch(e).then(e=>e.json());function R(){let e=(0,l.useRouter)(),{data:t=[]}=(0,c.Ay)("http://127.0.0.1:8000/api/products",J),[s,g]=(0,n.useState)(null),[f,N]=(0,n.useState)(""),[_,U]=(0,n.useState)([]),[B,q]=(0,n.useState)([]),[L,$]=(0,n.useState)(""),[V,R]=(0,n.useState)([]),[G,W]=(0,n.useState)(!1),[Z,Y]=(0,n.useState)(!1),[H,K]=(0,n.useState)(!1),[Q,X]=(0,n.useState)(""),[ee,et]=(0,n.useState)({gstin:"",taxPercentage:0,companyName:"",companyAddress:"",companyPhone:"",companyEmail:""}),[es,ea]=(0,n.useState)([]),[en,el]=(0,n.useState)(null),[ec,er]=(0,n.useState)({}),[ei,eo]=(0,n.useState)({}),[ed,em]=(0,n.useState)("A4");(0,n.useEffect)(()=>{let t=localStorage.getItem("adminLoggedIn"),s=localStorage.getItem("adminUser");if("true"!==t||!s)return void e.push("/");let a=JSON.parse(s);g(a),fetch("http://127.0.0.1:8000/api/settings").then(e=>e.json()).then(e=>{e.systemSettings&&et(e.systemSettings),e.billFormats&&er(e.billFormats),e.storeFormats&&eo(e.storeFormats)}),fetch("http://127.0.0.1:8000/api/bills").then(t=>{if(401===t.status)return e.push("/"),null;if(!t.ok)throw Error("Failed to fetch bills");return t.json()}).then(e=>{e&&R(e.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()))}).catch(e=>{console.error("Failed to load bills:",e)}),fetch("http://127.0.0.1:8000/api/stores").then(e=>e.json()).then(e=>{let t=e.filter(e=>"active"===e.status);if(ea(t),"billing_user"===a.role&&a.assignedStores){let e=t.filter(e=>{var t;return null==(t=a.assignedStores)?void 0:t.includes(e.id)});e.length>0&&el(e[0])}else t.length>0&&el(t[0])})},[e]),(0,n.useEffect)(()=>{f?U(t.filter(e=>e.name.toLowerCase().includes(f.toLowerCase())||e.category&&e.category.toLowerCase().includes(f.toLowerCase())||e.barcodes&&e.barcodes.some(e=>e.includes(f)))):U(t.slice(0,20))},[f,t]),(0,n.useEffect)(()=>{ee.taxPercentage>0&&q(e=>0!==e.length&&e.some(e=>e.taxPercentage!==ee.taxPercentage)?e.map(e=>{if(e.taxPercentage!==ee.taxPercentage){let t=e.subtotal,s=t*e.discountPercentage/100,a=t-s,n=a*ee.taxPercentage/100;return{...e,taxPercentage:ee.taxPercentage,taxAmount:n,total:a+n}}return e}):e)},[ee.taxPercentage]),(0,n.useEffect)(()=>{if(0===B.length&&ee.companyName){let e={id:"tab-1",name:"Bill #1",cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxPercentage:ee.taxPercentage,taxAmount:0,total:0,paymentMethod:"cash",notes:"",hasUnsavedChanges:!1};q([e]),$(e.id)}},[B.length,ee]);let eh=e=>{q(B.map(t=>t.id===e?{...t,cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxAmount:0,total:0,notes:"",hasUnsavedChanges:!1}:t))},ex=(e,t)=>{q(B.map(s=>s.id===e?{...s,...t,hasUnsavedChanges:!0}:s))},eu=()=>B.find(e=>e.id===L),ep=(e,s)=>{let a=eu();if(!a)return;if(s<=0)return void ej(e);let n=t.find(t=>t.id===e);if(n&&s>n.stock)return void alert("Cannot exceed available stock: ".concat(n.stock));let l=a.cart.map(t=>t.productId===e?{...t,quantity:s,total:s*t.price}:t),c=l.reduce((e,t)=>e+t.total,0),r=c*a.discountPercentage/100,i=c-r,o=i*a.taxPercentage/100;ex(L,{cart:l,subtotal:c,discountAmount:r,taxAmount:o,total:i+o})},ej=e=>{let t=eu();if(!t)return;let s=t.cart.filter(t=>t.productId!==e),a=s.reduce((e,t)=>e+t.total,0),n=a*t.discountPercentage/100,l=a-n,c=l*t.taxPercentage/100;ex(L,{cart:s,subtotal:a,discountAmount:n,taxAmount:c,total:l+c})},eg=async()=>{let e=eu();if(!e||0===e.cart.length||!en)return;let a=ei[en.id]||ed,n=ec[a]||ec.A4,l={id:"INV-".concat(Date.now()),storeId:en.id,storeName:en.name,storeAddress:en.address,storePhone:en.phone,customerName:e.customer.name||"",customerPhone:e.customer.phone||"",customerEmail:e.customer.email||"",customerAddress:e.customer.address||"",items:e.cart,subtotal:e.subtotal,taxPercentage:e.taxPercentage,taxAmount:e.taxAmount,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount,total:e.total,paymentMethod:e.paymentMethod,timestamp:new Date().toISOString(),notes:e.notes,gstin:ee.gstin,companyName:ee.companyName,companyAddress:ee.companyAddress,companyPhone:ee.companyPhone,companyEmail:ee.companyEmail,billFormat:a,createdBy:(null==s?void 0:s.id)||"Unknown"};try{await fetch("http://127.0.0.1:8000/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}catch(e){console.error("Failed to save bill:",e)}for(let s of e.cart){let e=t.find(e=>e.id===s.productId);if(e){let t=e.stock-s.quantity;try{await fetch("http://127.0.0.1:8000"+"/api/products/".concat(s.productId),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({stock:t})})}catch(e){console.error("Failed to update stock for product ".concat(s.productId,":"),e)}}}let c=ef(l,n);try{await (0,M.G)({htmlContent:c,isThermalPrinter:n.width<=80})}catch(e){console.error("Failed to send print job:",e)}eh(L),W(!1)},ef=(e,t)=>{let s=216===t.width&&279===t.height,a=210===t.width&&297===t.height,n=t.width<=80?"80mm":s?"216mm":a?"210mm":"".concat(t.width,"mm");return"\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Invoice - ".concat(e.id,"</title>\n          <style>\n            @page {\n              size: ").concat(s?"letter":a?"A4":"".concat(t.width,"mm ").concat("auto"===t.height?"auto":"".concat(t.height,"mm")),";\n              margin: ").concat(t.margins.top,"mm ").concat(t.margins.right,"mm ").concat(t.margins.bottom,"mm ").concat(t.margins.left,"mm;\n            }\n            body {\n              font-family: 'Arial', sans-serif;\n              max-width: ").concat(n,';\n              margin: 0 auto;\n              font-size: 13px;\n              color: #000;\n            }\n            .header, .footer {\n              text-align: center;\n              padding: 10px 0;\n            }\n            .company-name {\n              font-size: 18px;\n              font-weight: bold;\n              text-transform: uppercase;\n            }\n            .invoice-title {\n              font-size: 16px;\n              font-weight: bold;\n              margin-top: 10px;\n            }\n            .section {\n              margin: 20px 0;\n            }\n            .section-title {\n              font-weight: bold;\n              border-bottom: 1px solid #ccc;\n              margin-bottom: 5px;\n            }\n            .row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 6px;\n            }\n            .items-table {\n              width: 100%;\n              border-collapse: collapse;\n              margin-top: 15px;\n            }\n            .items-table th, .items-table td {\n              border: 1px solid #ccc;\n              padding: 6px 8px;\n              text-align: left;\n            }\n            .items-table th {\n              background-color: #f2f2f2;\n            }\n            .totals {\n              margin-top: 10px;\n              width: 100%;\n            }\n            .totals td {\n              padding: 6px;\n            }\n            .totals .label {\n              text-align: right;\n              font-weight: bold;\n            }\n            .totals .value {\n              text-align: right;\n              width: 100px;\n            }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <div class="company-name">').concat(e.companyName,"</div>\n            <div>").concat(e.companyAddress,"</div>\n            <div>Phone: ").concat(e.companyPhone,"</div>\n            <div>Email: ").concat(e.companyEmail,'</div>\n            <div class="invoice-title">INVOICE</div>\n          </div>\n\n          <div class="section">\n            <div class="row">\n              <div><strong>Invoice ID:</strong> ').concat(e.id,"</div>\n              <div><strong>Date:</strong> ").concat(new Date(e.timestamp).toLocaleString(),"</div>\n            </div>\n            ").concat(e.gstin?"<div><strong>GSTIN:</strong> ".concat(e.gstin,"</div>"):"","\n          </div>\n\n          ").concat(e.customerName||e.customerPhone?'\n          <div class="section">\n            <div class="section-title">Customer Details</div>\n            '.concat(e.customerName?"<div>Name: ".concat(e.customerName,"</div>"):"","\n            ").concat(e.customerPhone?"<div>Phone: ".concat(e.customerPhone,"</div>"):"","\n            ").concat(e.customerEmail?"<div>Email: ".concat(e.customerEmail,"</div>"):"","\n            ").concat(e.customerAddress?"<div>Address: ".concat(e.customerAddress,"</div>"):"","\n          </div>"):"",'\n\n          <div class="section">\n            <table class="items-table">\n              <thead>\n                <tr>\n                  <th>#</th>\n                  <th>Item</th>\n                  <th>Qty</th>\n                  <th>Rate</th>\n                  <th>Total</th>\n                </tr>\n              </thead>\n              <tbody>\n                ').concat(e.items.map((e,t)=>"\n                  <tr>\n                    <td>".concat(t+1,"</td>\n                    <td>").concat(e.productName,"</td>\n                    <td>").concat(e.quantity,"</td>\n                    <td>₹").concat(e.price.toFixed(2),"</td>\n                    <td>₹").concat(e.total.toFixed(2),"</td>\n                  </tr>\n                ")).join(""),'\n              </tbody>\n            </table>\n          </div>\n\n          <div class="section">\n            <table class="totals">\n              <tr>\n                <td class="label">Subtotal:</td>\n                <td class="value">₹').concat(e.subtotal.toFixed(2),"</td>\n              </tr>\n              ").concat(e.discountAmount>0?'<tr>\n                      <td class="label">Discount ('.concat(e.discountPercentage.toFixed(1),'%):</td>\n                      <td class="value">-₹').concat(e.discountAmount.toFixed(2),"</td>\n                    </tr>"):"",'\n              <tr>\n                <td class="label">Tax (').concat(e.taxPercentage,'%):</td>\n                <td class="value">₹').concat(e.taxAmount.toFixed(2),'</td>\n              </tr>\n              <tr>\n                <td class="label">Total:</td>\n                <td class="value"><strong>₹').concat(e.total.toFixed(2),'</strong></td>\n              </tr>\n              <tr>\n                <td class="label">Payment:</td>\n                <td class="value">').concat(e.paymentMethod.toUpperCase(),"</td>\n              </tr>\n            </table>\n          </div>\n\n          ").concat(e.notes?'<div class="section">\n                  <div class="section-title">Notes</div>\n                  <div>'.concat(e.notes,"</div>\n                </div>"):"",'\n\n          <div class="footer">\n            <p>Thank you for your business!</p>\n          </div>\n        </body>\n      </html>\n    ')},ev=eu(),eN=(0,n.useMemo)(()=>V.slice(0,10),[V]);return(0,a.jsx)(r.A,{children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center bg-gray-100 border-b border-gray-200 px-2 py-1",children:[(0,a.jsx)("div",{className:"flex items-center space-x-1 flex-1 overflow-x-auto",children:B.map(e=>(0,a.jsxs)("div",{className:"\n                  relative flex items-center px-4 py-2 min-w-0 max-w-48 cursor-pointer group\n                  ".concat(L===e.id?"bg-white border-t-2 border-blue-500 text-blue-600":"bg-gray-200 hover:bg-gray-300 text-gray-700","\n                  rounded-t-lg border-l border-r border-gray-300 mr-1\n                  transition-all duration-200\n                "),style:{clipPath:L===e.id?"polygon(8px 100%, 0 0, calc(100% - 8px) 0, 100% 100%)":"polygon(4px 100%, 0 0, calc(100% - 4px) 0, 100% 100%)"},onClick:()=>$(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate text-sm font-medium",children:e.name}),e.cart.length>0&&(0,a.jsx)(h.E,{variant:"secondary",className:"h-5 text-xs",children:e.cart.length}),e.hasUnsavedChanges&&(0,a.jsx)("div",{className:"h-2 w-2 bg-orange-500 rounded-full flex-shrink-0",title:"Unsaved changes"})]}),B.length>1&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 ml-2 opacity-0 group-hover:opacity-100 hover:bg-red-100 hover:text-red-600 flex-shrink-0",onClick:t=>{t.stopPropagation(),(e=>{let t=B.find(t=>t.id===e);if(null==t?void 0:t.hasUnsavedChanges){X(e),K(!0);return}if(1===B.length)return eh(e);let s=B.filter(t=>t.id!==e);if(q(s),L===e){let t=B.findIndex(t=>t.id===e);$((s[t]||s[t-1]||s[0]).id)}})(e.id)},children:(0,a.jsx)(y.A,{className:"h-3 w-3"})})]},e.id))}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>{let e=B.length+1,t={id:"tab-".concat(Date.now()),name:"Bill #".concat(e),cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxPercentage:ee.taxPercentage,taxAmount:0,total:0,paymentMethod:"cash",notes:"",hasUnsavedChanges:!1};q([...B,t]),$(t.id)},className:"ml-2 h-8 w-8 p-0 bg-gray-200 hover:bg-gray-300 rounded-full",title:"New Tab",children:(0,a.jsx)(w.A,{className:"h-4 w-4"})})]}),ev&&(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsxs)("div",{className:"w-1/2 border-r border-gray-200 flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(A.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(o.p,{placeholder:"Search products by name, category, or barcode...",value:f,onChange:e=>N(e.target.value),className:"pl-10"})]})}),(0,a.jsx)(v,{className:"flex-1",children:(0,a.jsxs)("div",{className:"p-4 space-y-2",children:[_.map(e=>(0,a.jsx)(m.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>(e=>{let t,s=eu();if(!s)return;if(e.stock<=0)return void alert("Product is out of stock");let a=s.cart.find(t=>t.productId===e.id);if(a){if(a.quantity>=e.stock)return void alert("Cannot add more. Maximum available: ".concat(e.stock));t=s.cart.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1,total:(t.quantity+1)*t.price}:t)}else t=[...s.cart,{productId:e.id,productName:e.name,quantity:1,price:e.price,total:e.price}];let n=t.reduce((e,t)=>e+t.total,0),l=n*s.discountPercentage/100,c=n-l,r=c*s.taxPercentage/100;ex(L,{cart:t,subtotal:n,discountAmount:l,taxAmount:r,total:c+r})})(e),children:(0,a.jsx)(m.Wu,{className:"p-3",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium text-sm",children:e.name}),e.category&&(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.category}),e.barcodes&&e.barcodes.length>0&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Barcode: ",e.barcodes[0]]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-bold text-green-600",children:["₹",e.price.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Stock: ",e.stock]})]})]})})},e.id)),0===_.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(A.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No products found"}),(0,a.jsx)("p",{className:"text-sm",children:"Try adjusting your search terms"})]})]})})]}),(0,a.jsxs)("div",{className:"w-1/2 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold flex items-center",children:[(0,a.jsx)(P.A,{className:"h-5 w-5 mr-2"}),ev.name]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[ev&&en&&ec&&(0,a.jsx)(z,{htmlContent:ef({id:"INV-".concat(Date.now()),storeId:en.id,storeName:en.name,storeAddress:en.address,storePhone:en.phone,customerName:ev.customer.name||"",customerPhone:ev.customer.phone||"",customerEmail:ev.customer.email||"",customerAddress:ev.customer.address||"",items:ev.cart,subtotal:ev.subtotal,taxPercentage:ev.taxPercentage,taxAmount:ev.taxAmount,discountPercentage:ev.discountPercentage,discountAmount:ev.discountAmount,total:ev.total,paymentMethod:ev.paymentMethod,timestamp:new Date().toISOString(),notes:ev.notes,gstin:ee.gstin,companyName:ee.companyName,companyAddress:ee.companyAddress,companyPhone:ee.companyPhone,companyEmail:ee.companyEmail,billFormat:ed,createdBy:(null==s?void 0:s.id)||"Unknown"},ec[ei[en.id]||ed]||ec.A4),isThermalPrinter:(ec[ei[en.id]||ed]||ec.A4).width<=80}),(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>Y(!0),children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-1"}),"Customer"]}),ev.cart.length>0&&(0,a.jsxs)(i.$,{size:"sm",onClick:()=>W(!0),children:[(0,a.jsx)(S.A,{className:"h-4 w-4 mr-1"}),"Checkout"]})]})]}),(ev.customer.name||ev.customer.phone)&&(0,a.jsx)("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)(C.A,{className:"h-4 w-4 text-blue-600"}),(0,a.jsx)("span",{className:"font-medium",children:ev.customer.name||"Customer"}),ev.customer.phone&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.A,{className:"h-3 w-3 text-gray-500"}),(0,a.jsx)("span",{className:"text-gray-600",children:ev.customer.phone})]})]})})]}),(0,a.jsx)(v,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4",children:ev.cart.length>0?(0,a.jsx)("div",{className:"space-y-3",children:ev.cart.map(e=>(0,a.jsx)(m.Zp,{children:(0,a.jsxs)(m.Wu,{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:e.productName}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:["₹",e.price.toFixed(2)," each"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>ep(e.productId,e.quantity-1),className:"h-8 w-8 p-0",children:(0,a.jsx)(E.A,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"w-8 text-center text-sm font-medium",children:e.quantity}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>ep(e.productId,e.quantity+1),className:"h-8 w-8 p-0",children:(0,a.jsx)(w.A,{className:"h-3 w-3"})}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>ej(e.productId),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50",children:(0,a.jsx)(I.A,{className:"h-3 w-3"})})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Total:"}),(0,a.jsxs)("span",{className:"font-bold",children:["₹",e.total.toFixed(2)]})]})]})},e.productId))}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(P.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"Cart is empty"}),(0,a.jsx)("p",{className:"text-sm",children:"Add products from the left panel"})]})})}),ev.cart.length>0?(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(d.J,{className:"text-sm",children:"Discount %:"}),(0,a.jsx)(o.p,{type:"number",value:ev.discountPercentage,onChange:e=>(e=>{let t=eu();if(!t)return;let s=Math.max(0,Math.min(100,e)),a=t.subtotal*s/100,n=t.subtotal-a,l=n*t.taxPercentage/100;ex(L,{discountPercentage:s,discountAmount:a,taxAmount:l,total:n+l})})(Number(e.target.value)),className:"w-20 h-8",min:"0",max:"100"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["(-₹",ev.discountAmount.toFixed(2),")"]})]}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{children:["₹",ev.subtotal.toFixed(2)]})]}),ev.discountAmount>0&&(0,a.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,a.jsx)("span",{children:"Discount:"}),(0,a.jsxs)("span",{children:["-₹",ev.discountAmount.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Tax (",ev.taxPercentage,"%):"]}),(0,a.jsxs)("span",{children:["₹",ev.taxAmount.toFixed(2)]})]}),(0,a.jsx)(j.w,{}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"₹"}),(0,a.jsx)(o.p,{type:"number",value:ev.total.toFixed(2),onChange:e=>(e=>{let t=eu();if(!t||0===t.subtotal)return;let s=Math.max(0,t.subtotal+t.taxAmount-e),a=t.subtotal>0?s/t.subtotal*100:0;ex(L,{total:e,discountAmount:s,discountPercentage:a})})(Number(e.target.value)),className:"w-24 h-8 text-right font-bold",step:"0.01"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{className:"text-sm",children:"Notes:"}),(0,a.jsx)(x.T,{value:ev.notes,onChange:e=>ex(L,{notes:e.target.value}),placeholder:"Add notes for this bill...",className:"mt-1 h-16 text-sm"})]})]})}):(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Recent Bills"}),(0,a.jsx)(v,{className:"h-64",children:(0,a.jsx)("div",{className:"space-y-2",children:eN.map(e=>(0,a.jsx)(m.Zp,{children:(0,a.jsxs)(m.Wu,{className:"p-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"font-medium",children:e.id}),(0,a.jsxs)("span",{className:"font-bold",children:["₹",e.total.toFixed(2)]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:new Date(e.timestamp).toLocaleString()})]})},e.id))})})]})]})]}),(0,a.jsx)(u.lG,{open:Z,onOpenChange:Y,children:(0,a.jsxs)(u.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(u.c7,{children:[(0,a.jsxs)(u.L3,{className:"flex items-center",children:[(0,a.jsx)(C.A,{className:"h-5 w-5 mr-2"}),"Customer Information"]}),(0,a.jsx)(u.rr,{children:"Add customer details for this bill"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"customerName",children:"Name"}),(0,a.jsx)(o.p,{id:"customerName",defaultValue:(null==ev?void 0:ev.customer.name)||"",placeholder:"Customer name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"customerPhone",children:"Phone"}),(0,a.jsx)(o.p,{id:"customerPhone",defaultValue:(null==ev?void 0:ev.customer.phone)||"",placeholder:"Phone number"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"customerEmail",children:"Email"}),(0,a.jsx)(o.p,{id:"customerEmail",defaultValue:(null==ev?void 0:ev.customer.email)||"",placeholder:"Email address"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"customerAddress",children:"Address"}),(0,a.jsx)(x.T,{id:"customerAddress",defaultValue:(null==ev?void 0:ev.customer.address)||"",placeholder:"Customer address",className:"h-20"})]})]}),(0,a.jsxs)(u.Es,{children:[(0,a.jsx)(i.$,{variant:"outline",onClick:()=>Y(!1),children:"Cancel"}),(0,a.jsx)(i.$,{onClick:()=>{var e,t,s,a,n;let l=null==(e=document.getElementById("customerName"))?void 0:e.value,c=null==(t=document.getElementById("customerPhone"))?void 0:t.value;n={name:l,phone:c,email:null==(s=document.getElementById("customerEmail"))?void 0:s.value,address:null==(a=document.getElementById("customerAddress"))?void 0:a.value},eu()&&(ex(L,{customer:n}),Y(!1))},children:"Save Customer"})]})]})}),(0,a.jsx)(u.lG,{open:G,onOpenChange:W,children:(0,a.jsxs)(u.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(u.c7,{children:[(0,a.jsxs)(u.L3,{className:"flex items-center",children:[(0,a.jsx)(k.A,{className:"h-5 w-5 mr-2"}),"Process Payment"]}),(0,a.jsx)(u.rr,{children:"Complete the transaction and select bill format"})]}),ev&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{className:"text-sm font-medium",children:"Bill Format"}),(0,a.jsxs)(p.l6,{value:ed,onValueChange:em,children:[(0,a.jsx)(p.bq,{className:"mt-1",children:(0,a.jsx)(p.yv,{})}),(0,a.jsx)(p.gC,{children:Object.entries(ec).map(e=>{let[t,s]=e;return(0,a.jsxs)(p.eb,{value:t,children:[t.replace("_"," ")," (",s.width,"\xd7","auto"===s.height?"Auto":s.height,"mm)"]},t)})})]})]}),(0,a.jsx)(m.Zp,{children:(0,a.jsx)(m.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Items:"}),(0,a.jsxs)("span",{children:[ev.cart.length," (",ev.cart.reduce((e,t)=>e+t.quantity,0)," qty)"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{children:["₹",ev.subtotal.toFixed(2)]})]}),ev.discountAmount>0&&(0,a.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,a.jsxs)("span",{children:["Discount (",ev.discountPercentage.toFixed(1),"%):"]}),(0,a.jsxs)("span",{children:["-₹",ev.discountAmount.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Tax (",ev.taxPercentage,"%):"]}),(0,a.jsxs)("span",{children:["₹",ev.taxAmount.toFixed(2)]})]}),(0,a.jsx)(j.w,{}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("span",{children:["₹",ev.total.toFixed(2)]})]})]})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{className:"text-sm font-medium",children:"Payment Method"}),(0,a.jsxs)(p.l6,{value:ev.paymentMethod,onValueChange:e=>ex(L,{paymentMethod:e}),children:[(0,a.jsx)(p.bq,{className:"mt-1",children:(0,a.jsx)(p.yv,{})}),(0,a.jsxs)(p.gC,{children:[(0,a.jsx)(p.eb,{value:"cash",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Cash"]})}),(0,a.jsx)(p.eb,{value:"card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Card"]})}),(0,a.jsx)(p.eb,{value:"upi",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(D.A,{className:"h-4 w-4 mr-2"}),"UPI"]})})]})]})]}),en&&(0,a.jsx)(m.Zp,{children:(0,a.jsx)(m.Wu,{className:"p-3",children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{className:"font-medium",children:["Store: ",en.name]}),(0,a.jsx)("div",{className:"text-gray-600 mt-1",children:en.address}),en.phone&&(0,a.jsxs)("div",{className:"text-gray-600",children:["Phone: ",en.phone]}),(0,a.jsxs)("div",{className:"text-gray-600",children:["GSTIN: ",ee.gstin]}),(0,a.jsxs)("div",{className:"text-gray-600",children:["Tax Rate: ",ee.taxPercentage,"%"]})]})})}),(ev.customer.name||ev.customer.phone)&&(0,a.jsx)(m.Zp,{children:(0,a.jsx)(m.Wu,{className:"p-3",children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{className:"font-medium flex items-center",children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Customer Details"]}),(0,a.jsxs)("div",{className:"mt-2 space-y-1 text-gray-600",children:[ev.customer.name&&(0,a.jsxs)("div",{children:["Name: ",ev.customer.name]}),ev.customer.phone&&(0,a.jsxs)("div",{children:["Phone: ",ev.customer.phone]}),ev.customer.email&&(0,a.jsxs)("div",{children:["Email: ",ev.customer.email]})]})]})})})]}),(0,a.jsxs)(u.Es,{children:[(0,a.jsx)(i.$,{variant:"outline",onClick:()=>W(!1),children:"Cancel"}),(0,a.jsxs)(i.$,{onClick:eg,className:"bg-green-600 hover:bg-green-700",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Complete Payment"]})]})]})}),(0,a.jsx)(u.lG,{open:H,onOpenChange:K,children:(0,a.jsxs)(u.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(u.c7,{children:[(0,a.jsxs)(u.L3,{className:"flex items-center",children:[(0,a.jsx)(O.A,{className:"h-5 w-5 mr-2 text-orange-500"}),"Unsaved Changes"]}),(0,a.jsx)(u.rr,{children:"This tab has unsaved changes. Are you sure you want to close it?"})]}),(0,a.jsxs)(u.Es,{children:[(0,a.jsx)(i.$,{variant:"outline",onClick:()=>K(!1),children:"Cancel"}),(0,a.jsx)(i.$,{variant:"destructive",onClick:()=>{if(1===B.length)eh(Q);else{let e=B.filter(e=>e.id!==Q);if(q(e),L===Q){let t=B.findIndex(e=>e.id===Q);$((e[t]||e[t-1]||e[0]).id)}}K(!1),X("")},children:"Close Tab"})]})]})})]})})}},67001:(e,t,s)=>{"use strict";s.d(t,{T:()=>c});var a=s(95155),n=s(12115),l=s(25016);let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});c.displayName="Textarea"},70068:(e,t,s)=>{Promise.resolve().then(s.bind(s,42928))}},e=>{e.O(0,[666,530,143,410,886,747,441,255,358],()=>e(e.s=70068)),_N_E=e.O()}]);