(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{19263:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>H});var n=s(95155),a=s(12115),r=s(20063),l=s(1026),c=s(27702),i=s(97003),o=s(33789),d=s(90235),m=s(83209),h=s(67812),u=s(67001),x=s(54679),p=s(47507),g=s(54664),f=s(59034),j=s(25016);let v=a.forwardRef((e,t)=>{let{className:s,children:a,...r}=e;return(0,n.jsxs)(f.bL,{ref:t,className:(0,j.cn)("relative overflow-hidden",s),...r,children:[(0,n.jsx)(f.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,n.jsx)(b,{}),(0,n.jsx)(f.OK,{})]})});v.displayName=f.bL.displayName;let b=a.forwardRef((e,t)=>{let{className:s,orientation:a="vertical",...r}=e;return(0,n.jsx)(f.VM,{ref:t,orientation:a,className:(0,j.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...r,children:(0,n.jsx)(f.lr,{className:"relative flex-1 rounded-full bg-border"})})});b.displayName=f.VM.displayName;var y=s(89715),N=s(65229),w=s(6191),A=s(86651),P=s(10512),C=s(20508),S=s(53409),T=s(69141),E=s(7125),k=s(71360),I=s(78519),F=s(35597),O=s(52508),_=s(6132),D=s(68267);async function M(e){let t=window.open("","_blank");if(t)t.document.write(e),t.document.close(),t.focus(),t.print(),console.log("Print dialog triggered successfully in browser. User needs to close the window manually.");else throw console.error("Failed to open new window for printing."),Error("Failed to open new window for printing.")}async function U(e,t){if(!t)throw console.warn("Attempted to print thermal label to a non-thermal printer."),Error("Not a thermal printer.");try{await (0,D.lA)("print_thermal_document",{content:e}),console.log("Thermal label content sent to printer successfully.")}catch(e){throw console.error("Failed to print thermal label:",e),e}}async function B(e){let{htmlContent:t,thermalContent:s,isThermalPrinter:n=!1,productIds:a,copies:r=1,useBackendPrint:l=!1}=e,c=!!window.__TAURI__;if(l&&a&&a.length>0)try{let e=await fetch("".concat("http://127.0.0.1:8080","/api/print-label"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productIds:a,copies:r})}),t=await e.json();if("success"===t.status)console.log("Print job sent to backend successfully:",t.message),alert("Print job sent successfully");else throw console.error("Backend print failed:",t.message),alert("Print failed: ".concat(t.message)),Error("Backend print failed: ".concat(t.message))}catch(t){console.error("Error calling backend print API:",t);let e=t instanceof Error?t.message:String(t);throw alert("Error sending print job: ".concat(e)),Error("Error sending print job: ".concat(e))}else if(n&&s)if(c)await U(s,!0);else throw console.warn("Thermal printing is only supported in Tauri desktop application."),Error("Thermal printing not available in web environment.");else if(t)if(c)try{await (0,D.lA)("print_html_document",{html_content:t}),console.log("HTML content sent to backend for preparation. Triggering browser print."),await M(t)}catch(e){console.error("Failed to prepare HTML content via custom Tauri command, falling back to direct browser print:",e),await M(t)}else await M(t);else throw Error("No printable content provided.")}let q=0,$=new Map,J=e=>{if($.has(e))return;let t=setTimeout(()=>{$.delete(e),z({type:"REMOVE_TOAST",toastId:e})},1e6);$.set(e,t)},L=[],V={toasts:[]};function z(e){V=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?J(s):e.toasts.forEach(e=>{J(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(V,e),L.forEach(e=>{e(V)})}function R(e){let{...t}=e,s=(q=(q+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>z({type:"DISMISS_TOAST",toastId:s});return z({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||n()}}}),{id:s,dismiss:n,update:e=>z({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function G(e){let{htmlContent:t,thermalContent:s,isThermalPrinter:r=!1,onPrintSuccess:l,onPrintError:c}=e,[o,d]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),{toast:u}=function(){let[e,t]=a.useState(V);return a.useEffect(()=>(L.push(t),()=>{let e=L.indexOf(t);e>-1&&L.splice(e,1)}),[e]),{...e,toast:R,dismiss:e=>z({type:"DISMISS_TOAST",toastId:e})}}(),x=async()=>{if(console.log("PrintButton: handlePrint called."),console.log("PrintButton: htmlContent =",t?"present":"absent"),console.log("PrintButton: thermalContent =",s?"present":"absent"),console.log("PrintButton: isThermalPrinter =",r),!t&&!s)return void u({title:"No Content to Print",description:"Please provide HTML or thermal content to print.",variant:"destructive"});h(!0);try{await B({htmlContent:t,thermalContent:s,isThermalPrinter:r}),u({title:"Print Job Sent",description:"Your document has been sent to the printer."}),null==l||l()}catch(e){u({title:"Printing Failed",description:e.message||"An unknown error occurred while sending the print job.",variant:"destructive"}),null==c||c(e)}finally{h(!1)}};return(0,n.jsx)(i.$,{onClick:x,disabled:m||!t&&!s,children:m?"Printing...":"Print Document"})}var W=s(15571);let Z=e=>fetch(e).then(e=>e.json());function H(){let e=(0,r.useRouter)(),{data:t=[]}=(0,l.Ay)("http://127.0.0.1:8080/api/products",Z),[s,f]=(0,a.useState)(null),[j,b]=(0,a.useState)(""),[D,M]=(0,a.useState)([]),[U,B]=(0,a.useState)([]),[q,$]=(0,a.useState)(""),[J,L]=(0,a.useState)([]),[V,z]=(0,a.useState)(!1),[R,H]=(0,a.useState)(!1),[Y,K]=(0,a.useState)(!1),[Q,X]=(0,a.useState)(""),[ee,et]=(0,a.useState)({gstin:"",taxPercentage:0,companyName:"",companyAddress:"",companyPhone:"",companyEmail:""}),[es,en]=(0,a.useState)([]),[ea,er]=(0,a.useState)(null),[el,ec]=(0,a.useState)({}),[ei,eo]=(0,a.useState)({}),[ed,em]=(0,a.useState)("A4");(0,a.useEffect)(()=>{let t=localStorage.getItem("adminUser");if(!t)return void e.push("/");let s=JSON.parse(t);f(s),fetch("http://127.0.0.1:8080/api/settings").then(e=>e.json()).then(e=>{e.systemSettings&&et(e.systemSettings),e.billFormats&&ec(e.billFormats),e.storeFormats&&eo(e.storeFormats)}),fetch("http://127.0.0.1:8080/api/bills").then(t=>{if(401===t.status)return e.push("/"),null;if(!t.ok)throw Error("Failed to fetch bills");return t.json()}).then(e=>{e&&L(e.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()))}).catch(e=>{console.error("Failed to load bills:",e)}),fetch("http://127.0.0.1:8080/api/stores").then(e=>e.json()).then(e=>{let t=e.filter(e=>"active"===e.status);if(en(t),"billing_user"===s.role&&s.assignedStores){let e=t.filter(e=>{var t;return null==(t=s.assignedStores)?void 0:t.includes(e.id)});e.length>0&&er(e[0])}else t.length>0&&er(t[0])})},[e]),(0,a.useEffect)(()=>{if(!Array.isArray(t))return void M([]);j?M(t.filter(e=>e.name.toLowerCase().includes(j.toLowerCase())||e.barcodes&&e.barcodes.some(e=>e.includes(j)))):M(t.slice(0,20))},[j,t]),(0,a.useEffect)(()=>{ee.taxPercentage>0&&B(e=>0!==e.length&&e.some(e=>e.taxPercentage!==ee.taxPercentage)?e.map(e=>{if(e.taxPercentage!==ee.taxPercentage){let t=e.subtotal,s=t*e.discountPercentage/100,n=t-s,a=n*ee.taxPercentage/100;return{...e,taxPercentage:ee.taxPercentage,taxAmount:a,total:n+a}}return e}):e)},[ee.taxPercentage]),(0,a.useEffect)(()=>{if(0===U.length&&ee.companyName){let e={id:"tab-1",name:"Bill #1",cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxPercentage:ee.taxPercentage,taxAmount:0,total:0,paymentMethod:"cash",notes:"",hasUnsavedChanges:!1};B([e]),$(e.id)}},[U.length,ee]);let eh=e=>{B(U.map(t=>t.id===e?{...t,cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxAmount:0,total:0,notes:"",hasUnsavedChanges:!1}:t))},eu=(e,t)=>{B(U.map(s=>s.id===e?{...s,...t,hasUnsavedChanges:!0}:s))},ex=()=>U.find(e=>e.id===q),ep=(e,s)=>{let n=ex();if(!n)return;if(s<=0)return void eg(e);let a=t.find(t=>t.id===e);if(a&&s>a.stock)return void alert("Cannot exceed available stock: ".concat(a.stock));let r=n.cart.map(t=>t.productId===e?{...t,quantity:s,total:s*t.price}:t),l=r.reduce((e,t)=>e+t.total,0),c=l*n.discountPercentage/100,i=l-c,o=i*n.taxPercentage/100;eu(q,{cart:r,subtotal:l,discountAmount:c,taxAmount:o,total:i+o})},eg=e=>{let t=ex();if(!t)return;let s=t.cart.filter(t=>t.productId!==e),n=s.reduce((e,t)=>e+t.total,0),a=n*t.discountPercentage/100,r=n-a,l=r*t.taxPercentage/100;eu(q,{cart:s,subtotal:n,discountAmount:a,taxAmount:l,total:r+l})},ef=async()=>{let e=ex();if(!e||0===e.cart.length||!ea)return;let n=ei[ea.id]||ed,a=el[n]||el.A4,r={id:"INV-".concat(Date.now()),storeId:ea.id,storeName:ea.name,storeAddress:ea.address,storePhone:ea.phone,customerName:e.customer.name||"",customerPhone:e.customer.phone||"",customerEmail:e.customer.email||"",customerAddress:e.customer.address||"",items:e.cart,subtotal:e.subtotal,taxPercentage:e.taxPercentage,taxAmount:e.taxAmount,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount,total:e.total,paymentMethod:e.paymentMethod,timestamp:new Date().toISOString(),notes:e.notes,gstin:ee.gstin,companyName:ee.companyName,companyAddress:ee.companyAddress,companyPhone:ee.companyPhone,companyEmail:ee.companyEmail,billFormat:n,createdBy:(null==s?void 0:s.id)||"Unknown"};try{await fetch("http://127.0.0.1:8080/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(e){console.error("Failed to save bill:",e)}for(let s of e.cart){let e=t.find(e=>e.id===s.productId);if(e){let t=e.stock-s.quantity;try{await fetch("http://127.0.0.1:8080"+"/api/products/".concat(s.productId),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({stock:t})})}catch(e){console.error("Failed to update stock for product ".concat(s.productId,":"),e)}}}let l=ej(r,a);try{await (0,W.H)(l)}catch(e){console.error("Failed to send print job:",e)}eh(q),z(!1)},ej=(e,t)=>{let s=216===t.width&&279===t.height,n=210===t.width&&297===t.height,a=t.width<=80?"80mm":s?"216mm":n?"210mm":"".concat(t.width,"mm");return"\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Invoice - ".concat(e.id,"</title>\n          <style>\n            @page {\n              size: ").concat(s?"letter":n?"A4":"".concat(t.width,"mm ").concat("auto"===t.height?"auto":"".concat(t.height,"mm")),";\n              margin: ").concat(t.margins.top,"mm ").concat(t.margins.right,"mm ").concat(t.margins.bottom,"mm ").concat(t.margins.left,"mm;\n            }\n            body {\n              font-family: 'Arial', sans-serif;\n              max-width: ").concat(a,';\n              margin: 0 auto;\n              font-size: 13px;\n              color: #000;\n            }\n            .header, .footer {\n              text-align: center;\n              padding: 10px 0;\n            }\n            .company-name {\n              font-size: 18px;\n              font-weight: bold;\n              text-transform: uppercase;\n            }\n            .invoice-title {\n              font-size: 16px;\n              font-weight: bold;\n              margin-top: 10px;\n            }\n            .section {\n              margin: 20px 0;\n            }\n            .section-title {\n              font-weight: bold;\n              border-bottom: 1px solid #ccc;\n              margin-bottom: 5px;\n            }\n            .row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 6px;\n            }\n            .items-table {\n              width: 100%;\n              border-collapse: collapse;\n              margin-top: 15px;\n            }\n            .items-table th, .items-table td {\n              border: 1px solid #ccc;\n              padding: 6px 8px;\n              text-align: left;\n            }\n            .items-table th {\n              background-color: #f2f2f2;\n            }\n            .totals {\n              margin-top: 10px;\n              width: 100%;\n            }\n            .totals td {\n              padding: 6px;\n            }\n            .totals .label {\n              text-align: right;\n              font-weight: bold;\n            }\n            .totals .value {\n              text-align: right;\n              width: 100px;\n            }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <div class="company-name">').concat(e.companyName,"</div>\n            <div>").concat(e.companyAddress,"</div>\n            <div>Phone: ").concat(e.companyPhone,"</div>\n            <div>Email: ").concat(e.companyEmail,'</div>\n            <div class="invoice-title">INVOICE</div>\n          </div>\n\n          <div class="section">\n            <div class="row">\n              <div><strong>Invoice ID:</strong> ').concat(e.id,"</div>\n              <div><strong>Date:</strong> ").concat(new Date(e.timestamp).toLocaleString(),"</div>\n            </div>\n            ").concat(e.gstin?"<div><strong>GSTIN:</strong> ".concat(e.gstin,"</div>"):"","\n          </div>\n\n          ").concat(e.customerName||e.customerPhone?'\n          <div class="section">\n            <div class="section-title">Customer Details</div>\n            '.concat(e.customerName?"<div>Name: ".concat(e.customerName,"</div>"):"","\n            ").concat(e.customerPhone?"<div>Phone: ".concat(e.customerPhone,"</div>"):"","\n            ").concat(e.customerEmail?"<div>Email: ".concat(e.customerEmail,"</div>"):"","\n            ").concat(e.customerAddress?"<div>Address: ".concat(e.customerAddress,"</div>"):"","\n          </div>"):"",'\n\n          <div class="section">\n            <table class="items-table">\n              <thead>\n                <tr>\n                  <th>#</th>\n                  <th>Item</th>\n                  <th>Qty</th>\n                  <th>Rate</th>\n                  <th>Total</th>\n                </tr>\n              </thead>\n              <tbody>\n                ').concat(e.items.map((e,t)=>"\n                  <tr>\n                    <td>".concat(t+1,"</td>\n                    <td>").concat(e.productName,"</td>\n                    <td>").concat(e.quantity,"</td>\n                    <td>₹").concat(e.price.toFixed(2),"</td>\n                    <td>₹").concat(e.total.toFixed(2),"</td>\n                  </tr>\n                ")).join(""),'\n              </tbody>\n            </table>\n          </div>\n\n          <div class="section">\n            <table class="totals">\n              <tr>\n                <td class="label">Subtotal:</td>\n                <td class="value">₹').concat(e.subtotal.toFixed(2),"</td>\n              </tr>\n              ").concat(e.discountAmount>0?'<tr>\n                      <td class="label">Discount ('.concat(e.discountPercentage.toFixed(1),'%):</td>\n                      <td class="value">-₹').concat(e.discountAmount.toFixed(2),"</td>\n                    </tr>"):"",'\n              <tr>\n                <td class="label">Tax (').concat(e.taxPercentage,'%):</td>\n                <td class="value">₹').concat(e.taxAmount.toFixed(2),'</td>\n              </tr>\n              <tr>\n                <td class="label">Total:</td>\n                <td class="value"><strong>₹').concat(e.total.toFixed(2),'</strong></td>\n              </tr>\n              <tr>\n                <td class="label">Payment:</td>\n                <td class="value">').concat(e.paymentMethod.toUpperCase(),"</td>\n              </tr>\n            </table>\n          </div>\n\n          ").concat(e.notes?'<div class="section">\n                  <div class="section-title">Notes</div>\n                  <div>'.concat(e.notes,"</div>\n                </div>"):"",'\n\n          <div class="footer">\n            <p>Thank you for your business!</p>\n          </div>\n        </body>\n      </html>\n    ')},ev=ex(),eb=(0,a.useMemo)(()=>J.slice(0,10),[J]);return(0,n.jsx)(c.A,{children:(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center bg-gray-100 border-b border-gray-200 px-2 py-1",children:[(0,n.jsx)("div",{className:"flex items-center space-x-1 flex-1 overflow-x-auto",children:U.map(e=>(0,n.jsxs)("div",{className:"\n                  relative flex items-center px-4 py-2 min-w-0 max-w-48 cursor-pointer group\n                  ".concat(q===e.id?"bg-white border-t-2 border-blue-500 text-blue-600":"bg-gray-200 hover:bg-gray-300 text-gray-700","\n                  rounded-t-lg border-l border-r border-gray-300 mr-1\n                  transition-all duration-200\n                "),style:{clipPath:q===e.id?"polygon(8px 100%, 0 0, calc(100% - 8px) 0, 100% 100%)":"polygon(4px 100%, 0 0, calc(100% - 4px) 0, 100% 100%)"},onClick:()=>$(e.id),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[(0,n.jsx)(y.A,{className:"h-4 w-4 flex-shrink-0"}),(0,n.jsx)("span",{className:"truncate text-sm font-medium",children:e.name}),e.cart.length>0&&(0,n.jsx)(h.E,{variant:"secondary",className:"h-5 text-xs",children:e.cart.length}),e.hasUnsavedChanges&&(0,n.jsx)("div",{className:"h-2 w-2 bg-orange-500 rounded-full flex-shrink-0",title:"Unsaved changes"})]}),U.length>1&&(0,n.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 ml-2 opacity-0 group-hover:opacity-100 hover:bg-red-100 hover:text-red-600 flex-shrink-0",onClick:t=>{t.stopPropagation(),(e=>{let t=U.find(t=>t.id===e);if(null==t?void 0:t.hasUnsavedChanges){X(e),K(!0);return}if(1===U.length)return eh(e);let s=U.filter(t=>t.id!==e);if(B(s),q===e){let t=U.findIndex(t=>t.id===e);$((s[t]||s[t-1]||s[0]).id)}})(e.id)},children:(0,n.jsx)(N.A,{className:"h-3 w-3"})})]},e.id))}),(0,n.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>{let e=U.length+1,t={id:"tab-".concat(Date.now()),name:"Bill #".concat(e),cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxPercentage:ee.taxPercentage,taxAmount:0,total:0,paymentMethod:"cash",notes:"",hasUnsavedChanges:!1};B([...U,t]),$(t.id)},className:"ml-2 h-8 w-8 p-0 bg-gray-200 hover:bg-gray-300 rounded-full",title:"New Tab",children:(0,n.jsx)(w.A,{className:"h-4 w-4"})})]}),ev&&(0,n.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,n.jsxs)("div",{className:"w-1/2 border-r border-gray-200 flex flex-col",children:[(0,n.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(A.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,n.jsx)(o.p,{placeholder:"Search products by name or barcode...",value:j,onChange:e=>b(e.target.value),className:"pl-10"})]})}),(0,n.jsx)(v,{className:"flex-1",children:(0,n.jsxs)("div",{className:"p-4 space-y-2",children:[D.map(e=>(0,n.jsx)(m.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>(e=>{let t,s=ex();if(!s)return;if(e.stock<=0)return void alert("Product is out of stock");let n=s.cart.find(t=>t.productId===e.id);if(n){if(n.quantity>=e.stock)return void alert("Cannot add more. Maximum available: ".concat(e.stock));t=s.cart.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1,total:(t.quantity+1)*t.price}:t)}else t=[...s.cart,{productId:e.id,productName:e.name,quantity:1,price:e.price,total:e.price}];let a=t.reduce((e,t)=>e+t.total,0),r=a*s.discountPercentage/100,l=a-r,c=l*s.taxPercentage/100;eu(q,{cart:t,subtotal:a,discountAmount:r,taxAmount:c,total:l+c})})(e),children:(0,n.jsx)(m.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"font-medium text-sm",children:e.name}),e.barcodes&&e.barcodes.length>0&&(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Barcode: ",e.barcodes[0]]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsxs)("p",{className:"font-bold text-green-600",children:["₹",e.price.toFixed(2)]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["Stock: ",e.stock]})]})]})})},e.id)),0===D.length&&(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,n.jsx)(A.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,n.jsx)("p",{children:"No products found"}),(0,n.jsx)("p",{className:"text-sm",children:"Try adjusting your search terms"})]})]})})]}),(0,n.jsxs)("div",{className:"w-1/2 flex flex-col",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("h2",{className:"text-lg font-semibold flex items-center",children:[(0,n.jsx)(P.A,{className:"h-5 w-5 mr-2"}),ev.name]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[ev&&ea&&el&&(0,n.jsx)(G,{htmlContent:ej({id:"INV-".concat(Date.now()),storeId:ea.id,storeName:ea.name,storeAddress:ea.address,storePhone:ea.phone,customerName:ev.customer.name||"",customerPhone:ev.customer.phone||"",customerEmail:ev.customer.email||"",customerAddress:ev.customer.address||"",items:ev.cart,subtotal:ev.subtotal,taxPercentage:ev.taxPercentage,taxAmount:ev.taxAmount,discountPercentage:ev.discountPercentage,discountAmount:ev.discountAmount,total:ev.total,paymentMethod:ev.paymentMethod,timestamp:new Date().toISOString(),notes:ev.notes,gstin:ee.gstin,companyName:ee.companyName,companyAddress:ee.companyAddress,companyPhone:ee.companyPhone,companyEmail:ee.companyEmail,billFormat:ed,createdBy:(null==s?void 0:s.id)||"Unknown"},el[ei[ea.id]||ed]||el.A4),isThermalPrinter:(el[ei[ea.id]||ed]||el.A4).width<=80}),(0,n.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>H(!0),children:[(0,n.jsx)(C.A,{className:"h-4 w-4 mr-1"}),"Customer"]}),ev.cart.length>0&&(0,n.jsxs)(i.$,{size:"sm",onClick:()=>z(!0),children:[(0,n.jsx)(S.A,{className:"h-4 w-4 mr-1"}),"Checkout"]})]})]}),(ev.customer.name||ev.customer.phone)&&(0,n.jsx)("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,n.jsx)(C.A,{className:"h-4 w-4 text-blue-600"}),(0,n.jsx)("span",{className:"font-medium",children:ev.customer.name||"Customer"}),ev.customer.phone&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.A,{className:"h-3 w-3 text-gray-500"}),(0,n.jsx)("span",{className:"text-gray-600",children:ev.customer.phone})]})]})})]}),(0,n.jsx)(v,{className:"flex-1",children:(0,n.jsx)("div",{className:"p-4",children:ev.cart.length>0?(0,n.jsx)("div",{className:"space-y-3",children:ev.cart.map(e=>(0,n.jsx)(m.Zp,{children:(0,n.jsxs)(m.Wu,{className:"p-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h4",{className:"font-medium text-sm",children:e.productName}),(0,n.jsxs)("p",{className:"text-xs text-gray-600",children:["₹",e.price.toFixed(2)," each"]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>ep(e.productId,e.quantity-1),className:"h-8 w-8 p-0",children:(0,n.jsx)(E.A,{className:"h-3 w-3"})}),(0,n.jsx)("span",{className:"w-8 text-center text-sm font-medium",children:e.quantity}),(0,n.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>ep(e.productId,e.quantity+1),className:"h-8 w-8 p-0",children:(0,n.jsx)(w.A,{className:"h-3 w-3"})}),(0,n.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>eg(e.productId),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50",children:(0,n.jsx)(k.A,{className:"h-3 w-3"})})]})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"Total:"}),(0,n.jsxs)("span",{className:"font-bold",children:["₹",e.total.toFixed(2)]})]})]})},e.productId))}):(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,n.jsx)(P.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,n.jsx)("p",{children:"Cart is empty"}),(0,n.jsx)("p",{className:"text-sm",children:"Add products from the left panel"})]})})}),ev.cart.length>0?(0,n.jsx)("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(d.J,{className:"text-sm",children:"Discount %:"}),(0,n.jsx)(o.p,{type:"number",value:ev.discountPercentage,onChange:e=>(e=>{let t=ex();if(!t)return;let s=Math.max(0,Math.min(100,e)),n=t.subtotal*s/100,a=t.subtotal-n,r=a*t.taxPercentage/100;eu(q,{discountPercentage:s,discountAmount:n,taxAmount:r,total:a+r})})(Number(e.target.value)),className:"w-20 h-8",min:"0",max:"100"}),(0,n.jsxs)("span",{className:"text-sm text-gray-600",children:["(-₹",ev.discountAmount.toFixed(2),")"]})]}),(0,n.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Subtotal:"}),(0,n.jsxs)("span",{children:["₹",ev.subtotal.toFixed(2)]})]}),ev.discountAmount>0&&(0,n.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,n.jsx)("span",{children:"Discount:"}),(0,n.jsxs)("span",{children:["-₹",ev.discountAmount.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{children:["Tax (",ev.taxPercentage,"%):"]}),(0,n.jsxs)("span",{children:["₹",ev.taxAmount.toFixed(2)]})]}),(0,n.jsx)(g.w,{}),(0,n.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,n.jsx)("span",{children:"Total:"}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{children:"₹"}),(0,n.jsx)(o.p,{type:"number",value:ev.total.toFixed(2),onChange:e=>(e=>{let t=ex();if(!t||0===t.subtotal)return;let s=Math.max(0,t.subtotal+t.taxAmount-e),n=t.subtotal>0?s/t.subtotal*100:0;eu(q,{total:e,discountAmount:s,discountPercentage:n})})(Number(e.target.value)),className:"w-24 h-8 text-right font-bold",step:"0.01"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{className:"text-sm",children:"Notes:"}),(0,n.jsx)(u.T,{value:ev.notes,onChange:e=>eu(q,{notes:e.target.value}),placeholder:"Add notes for this bill...",className:"mt-1 h-16 text-sm"})]})]})}):(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("h3",{className:"font-semibold mb-2",children:"Recent Bills"}),(0,n.jsx)(v,{className:"h-64",children:(0,n.jsx)("div",{className:"space-y-2",children:eb.map(e=>(0,n.jsx)(m.Zp,{children:(0,n.jsxs)(m.Wu,{className:"p-3 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"font-medium",children:e.id}),(0,n.jsxs)("span",{className:"font-bold",children:["₹",e.total.toFixed(2)]})]}),(0,n.jsx)("div",{className:"text-xs text-gray-600",children:new Date(e.timestamp).toLocaleString()})]})},e.id))})})]})]})]}),(0,n.jsx)(x.lG,{open:R,onOpenChange:H,children:(0,n.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,n.jsxs)(x.c7,{children:[(0,n.jsxs)(x.L3,{className:"flex items-center",children:[(0,n.jsx)(C.A,{className:"h-5 w-5 mr-2"}),"Customer Information"]}),(0,n.jsx)(x.rr,{children:"Add customer details for this bill"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"customerName",children:"Name"}),(0,n.jsx)(o.p,{id:"customerName",defaultValue:(null==ev?void 0:ev.customer.name)||"",placeholder:"Customer name"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"customerPhone",children:"Phone"}),(0,n.jsx)(o.p,{id:"customerPhone",defaultValue:(null==ev?void 0:ev.customer.phone)||"",placeholder:"Phone number"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"customerEmail",children:"Email"}),(0,n.jsx)(o.p,{id:"customerEmail",defaultValue:(null==ev?void 0:ev.customer.email)||"",placeholder:"Email address"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"customerAddress",children:"Address"}),(0,n.jsx)(u.T,{id:"customerAddress",defaultValue:(null==ev?void 0:ev.customer.address)||"",placeholder:"Customer address",className:"h-20"})]})]}),(0,n.jsxs)(x.Es,{children:[(0,n.jsx)(i.$,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),(0,n.jsx)(i.$,{onClick:()=>{var e,t,s,n,a;let r=null==(e=document.getElementById("customerName"))?void 0:e.value,l=null==(t=document.getElementById("customerPhone"))?void 0:t.value;a={name:r,phone:l,email:null==(s=document.getElementById("customerEmail"))?void 0:s.value,address:null==(n=document.getElementById("customerAddress"))?void 0:n.value},ex()&&(eu(q,{customer:a}),H(!1))},children:"Save Customer"})]})]})}),(0,n.jsx)(x.lG,{open:V,onOpenChange:z,children:(0,n.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,n.jsxs)(x.c7,{children:[(0,n.jsxs)(x.L3,{className:"flex items-center",children:[(0,n.jsx)(I.A,{className:"h-5 w-5 mr-2"}),"Process Payment"]}),(0,n.jsx)(x.rr,{children:"Complete the transaction and select bill format"})]}),ev&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{className:"text-sm font-medium",children:"Bill Format"}),(0,n.jsxs)(p.l6,{value:ed,onValueChange:em,children:[(0,n.jsx)(p.bq,{className:"mt-1",children:(0,n.jsx)(p.yv,{})}),(0,n.jsx)(p.gC,{children:Object.entries(el).map(e=>{let[t,s]=e;return(0,n.jsxs)(p.eb,{value:t,children:[t.replace("_"," ")," (",s.width,"\xd7","auto"===s.height?"Auto":s.height,"mm)"]},t)})})]})]}),(0,n.jsx)(m.Zp,{children:(0,n.jsx)(m.Wu,{className:"p-4",children:(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Items:"}),(0,n.jsxs)("span",{children:[ev.cart.length," (",ev.cart.reduce((e,t)=>e+t.quantity,0)," qty)"]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Subtotal:"}),(0,n.jsxs)("span",{children:["₹",ev.subtotal.toFixed(2)]})]}),ev.discountAmount>0&&(0,n.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,n.jsxs)("span",{children:["Discount (",ev.discountPercentage.toFixed(1),"%):"]}),(0,n.jsxs)("span",{children:["-₹",ev.discountAmount.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{children:["Tax (",ev.taxPercentage,"%):"]}),(0,n.jsxs)("span",{children:["₹",ev.taxAmount.toFixed(2)]})]}),(0,n.jsx)(g.w,{}),(0,n.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,n.jsx)("span",{children:"Total:"}),(0,n.jsxs)("span",{children:["₹",ev.total.toFixed(2)]})]})]})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{className:"text-sm font-medium",children:"Payment Method"}),(0,n.jsxs)(p.l6,{value:ev.paymentMethod,onValueChange:e=>eu(q,{paymentMethod:e}),children:[(0,n.jsx)(p.bq,{className:"mt-1",children:(0,n.jsx)(p.yv,{})}),(0,n.jsxs)(p.gC,{children:[(0,n.jsx)(p.eb,{value:"cash",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Cash"]})}),(0,n.jsx)(p.eb,{value:"card",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Card"]})}),(0,n.jsx)(p.eb,{value:"upi",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(O.A,{className:"h-4 w-4 mr-2"}),"UPI"]})})]})]})]}),ea&&(0,n.jsx)(m.Zp,{children:(0,n.jsx)(m.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsxs)("div",{className:"font-medium",children:["Store: ",ea.name]}),(0,n.jsx)("div",{className:"text-gray-600 mt-1",children:ea.address}),ea.phone&&(0,n.jsxs)("div",{className:"text-gray-600",children:["Phone: ",ea.phone]}),(0,n.jsxs)("div",{className:"text-gray-600",children:["GSTIN: ",ee.gstin]}),(0,n.jsxs)("div",{className:"text-gray-600",children:["Tax Rate: ",ee.taxPercentage,"%"]})]})})}),(ev.customer.name||ev.customer.phone)&&(0,n.jsx)(m.Zp,{children:(0,n.jsx)(m.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsxs)("div",{className:"font-medium flex items-center",children:[(0,n.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Customer Details"]}),(0,n.jsxs)("div",{className:"mt-2 space-y-1 text-gray-600",children:[ev.customer.name&&(0,n.jsxs)("div",{children:["Name: ",ev.customer.name]}),ev.customer.phone&&(0,n.jsxs)("div",{children:["Phone: ",ev.customer.phone]}),ev.customer.email&&(0,n.jsxs)("div",{children:["Email: ",ev.customer.email]})]})]})})})]}),(0,n.jsxs)(x.Es,{children:[(0,n.jsx)(i.$,{variant:"outline",onClick:()=>z(!1),children:"Cancel"}),(0,n.jsxs)(i.$,{onClick:ef,className:"bg-green-600 hover:bg-green-700",children:[(0,n.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Complete Payment"]})]})]})}),(0,n.jsx)(x.lG,{open:Y,onOpenChange:K,children:(0,n.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,n.jsxs)(x.c7,{children:[(0,n.jsxs)(x.L3,{className:"flex items-center",children:[(0,n.jsx)(_.A,{className:"h-5 w-5 mr-2 text-orange-500"}),"Unsaved Changes"]}),(0,n.jsx)(x.rr,{children:"This tab has unsaved changes. Are you sure you want to close it?"})]}),(0,n.jsxs)(x.Es,{children:[(0,n.jsx)(i.$,{variant:"outline",onClick:()=>K(!1),children:"Cancel"}),(0,n.jsx)(i.$,{variant:"destructive",onClick:()=>{if(1===U.length)eh(Q);else{let e=U.filter(e=>e.id!==Q);if(B(e),q===Q){let t=U.findIndex(e=>e.id===Q);$((e[t]||e[t-1]||e[0]).id)}}K(!1),X("")},children:"Close Tab"})]})]})})]})})}},57899:(e,t,s)=>{Promise.resolve().then(s.bind(s,19263))},67001:(e,t,s)=>{"use strict";s.d(t,{T:()=>l});var n=s(95155),a=s(12115),r=s(25016);let l=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...a})});l.displayName="Textarea"}},e=>{e.O(0,[666,530,143,148,312,489,441,255,358],()=>e(e.s=57899)),_N_E=e.O()}]);