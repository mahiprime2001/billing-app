(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7522],{42928:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>W});var n=s(95155),a=s(12115),r=s(20063),l=s(85400),i=s(27702),c=s(97003),o=s(33789),d=s(90235),m=s(83209),u=s(67812),h=s(67001),x=s(54679),p=s(47507),g=s(54664),f=s(59034),j=s(25016);let v=a.forwardRef((e,t)=>{let{className:s,children:a,...r}=e;return(0,n.jsxs)(f.bL,{ref:t,className:(0,j.cn)("relative overflow-hidden",s),...r,children:[(0,n.jsx)(f.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,n.jsx)(b,{}),(0,n.jsx)(f.OK,{})]})});v.displayName=f.bL.displayName;let b=a.forwardRef((e,t)=>{let{className:s,orientation:a="vertical",...r}=e;return(0,n.jsx)(f.VM,{ref:t,orientation:a,className:(0,j.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...r,children:(0,n.jsx)(f.lr,{className:"relative flex-1 rounded-full bg-border"})})});b.displayName=f.VM.displayName;var y=s(89715),N=s(65229),w=s(6191),P=s(86651),A=s(10512),C=s(20508),S=s(53409),T=s(69141),E=s(7125),k=s(71360),$=s(78519),I=s(35597),F=s(52508),_=s(6132),D=s(73609),O=s(76577);let M=0,U=new Map,q=e=>{if(U.has(e))return;let t=setTimeout(()=>{U.delete(e),L({type:"REMOVE_TOAST",toastId:e})},1e6);U.set(e,t)},B=[],J={toasts:[]};function L(e){J=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?q(s):e.toasts.forEach(e=>{q(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(J,e),B.forEach(e=>{e(J)})}function V(e){let{...t}=e,s=(M=(M+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>L({type:"DISMISS_TOAST",toastId:s});return L({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||n()}}}),{id:s,dismiss:n,update:e=>L({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function z(e){let{htmlContent:t,thermalContent:s,isThermalPrinter:r=!1,onPrintSuccess:l,onPrintError:i}=e,[o,d]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),{toast:h}=function(){let[e,t]=a.useState(J);return a.useEffect(()=>(B.push(t),()=>{let e=B.indexOf(t);e>-1&&B.splice(e,1)}),[e]),{...e,toast:V,dismiss:e=>L({type:"DISMISS_TOAST",toastId:e})}}(),x=async()=>{if(console.log("PrintButton: handlePrint called."),console.log("PrintButton: htmlContent =",t?"present":"absent"),console.log("PrintButton: thermalContent =",s?"present":"absent"),console.log("PrintButton: isThermalPrinter =",r),!t&&!s)return void h({title:"No Content to Print",description:"Please provide HTML or thermal content to print.",variant:"destructive"});u(!0);try{await (0,O.G)({htmlContent:t,thermalContent:s,isThermalPrinter:r}),h({title:"Print Job Sent",description:"Your document has been sent to the printer."}),null==l||l()}catch(e){h({title:"Printing Failed",description:e.message||"An unknown error occurred while sending the print job.",variant:"destructive"}),null==i||i(e)}finally{u(!1)}};return(0,n.jsx)(c.$,{onClick:x,disabled:m||!t&&!s,children:m?"Printing...":"Print Document"})}let R=e=>fetch(e).then(e=>e.json());function W(){let e=(0,r.useRouter)(),{data:t=[]}=(0,l.Ay)("http://127.0.0.1:8080/api/products",R),[s,f]=(0,a.useState)(null),[j,b]=(0,a.useState)(""),[M,U]=(0,a.useState)([]),[q,B]=(0,a.useState)([]),[J,L]=(0,a.useState)(""),[V,W]=(0,a.useState)([]),[G,Z]=(0,a.useState)(!1),[Y,H]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(!1),[X,ee]=(0,a.useState)(""),[et,es]=(0,a.useState)({gstin:"",taxPercentage:0,companyName:"",companyAddress:"",companyPhone:"",companyEmail:""}),[en,ea]=(0,a.useState)([]),[er,el]=(0,a.useState)(null),[ei,ec]=(0,a.useState)({}),[eo,ed]=(0,a.useState)({}),[em,eu]=(0,a.useState)("A4");(0,a.useEffect)(()=>{let t=localStorage.getItem("adminUser");if(!t)return void e.push("/");let s=JSON.parse(t);f(s),fetch("http://127.0.0.1:8080/api/settings").then(e=>e.json()).then(e=>{e.systemSettings&&es(e.systemSettings),e.billFormats&&ec(e.billFormats),e.storeFormats&&ed(e.storeFormats)}),fetch("http://127.0.0.1:8080/api/bills").then(t=>{if(401===t.status)return e.push("/"),null;if(!t.ok)throw Error("Failed to fetch bills");return t.json()}).then(e=>{e&&W(e.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()))}).catch(e=>{console.error("Failed to load bills:",e)}),fetch("http://127.0.0.1:8080/api/stores").then(e=>e.json()).then(e=>{let t=e.filter(e=>"active"===e.status);if(ea(t),"billing_user"===s.role&&s.assignedStores){let e=t.filter(e=>{var t;return null==(t=s.assignedStores)?void 0:t.includes(e.id)});e.length>0&&el(e[0])}else t.length>0&&el(t[0])})},[e]),(0,a.useEffect)(()=>{if(!Array.isArray(t))return void U([]);if(j){let e=j.toLowerCase();U(t.filter(t=>{let s=t.name.toLowerCase().includes(e),n=(0,D.n)(t),a=!!n&&n.toLowerCase().includes(e);return s||a}))}else U(t.slice(0,20))},[j,t]),(0,a.useEffect)(()=>{et.taxPercentage>0&&B(e=>0!==e.length&&e.some(e=>e.taxPercentage!==et.taxPercentage)?e.map(e=>{if(e.taxPercentage!==et.taxPercentage){let t=e.subtotal,s=t*e.discountPercentage/100,n=t-s,a=n*et.taxPercentage/100;return{...e,taxPercentage:et.taxPercentage,taxAmount:a,total:n+a}}return e}):e)},[et.taxPercentage]),(0,a.useEffect)(()=>{if(0===q.length&&et.companyName){let e={id:"tab-1",name:"Bill #1",cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxPercentage:et.taxPercentage,taxAmount:0,total:0,paymentMethod:"cash",notes:"",hasUnsavedChanges:!1};B([e]),L(e.id)}},[q.length,et]);let eh=e=>{B(q.map(t=>t.id===e?{...t,cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxAmount:0,total:0,notes:"",hasUnsavedChanges:!1}:t))},ex=(e,t)=>{B(q.map(s=>s.id===e?{...s,...t,hasUnsavedChanges:!0}:s))},ep=()=>q.find(e=>e.id===J),eg=(e,s)=>{let n=ep();if(!n)return;if(s<=0)return void ef(e);let a=t.find(t=>t.id===e);if(a&&s>a.stock)return void alert("Cannot exceed available stock: ".concat(a.stock));let r=n.cart.map(t=>t.productId===e?{...t,quantity:s,total:s*t.price}:t),l=r.reduce((e,t)=>e+t.total,0),i=l*n.discountPercentage/100,c=l-i,o=c*n.taxPercentage/100;ex(J,{cart:r,subtotal:l,discountAmount:i,taxAmount:o,total:c+o})},ef=e=>{let t=ep();if(!t)return;let s=t.cart.filter(t=>t.productId!==e),n=s.reduce((e,t)=>e+t.total,0),a=n*t.discountPercentage/100,r=n-a,l=r*t.taxPercentage/100;ex(J,{cart:s,subtotal:n,discountAmount:a,taxAmount:l,total:r+l})},ej=async()=>{let e=ep();if(!e||0===e.cart.length||!er)return;let n=eo[er.id]||em,a=ei[n]||ei.A4,r={id:"INV-".concat(Date.now()),storeId:er.id,storeName:er.name,storeAddress:er.address,storePhone:er.phone,customerName:e.customer.name||"",customerPhone:e.customer.phone||"",customerEmail:e.customer.email||"",customerAddress:e.customer.address||"",items:e.cart,subtotal:e.subtotal,taxPercentage:e.taxPercentage,taxAmount:e.taxAmount,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount,total:e.total,paymentMethod:e.paymentMethod,timestamp:new Date().toISOString(),notes:e.notes,gstin:et.gstin,companyName:et.companyName,companyAddress:et.companyAddress,companyPhone:et.companyPhone,companyEmail:et.companyEmail,billFormat:n,createdBy:(null==s?void 0:s.id)||"Unknown"};try{await fetch("http://127.0.0.1:8080/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(e){console.error("Failed to save bill:",e)}for(let s of e.cart){let e=t.find(e=>e.id===s.productId);if(e){let t=e.stock-s.quantity;try{await fetch("http://127.0.0.1:8080"+"/api/products/".concat(s.productId),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({stock:t})})}catch(e){console.error("Failed to update stock for product ".concat(s.productId,":"),e)}}}let l=ev(r,a);try{await (0,O.G)({htmlContent:l})}catch(e){console.error("Failed to send print job:",e)}eh(J),Z(!1)},ev=(e,t)=>{let s=216===t.width&&279===t.height,n=210===t.width&&297===t.height,a=t.width<=80?"80mm":s?"216mm":n?"210mm":"".concat(t.width,"mm");return"\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Invoice - ".concat(e.id,"</title>\n          <style>\n            @page {\n              size: ").concat(s?"letter":n?"A4":"".concat(t.width,"mm ").concat("auto"===t.height?"auto":"".concat(t.height,"mm")),";\n              margin: ").concat(t.margins.top,"mm ").concat(t.margins.right,"mm ").concat(t.margins.bottom,"mm ").concat(t.margins.left,"mm;\n            }\n            body {\n              font-family: 'Arial', sans-serif;\n              max-width: ").concat(a,';\n              margin: 0 auto;\n              font-size: 13px;\n              color: #000;\n            }\n            .header, .footer {\n              text-align: center;\n              padding: 10px 0;\n            }\n            .company-name {\n              font-size: 18px;\n              font-weight: bold;\n              text-transform: uppercase;\n            }\n            .invoice-title {\n              font-size: 16px;\n              font-weight: bold;\n              margin-top: 10px;\n            }\n            .section {\n              margin: 20px 0;\n            }\n            .section-title {\n              font-weight: bold;\n              border-bottom: 1px solid #ccc;\n              margin-bottom: 5px;\n            }\n            .row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 6px;\n            }\n            .items-table {\n              width: 100%;\n              border-collapse: collapse;\n              margin-top: 15px;\n            }\n            .items-table th, .items-table td {\n              border: 1px solid #ccc;\n              padding: 6px 8px;\n              text-align: left;\n            }\n            .items-table th {\n              background-color: #f2f2f2;\n            }\n            .totals {\n              margin-top: 10px;\n              width: 100%;\n            }\n            .totals td {\n              padding: 6px;\n            }\n            .totals .label {\n              text-align: right;\n              font-weight: bold;\n            }\n            .totals .value {\n              text-align: right;\n              width: 100px;\n            }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <div class="company-name">').concat(e.companyName,"</div>\n            <div>").concat(e.companyAddress,"</div>\n            <div>Phone: ").concat(e.companyPhone,"</div>\n            <div>Email: ").concat(e.companyEmail,'</div>\n            <div class="invoice-title">INVOICE</div>\n          </div>\n\n          <div class="section">\n            <div class="row">\n              <div><strong>Invoice ID:</strong> ').concat(e.id,"</div>\n              <div><strong>Date:</strong> ").concat(new Date(e.timestamp).toLocaleString(),"</div>\n            </div>\n            ").concat(e.gstin?"<div><strong>GSTIN:</strong> ".concat(e.gstin,"</div>"):"","\n          </div>\n\n          ").concat(e.customerName||e.customerPhone?'\n          <div class="section">\n            <div class="section-title">Customer Details</div>\n            '.concat(e.customerName?"<div>Name: ".concat(e.customerName,"</div>"):"","\n            ").concat(e.customerPhone?"<div>Phone: ".concat(e.customerPhone,"</div>"):"","\n            ").concat(e.customerEmail?"<div>Email: ".concat(e.customerEmail,"</div>"):"","\n            ").concat(e.customerAddress?"<div>Address: ".concat(e.customerAddress,"</div>"):"","\n          </div>"):"",'\n\n          <div class="section">\n            <table class="items-table">\n              <thead>\n                <tr>\n                  <th>#</th>\n                  <th>Item</th>\n                  <th>Qty</th>\n                  <th>Rate</th>\n                  <th>Total</th>\n                </tr>\n              </thead>\n              <tbody>\n                ').concat(e.items.map((e,t)=>"\n                  <tr>\n                    <td>".concat(t+1,"</td>\n                    <td>").concat(e.productName,"</td>\n                    <td>").concat(e.quantity,"</td>\n                    <td>₹").concat(e.price.toFixed(2),"</td>\n                    <td>₹").concat(e.total.toFixed(2),"</td>\n                  </tr>\n                ")).join(""),'\n              </tbody>\n            </table>\n          </div>\n\n          <div class="section">\n            <table class="totals">\n              <tr>\n                <td class="label">Subtotal:</td>\n                <td class="value">₹').concat(e.subtotal.toFixed(2),"</td>\n              </tr>\n              ").concat(e.discountAmount>0?'<tr>\n                      <td class="label">Discount ('.concat(e.discountPercentage.toFixed(1),'%):</td>\n                      <td class="value">-₹').concat(e.discountAmount.toFixed(2),"</td>\n                    </tr>"):"",'\n              <tr>\n                <td class="label">Tax (').concat(e.taxPercentage,'%):</td>\n                <td class="value">₹').concat(e.taxAmount.toFixed(2),'</td>\n              </tr>\n              <tr>\n                <td class="label">Total:</td>\n                <td class="value"><strong>₹').concat(e.total.toFixed(2),'</strong></td>\n              </tr>\n              <tr>\n                <td class="label">Payment:</td>\n                <td class="value">').concat(e.paymentMethod.toUpperCase(),"</td>\n              </tr>\n            </table>\n          </div>\n\n          ").concat(e.notes?'<div class="section">\n                  <div class="section-title">Notes</div>\n                  <div>'.concat(e.notes,"</div>\n                </div>"):"",'\n\n          <div class="footer">\n            <p>Thank you for your business!</p>\n          </div>\n        </body>\n      </html>\n    ')},eb=ep(),ey=(0,a.useMemo)(()=>V.slice(0,10),[V]);return(0,n.jsx)(i.A,{children:(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center bg-gray-100 border-b border-gray-200 px-2 py-1",children:[(0,n.jsx)("div",{className:"flex items-center space-x-1 flex-1 overflow-x-auto",children:q.map(e=>(0,n.jsxs)("div",{className:"\n                  relative flex items-center px-4 py-2 min-w-0 max-w-48 cursor-pointer group\n                  ".concat(J===e.id?"bg-white border-t-2 border-blue-500 text-blue-600":"bg-gray-200 hover:bg-gray-300 text-gray-700","\n                  rounded-t-lg border-l border-r border-gray-300 mr-1\n                  transition-all duration-200\n                "),style:{clipPath:J===e.id?"polygon(8px 100%, 0 0, calc(100% - 8px) 0, 100% 100%)":"polygon(4px 100%, 0 0, calc(100% - 4px) 0, 100% 100%)"},onClick:()=>L(e.id),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[(0,n.jsx)(y.A,{className:"h-4 w-4 flex-shrink-0"}),(0,n.jsx)("span",{className:"truncate text-sm font-medium",children:e.name}),e.cart.length>0&&(0,n.jsx)(u.E,{variant:"secondary",className:"h-5 text-xs",children:e.cart.length}),e.hasUnsavedChanges&&(0,n.jsx)("div",{className:"h-2 w-2 bg-orange-500 rounded-full flex-shrink-0",title:"Unsaved changes"})]}),q.length>1&&(0,n.jsx)(c.$,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 ml-2 opacity-0 group-hover:opacity-100 hover:bg-red-100 hover:text-red-600 flex-shrink-0",onClick:t=>{t.stopPropagation(),(e=>{let t=q.find(t=>t.id===e);if(null==t?void 0:t.hasUnsavedChanges){ee(e),Q(!0);return}if(1===q.length)return eh(e);let s=q.filter(t=>t.id!==e);if(B(s),J===e){let t=q.findIndex(t=>t.id===e);L((s[t]||s[t-1]||s[0]).id)}})(e.id)},children:(0,n.jsx)(N.A,{className:"h-3 w-3"})})]},e.id))}),(0,n.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>{let e=q.length+1,t={id:"tab-".concat(Date.now()),name:"Bill #".concat(e),cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxPercentage:et.taxPercentage,taxAmount:0,total:0,paymentMethod:"cash",notes:"",hasUnsavedChanges:!1};B([...q,t]),L(t.id)},className:"ml-2 h-8 w-8 p-0 bg-gray-200 hover:bg-gray-300 rounded-full",title:"New Tab",children:(0,n.jsx)(w.A,{className:"h-4 w-4"})})]}),eb&&(0,n.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,n.jsxs)("div",{className:"w-1/2 border-r border-gray-200 flex flex-col",children:[(0,n.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(P.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,n.jsx)(o.p,{placeholder:"Search products by name or barcode...",value:j,onChange:e=>b(e.target.value),className:"pl-10"})]})}),(0,n.jsx)(v,{className:"flex-1",children:(0,n.jsxs)("div",{className:"p-4 space-y-2",children:[M.map(e=>{var t,s,a,r;return(0,n.jsx)(m.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>(e=>{var t,s,n;let a,r=ep();if(!r)return;if(e.stock<=0)return void alert("Product is out of stock");let l=r.cart.find(t=>t.productId===e.id),i=Number(null!=(n=null!=(s=null!=(t=e.sellingPrice)?t:e.selling_price)?s:e.price)?n:0);if(l){if(l.quantity>=e.stock)return void alert("Cannot add more. Maximum available: ".concat(e.stock));a=r.cart.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1,total:(t.quantity+1)*t.price}:t)}else a=[...r.cart,{productId:e.id,productName:e.name,quantity:1,price:i,total:i,barcodes:e.barcode?[e.barcode]:[]}];let c=a.reduce((e,t)=>e+t.total,0),o=c*r.discountPercentage/100,d=c-o,m=d*r.taxPercentage/100;ex(J,{cart:a,subtotal:c,discountAmount:o,taxAmount:m,total:d+m})})(e),children:(0,n.jsx)(m.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"font-medium text-sm",children:e.name}),(()=>{let t=(0,D.n)(e);return t?(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Barcode: ",t]}):null})()]}),(0,n.jsxs)("div",{className:"text-right",children:[(null!=(t=e.sellingPrice)?t:e.selling_price)!=null?(0,n.jsxs)("p",{className:"font-bold text-green-600",children:["Selling: ₹$",Number(null!=(s=e.sellingPrice)?s:e.selling_price).toFixed(2)]}):(0,n.jsxs)("p",{className:"font-bold text-green-600",children:["₹$",Number(null!=(a=e.price)?a:0).toFixed(2)]}),null!=e.price&&Number(e.price)!==Number(null!=(r=e.sellingPrice)?r:e.selling_price)&&(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Price: ₹$",Number(e.price).toFixed(2)]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["Stock: $",e.stock]})]})]})})},e.id)}),0===M.length&&(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,n.jsx)(P.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,n.jsx)("p",{children:"No products found"}),(0,n.jsx)("p",{className:"text-sm",children:"Try adjusting your search terms"})]})]})})]}),(0,n.jsxs)("div",{className:"w-1/2 flex flex-col",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("h2",{className:"text-lg font-semibold flex items-center",children:[(0,n.jsx)(A.A,{className:"h-5 w-5 mr-2"}),"$",eb.name]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[eb&&er&&ei&&(0,n.jsx)(z,{htmlContent:ev({id:"INV-".concat(Date.now()),storeId:er.id,storeName:er.name,storeAddress:er.address,storePhone:er.phone,customerName:eb.customer.name||"",customerPhone:eb.customer.phone||"",customerEmail:eb.customer.email||"",customerAddress:eb.customer.address||"",items:eb.cart,subtotal:eb.subtotal,taxPercentage:eb.taxPercentage,taxAmount:eb.taxAmount,discountPercentage:eb.discountPercentage,discountAmount:eb.discountAmount,total:eb.total,paymentMethod:eb.paymentMethod,timestamp:new Date().toISOString(),notes:eb.notes,gstin:et.gstin,companyName:et.companyName,companyAddress:et.companyAddress,companyPhone:et.companyPhone,companyEmail:et.companyEmail,billFormat:em,createdBy:(null==s?void 0:s.id)||"Unknown"},ei[eo[er.id]||em]||ei.A4),isThermalPrinter:(ei[eo[er.id]||em]||ei.A4).width<=80}),(0,n.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>H(!0),children:[(0,n.jsx)(C.A,{className:"h-4 w-4 mr-1"}),"Customer"]}),eb.cart.length>0&&(0,n.jsxs)(c.$,{size:"sm",onClick:()=>Z(!0),children:[(0,n.jsx)(S.A,{className:"h-4 w-4 mr-1"}),"Checkout"]})]})]}),(eb.customer.name||eb.customer.phone)&&(0,n.jsx)("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,n.jsx)(C.A,{className:"h-4 w-4 text-blue-600"}),(0,n.jsxs)("span",{className:"font-medium",children:["$",eb.customer.name||"Customer"]}),eb.customer.phone&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.A,{className:"h-3 w-3 text-gray-500"}),(0,n.jsxs)("span",{className:"text-gray-600",children:["$",eb.customer.phone]})]})]})})]}),(0,n.jsx)(v,{className:"flex-1",children:(0,n.jsx)("div",{className:"p-4",children:eb.cart.length>0?(0,n.jsx)("div",{className:"space-y-3",children:eb.cart.map(e=>(0,n.jsx)(m.Zp,{children:(0,n.jsxs)(m.Wu,{className:"p-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("h4",{className:"font-medium text-sm",children:["$",e.productName]}),(0,n.jsxs)("p",{className:"text-xs text-gray-600",children:["₹$",e.price.toFixed(2)," each"]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>eg(e.productId,e.quantity-1),className:"h-8 w-8 p-0",children:(0,n.jsx)(E.A,{className:"h-3 w-3"})}),(0,n.jsxs)("span",{className:"w-8 text-center text-sm font-medium",children:["$",e.quantity]}),(0,n.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>eg(e.productId,e.quantity+1),className:"h-8 w-8 p-0",children:(0,n.jsx)(w.A,{className:"h-3 w-3"})}),(0,n.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>ef(e.productId),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50",children:(0,n.jsx)(k.A,{className:"h-3 w-3"})})]})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"Total:"}),(0,n.jsxs)("span",{className:"font-bold",children:["₹$",e.total.toFixed(2)]})]})]})},e.productId))}):(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,n.jsx)(A.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,n.jsx)("p",{children:"Cart is empty"}),(0,n.jsx)("p",{className:"text-sm",children:"Add products from the left panel"})]})})}),eb.cart.length>0?(0,n.jsx)("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(d.J,{className:"text-sm",children:"Discount %:"}),(0,n.jsx)(o.p,{type:"number",value:eb.discountPercentage,onChange:e=>(e=>{let t=ep();if(!t)return;let s=Math.max(0,Math.min(100,e)),n=t.subtotal*s/100,a=t.subtotal-n,r=a*t.taxPercentage/100;ex(J,{discountPercentage:s,discountAmount:n,taxAmount:r,total:a+r})})(Number(e.target.value)),className:"w-20 h-8",min:"0",max:"100"}),(0,n.jsxs)("span",{className:"text-sm text-gray-600",children:["(-₹$",eb.discountAmount.toFixed(2),")"]})]}),(0,n.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Subtotal:"}),(0,n.jsxs)("span",{children:["₹$",eb.subtotal.toFixed(2)]})]}),eb.discountAmount>0&&(0,n.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,n.jsx)("span",{children:"Discount:"}),(0,n.jsxs)("span",{children:["-₹$",eb.discountAmount.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{children:["Tax ($",eb.taxPercentage,"%):"]}),(0,n.jsxs)("span",{children:["₹$",eb.taxAmount.toFixed(2)]})]}),(0,n.jsx)(g.w,{}),(0,n.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,n.jsx)("span",{children:"Total:"}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{children:"₹"}),(0,n.jsx)(o.p,{type:"number",value:eb.total.toFixed(2),onChange:e=>(e=>{let t=ep();if(!t||0===t.subtotal)return;let s=Math.max(0,t.subtotal+t.taxAmount-e),n=t.subtotal>0?s/t.subtotal*100:0;ex(J,{total:e,discountAmount:s,discountPercentage:n})})(Number(e.target.value)),className:"w-24 h-8 text-right font-bold",step:"0.01"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{className:"text-sm",children:"Notes:"}),(0,n.jsx)(h.T,{value:eb.notes,onChange:e=>ex(J,{notes:e.target.value}),placeholder:"Add notes for this bill...",className:"mt-1 h-16 text-sm"})]})]})}):(0,n.jsxs)("div",{className:"p-4 flex flex-col h-full",children:[(0,n.jsx)("h3",{className:"font-semibold mb-2",children:"Recent Bills"}),(0,n.jsx)(v,{className:"flex-1 min-h-0",children:(0,n.jsx)("div",{className:"space-y-2",children:ey.map(e=>(0,n.jsx)(m.Zp,{children:(0,n.jsxs)(m.Wu,{className:"p-3 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{className:"font-medium",children:["$",e.id]}),(0,n.jsxs)("span",{className:"font-bold",children:["₹$",e.total.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"text-xs text-gray-600",children:["$",new Date(e.timestamp).toLocaleString()]})]})},e.id))})})]})]})]}),(0,n.jsx)(x.lG,{open:Y,onOpenChange:H,children:(0,n.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,n.jsxs)(x.c7,{children:[(0,n.jsxs)(x.L3,{className:"flex items-center",children:[(0,n.jsx)(C.A,{className:"h-5 w-5 mr-2"}),"Customer Information"]}),(0,n.jsx)(x.rr,{children:"Add customer details for this bill"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"customerName",children:"Name"}),(0,n.jsx)(o.p,{id:"customerName",defaultValue:(null==eb?void 0:eb.customer.name)||"",placeholder:"Customer name"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"customerPhone",children:"Phone"}),(0,n.jsx)(o.p,{id:"customerPhone",defaultValue:(null==eb?void 0:eb.customer.phone)||"",placeholder:"Phone number"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"customerEmail",children:"Email"}),(0,n.jsx)(o.p,{id:"customerEmail",defaultValue:(null==eb?void 0:eb.customer.email)||"",placeholder:"Email address"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"customerAddress",children:"Address"}),(0,n.jsx)(h.T,{id:"customerAddress",defaultValue:(null==eb?void 0:eb.customer.address)||"",placeholder:"Customer address",className:"h-20"})]})]}),(0,n.jsxs)(x.Es,{children:[(0,n.jsx)(c.$,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),(0,n.jsx)(c.$,{onClick:()=>{var e,t,s,n,a;let r=null==(e=document.getElementById("customerName"))?void 0:e.value,l=null==(t=document.getElementById("customerPhone"))?void 0:t.value;a={name:r,phone:l,email:null==(s=document.getElementById("customerEmail"))?void 0:s.value,address:null==(n=document.getElementById("customerAddress"))?void 0:n.value},ep()&&(ex(J,{customer:a}),H(!1))},children:"Save Customer"})]})]})}),(0,n.jsx)(x.lG,{open:G,onOpenChange:Z,children:(0,n.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,n.jsxs)(x.c7,{children:[(0,n.jsxs)(x.L3,{className:"flex items-center",children:[(0,n.jsx)($.A,{className:"h-5 w-5 mr-2"}),"Process Payment"]}),(0,n.jsx)(x.rr,{children:"Complete the transaction and select bill format"})]}),eb&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{className:"text-sm font-medium",children:"Bill Format"}),(0,n.jsxs)(p.l6,{value:em,onValueChange:eu,children:[(0,n.jsx)(p.bq,{className:"mt-1",children:(0,n.jsx)(p.yv,{})}),(0,n.jsx)(p.gC,{children:Object.entries(ei).map(e=>{let[t,s]=e;return(0,n.jsxs)(p.eb,{value:t,children:[t.replace("_"," ")," ($",s.width,"\xd7 $","auto"===s.height?"Auto":s.height,"mm)"]},t)})})]})]}),(0,n.jsx)(m.Zp,{children:(0,n.jsx)(m.Wu,{className:"p-4",children:(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Items:"}),(0,n.jsxs)("span",{children:["$",eb.cart.length," ($",eb.cart.reduce((e,t)=>e+t.quantity,0)," qty)"]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Subtotal:"}),(0,n.jsxs)("span",{children:["₹$",eb.subtotal.toFixed(2)]})]}),eb.discountAmount>0&&(0,n.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,n.jsxs)("span",{children:["Discount ($",eb.discountPercentage.toFixed(1),"%):"]}),(0,n.jsxs)("span",{children:["-₹$",eb.discountAmount.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{children:["Tax ($",eb.taxPercentage,"%):"]}),(0,n.jsxs)("span",{children:["₹$",eb.taxAmount.toFixed(2)]})]}),(0,n.jsx)(g.w,{}),(0,n.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,n.jsx)("span",{children:"Total:"}),(0,n.jsxs)("span",{children:["₹$",eb.total.toFixed(2)]})]})]})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{className:"text-sm font-medium",children:"Payment Method"}),(0,n.jsxs)(p.l6,{value:eb.paymentMethod,onValueChange:e=>ex(J,{paymentMethod:e}),children:[(0,n.jsx)(p.bq,{className:"mt-1",children:(0,n.jsx)(p.yv,{})}),(0,n.jsxs)(p.gC,{children:[(0,n.jsx)(p.eb,{value:"cash",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Cash"]})}),(0,n.jsx)(p.eb,{value:"card",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Card"]})}),(0,n.jsx)(p.eb,{value:"upi",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"UPI"]})})]})]})]}),er&&(0,n.jsx)(m.Zp,{children:(0,n.jsx)(m.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsxs)("div",{className:"font-medium",children:["Store: $",er.name]}),(0,n.jsxs)("div",{className:"text-gray-600 mt-1",children:["$",er.address]}),er.phone&&(0,n.jsxs)("div",{className:"text-gray-600",children:["Phone: $",er.phone]}),(0,n.jsxs)("div",{className:"text-gray-600",children:["GSTIN: $",et.gstin]}),(0,n.jsxs)("div",{className:"text-gray-600",children:["Tax Rate: $",et.taxPercentage,"%"]})]})})}),(eb.customer.name||eb.customer.phone)&&(0,n.jsx)(m.Zp,{children:(0,n.jsx)(m.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsxs)("div",{className:"font-medium flex items-center",children:[(0,n.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Customer Details"]}),(0,n.jsxs)("div",{className:"mt-2 space-y-1 text-gray-600",children:[eb.customer.name&&(0,n.jsxs)("div",{children:["Name: $",eb.customer.name]}),eb.customer.phone&&(0,n.jsxs)("div",{children:["Phone: $",eb.customer.phone]}),eb.customer.email&&(0,n.jsxs)("div",{children:["Email: $",eb.customer.email]})]})]})})})]}),(0,n.jsxs)(x.Es,{children:[(0,n.jsx)(c.$,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),(0,n.jsxs)(c.$,{onClick:ej,className:"bg-green-600 hover:bg-green-700",children:[(0,n.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Complete Payment"]})]})]})}),(0,n.jsx)(x.lG,{open:K,onOpenChange:Q,children:(0,n.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,n.jsxs)(x.c7,{children:[(0,n.jsxs)(x.L3,{className:"flex items-center",children:[(0,n.jsx)(_.A,{className:"h-5 w-5 mr-2 text-orange-500"}),"Unsaved Changes"]}),(0,n.jsx)(x.rr,{children:"This tab has unsaved changes. Are you sure you want to close it?"})]}),(0,n.jsxs)(x.Es,{children:[(0,n.jsx)(c.$,{variant:"outline",onClick:()=>Q(!1),children:"Cancel"}),(0,n.jsx)(c.$,{variant:"destructive",onClick:()=>{if(1===q.length)eh(X);else{let e=q.filter(e=>e.id!==X);if(B(e),J===X){let t=q.findIndex(e=>e.id===X);L((e[t]||e[t-1]||e[0]).id)}}Q(!1),ee("")},children:"Close Tab"})]})]})})]})})}},50782:(e,t,s)=>{Promise.resolve().then(s.bind(s,42928))},67001:(e,t,s)=>{"use strict";s.d(t,{T:()=>l});var n=s(95155),a=s(12115),r=s(25016);let l=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...a})});l.displayName="Textarea"},73609:(e,t,s)=>{"use strict";function n(e){if(e){if(Array.isArray(e.barcodes)&&e.barcodes.length>0){let t=e.barcodes.find(e=>"string"==typeof e&&""!==e.trim());if(t)return t}if("string"==typeof e.barcode&&""!==e.barcode.trim())return e.barcode}}s.d(t,{n:()=>n})},76577:(e,t,s)=>{"use strict";async function n(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((s,n)=>{try{var a;if(t){let t=window.open("","_blank","width=800,height=900");if(!t)return void n(Error("Failed to open print window"));t.document.open(),t.document.write(e),t.document.close(),t.focus(),t.print(),setTimeout(()=>{t.close(),s()},500);return}let r=!1,l=document.createElement("iframe");l.style.position="fixed",l.style.right="0",l.style.bottom="0",l.style.width="0",l.style.height="0",l.style.border="none",document.body.appendChild(l);let i=null==(a=l.contentWindow)?void 0:a.document;if(!i){document.body.removeChild(l),n(Error("Failed to access iframe document"));return}i.open(),i.write(e),i.close(),l.onload=()=>{if(!r){r=!0;try{var e,t;null==(e=l.contentWindow)||e.focus(),null==(t=l.contentWindow)||t.print(),setTimeout(()=>{l.parentNode&&document.body.removeChild(l),s()},1e3)}catch(e){l.parentNode&&document.body.removeChild(l),n(e)}}},setTimeout(()=>{if(!r){r=!0;try{l.contentWindow&&(l.contentWindow.focus(),l.contentWindow.print(),setTimeout(()=>{l.parentNode&&document.body.removeChild(l),s()},1e3))}catch(e){l.parentNode&&document.body.removeChild(l),n(e)}}},500)}catch(e){console.error("Print error:",e),n(e)}})}async function a(e){let{htmlContent:t,thermalContent:s,isThermalPrinter:a=!1,labelData:r,copies:l=1,useBackendPrint:i=!1,printerName:c,storeName:o,labelProfile:d,labelDimensions:m}=e;if(i&&r&&r.length>0)try{let e="http://127.0.0.1:8080".replace(/\/+$/g,""),t={labelData:r.map(e=>{let t=e.selling_price;return void 0===t&&void 0!==e.sellingPrice&&(t=e.sellingPrice),{id:e.id,name:e.name,barcode:e.barcode,selling_price:null!=t?t:0,batchNumber:e.batchNumber||""}}),copies:l};c&&(t.printerName=c),o&&(t.storeName=o),d&&(t.labelProfile=d),m&&(t.labelDimensions=m),console.log("\uD83D\uDCE4 Sending backend print request (selling_price only):",t);let s=await fetch("".concat(e,"/api/print-label"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await s.json().catch(()=>({}));if(s.ok&&"success"===n.status)return void console.log("✅ Backend print succeeded:",n.message||"");console.warn("⚠️ Backend print returned non-success, falling back to browser print",n)}catch(e){console.error("❌ Error sending backend print request, falling back to browser print:",e)}if(t){console.log("\uD83D\uDDA8️ Using browser-based HTML printing");let e=!!window.__TAURI__;await n(t,e);return}if(s){console.log("\uD83D\uDDA8️ Using browser-based thermal content printing");let e='<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>Print</title>\n  <style>\n    body {\n      font-family: monospace;\n      white-space: pre-wrap;\n      margin: 0;\n      padding: 10mm;\n    }\n  </style>\n</head>\n<body><pre>'.concat(String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),"</pre></body>\n</html>"),t=!!window.__TAURI__;await n(e,t);return}throw Error("No printable content provided.")}s.d(t,{G:()=>a}),s(68267)}},e=>{e.O(0,[9206,6445,9648,9309,7518,6899,8441,1255,7358],()=>e(e.s=50782)),_N_E=e.O()}]);