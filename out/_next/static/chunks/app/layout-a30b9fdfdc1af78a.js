(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{4122:(e,t,l)=>{Promise.resolve().then(l.bind(l,78217)),Promise.resolve().then(l.t.bind(l,95003,23)),Promise.resolve().then(l.t.bind(l,41290,23))},41290:()=>{},78217:(e,t,l)=>{"use strict";l.d(t,{default:()=>f});var a=l(95155),n=l(12115),s=l(20063);let r=e=>{let t,{timeoutInMinutes:l=120}=e;(0,s.useRouter)();let a=(0,n.useCallback)(()=>{window.location.href="/"},[]),r=(0,n.useCallback)(()=>{clearTimeout(t),t=setTimeout(a,60*l*1e3)},[a,l]);return(0,n.useEffect)(()=>{let e=["mousemove","keydown","click","scroll"],l=()=>r();return e.forEach(e=>window.addEventListener(e,l)),r(),()=>{clearTimeout(t),e.forEach(e=>window.removeEventListener(e,l))}},[r]),null};function o(){let[e,t]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{let e=()=>t(!0),l=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",l),void 0!==navigator.onLine&&t(navigator.onLine),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",l)}},[]),e)?null:(0,a.jsx)("div",{className:"bg-yellow-500 text-white text-center p-2",children:"You are currently offline. Some features may not be available."})}function i(e){let{children:t}=e,[s,r]=(0,n.useState)(null);return((0,n.useEffect)(()=>{let e;return(async()=>{if(window.__TAURI__){let{listen:t}=await l.e(380).then(l.bind(l,13380)),a=t("server-error",e=>{r(e.payload)});e=await a}})(),()=>{null==e||e()}},[]),s)?(0,a.jsxs)("div",{style:{color:"red",display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:["Error: ",s]}):(0,a.jsx)(a.Fragment,{children:t})}var c=l(2950),d=l(58029),u=l(66638);function h(){let e=(0,n.useRef)(null),[t,l]=(0,n.useState)(!1),[s,r]=(0,n.useState)(!1),[o,i]=(0,n.useState)(0),[h,x]=(0,n.useState)(null);async function f(){if(t&&e.current)try{await (0,d.kA)("A new version ".concat(null==h?void 0:h.version," is available!\n\nRelease notes:\n").concat(null==h?void 0:h.notes,"\n\nWould you like to install it now? (App will restart after update)"),{title:"Update Available!",kind:"info",okLabel:"Install Update",cancelLabel:"Later"})&&!s?await m():l(!1)}catch(e){console.error("Prompt failed:",e)}}async function m(){if(e.current)try{r(!0),i(0),await e.current.downloadAndInstall(e=>{switch(e.event){case"Started":console.log("Download started"),i(0);break;case"Progress":let t=e.data;if(t.contentLength){let e=Math.round(t.chunkLength/t.contentLength*100);i(e),console.log("Download progress: ".concat(e,"%"))}break;case"Finished":console.log("Download finished, installing..."),i(100)}}),await (0,d.iU)("Update installed successfully! The app will now restart.",{title:"Update Complete",kind:"info",okLabel:"Restart Now"}),await (0,u.b)()}catch(e){console.error("Update installation failed:",e),await (0,d.iU)("Update download failed. Please try again later.",{kind:"error",title:"Update Failed"}),r(!1),i(0)}}return((0,n.useEffect)(()=>{(async()=>{if("__TAURI__"in window)try{let t=await (0,c.z)();if(!t||!t.available)return void console.log("No updates available.");e.current=t,l(!0),x({version:t.version,notes:t.body||"No release notes available."}),f()}catch(e){console.error("Failed to check for updates:",e)}else console.log("Not running in Tauri environment, skipping update check")})()},[]),s)?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full mx-4",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Downloading Update..."}),(0,a.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-4",children:(0,a.jsx)("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-300",style:{width:"".concat(o,"%")}})}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[o,"% complete"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:"Please don't close the application"})]})})}):t&&h?(0,a.jsx)("div",{className:"fixed bottom-4 right-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 rounded-lg shadow-2xl max-w-sm z-50 animate-slide-in",children:(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-6 h-6 text-yellow-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),(0,a.jsx)("p",{className:"font-semibold text-lg",children:"Update Available!"})]}),(0,a.jsx)("button",{onClick:()=>l(!1),className:"text-white hover:text-gray-200 transition-colors","aria-label":"Close",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium",children:["Version ",h.version]}),(0,a.jsx)("p",{className:"text-xs text-blue-100 mt-1 line-clamp-2",children:h.notes})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:m,disabled:s,className:"bg-white text-blue-600 px-4 py-2 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed flex-1 font-medium transition-colors text-sm",children:"Install Now"}),(0,a.jsx)("button",{onClick:()=>l(!1),className:"bg-transparent border border-white px-4 py-2 rounded-md hover:bg-blue-800 transition-colors text-sm font-medium",children:"Later"})]})]})}):null}let x={rE:"0.1.44"};function f(e){let{children:t}=e;return(0,n.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat("http://127.0.0.1:8080","/api/sync/status"));if(e.ok){let t=await e.json();console.log("Heartbeat successful:",t)}else console.error("Heartbeat failed: ".concat(e.status," ").concat(e.statusText))}catch(e){console.error("Error sending heartbeat:",e)}};e();let t=setInterval(e,5e3);return()=>clearInterval(t)},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h,{}),(0,a.jsx)(o,{}),(0,a.jsx)(r,{}),(0,a.jsx)(i,{children:t}),(0,a.jsxs)("div",{className:"fixed bottom-2 left-2 text-xs text-gray-400 pointer-events-none z-50",children:["v",x.rE]})]})}}},e=>{e.O(0,[761,360,441,255,358],()=>e(e.s=4122)),_N_E=e.O()}]);