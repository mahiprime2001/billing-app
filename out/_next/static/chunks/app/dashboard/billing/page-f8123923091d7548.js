(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3613],{18728:(e,t,s)=>{Promise.resolve().then(s.bind(s,63289))},28171:(e,t,s)=>{"use strict";s.d(t,{oR:()=>c}),s(12115);let n=0,a=new Map,l=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},i=[],r={toasts:[]};function o(e){r=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?l(s):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(r,e),i.forEach(e=>{e(r)})}function c(e){let{...t}=e,s=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>o({type:"DISMISS_TOAST",toastId:s});return o({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:s}})}}},47507:(e,t,s)=>{"use strict";s.d(t,{bq:()=>u,eb:()=>f,gC:()=>p,l6:()=>d,yv:()=>m});var n=s(95155),a=s(12115),l=s(4729),i=s(24033),r=s(12108),o=s(5917),c=s(25016);let d=l.bL;l.YJ;let m=l.WT,u=a.forwardRef((e,t)=>{let{className:s,children:a,...r}=e;return(0,n.jsxs)(l.l9,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...r,children:[a,(0,n.jsx)(l.In,{asChild:!0,children:(0,n.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.PP,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,n.jsx)(r.A,{className:"h-4 w-4"})})});x.displayName=l.PP.displayName;let h=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.wn,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,n.jsx)(i.A,{className:"h-4 w-4"})})});h.displayName=l.wn.displayName;let p=a.forwardRef((e,t)=>{let{className:s,children:a,position:i="popper",...r}=e;return(0,n.jsx)(l.ZL,{children:(0,n.jsxs)(l.UC,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...r,children:[(0,n.jsx)(x,{}),(0,n.jsx)(l.LM,{className:(0,c.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,n.jsx)(h,{})]})})});p.displayName=l.UC.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.JU,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=l.JU.displayName;let f=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,n.jsxs)(l.q7,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(l.VF,{children:(0,n.jsx)(o.A,{className:"h-4 w-4"})})}),(0,n.jsx)(l.p4,{children:a})]})});f.displayName=l.q7.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=l.wv.displayName},54679:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>h,L3:()=>p,c7:()=>x,lG:()=>o,rr:()=>f,zM:()=>c});var n=s(95155),a=s(12115),l=s(93409),i=s(65229),r=s(25016);let o=l.bL,c=l.l9,d=l.ZL;l.bm;let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.hJ,{ref:t,className:(0,r.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a})});m.displayName=l.hJ.displayName;let u=a.forwardRef((e,t)=>{let{className:s,children:a,...o}=e;return(0,n.jsxs)(d,{children:[(0,n.jsx)(m,{}),(0,n.jsxs)(l.UC,{ref:t,className:(0,r.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...o,children:[a,(0,n.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(i.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=l.UC.displayName;let x=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,r.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};x.displayName="DialogHeader";let h=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,r.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="DialogFooter";let p=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.hE,{ref:t,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",s),...a})});p.displayName=l.hE.displayName;let f=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.VY,{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",s),...a})});f.displayName=l.VY.displayName},62217:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var n=s(95155),a=s(12115),l=s(28171);function i(){let[e,t]=(0,a.useState)(!0),[s,i]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e=()=>{t(!0),s&&(0,l.oR)({title:"You are back online!",description:"All features are now available.",variant:"default"})},n=()=>{t(!1),s&&(0,l.oR)({title:"You are currently offline.",description:"Some features may not be available.",variant:"destructive"})};return window.addEventListener("online",e),window.addEventListener("offline",n),void 0!==navigator.onLine&&t(navigator.onLine),i(!0),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}},[s]),e)?null:(0,n.jsx)("div",{className:"bg-yellow-500 text-white text-center p-2",children:"You are currently offline. Some features may not be available."})}},63289:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var n=s(95155),a=s(12115),l=s(20063),i=s(10832),r=s(62217),o=s(97003);let c=(e,t)=>{let{interval:s=5e3,enabled:n=!0}=t||{},[l,i]=(0,a.useState)(void 0),[r,o]=(0,a.useState)(!0),[c,d]=(0,a.useState)(void 0),m=(0,a.useRef)(e);return(0,a.useEffect)(()=>{m.current=e},[e]),(0,a.useEffect)(()=>{if(!n)return void o(!1);let e=async()=>{o(!0);try{let e=await m.current();i(e),d(void 0)}catch(e){d(e),i(void 0)}finally{o(!1)}};e();let t=setInterval(()=>{e()},s);return()=>clearInterval(t)},[s,n]),{data:l,loading:r,error:c,refetch:()=>{(async()=>{o(!0);try{let e=await m.current();i(e),d(void 0)}catch(e){d(e),i(void 0)}finally{o(!1)}})()}}},d=s(95125).A.create({baseURL:"http://localhost:8080",withCredentials:!0});d.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&(console.log("401 Unauthorized: Redirecting to login page."),localStorage.removeItem("adminLoggedIn"),localStorage.removeItem("adminUser"),window.location.href="/"),Promise.reject(e)));var m=s(33789),u=s(90235),x=s(83209),h=s(96633),p=s(54679),f=s(47507),g=s(67812),j=s(89559),b=s(6191),y=s(71360),v=s(19204),N=s(86651),w=s(57828),A=s(309),C=s(53409),S=s(54664),P=s(21786),F=s(76577),E=s(90923);function I(){var e;let t=(0,l.useRouter)(),[s,I]=(0,a.useState)(!0),[B,k]=(0,a.useState)(!1),[T,R]=(0,a.useState)(!1),[D,L]=(0,a.useState)(null),[z,O]=(0,a.useState)(""),[_,U]=(0,a.useState)(""),[$,H]=(0,a.useState)(!1),[q,J]=(0,a.useState)(null),[M,W]=(0,a.useState)(!1),[G,V]=(0,a.useState)(null),[X,Y]=(0,a.useState)(!1),[Z,Q]=(0,a.useState)(""),[K,ee]=(0,a.useState)(""),[et,es]=(0,a.useState)(""),[en,ea]=(0,a.useState)([]),[el,ei]=(0,a.useState)(""),[er,eo]=(0,a.useState)(1),[ec,ed]=(0,a.useState)(0),[em,eu]=(0,a.useState)({gstin:"",taxPercentage:0,companyName:"",companyAddress:"",companyPhone:"",companyEmail:""}),[ex,eh]=(0,a.useState)({}),[ep,ef]=(0,a.useState)("A4");(0,a.useEffect)(()=>(console.log("BillingPage: Component mounting..."),localStorage.setItem("adminLoggedIn","true"),fetch("".concat("http://127.0.0.1:8080","/api/settings")).then(e=>e.json()).then(e=>{if(console.log("Settings: Loaded settings",e),e.systemSettings){let t=e.systemSettings,s={gstin:t.gstin||"",taxPercentage:t.taxPercentage||t.tax_percentage||0,companyName:t.companyName||t.company_name||"",companyAddress:t.companyAddress||t.company_address||"",companyPhone:t.companyPhone||t.company_phone||"",companyEmail:t.companyEmail||t.company_email||""};console.log("Settings: Normalized settings",s),eu(s)}e.billFormats&&eh(e.billFormats)}).catch(e=>console.error("Failed to load system settings and bill formats",e)),"true"!==localStorage.getItem("adminLoggedIn"))?void t.push("/"):(I(navigator.onLine),window.addEventListener("online",()=>I(!0)),window.addEventListener("offline",()=>I(!1)),()=>{window.removeEventListener("online",()=>I(!0)),window.removeEventListener("offline",()=>I(!1))}),[t]);let eg=(0,a.useCallback)(async(e,t,n,a)=>{if(console.log("fetchData: Fetching ".concat(a,"...")),s)try{console.log("fetchData: Fetching ".concat(a," from Supabase..."));let t=(await d.get(e)).data;console.log("fetchData: Raw ".concat(a," from API"),t);let s=t;return"products"===a?s=t.map(e=>({...e,stock:e.stock||0})):"customers"===a&&(s=t.map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone,address:e.address,createdAt:e.createdat||e.createdAt,updatedAt:e.updatedat||e.updatedAt}))),console.log("fetchData: Processed ".concat(a),s),d.post(n,s).catch(()=>{}),s}catch(s){console.warn("Failed to fetch ".concat(a," from Supabase, falling back to local"),s),console.log("fetchData: Falling back to local for ".concat(a));let e=await d.get(t);if(console.log("fetchData: Local ".concat(a," data"),e.data),"products"===a)return e.data.map(e=>({...e,stock:e.stock||0}));if("customers"===a)return e.data.map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone,address:e.address,createdAt:e.createdat||e.createdAt,updatedAt:e.updatedat||e.updatedAt}));return e.data}},[s]),ej=(0,a.useCallback)(()=>eg("/api/supabase/products","/api/local/products","/api/local/products/update","products"),[eg]),eb=(0,a.useCallback)(async()=>{if(console.log("fetchBills: Starting fetch..."),s)try{console.log("fetchBills: Fetching from Supabase...");let e=(await d.get("/api/supabase/bills-with-details")).data;console.log("fetchBills: Raw data from API",e),console.log("fetchBills: Number of bills",e.length),e.length>0&&e[0].items&&(console.log("fetchBills: First bill items",e[0].items),console.log("fetchBills: First item details",e[0].items[0]));let t=e.map(e=>{console.log("fetchBills: Processing bill ".concat(e.id));let t=e.discountpercentage||e.discountPercentage||0,s=e.discountamount||e.discountAmount||0,n=e.taxpercentage||e.taxPercentage||0,a=e.taxamount||e.taxAmount||e.tax||0;return{...e,date:e.timestamp||e.date,tax:a,taxPercentage:n,status:e.status||"Paid",items:"string"==typeof e.items?JSON.parse(e.items):e.items,discountPercentage:t,discountAmount:s}});return console.log("fetchBills: Final processed data",t),d.post("/api/local/bills/update",t).catch(()=>{}),t}catch(t){console.error("fetchBills: Error fetching from Supabase",t),console.log("fetchBills: Falling back to local storage");let e=await d.get("/api/local/bills");return console.log("fetchBills: Local data",e.data),e.data.map(e=>{let t=e.discountpercentage||e.discountPercentage||0,s=e.discountamount||e.discountAmount||0,n=e.taxpercentage||e.taxPercentage||0,a=e.taxamount||e.taxAmount||e.tax||0;return{...e,date:e.timestamp||e.date,tax:a,taxPercentage:n,status:e.status||"Paid",items:"string"==typeof e.items?JSON.parse(e.items):e.items,discountPercentage:t,discountAmount:s}})}},[s]),ey=(0,a.useCallback)(()=>eg("/api/supabase/customers","/api/local/customers","/api/local/customers/update","customers"),[eg]),{data:ev,loading:eN,error:ew,refetch:eA}=c(ej,{interval:2e4}),{data:eC,loading:eS,error:eP,refetch:eF}=c(eb,{interval:2e4}),{data:eE,loading:eI,error:eB,refetch:ek}=c(ey,{interval:2e4}),eT=async()=>{console.log("handleManualRefresh: Manual refresh triggered."),Y(!0);try{await Promise.all([eA(),eF(),ek()])}finally{setTimeout(()=>Y(!1),500)}};(0,a.useEffect)(()=>{ew&&console.error("Failed to load products",ew),eP&&console.error("Failed to load bills",eP),eB&&console.error("Failed to load customers",eB)},[ew,eP,eB]);let eR=ev||[],eD=eC||[],eL=eE||[];(0,a.useEffect)(()=>{console.log("Products: Updated products data",ev)},[ev]),(0,a.useEffect)(()=>{console.log("Bills: Updated bills data",eC)},[eC]),(0,a.useEffect)(()=>{console.log("Customers: Updated customers data",eE)},[eE]);let ez=()=>{let e=en.reduce((e,t)=>e+t.total,0),t=.1*e,s=e*ec/100;return{subtotal:e,tax:t,discountAmount:s,total:e+t-s}},eO=async()=>{if(!Z||0===en.length)return;console.log("createBill: Attempting to create bill...");let{subtotal:e,tax:t,discountAmount:s,total:n}=ez(),a={id:Date.now().toString(),customerName:Z,customerEmail:K,customerPhone:et,items:en,subtotal:e,tax:t,discountPercentage:ec,discountAmount:s,total:n,date:new Date().toISOString(),status:"Paid",companyName:em.companyName,companyAddress:em.companyAddress,companyPhone:em.companyPhone,companyEmail:em.companyEmail,gstin:em.gstin,billFormat:ep};console.log("createBill: Bill payload",a);try{let e=await d.post("/api/bills",a);if(console.log("createBill: API response",e),!e.status.toString().startsWith("2"))throw Error("Failed to create bill");Q(""),ee(""),es(""),ea([]),ed(0),k(!1),eF()}catch(e){console.error("Error creating bill",e),alert("Failed to create bill.")}},e_=async e=>{console.log("deleteBill: Deleting bill with ID",e);try{let t=await d.delete("/api/bills/".concat(e));if(console.log("deleteBill: API Response for deletion of",e,t),!t.status.toString().startsWith("2"))throw Error("Failed to delete bill");eF()}catch(e){console.error("Error deleting bill",e)}},eU=async e=>{console.log("handlePrintBill: Printing bill",e),console.log("handlePrintBill: System settings",em),console.log("handlePrintBill: Bill items",e.items);let t=ex[e.billFormat||ep]||ex.A4||{width:210,height:297,margins:{top:10,bottom:10,left:10,right:10},unit:"mm"};console.log("handlePrintBill: Using bill format",t);let s=((e,t)=>{console.log("generateReceiptHtml: Bill data",e),console.log("generateReceiptHtml: System settings",em);let s=216===t.width&&279===t.height,n=210===t.width&&297===t.height,a=80===t.width,l=a?"80mm":s?"216mm":n?"210mm":"".concat(t.width,"mm"),i=e.companyName||em.companyName||em.company_name||"UNDEFINED",r=e.companyAddress||em.companyAddress||em.company_address||void 0,o=e.companyPhone||em.companyPhone||em.company_phone||void 0,c=e.companyEmail||em.companyEmail||em.company_email||void 0,d=e.gstin||em.gstin||em.gstin||"",m=e.taxPercentage||em.taxPercentage||em.tax_percentage||0;console.log("generateReceiptHtml: Using company info",{companyName:i,companyAddress:r,companyPhone:o,companyEmail:c,gstin:d,taxPercentage:m});let u=a?"11px":"13px";return"<!DOCTYPE html>\n<html>\n<head>\n  <title>Invoice - ".concat(e.id,"</title>\n  <style>\n    @page {\n      size: ").concat(s?"letter":n?"A4":"".concat(t.width,"mm ").concat("auto"===t.height?"auto":t.height+"mm"),";\n      margin: ").concat(t.margins.top,"mm ").concat(t.margins.right,"mm ").concat(t.margins.bottom,"mm ").concat(t.margins.left,"mm;\n    }\n    body {\n      font-family: Arial, sans-serif;\n      max-width: ").concat(l,";\n      margin: 0 auto;\n      font-size: ").concat(u,";\n      color: #000;\n      padding: ").concat(a?"5px 0":"0",";\n    }\n    .header, .footer {\n      text-align: center;\n      padding: ").concat(a?"5px 0":"10px 0",";\n    }\n    .company-name {\n      font-size: ").concat(a?"14px":"18px",";\n      font-weight: bold;\n      text-transform: uppercase;\n      margin-bottom: 3px;\n    }\n    .company-details {\n      font-size: ").concat(a?"10px":"12px",";\n      line-height: 1.4;\n    }\n    .invoice-title {\n      font-size: ").concat(a?"13px":"16px",";\n      font-weight: bold;\n      margin-top: ").concat(a?"5px":"10px",";\n      border-top: 1px solid #000;\n      border-bottom: 1px solid #000;\n      padding: ").concat(a?"3px 0":"5px 0",";\n    }\n    .section {\n      margin: ").concat(a?"10px 0":"15px 0",";\n    }\n    .section-title {\n      font-weight: bold;\n      border-bottom: 1px dashed #000;\n      margin-bottom: 5px;\n      padding-bottom: 2px;\n    }\n    .row {\n      display: flex;\n      justify-content: space-between;\n      margin-bottom: ").concat(a?"3px":"5px",";\n      font-size: ").concat(a?"10px":"12px",";\n    }\n    .items-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin-top: ").concat(a?"5px":"10px",";\n      font-size: ").concat(a?"10px":u,";\n    }\n    .items-table th, .items-table td {\n      border: 1px solid #000;\n      padding: ").concat(a?"3px 4px":"6px 8px",";\n      text-align: left;\n    }\n    .items-table th {\n      background-color: #f2f2f2;\n      font-weight: bold;\n    }\n    .items-table td.number {\n      text-align: right;\n    }\n    .totals {\n      margin-top: ").concat(a?"10px":"15px",";\n      border-top: 1px dashed #000;\n      padding-top: ").concat(a?"5px":"10px",";\n    }\n    .totals-row {\n      display: flex;\n      justify-content: space-between;\n      margin-bottom: ").concat(a?"3px":"5px",";\n      font-size: ").concat(a?"11px":"13px",";\n    }\n    .totals-row.total {\n      font-weight: bold;\n      font-size: ").concat(a?"13px":"15px",";\n      border-top: 2px solid #000;\n      padding-top: 5px;\n      margin-top: 5px;\n    }\n    .footer {\n      margin-top: ").concat(a?"10px":"20px",";\n      font-size: ").concat(a?"10px":"12px",';\n      border-top: 1px dashed #000;\n      padding-top: 10px;\n    }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <div class="company-name">').concat(i,'</div>\n    <div class="company-details">\n      ').concat(r,"<br>\n      Phone: ").concat(o,"<br>\n      Email: ").concat(c,"\n      ").concat(d?"<br>GSTIN: ".concat(d):"",'\n    </div>\n  </div>\n\n  <div class="invoice-title">INVOICE</div>\n\n  <div class="section">\n    <div class="row">\n      <span><strong>Invoice:</strong> ').concat(e.id.substring(5,17),"</span>\n      <span><strong>Date:</strong> ").concat(new Date(e.date).toLocaleDateString(),"</span>\n    </div>\n    ").concat(e.customerName||e.customerPhone?'\n    <div class="row">\n      <span><strong>Customer:</strong> '.concat(e.customerName||"Walk-in","</span>\n      ").concat(e.customerPhone?"<span>".concat(e.customerPhone,"</span>"):"","\n    </div>"):"",'\n  </div>\n\n  <table class="items-table">\n    <thead>\n      <tr>\n        <th style="width: ').concat(a?"10%":"8%",'">#</th>\n        <th style="width: ').concat(a?"40%":"45%",'">Item</th>\n        <th style="width: ').concat(a?"15%":"12%",'" class="number">Qty</th>\n        <th style="width: ').concat("17%",'" class="number">Rate</th>\n        <th style="width: ').concat("18%",'" class="number">Total</th>\n      </tr>\n    </thead>\n    <tbody>\n      ').concat(e.items.map((e,t)=>{let s=e.productName||e.product_name||e.productname||"Item";return"\n        <tr>\n          <td>".concat(t+1,"</td>\n          <td>").concat(s,'</td>\n          <td class="number">').concat(e.quantity,'</td>\n          <td class="number">₹').concat(e.price.toFixed(2),'</td>\n          <td class="number">₹').concat(e.total.toFixed(2),"</td>\n        </tr>")}).join(""),'\n    </tbody>\n  </table>\n\n  <div class="totals">\n    <div class="totals-row">\n      <span>Subtotal</span>\n      <span>₹').concat(e.subtotal.toFixed(2),"</span>\n    </div>\n    ").concat(e.discountAmount&&e.discountAmount>0?'\n    <div class="totals-row" style="color: #c00">\n      <span>Discount ('.concat(e.discountPercentage.toFixed(1),"%)</span>\n      <span>-₹").concat(e.discountAmount.toFixed(2),"</span>\n    </div>"):"",'\n    <div class="totals-row">\n      <span>Tax (').concat(m.toFixed(1),"%)</span>\n      <span>₹").concat(e.tax.toFixed(2),'</span>\n    </div>\n    <div class="totals-row total">\n      <span>TOTAL</span>\n      <span>₹').concat(e.total.toFixed(2),'</span>\n    </div>\n  </div>\n\n  <div class="footer">\n    <p style="margin: 5px 0;">Thank you for your business!</p>\n    ').concat(a?'<p style="margin: 5px 0; font-size: 9px;">Powered by SIRI Billing System</p>':"","\n  </div>\n</body>\n</html>")})(e,t);try{await (0,F.G)({htmlContent:s})}catch(e){console.error("Failed to send print job",e),alert("Failed to print bill. Please check console for details.")}},e$=eD.filter(e=>{let t=e.customerName||"",s=e.id||"",n=z.toLowerCase();return t.toLowerCase().includes(n)||s.includes(n)}),eH=eL.filter(e=>{let t=e.name||"",s=e.email||"",n=e.phone||"",a=_.toLowerCase();return t.toLowerCase().includes(a)||s.toLowerCase().includes(a)||n.toLowerCase().includes(a)}),{subtotal:eq,tax:eJ,discountAmount:eM,total:eW}=ez(),eG=async()=>{if(!q)return;console.log("handleImportBills: Importing bills from file",q.name);let e=new FileReader;e.onload=async e=>{try{var t;let s=JSON.parse(null==(t=e.target)?void 0:t.result);console.log("handleImportBills: Parsed bills for import",s);let n=await d.post("/api/bills/import",s);if(console.log("handleImportBills: Import API response",n),!n.status.toString().startsWith("2"))throw Error("Failed to import bills");console.log("Bills imported successfully"),H(!1),J(null),eF()}catch(e){console.error("Error parsing or importing bills",e)}},e.readAsText(q)};return(0,n.jsx)(i.default,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[!s&&(0,n.jsx)(r.A,{}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"Billing System"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Create and manage bills with discount adjustments"}),(eN||eS||eI)&&(0,n.jsx)("p",{className:"text-sm text-blue-500",children:"Loading data..."}),(ew||eP||eB)&&(0,n.jsx)("p",{className:"text-sm text-red-500",children:"Error loading data."})]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsxs)(o.$,{variant:"outline",onClick:eT,disabled:X||!s,children:[(0,n.jsx)(j.A,{className:"h-4 w-4 mr-2 ".concat(X?"animate-spin":"")}),X?"Refreshing...":"Refresh"]}),(0,n.jsxs)(p.lG,{open:$,onOpenChange:H,children:[(0,n.jsx)(p.zM,{asChild:!0,children:(0,n.jsxs)(o.$,{variant:"outline",disabled:!s,children:[(0,n.jsx)(P.A,{className:"h-4 w-4 mr-2"}),"Import Bills"]})}),(0,n.jsxs)(p.Cf,{children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Import Bills from JSON"}),(0,n.jsx)(p.rr,{children:"Upload a JSON file containing bill data."})]}),(0,n.jsx)("div",{className:"grid gap-4 py-4",children:(0,n.jsx)(m.p,{id:"billFile",type:"file",accept:".json",onChange:e=>J(e.target.files?e.target.files[0]:null)})}),(0,n.jsxs)(p.Es,{children:[(0,n.jsx)(o.$,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),(0,n.jsx)(o.$,{onClick:eG,disabled:!q,children:"Import"})]})]})]}),(0,n.jsxs)(p.lG,{open:B,onOpenChange:k,children:[(0,n.jsx)(p.zM,{asChild:!0,children:(0,n.jsxs)(o.$,{children:[(0,n.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Create Bill"]})}),(0,n.jsxs)(p.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Create New Bill"}),(0,n.jsx)(p.rr,{children:"Enter customer details and add products to create a bill"})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:"Customer Information"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"customerName",children:"Customer Name"}),(0,n.jsx)(m.p,{id:"customerName",value:Z,onChange:e=>Q(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"customerEmail",children:"Email (optional)"}),(0,n.jsx)(m.p,{id:"customerEmail",type:"email",value:K,onChange:e=>ee(e.target.value)})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"customerPhone",children:"Phone (optional)"}),(0,n.jsx)(m.p,{id:"customerPhone",value:et,onChange:e=>es(e.target.value)})]})]})]}),(0,n.jsx)(S.w,{}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:"Add Products"}),(0,n.jsxs)("div",{className:"flex gap-4 items-end",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)(u.J,{htmlFor:"productSelect",children:"Product"}),(0,n.jsxs)(f.l6,{value:el,onValueChange:ei,children:[(0,n.jsx)(f.bq,{children:(0,n.jsx)(f.yv,{placeholder:"Choose a product"})}),(0,n.jsx)(f.gC,{children:eR.map(e=>(0,n.jsxs)(f.eb,{value:e.id,children:[e.name," - ₹",e.price?e.price.toFixed(2):"0.00"," (Stock: ",e.stock,")"]},e.id))})]})]}),(0,n.jsxs)("div",{className:"w-24",children:[(0,n.jsx)(u.J,{htmlFor:"quantity",children:"Quantity"}),(0,n.jsx)(m.p,{id:"quantity",type:"number",min:"1",value:er,onChange:e=>eo(Number.parseInt(e.target.value)||1)})]}),(0,n.jsx)(o.$,{onClick:()=>{if(!el)return;let e=eR.find(e=>e.id===el);if(!e)return;console.log("addItemToBill: Adding product to bill",e,"Quantity:",er);let t=void 0!==e.price&&null!==e.price?e.price:0,s=void 0!==e.stock&&null!==e.stock?e.stock:1/0,n=en.findIndex(e=>e.productId===el),a=er;if(n>=0&&(a=en[n].quantity+er),a>s)return void alert("Cannot add ".concat(er," more units of ").concat(e.name,". Only ").concat(s-(n>=0?en[n].quantity:0)," units available."));if(n>=0){let e=[...en];e[n].quantity=a,e[n].total=e[n].quantity*t,ea(e)}else ea([...en,{productId:e.id,productName:e.name,price:t,quantity:er,total:t*er}]);ei(""),eo(1)},disabled:!el,children:"Add Item"})]})]}),en.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:"Bill Items"}),(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{children:"Product"}),(0,n.jsx)(h.nd,{children:"Price"}),(0,n.jsx)(h.nd,{children:"Quantity"}),(0,n.jsx)(h.nd,{children:"Total"}),(0,n.jsx)(h.nd,{children:"Actions"})]})}),(0,n.jsx)(h.BF,{children:en.map(e=>(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{children:e.productName}),(0,n.jsxs)(h.nA,{children:["₹",e.price.toFixed(2)]}),(0,n.jsx)(h.nA,{children:e.quantity}),(0,n.jsxs)(h.nA,{children:["₹",e.total.toFixed(2)]}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{var t;console.log("removeItemFromBill: Removing product ID from bill",t=e.productId),ea(en.filter(e=>e.productId!==t))},children:(0,n.jsx)(y.A,{className:"h-4 w-4"})})})]},e.productId))})]}),(0,n.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between text-base",children:[(0,n.jsx)("span",{children:"Subtotal"}),(0,n.jsxs)("span",{className:"font-medium",children:["₹",eq.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between text-base",children:[(0,n.jsx)("span",{children:"Tax (10%)"}),(0,n.jsxs)("span",{className:"font-medium",children:["₹",eJ.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)(u.J,{className:"flex items-center text-base",children:[(0,n.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Discount Percentage"]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.p,{type:"number",min:"0",max:"100",step:"0.1",value:ec.toFixed(1),onChange:e=>{ed(Math.max(0,Math.min(100,Number.parseFloat(e.target.value)||0)))},className:"w-20 text-right"}),(0,n.jsx)("span",{className:"text-sm",children:"%"})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600 mr-2",children:"Quick:"}),[5,10,15,20,25].map(e=>(0,n.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>ed(e),className:"text-xs h-7",children:[e,"%"]},e)),(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>ed(0),className:"text-xs h-7",children:"Clear"})]}),ec>0&&(0,n.jsxs)("div",{className:"flex justify-between text-base text-red-600",children:[(0,n.jsxs)("span",{children:["Discount (",ec.toFixed(1),"%)"]}),(0,n.jsxs)("span",{className:"font-medium",children:["-₹",eM.toFixed(2)]})]})]}),(0,n.jsx)(S.w,{}),(0,n.jsxs)("div",{className:"flex justify-between items-center text-xl font-bold",children:[(0,n.jsx)("span",{children:"Total"}),(0,n.jsxs)("span",{children:["₹",eW.toFixed(2)]})]}),ec>0&&(0,n.jsx)("div",{className:"text-center",children:(0,n.jsxs)("p",{className:"text-sm text-green-600 font-medium",children:["Customer saves ₹",eM.toFixed(2)," (",ec.toFixed(1),"% discount)"]})})]})]})]}),(0,n.jsxs)(p.Es,{children:[(0,n.jsx)(o.$,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),(0,n.jsx)(o.$,{onClick:eO,disabled:!Z||0===en.length,children:"Create Bill"})]})]})]})]})]}),(0,n.jsxs)(E.tU,{defaultValue:"bills",className:"w-full",children:[(0,n.jsxs)(E.j7,{className:"grid w-full grid-cols-2",children:[(0,n.jsx)(E.Xi,{value:"bills",children:"Bills History"}),(0,n.jsx)(E.Xi,{value:"customers",children:"Customers Info"})]}),(0,n.jsx)(E.av,{value:"bills",children:(0,n.jsxs)(x.Zp,{children:[(0,n.jsxs)(x.aR,{children:[(0,n.jsx)(x.ZB,{children:"Bills History"}),(0,n.jsxs)(x.BT,{children:[eD.length," bills created"]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(N.A,{className:"h-4 w-4 text-muted-foreground"}),(0,n.jsx)(m.p,{placeholder:"Search bills...",value:z,onChange:e=>O(e.target.value),className:"max-w-sm"})]})]}),(0,n.jsx)(x.Wu,{children:e$.length>0?(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{children:"Bill ID"}),(0,n.jsx)(h.nd,{children:"Customer"}),(0,n.jsx)(h.nd,{children:"Date"}),(0,n.jsx)(h.nd,{children:"Items"}),(0,n.jsx)(h.nd,{children:"Discount"}),(0,n.jsx)(h.nd,{children:"Total"}),(0,n.jsx)(h.nd,{children:"Status"}),(0,n.jsx)(h.nd,{children:"Actions"})]})}),(0,n.jsx)(h.BF,{children:e$.map(e=>{var t;return(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{className:"font-mono",children:e.id}),(0,n.jsx)(h.nA,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium",children:e.customerName||"Walk-in Customer"}),e.customerEmail&&(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:e.customerEmail})]})}),(0,n.jsx)(h.nA,{children:new Date(e.date).toLocaleDateString()}),(0,n.jsxs)(h.nA,{children:[(null==(t=e.items)?void 0:t.length)||0," items"]}),(0,n.jsx)(h.nA,{children:e.discountAmount>0?(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsxs)("div",{className:"text-red-600 font-medium",children:["-",e.discountPercentage.toFixed(1),"%"]}),(0,n.jsxs)("div",{className:"text-xs text-red-600",children:["-₹",e.discountAmount.toFixed(2)]})]}):(0,n.jsx)("span",{className:"text-gray-400",children:"No discount"})}),(0,n.jsxs)(h.nA,{className:"font-bold",children:["₹",e.total.toFixed(2)]}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(g.E,{variant:"default",children:e.status})}),(0,n.jsx)(h.nA,{children:(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{console.log("viewBill: Viewing bill",e),L(e),R(!0)},children:(0,n.jsx)(w.A,{className:"h-4 w-4"})}),(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>eU(e),children:(0,n.jsx)(A.A,{className:"h-4 w-4"})}),(0,n.jsxs)(p.lG,{children:[(0,n.jsx)(p.zM,{asChild:!0,children:(0,n.jsx)(o.$,{variant:"outline",size:"sm",children:(0,n.jsx)(y.A,{className:"h-4 w-4"})})}),(0,n.jsxs)(p.Cf,{children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Are you sure?"}),(0,n.jsxs)(p.rr,{children:["This action cannot be undone. This will permanently delete the bill ",e.id,"."]})]}),(0,n.jsxs)(p.Es,{children:[(0,n.jsx)(o.$,{variant:"outline",onClick:()=>{var e;return null==(e=document.querySelector('[data-state="open"]'))?void 0:e.click()},children:"Cancel"}),(0,n.jsx)(o.$,{variant:"destructive",onClick:()=>e_(e.id),children:"Delete"})]})]})]})]})})]},e.id)})})]}):(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(C.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-medium",children:"No bills found"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:z?"Try adjusting your search terms":"Create your first bill to get started"})]})})]})}),(0,n.jsx)(E.av,{value:"customers",children:(0,n.jsxs)(x.Zp,{children:[(0,n.jsxs)(x.aR,{children:[(0,n.jsx)(x.ZB,{children:"Customers Information"}),(0,n.jsxs)(x.BT,{children:[eL.length," registered customers"]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(N.A,{className:"h-4 w-4 text-muted-foreground"}),(0,n.jsx)(m.p,{placeholder:"Search customers...",value:_,onChange:e=>U(e.target.value),className:"max-w-sm"})]})]}),(0,n.jsx)(x.Wu,{children:eH.length>0?(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{children:"Name"}),(0,n.jsx)(h.nd,{children:"Email"}),(0,n.jsx)(h.nd,{children:"Phone"}),(0,n.jsx)(h.nd,{children:"Address"}),(0,n.jsx)(h.nd,{children:"Total Bills"}),(0,n.jsx)(h.nd,{children:"Total Spent"}),(0,n.jsx)(h.nd,{children:"Actions"})]})}),(0,n.jsx)(h.BF,{children:eH.map(e=>{let t=eD.filter(t=>(t.customerId||t.customerid)===e.id),s=t.reduce((e,t)=>e+(t.total||0),0);return(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{className:"font-medium",children:e.name||"N/A"}),(0,n.jsx)(h.nA,{children:e.email||"N/A"}),(0,n.jsx)(h.nA,{children:e.phone||"N/A"}),(0,n.jsx)(h.nA,{children:e.address||"N/A"}),(0,n.jsx)(h.nA,{children:t.length}),(0,n.jsxs)(h.nA,{children:["₹",s.toFixed(2)]}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{console.log("viewCustomer: Viewing customer",e),V(e),W(!0)},children:(0,n.jsx)(w.A,{className:"h-4 w-4"})})})]},e.id)})})]}):(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:"No customers found"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:_?"Try adjusting your search terms":"Customers will appear here once they have bills"})]})})]})})]}),(0,n.jsx)(p.lG,{open:T,onOpenChange:R,children:(0,n.jsxs)(p.Cf,{className:"max-w-2xl",children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Bill Details"}),(0,n.jsxs)(p.rr,{children:["Bill: ",null==D?void 0:D.id]})]}),D&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Customer Information"}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[(0,n.jsx)("div",{children:D.customerName||"Walk-in Customer"}),D.customerEmail&&(0,n.jsx)("div",{children:D.customerEmail}),D.customerPhone&&(0,n.jsx)("div",{children:D.customerPhone})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Bill Information"}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[(0,n.jsxs)("div",{children:["Date: ",new Date(D.date).toLocaleString()]}),(0,n.jsxs)("div",{children:["Status: ",D.status]}),void 0!==D.taxPercentage&&D.taxPercentage>0&&(0,n.jsxs)("div",{children:["Tax Rate: ",D.taxPercentage,"%"]})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"Items"}),(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{children:"Product"}),(0,n.jsx)(h.nd,{children:"Price"}),(0,n.jsx)(h.nd,{children:"Qty"}),(0,n.jsx)(h.nd,{children:"Total"})]})}),(0,n.jsx)(h.BF,{children:null==(e=D.items)?void 0:e.map((e,t)=>{let s=e.productName||e.product_name||e.productname||"Unknown Product",a=e.price||0,l=e.quantity||0,i=e.total||0;return(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{children:s}),(0,n.jsxs)(h.nA,{children:["₹",a.toFixed(2)]}),(0,n.jsx)(h.nA,{children:l}),(0,n.jsxs)(h.nA,{children:["₹",i.toFixed(2)]})]},t)})})]})]}),(0,n.jsxs)("div",{className:"space-y-2 text-right bg-gray-50 p-4 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Subtotal"}),(0,n.jsxs)("span",{children:["₹",D.subtotal.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{children:["Tax ",void 0!==D.taxPercentage&&D.taxPercentage>0&&"(".concat(D.taxPercentage,"%)")]}),(0,n.jsxs)("span",{children:["₹",(D.tax||0).toFixed(2)]})]}),D.discountPercentage>0&&(0,n.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,n.jsxs)("span",{children:["Discount (",D.discountPercentage.toFixed(1),"%)"]}),(0,n.jsxs)("span",{children:["-₹",D.discountAmount.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,n.jsx)("span",{children:"Total"}),(0,n.jsxs)("span",{children:["₹",D.total.toFixed(2)]})]})]})]}),(0,n.jsxs)(p.Es,{children:[(0,n.jsx)(o.$,{variant:"outline",onClick:()=>R(!1),children:"Close"}),D&&(0,n.jsxs)(o.$,{onClick:()=>eU(D),className:"bg-blue-600 hover:bg-blue-700",children:[(0,n.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Print Bill"]})]})]})}),(0,n.jsx)(p.lG,{open:M,onOpenChange:W,children:(0,n.jsxs)(p.Cf,{className:"max-w-2xl",children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Customer Details"}),(0,n.jsx)(p.rr,{children:null==G?void 0:G.name})]}),G&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Contact Information"}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[(0,n.jsxs)("div",{children:["Email: ",G.email||"N/A"]}),(0,n.jsxs)("div",{children:["Phone: ",G.phone||"N/A"]}),(0,n.jsxs)("div",{children:["Address: ",G.address||"N/A"]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Spending Overview"}),(0,n.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:(()=>{let e=eD.filter(e=>(e.customerId||e.customerid)===G.id),t=e.reduce((e,t)=>e+(t.total||0),0);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:["Total Bills: ",e.length]}),(0,n.jsxs)("div",{children:["Total Spent: ₹",t.toFixed(2)]})]})})()})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"font-medium mb-2",children:["Bills by ",G.name]}),(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{children:"Bill ID"}),(0,n.jsx)(h.nd,{children:"Date"}),(0,n.jsx)(h.nd,{children:"Total"}),(0,n.jsx)(h.nd,{children:"Status"}),(0,n.jsx)(h.nd,{children:"Actions"})]})}),(0,n.jsx)(h.BF,{children:eD.filter(e=>(e.customerId||e.customerid)===G.id).map(e=>(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{className:"font-mono",children:e.id}),(0,n.jsx)(h.nA,{children:new Date(e.date).toLocaleDateString()}),(0,n.jsxs)(h.nA,{children:["₹",e.total.toFixed(2)]}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(g.E,{variant:"default",children:e.status})}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{L(e),R(!0),W(!1)},children:(0,n.jsx)(w.A,{className:"h-4 w-4"})})})]},e.id))})]})]})]}),(0,n.jsx)(p.Es,{children:(0,n.jsx)(o.$,{variant:"outline",onClick:()=>W(!1),children:"Close"})})]})})]})})}},76577:(e,t,s)=>{"use strict";async function n(e){return new Promise((t,s)=>{try{var n;let a=!1,l=document.createElement("iframe");l.style.position="fixed",l.style.right="0",l.style.bottom="0",l.style.width="0",l.style.height="0",l.style.border="none",document.body.appendChild(l);let i=null==(n=l.contentWindow)?void 0:n.document;if(!i){document.body.removeChild(l),s(Error("Failed to access iframe document"));return}i.open(),i.write(e),i.close(),l.onload=()=>{if(!a){a=!0;try{var e,n;null==(e=l.contentWindow)||e.focus(),null==(n=l.contentWindow)||n.print(),setTimeout(()=>{l.parentNode&&document.body.removeChild(l),t()},1e3)}catch(e){l.parentNode&&document.body.removeChild(l),s(e)}}},setTimeout(()=>{if(!a){a=!0;try{l.contentWindow&&(l.contentWindow.focus(),l.contentWindow.print(),setTimeout(()=>{l.parentNode&&document.body.removeChild(l),t()},1e3))}catch(e){l.parentNode&&document.body.removeChild(l),s(e)}}},500)}catch(e){console.error("Print error:",e),s(e)}})}async function a(e){let{htmlContent:t,thermalContent:s,isThermalPrinter:a=!1,productIds:l,copies:i=1,useBackendPrint:r=!1,printerName:o,storeName:c}=e;if(r&&l&&l.length>0)try{let e="http://127.0.0.1:8080".replace(/\/+$/g,""),t={productIds:l,copies:i};o&&(t.printerName=o),c&&(t.storeName=c),console.log("\uD83D\uDCE4 Sending backend print request:",t);let s=await fetch("".concat(e,"/api/print-label"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await s.json().catch(()=>({}));if(s.ok&&"success"===n.status)return void console.log("✅ Backend print succeeded:",n.message||"");console.warn("⚠️ Backend print returned non-success, falling back to browser print",n)}catch(e){console.error("❌ Error sending backend print request, falling back to browser print:",e)}if(t){console.log("\uD83D\uDDA8️ Using browser-based HTML printing"),await n(t);return}if(s){console.log("\uD83D\uDDA8️ Using browser-based thermal content printing");let e='<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>Print</title>\n  <style>\n    body {\n      font-family: monospace;\n      white-space: pre-wrap;\n      margin: 0;\n      padding: 10mm;\n    }\n  </style>\n</head>\n<body><pre>'.concat(String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),"</pre></body>\n</html>");await n(e);return}throw Error("No printable content provided.")}s.d(t,{G:()=>a}),s(68267)},83209:(e,t,s)=>{"use strict";s.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>i,aR:()=>r});var n=s(95155),a=s(12115),l=s(25016);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});i.displayName="Card";let r=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...a})});r.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});o.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter"},90235:(e,t,s)=>{"use strict";s.d(t,{J:()=>c});var n=s(95155),a=s(12115),l=s(32894),i=s(83101),r=s(25016);let o=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.b,{ref:t,className:(0,r.cn)(o(),s),...a})});c.displayName=l.b.displayName},90923:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>c,av:()=>d,j7:()=>o,tU:()=>r});var n=s(95155),a=s(12115),l=s(25667),i=s(25016);let r=l.bL,o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.B8,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a})});o.displayName=l.B8.displayName;let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.l9,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a})});c.displayName=l.l9.displayName;let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.UC,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a})});d.displayName=l.UC.displayName},96633:(e,t,s)=>{"use strict";s.d(t,{A0:()=>r,BF:()=>o,Gg:()=>c,Hj:()=>d,XI:()=>i,nA:()=>u,nd:()=>m});var n=s(95155),a=s(12115),l=s(25016);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{className:"relative w-full overflow-auto",children:(0,n.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",s),...a})})});i.displayName="Table";let r=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",s),...a})});r.displayName="TableHeader";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...a})});o.displayName="TableBody";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a})});c.displayName="TableFooter";let d=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,n.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...i,children:a})});d.displayName="TableRow";let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a})});m.displayName="TableHead";let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a})});u.displayName="TableCell",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...a})}).displayName="TableCaption"}},e=>{e.O(0,[9206,6445,5239,3343,9648,6840,3018,832,8441,1255,7358],()=>e(e.s=18728)),_N_E=e.O()}]);