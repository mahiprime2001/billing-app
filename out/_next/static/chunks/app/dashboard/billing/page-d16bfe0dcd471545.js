(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3613],{18728:(e,t,s)=>{Promise.resolve().then(s.bind(s,63289))},28171:(e,t,s)=>{"use strict";s.d(t,{oR:()=>c}),s(12115);let a=0,n=new Map,l=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},r=[],i={toasts:[]};function o(e){i=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?l(s):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(i,e),r.forEach(e=>{e(i)})}function c(e){let{...t}=e,s=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>o({type:"DISMISS_TOAST",toastId:s});return o({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||n()}}}),{id:s,dismiss:n,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:s}})}}},47507:(e,t,s)=>{"use strict";s.d(t,{bq:()=>u,eb:()=>f,gC:()=>p,l6:()=>d,yv:()=>m});var a=s(95155),n=s(12115),l=s(4729),r=s(24033),i=s(12108),o=s(5917),c=s(25016);let d=l.bL;l.YJ;let m=l.WT,u=n.forwardRef((e,t)=>{let{className:s,children:n,...i}=e;return(0,a.jsxs)(l.l9,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[n,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(r.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let x=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.PP,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...n,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})});x.displayName=l.PP.displayName;let h=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.wn,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...n,children:(0,a.jsx)(r.A,{className:"h-4 w-4"})})});h.displayName=l.wn.displayName;let p=n.forwardRef((e,t)=>{let{className:s,children:n,position:r="popper",...i}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...i,children:[(0,a.jsx)(x,{}),(0,a.jsx)(l.LM,{className:(0,c.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,a.jsx)(h,{})]})})});p.displayName=l.UC.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.JU,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...n})}).displayName=l.JU.displayName;let f=n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e;return(0,a.jsxs)(l.q7,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(o.A,{className:"h-4 w-4"})})}),(0,a.jsx)(l.p4,{children:n})]})});f.displayName=l.q7.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...n})}).displayName=l.wv.displayName},54679:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>h,L3:()=>p,c7:()=>x,lG:()=>o,rr:()=>f,zM:()=>c});var a=s(95155),n=s(12115),l=s(93409),r=s(65229),i=s(25016);let o=l.bL,c=l.l9,d=l.ZL;l.bm;let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n})});m.displayName=l.hJ.displayName;let u=n.forwardRef((e,t)=>{let{className:s,children:n,...o}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(m,{}),(0,a.jsxs)(l.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...o,children:[n,(0,a.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(r.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=l.UC.displayName;let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};x.displayName="DialogHeader";let h=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="DialogFooter";let p=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...n})});p.displayName=l.hE.displayName;let f=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...n})});f.displayName=l.VY.displayName},62217:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(95155),n=s(12115),l=s(28171);function r(){let[e,t]=(0,n.useState)(!0),[s,r]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{let e=()=>{t(!0),s&&(0,l.oR)({title:"You are back online!",description:"All features are now available.",variant:"default"})},a=()=>{t(!1),s&&(0,l.oR)({title:"You are currently offline.",description:"Some features may not be available.",variant:"destructive"})};return window.addEventListener("online",e),window.addEventListener("offline",a),void 0!==navigator.onLine&&t(navigator.onLine),r(!0),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a)}},[s]),e)?null:(0,a.jsx)("div",{className:"bg-yellow-500 text-white text-center p-2",children:"You are currently offline. Some features may not be available."})}},63289:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>T});var a=s(95155),n=s(12115),l=s(20063),r=s(10832),i=s(62217),o=s(97003);let c=(e,t)=>{let{interval:s=5e3,enabled:a=!0}=t||{},[l,r]=(0,n.useState)(void 0),[i,o]=(0,n.useState)(!0),[c,d]=(0,n.useState)(void 0),m=(0,n.useRef)(e);return(0,n.useEffect)(()=>{m.current=e},[e]),(0,n.useEffect)(()=>{if(!a)return void o(!1);let e=async()=>{o(!0);try{let e=await m.current();r(e),d(void 0)}catch(e){d(e),r(void 0)}finally{o(!1)}};e();let t=setInterval(()=>{e()},s);return()=>clearInterval(t)},[s,a]),{data:l,loading:i,error:c,refetch:()=>{(async()=>{o(!0);try{let e=await m.current();r(e),d(void 0)}catch(e){d(e),r(void 0)}finally{o(!1)}})()}}},d=s(95125).A.create({baseURL:"http://localhost:8080",withCredentials:!0});d.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&(console.log("401 Unauthorized: Redirecting to login page."),localStorage.removeItem("adminLoggedIn"),localStorage.removeItem("adminUser"),window.location.href="/"),Promise.reject(e)));var m=s(33789),u=s(90235),x=s(83209),h=s(96633),p=s(54679),f=s(47507),g=s(67812),j=s(84916),b=s(89559),v=s(6191),y=s(71360),N=s(19204),w=s(86651),A=s(93341),C=s(57828),S=s(309),P=s(53409),F=s(54664),k=s(21786),E=s(76577),I=s(90923);function T(){var e;let t=(0,l.useRouter)(),[s,T]=(0,n.useState)(!0),[B,R]=(0,n.useState)(!1),[D,L]=(0,n.useState)(!1),[z,_]=(0,n.useState)(null),[O,U]=(0,n.useState)(""),[$,H]=(0,n.useState)(""),[q,J]=(0,n.useState)(!1),[M,W]=(0,n.useState)(null),[G,V]=(0,n.useState)(!1),[X,Y]=(0,n.useState)(null),[Z,Q]=(0,n.useState)(!1),[K,ee]=(0,n.useState)([]),[et,es]=(0,n.useState)([]),[ea,en]=(0,n.useState)(!1),[el,er]=(0,n.useState)("date"),[ei,eo]=(0,n.useState)("desc"),[ec,ed]=(0,n.useState)(""),[em,eu]=(0,n.useState)(""),[ex,eh]=(0,n.useState)(""),[ep,ef]=(0,n.useState)([]),[eg,ej]=(0,n.useState)(""),[eb,ev]=(0,n.useState)(1),[ey,eN]=(0,n.useState)(0),[ew,eA]=(0,n.useState)({gstin:"",taxPercentage:0,companyName:"",companyAddress:"",companyPhone:"",companyEmail:""}),[eC,eS]=(0,n.useState)({}),[eP,eF]=(0,n.useState)("A4");(0,n.useEffect)(()=>(console.log("BillingPage: Component mounting..."),localStorage.setItem("adminLoggedIn","true"),fetch("".concat("http://127.0.0.1:8080","/api/settings")).then(e=>e.json()).then(e=>{if(console.log("Settings: Loaded settings",e),e.systemSettings){let t=e.systemSettings,s={gstin:t.gstin||"",taxPercentage:t.taxPercentage||t.tax_percentage||0,companyName:t.companyName||t.company_name||"",companyAddress:t.companyAddress||t.company_address||"",companyPhone:t.companyPhone||t.company_phone||"",companyEmail:t.companyEmail||t.company_email||""};console.log("Settings: Normalized settings",s),eA(s)}e.billFormats&&eS(e.billFormats)}).catch(e=>console.error("Failed to load system settings and bill formats",e)),"true"!==localStorage.getItem("adminLoggedIn"))?void t.push("/"):(T(navigator.onLine),window.addEventListener("online",()=>T(!0)),window.addEventListener("offline",()=>T(!1)),()=>{window.removeEventListener("online",()=>T(!0)),window.removeEventListener("offline",()=>T(!1))}),[t]);let ek=(0,n.useCallback)(async(e,t,a,n)=>{if(console.log("fetchData: Fetching ".concat(n,"...")),s)try{console.log("fetchData: Fetching ".concat(n," from Supabase..."));let t=(await d.get(e)).data;console.log("fetchData: Raw ".concat(n," from API"),t);let s=t;return"products"===n?s=t.map(e=>({...e,stock:e.stock||0})):"customers"===n&&(s=t.map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone,address:e.address,createdAt:e.createdat||e.createdAt,updatedAt:e.updatedat||e.updatedAt}))),console.log("fetchData: Processed ".concat(n),s),d.post(a,s).catch(()=>{}),s}catch(s){console.warn("Failed to fetch ".concat(n," from Supabase, falling back to local"),s),console.log("fetchData: Falling back to local for ".concat(n));let e=await d.get(t);if(console.log("fetchData: Local ".concat(n," data"),e.data),"products"===n)return e.data.map(e=>({...e,stock:e.stock||0}));if("customers"===n)return e.data.map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone,address:e.address,createdAt:e.createdat||e.createdAt,updatedAt:e.updatedat||e.updatedAt}));return e.data}},[s]),eE=(0,n.useCallback)(()=>ek("/api/supabase/products","/api/local/products","/api/local/products/update","products"),[ek]),eI=(0,n.useCallback)(async()=>{if(console.log("fetchBills: Starting fetch..."),s)try{console.log("fetchBills: Fetching from Supabase...");let e=(await d.get("/api/supabase/bills-with-details")).data;console.log("fetchBills: Raw data from API",e),console.log("fetchBills: Number of bills",e.length),e.length>0&&e[0].items&&(console.log("fetchBills: First bill items",e[0].items),console.log("fetchBills: First item details",e[0].items[0]));let t=e.map(e=>{console.log("fetchBills: Processing bill ".concat(e.id));let t=e.discountpercentage||e.discountPercentage||0,s=e.discountamount||e.discountAmount||0,a=e.taxpercentage||e.taxPercentage||0,n=e.taxamount||e.taxAmount||e.tax||0;return{...e,date:e.timestamp||e.date,tax:n,taxPercentage:a,status:e.status||"Paid",items:"string"==typeof e.items?JSON.parse(e.items):e.items,discountPercentage:t,discountAmount:s}});return console.log("fetchBills: Final processed data",t),d.post("/api/local/bills/update",t).catch(()=>{}),t}catch(t){console.error("fetchBills: Error fetching from Supabase",t),console.log("fetchBills: Falling back to local storage");let e=await d.get("/api/local/bills");return console.log("fetchBills: Local data",e.data),e.data.map(e=>{let t=e.discountpercentage||e.discountPercentage||0,s=e.discountamount||e.discountAmount||0,a=e.taxpercentage||e.taxPercentage||0,n=e.taxamount||e.taxAmount||e.tax||0;return{...e,date:e.timestamp||e.date,tax:n,taxPercentage:a,status:e.status||"Paid",items:"string"==typeof e.items?JSON.parse(e.items):e.items,discountPercentage:t,discountAmount:s}})}},[s]),eT=(0,n.useCallback)(()=>ek("/api/supabase/customers","/api/local/customers","/api/local/customers/update","customers"),[ek]),{data:eB,loading:eR,error:eD,refetch:eL}=c(eE,{interval:2e4}),{data:ez,loading:e_,error:eO,refetch:eU}=c(eI,{interval:2e4}),{data:e$,loading:eH,error:eq,refetch:eJ}=c(eT,{interval:2e4}),eM=async()=>{console.log("handleManualRefresh: Manual refresh triggered."),Q(!0);try{await Promise.all([eL(),eU(),eJ()])}finally{setTimeout(()=>Q(!1),500)}};(0,n.useEffect)(()=>{eD&&console.error("Failed to load products",eD),eO&&console.error("Failed to load bills",eO),eq&&console.error("Failed to load customers",eq)},[eD,eO,eq]);let eW=eB||[],eG=ez||[],eV=e$||[];(0,n.useEffect)(()=>{console.log("Products: Updated products data",eB)},[eB]),(0,n.useEffect)(()=>{console.log("Bills: Updated bills data",ez)},[ez]),(0,n.useEffect)(()=>{console.log("Customers: Updated customers data",e$)},[e$]);let eX=()=>{let e=ep.reduce((e,t)=>e+t.total,0),t=.1*e,s=e*ey/100;return{subtotal:e,tax:t,discountAmount:s,total:e+t-s}},eY=async()=>{if(!ec||0===ep.length)return;console.log("createBill: Attempting to create bill...");let{subtotal:e,tax:t,discountAmount:s,total:a}=eX(),n={id:Date.now().toString(),customerName:ec,customerEmail:em,customerPhone:ex,items:ep,subtotal:e,tax:t,discountPercentage:ey,discountAmount:s,total:a,date:new Date().toISOString(),status:"Paid",companyName:ew.companyName,companyAddress:ew.companyAddress,companyPhone:ew.companyPhone,companyEmail:ew.companyEmail,gstin:ew.gstin,billFormat:eP};console.log("createBill: Bill payload",n);try{let e=await d.post("/api/bills",n);if(console.log("createBill: API response",e),!e.status.toString().startsWith("2"))throw Error("Failed to create bill");ed(""),eu(""),eh(""),ef([]),eN(0),R(!1),eU()}catch(e){console.error("Error creating bill",e),alert("Failed to create bill.")}},eZ=async e=>{if(0!==e.length)try{if((await Promise.all(e.map(e=>d.delete("/api/bills/".concat(e))))).some(e=>!e.status.toString().startsWith("2")))throw Error("Failed to delete bill");ee(t=>t.filter(t=>!e.includes(t))),es([]),en(!1),eU()}catch(e){console.error("Error deleting bills",e)}},eQ=async e=>{console.log("handlePrintBill: Printing bill",e),console.log("handlePrintBill: System settings",ew),console.log("handlePrintBill: Bill items",e.items);let t=eC[e.billFormat||eP]||eC.A4||{width:210,height:297,margins:{top:10,bottom:10,left:10,right:10},unit:"mm"};console.log("handlePrintBill: Using bill format",t);let s=((e,t)=>{console.log("generateReceiptHtml: Bill data",e),console.log("generateReceiptHtml: System settings",ew);let s=216===t.width&&279===t.height,a=210===t.width&&297===t.height,n=80===t.width,l=n?"80mm":s?"216mm":a?"210mm":"".concat(t.width,"mm"),r=e.companyName||ew.companyName||ew.company_name||"UNDEFINED",i=e.companyAddress||ew.companyAddress||ew.company_address||void 0,o=e.companyPhone||ew.companyPhone||ew.company_phone||void 0,c=e.companyEmail||ew.companyEmail||ew.company_email||void 0,d=e.gstin||ew.gstin||ew.gstin||"",m=e.taxPercentage||ew.taxPercentage||ew.tax_percentage||0;console.log("generateReceiptHtml: Using company info",{companyName:r,companyAddress:i,companyPhone:o,companyEmail:c,gstin:d,taxPercentage:m});let u=n?"11px":"13px";return"<!DOCTYPE html>\n<html>\n<head>\n  <title>Invoice - ".concat(e.id,"</title>\n  <style>\n    @page {\n      size: ").concat(s?"letter":a?"A4":"".concat(t.width,"mm ").concat("auto"===t.height?"auto":t.height+"mm"),";\n      margin: ").concat(t.margins.top,"mm ").concat(t.margins.right,"mm ").concat(t.margins.bottom,"mm ").concat(t.margins.left,"mm;\n    }\n    body {\n      font-family: Arial, sans-serif;\n      max-width: ").concat(l,";\n      margin: 0 auto;\n      font-size: ").concat(u,";\n      color: #000;\n      padding: ").concat(n?"5px 0":"0",";\n    }\n    .header, .footer {\n      text-align: center;\n      padding: ").concat(n?"5px 0":"10px 0",";\n    }\n    .company-name {\n      font-size: ").concat(n?"14px":"18px",";\n      font-weight: bold;\n      text-transform: uppercase;\n      margin-bottom: 3px;\n    }\n    .company-details {\n      font-size: ").concat(n?"10px":"12px",";\n      line-height: 1.4;\n    }\n    .invoice-title {\n      font-size: ").concat(n?"13px":"16px",";\n      font-weight: bold;\n      margin-top: ").concat(n?"5px":"10px",";\n      border-top: 1px solid #000;\n      border-bottom: 1px solid #000;\n      padding: ").concat(n?"3px 0":"5px 0",";\n    }\n    .section {\n      margin: ").concat(n?"10px 0":"15px 0",";\n    }\n    .section-title {\n      font-weight: bold;\n      border-bottom: 1px dashed #000;\n      margin-bottom: 5px;\n      padding-bottom: 2px;\n    }\n    .row {\n      display: flex;\n      justify-content: space-between;\n      margin-bottom: ").concat(n?"3px":"5px",";\n      font-size: ").concat(n?"10px":"12px",";\n    }\n    .items-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin-top: ").concat(n?"5px":"10px",";\n      font-size: ").concat(n?"10px":u,";\n    }\n    .items-table th, .items-table td {\n      border: 1px solid #000;\n      padding: ").concat(n?"3px 4px":"6px 8px",";\n      text-align: left;\n    }\n    .items-table th {\n      background-color: #f2f2f2;\n      font-weight: bold;\n    }\n    .items-table td.number {\n      text-align: right;\n    }\n    .totals {\n      margin-top: ").concat(n?"10px":"15px",";\n      border-top: 1px dashed #000;\n      padding-top: ").concat(n?"5px":"10px",";\n    }\n    .totals-row {\n      display: flex;\n      justify-content: space-between;\n      margin-bottom: ").concat(n?"3px":"5px",";\n      font-size: ").concat(n?"11px":"13px",";\n    }\n    .totals-row.total {\n      font-weight: bold;\n      font-size: ").concat(n?"13px":"15px",";\n      border-top: 2px solid #000;\n      padding-top: 5px;\n      margin-top: 5px;\n    }\n    .footer {\n      margin-top: ").concat(n?"10px":"20px",";\n      font-size: ").concat(n?"10px":"12px",';\n      border-top: 1px dashed #000;\n      padding-top: 10px;\n    }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <div class="company-name">').concat(r,'</div>\n    <div class="company-details">\n      ').concat(i,"<br>\n      Phone: ").concat(o,"<br>\n      Email: ").concat(c,"\n      ").concat(d?"<br>GSTIN: ".concat(d):"",'\n    </div>\n  </div>\n\n  <div class="invoice-title">INVOICE</div>\n\n  <div class="section">\n    <div class="row">\n      <span><strong>Invoice:</strong> ').concat(e.id.substring(5,17),"</span>\n      <span><strong>Date:</strong> ").concat(new Date(e.date).toLocaleDateString(),"</span>\n    </div>\n    ").concat(e.customerName||e.customerPhone?'\n    <div class="row">\n      <span><strong>Customer:</strong> '.concat(e.customerName||"Walk-in","</span>\n      ").concat(e.customerPhone?"<span>".concat(e.customerPhone,"</span>"):"","\n    </div>"):"",'\n  </div>\n\n  <table class="items-table">\n    <thead>\n      <tr>\n        <th style="width: ').concat(n?"10%":"8%",'">#</th>\n        <th style="width: ').concat(n?"40%":"45%",'">Item</th>\n        <th style="width: ').concat(n?"15%":"12%",'" class="number">Qty</th>\n        <th style="width: ').concat("17%",'" class="number">Rate</th>\n        <th style="width: ').concat("18%",'" class="number">Total</th>\n      </tr>\n    </thead>\n    <tbody>\n      ').concat(e.items.map((e,t)=>{let s=e.productName||e.product_name||e.productname||"Item";return"\n        <tr>\n          <td>".concat(t+1,"</td>\n          <td>").concat(s,'</td>\n          <td class="number">').concat(e.quantity,'</td>\n          <td class="number">₹').concat(e.price.toFixed(2),'</td>\n          <td class="number">₹').concat(e.total.toFixed(2),"</td>\n        </tr>")}).join(""),'\n    </tbody>\n  </table>\n\n  <div class="totals">\n    <div class="totals-row">\n      <span>Subtotal</span>\n      <span>₹').concat(e.subtotal.toFixed(2),"</span>\n    </div>\n    ").concat(e.discountAmount&&e.discountAmount>0?'\n    <div class="totals-row" style="color: #c00">\n      <span>Discount ('.concat(e.discountPercentage.toFixed(1),"%)</span>\n      <span>-₹").concat(e.discountAmount.toFixed(2),"</span>\n    </div>"):"",'\n    <div class="totals-row">\n      <span>Tax (').concat(m.toFixed(1),"%)</span>\n      <span>₹").concat(e.tax.toFixed(2),'</span>\n    </div>\n    <div class="totals-row total">\n      <span>TOTAL</span>\n      <span>₹').concat(e.total.toFixed(2),'</span>\n    </div>\n  </div>\n\n  <div class="footer">\n    <p style="margin: 5px 0;">Thank you for your business!</p>\n    ').concat(n?'<p style="margin: 5px 0; font-size: 9px;">Powered by SIRI Billing System</p>':"","\n  </div>\n</body>\n</html>")})(e,t);try{await (0,E.G)({htmlContent:s})}catch(e){console.error("Failed to send print job",e),alert("Failed to print bill. Please check console for details.")}},eK=(0,n.useMemo)(()=>{let e=O.toLowerCase(),t=eG.filter(t=>{let s=t.customerName||"",a=t.id||"";return s.toLowerCase().includes(e)||a.includes(e)}),s=e=>{switch(el){case"total":return e.total||0;case"discount":return e.discountAmount||0;case"customer":return(e.customerName||"").toLowerCase();case"items":var t;return(null==(t=e.items)?void 0:t.length)||0;default:return new Date(e.date).getTime()}};return[...t].sort((e,t)=>{let a=s(e),n=s(t);if("string"==typeof a&&"string"==typeof n){let e=a.localeCompare(n);return"asc"===ei?e:-e}let l=Number(a)-Number(n);return"asc"===ei?l:-l})},[eG,O,ei,el]),e0=eK.length>0&&eK.every(e=>K.includes(e.id)),e1=!e0&&eK.some(e=>K.includes(e.id)),e2=eV.filter(e=>{let t=e.name||"",s=e.email||"",a=e.phone||"",n=$.toLowerCase();return t.toLowerCase().includes(n)||s.toLowerCase().includes(n)||a.toLowerCase().includes(n)});(0,n.useEffect)(()=>{let e=new Set(eG.map(e=>e.id));ee(t=>t.filter(t=>e.has(t)))},[eG]);let{subtotal:e5,tax:e4,discountAmount:e6,total:e3}=eX(),e9=async()=>{if(!M)return;console.log("handleImportBills: Importing bills from file",M.name);let e=new FileReader;e.onload=async e=>{try{var t;let s=JSON.parse(null==(t=e.target)?void 0:t.result);console.log("handleImportBills: Parsed bills for import",s);let a=await d.post("/api/bills/import",s);if(console.log("handleImportBills: Import API response",a),!a.status.toString().startsWith("2"))throw Error("Failed to import bills");console.log("Bills imported successfully"),J(!1),W(null),eU()}catch(e){console.error("Error parsing or importing bills",e)}},e.readAsText(M)};return(0,a.jsx)(r.default,{children:(0,a.jsxs)("div",{className:"space-y-6 max-w-full overflow-x-auto",children:[!s&&(0,a.jsx)(i.A,{}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Billing System"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Create and manage bills with discount adjustments"}),(eR||e_||eH)&&(0,a.jsx)("p",{className:"text-sm text-blue-500",children:"Loading data..."}),(eD||eO||eq)&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:"Error loading data."})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(o.$,{variant:"outline",onClick:eM,disabled:Z||!s,children:[(0,a.jsx)(b.A,{className:"h-4 w-4 mr-2 ".concat(Z?"animate-spin":"")}),Z?"Refreshing...":"Refresh"]}),(0,a.jsxs)(p.lG,{open:q,onOpenChange:J,children:[(0,a.jsx)(p.zM,{asChild:!0,children:(0,a.jsxs)(o.$,{variant:"outline",disabled:!s,children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Import Bills"]})}),(0,a.jsxs)(p.Cf,{children:[(0,a.jsxs)(p.c7,{children:[(0,a.jsx)(p.L3,{children:"Import Bills from JSON"}),(0,a.jsx)(p.rr,{children:"Upload a JSON file containing bill data."})]}),(0,a.jsx)("div",{className:"grid gap-4 py-4",children:(0,a.jsx)(m.p,{id:"billFile",type:"file",accept:".json",onChange:e=>W(e.target.files?e.target.files[0]:null)})}),(0,a.jsxs)(p.Es,{children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>J(!1),children:"Cancel"}),(0,a.jsx)(o.$,{onClick:e9,disabled:!M,children:"Import"})]})]})]}),(0,a.jsxs)(p.lG,{open:B,onOpenChange:R,children:[(0,a.jsx)(p.zM,{asChild:!0,children:(0,a.jsxs)(o.$,{children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Create Bill"]})}),(0,a.jsxs)(p.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(p.c7,{children:[(0,a.jsx)(p.L3,{children:"Create New Bill"}),(0,a.jsx)(p.rr,{children:"Enter customer details and add products to create a bill"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Customer Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"customerName",children:"Customer Name"}),(0,a.jsx)(m.p,{id:"customerName",value:ec,onChange:e=>ed(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"customerEmail",children:"Email (optional)"}),(0,a.jsx)(m.p,{id:"customerEmail",type:"email",value:em,onChange:e=>eu(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"customerPhone",children:"Phone (optional)"}),(0,a.jsx)(m.p,{id:"customerPhone",value:ex,onChange:e=>eh(e.target.value)})]})]})]}),(0,a.jsx)(F.w,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Add Products"}),(0,a.jsxs)("div",{className:"flex gap-4 items-end",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(u.J,{htmlFor:"productSelect",children:"Product"}),(0,a.jsxs)(f.l6,{value:eg,onValueChange:ej,children:[(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Choose a product"})}),(0,a.jsx)(f.gC,{children:eW.map(e=>(0,a.jsxs)(f.eb,{value:e.id,children:[e.name," - ₹",e.price?e.price.toFixed(2):"0.00"," (Stock: ",e.stock,")"]},e.id))})]})]}),(0,a.jsxs)("div",{className:"w-24",children:[(0,a.jsx)(u.J,{htmlFor:"quantity",children:"Quantity"}),(0,a.jsx)(m.p,{id:"quantity",type:"number",min:"1",value:eb,onChange:e=>ev(Number.parseInt(e.target.value)||1)})]}),(0,a.jsx)(o.$,{onClick:()=>{if(!eg)return;let e=eW.find(e=>e.id===eg);if(!e)return;console.log("addItemToBill: Adding product to bill",e,"Quantity:",eb);let t=void 0!==e.price&&null!==e.price?e.price:0,s=void 0!==e.stock&&null!==e.stock?e.stock:1/0,a=ep.findIndex(e=>e.productId===eg),n=eb;if(a>=0&&(n=ep[a].quantity+eb),n>s)return void alert("Cannot add ".concat(eb," more units of ").concat(e.name,". Only ").concat(s-(a>=0?ep[a].quantity:0)," units available."));if(a>=0){let e=[...ep];e[a].quantity=n,e[a].total=e[a].quantity*t,ef(e)}else ef([...ep,{productId:e.id,productName:e.name,price:t,quantity:eb,total:t*eb}]);ej(""),ev(1)},disabled:!eg,children:"Add Item"})]})]}),ep.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Bill Items"}),(0,a.jsxs)(h.XI,{children:[(0,a.jsx)(h.A0,{children:(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nd,{children:"Product"}),(0,a.jsx)(h.nd,{children:"Price"}),(0,a.jsx)(h.nd,{children:"Quantity"}),(0,a.jsx)(h.nd,{children:"Total"}),(0,a.jsx)(h.nd,{children:"Actions"})]})}),(0,a.jsx)(h.BF,{children:ep.map(e=>(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nA,{children:e.productName}),(0,a.jsxs)(h.nA,{children:["₹",e.price.toFixed(2)]}),(0,a.jsx)(h.nA,{children:e.quantity}),(0,a.jsxs)(h.nA,{children:["₹",e.total.toFixed(2)]}),(0,a.jsx)(h.nA,{children:(0,a.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{var t;console.log("removeItemFromBill: Removing product ID from bill",t=e.productId),ef(ep.filter(e=>e.productId!==t))},children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})})]},e.productId))})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between text-base",children:[(0,a.jsx)("span",{children:"Subtotal"}),(0,a.jsxs)("span",{className:"font-medium",children:["₹",e5.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-base",children:[(0,a.jsx)("span",{children:"Tax (10%)"}),(0,a.jsxs)("span",{className:"font-medium",children:["₹",e4.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(u.J,{className:"flex items-center text-base",children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Discount Percentage"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(m.p,{type:"number",min:"0",max:"100",step:"0.1",value:ey.toFixed(1),onChange:e=>{eN(Math.max(0,Math.min(100,Number.parseFloat(e.target.value)||0)))},className:"w-20 text-right"}),(0,a.jsx)("span",{className:"text-sm",children:"%"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600 mr-2",children:"Quick:"}),[5,10,15,20,25].map(e=>(0,a.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>eN(e),className:"text-xs h-7",children:[e,"%"]},e)),(0,a.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>eN(0),className:"text-xs h-7",children:"Clear"})]}),ey>0&&(0,a.jsxs)("div",{className:"flex justify-between text-base text-red-600",children:[(0,a.jsxs)("span",{children:["Discount (",ey.toFixed(1),"%)"]}),(0,a.jsxs)("span",{className:"font-medium",children:["-₹",e6.toFixed(2)]})]})]}),(0,a.jsx)(F.w,{}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-xl font-bold",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsxs)("span",{children:["₹",e3.toFixed(2)]})]}),ey>0&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("p",{className:"text-sm text-green-600 font-medium",children:["Customer saves ₹",e6.toFixed(2)," (",ey.toFixed(1),"% discount)"]})})]})]})]}),(0,a.jsxs)(p.Es,{children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),(0,a.jsx)(o.$,{onClick:eY,disabled:!ec||0===ep.length,children:"Create Bill"})]})]})]})]})]}),(0,a.jsxs)(I.tU,{defaultValue:"bills",className:"w-full",children:[(0,a.jsxs)(I.j7,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(I.Xi,{value:"bills",children:"Bills History"}),(0,a.jsx)(I.Xi,{value:"customers",children:"Customers Info"})]}),(0,a.jsx)(I.av,{value:"bills",children:(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsx)(x.ZB,{children:"Bills History"}),(0,a.jsxs)(x.BT,{children:[eG.length," bills created"]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(w.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)(m.p,{placeholder:"Search bills...",value:O,onChange:e=>U(e.target.value),className:"max-w-sm"})]}),(0,a.jsxs)(f.l6,{value:el,onValueChange:e=>er(e),children:[(0,a.jsx)(f.bq,{className:"w-[180px]",children:(0,a.jsx)(f.yv,{placeholder:"Sort by"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"date",children:"Date"}),(0,a.jsx)(f.eb,{value:"total",children:"Total"}),(0,a.jsx)(f.eb,{value:"discount",children:"Discount Amount"}),(0,a.jsx)(f.eb,{value:"items",children:"Items Count"}),(0,a.jsx)(f.eb,{value:"customer",children:"Customer Name"})]})]}),(0,a.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>{eo(e=>"asc"===e?"desc":"asc")},children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-1"}),"asc"===ei?"Ascending":"Descending"]}),K.length>0&&(0,a.jsxs)(o.$,{variant:"destructive",size:"sm",onClick:()=>{0!==K.length&&(es(K),en(!0))},children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Delete Selected (",K.length,")"]})]})]}),(0,a.jsx)(x.Wu,{children:eK.length>0?(0,a.jsxs)(h.XI,{children:[(0,a.jsx)(h.A0,{children:(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nd,{className:"w-12",children:(0,a.jsx)(j.S,{checked:e0||!!e1&&"indeterminate",onCheckedChange:e=>(e=>{let t=eK.map(e=>e.id);if(!e)return void ee(e=>e.filter(e=>!t.includes(e)));ee(e=>Array.from(new Set([...e,...t])))})(!0===e),"aria-label":"Select all bills"})}),(0,a.jsx)(h.nd,{children:"Bill ID"}),(0,a.jsx)(h.nd,{children:"Customer"}),(0,a.jsx)(h.nd,{children:"Date"}),(0,a.jsx)(h.nd,{children:"Items"}),(0,a.jsx)(h.nd,{children:"Discount"}),(0,a.jsx)(h.nd,{children:"Total"}),(0,a.jsx)(h.nd,{children:"Status"}),(0,a.jsx)(h.nd,{children:"Actions"})]})}),(0,a.jsx)(h.BF,{children:eK.map(e=>{var t;return(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nA,{children:(0,a.jsx)(j.S,{checked:K.includes(e.id),onCheckedChange:t=>{var s,a;return s=e.id,a=!0===t,void ee(e=>a?e.includes(s)?e:[...e,s]:e.filter(e=>e!==s))},"aria-label":"Select bill ".concat(e.id)})}),(0,a.jsx)(h.nA,{className:"font-mono",children:e.id}),(0,a.jsx)(h.nA,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.customerName||"Walk-in Customer"}),e.customerEmail&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:e.customerEmail})]})}),(0,a.jsx)(h.nA,{children:new Date(e.date).toLocaleDateString()}),(0,a.jsxs)(h.nA,{children:[(null==(t=e.items)?void 0:t.length)||0," items"]}),(0,a.jsx)(h.nA,{children:e.discountAmount>0?(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{className:"text-red-600 font-medium",children:["-",e.discountPercentage.toFixed(1),"%"]}),(0,a.jsxs)("div",{className:"text-xs text-red-600",children:["-₹",e.discountAmount.toFixed(2)]})]}):(0,a.jsx)("span",{className:"text-gray-400",children:"No discount"})}),(0,a.jsxs)(h.nA,{className:"font-bold",children:["₹",e.total.toFixed(2)]}),(0,a.jsx)(h.nA,{children:(0,a.jsx)(g.E,{variant:"default",children:e.status})}),(0,a.jsx)(h.nA,{children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{console.log("viewBill: Viewing bill",e),_(e),L(!0)},children:(0,a.jsx)(C.A,{className:"h-4 w-4"})}),(0,a.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>eQ(e),children:(0,a.jsx)(S.A,{className:"h-4 w-4"})}),(0,a.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{es([e.id]),en(!0)},children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})]})})]},e.id)})})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(P.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium",children:"No bills found"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:O?"Try adjusting your search terms":"Create your first bill to get started"})]})})]})}),(0,a.jsx)(I.av,{value:"customers",children:(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsx)(x.ZB,{children:"Customers Information"}),(0,a.jsxs)(x.BT,{children:[eV.length," registered customers"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(w.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)(m.p,{placeholder:"Search customers...",value:$,onChange:e=>H(e.target.value),className:"max-w-sm"})]})]}),(0,a.jsx)(x.Wu,{children:e2.length>0?(0,a.jsxs)(h.XI,{children:[(0,a.jsx)(h.A0,{children:(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nd,{children:"Name"}),(0,a.jsx)(h.nd,{children:"Email"}),(0,a.jsx)(h.nd,{children:"Phone"}),(0,a.jsx)(h.nd,{children:"Address"}),(0,a.jsx)(h.nd,{children:"Total Bills"}),(0,a.jsx)(h.nd,{children:"Total Spent"}),(0,a.jsx)(h.nd,{children:"Actions"})]})}),(0,a.jsx)(h.BF,{children:e2.map(e=>{let t=eG.filter(t=>(t.customerId||t.customerid)===e.id),s=t.reduce((e,t)=>e+(t.total||0),0);return(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nA,{className:"font-medium",children:e.name||"N/A"}),(0,a.jsx)(h.nA,{children:e.email||"N/A"}),(0,a.jsx)(h.nA,{children:e.phone||"N/A"}),(0,a.jsx)(h.nA,{children:e.address||"N/A"}),(0,a.jsx)(h.nA,{children:t.length}),(0,a.jsxs)(h.nA,{children:["₹",s.toFixed(2)]}),(0,a.jsx)(h.nA,{children:(0,a.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{console.log("viewCustomer: Viewing customer",e),Y(e),V(!0)},children:(0,a.jsx)(C.A,{className:"h-4 w-4"})})})]},e.id)})})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"No customers found"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:$?"Try adjusting your search terms":"Customers will appear here once they have bills"})]})})]})})]}),(0,a.jsx)(p.lG,{open:D,onOpenChange:L,children:(0,a.jsxs)(p.Cf,{className:"max-w-2xl",children:[(0,a.jsxs)(p.c7,{children:[(0,a.jsx)(p.L3,{children:"Bill Details"}),(0,a.jsxs)(p.rr,{children:["Bill: ",null==z?void 0:z.id]})]}),z&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:"Customer Information"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[(0,a.jsx)("div",{children:z.customerName||"Walk-in Customer"}),z.customerEmail&&(0,a.jsx)("div",{children:z.customerEmail}),z.customerPhone&&(0,a.jsx)("div",{children:z.customerPhone})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:"Bill Information"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[(0,a.jsxs)("div",{children:["Date: ",new Date(z.date).toLocaleString()]}),(0,a.jsxs)("div",{children:["Status: ",z.status]}),void 0!==z.taxPercentage&&z.taxPercentage>0&&(0,a.jsxs)("div",{children:["Tax Rate: ",z.taxPercentage,"%"]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Items"}),(0,a.jsxs)(h.XI,{children:[(0,a.jsx)(h.A0,{children:(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nd,{children:"Product"}),(0,a.jsx)(h.nd,{children:"Price"}),(0,a.jsx)(h.nd,{children:"Qty"}),(0,a.jsx)(h.nd,{children:"Total"})]})}),(0,a.jsx)(h.BF,{children:null==(e=z.items)?void 0:e.map((e,t)=>{let s=e.productName||e.product_name||e.productname||"Unknown Product",n=e.price||0,l=e.quantity||0,r=e.total||0;return(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nA,{children:s}),(0,a.jsxs)(h.nA,{children:["₹",n.toFixed(2)]}),(0,a.jsx)(h.nA,{children:l}),(0,a.jsxs)(h.nA,{children:["₹",r.toFixed(2)]})]},t)})})]})]}),(0,a.jsxs)("div",{className:"space-y-2 text-right bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal"}),(0,a.jsxs)("span",{children:["₹",z.subtotal.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Tax ",void 0!==z.taxPercentage&&z.taxPercentage>0&&"(".concat(z.taxPercentage,"%)")]}),(0,a.jsxs)("span",{children:["₹",(z.tax||0).toFixed(2)]})]}),z.discountPercentage>0&&(0,a.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,a.jsxs)("span",{children:["Discount (",z.discountPercentage.toFixed(1),"%)"]}),(0,a.jsxs)("span",{children:["-₹",z.discountAmount.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsxs)("span",{children:["₹",z.total.toFixed(2)]})]})]})]}),(0,a.jsxs)(p.Es,{children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>L(!1),children:"Close"}),z&&(0,a.jsxs)(o.$,{onClick:()=>eQ(z),className:"bg-blue-600 hover:bg-blue-700",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Print Bill"]})]})]})}),(0,a.jsx)(p.lG,{open:ea,onOpenChange:e=>{en(e),e||es([])},children:(0,a.jsxs)(p.Cf,{children:[(0,a.jsxs)(p.c7,{children:[(0,a.jsx)(p.L3,{children:"Are you sure?"}),(0,a.jsxs)(p.rr,{children:["This action cannot be undone. This will permanently delete"," ",et.length>1?"".concat(et.length," selected bills"):"bill ".concat(et[0]||""),"."]})]}),(0,a.jsxs)(p.Es,{children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>{en(!1),es([])},children:"Cancel"}),(0,a.jsx)(o.$,{variant:"destructive",onClick:()=>eZ(et),children:"Delete"})]})]})}),(0,a.jsx)(p.lG,{open:G,onOpenChange:V,children:(0,a.jsxs)(p.Cf,{className:"max-w-2xl max-h-[85vh] flex flex-col",children:[(0,a.jsxs)(p.c7,{children:[(0,a.jsx)(p.L3,{children:"Customer Details"}),(0,a.jsx)(p.rr,{children:null==X?void 0:X.name})]}),X&&(0,a.jsxs)("div",{className:"space-y-6 overflow-y-auto pr-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:"Contact Information"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[(0,a.jsxs)("div",{children:["Email: ",X.email||"N/A"]}),(0,a.jsxs)("div",{children:["Phone: ",X.phone||"N/A"]}),(0,a.jsxs)("div",{children:["Address: ",X.address||"N/A"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:"Spending Overview"}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:(()=>{let e=eG.filter(e=>(e.customerId||e.customerid)===X.id),t=e.reduce((e,t)=>e+(t.total||0),0);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:["Total Bills: ",e.length]}),(0,a.jsxs)("div",{children:["Total Spent: ₹",t.toFixed(2)]})]})})()})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium mb-2",children:["Bills by ",X.name]}),(0,a.jsx)("div",{className:"max-h-[360px] overflow-y-auto border rounded-md",children:(0,a.jsxs)(h.XI,{children:[(0,a.jsx)(h.A0,{className:"sticky top-0 bg-white z-10",children:(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nd,{children:"Bill ID"}),(0,a.jsx)(h.nd,{children:"Date"}),(0,a.jsx)(h.nd,{children:"Total"}),(0,a.jsx)(h.nd,{children:"Status"}),(0,a.jsx)(h.nd,{children:"Actions"})]})}),(0,a.jsx)(h.BF,{children:eG.filter(e=>(e.customerId||e.customerid)===X.id).map(e=>(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nA,{className:"font-mono",children:e.id}),(0,a.jsx)(h.nA,{children:new Date(e.date).toLocaleDateString()}),(0,a.jsxs)(h.nA,{children:["₹",e.total.toFixed(2)]}),(0,a.jsx)(h.nA,{children:(0,a.jsx)(g.E,{children:e.status})}),(0,a.jsx)(h.nA,{children:(0,a.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{_(e),L(!0),V(!1)},children:(0,a.jsx)(C.A,{className:"h-4 w-4"})})})]},e.id))})]})})]})]}),(0,a.jsx)(p.Es,{children:(0,a.jsx)(o.$,{variant:"outline",onClick:()=>V(!1),children:"Close"})})]})})]})})}},76577:(e,t,s)=>{"use strict";async function a(e){return new Promise((t,s)=>{try{var a;let n=!1,l=document.createElement("iframe");l.style.position="fixed",l.style.right="0",l.style.bottom="0",l.style.width="0",l.style.height="0",l.style.border="none",document.body.appendChild(l);let r=null==(a=l.contentWindow)?void 0:a.document;if(!r){document.body.removeChild(l),s(Error("Failed to access iframe document"));return}r.open(),r.write(e),r.close(),l.onload=()=>{if(!n){n=!0;try{var e,a;null==(e=l.contentWindow)||e.focus(),null==(a=l.contentWindow)||a.print(),setTimeout(()=>{l.parentNode&&document.body.removeChild(l),t()},1e3)}catch(e){l.parentNode&&document.body.removeChild(l),s(e)}}},setTimeout(()=>{if(!n){n=!0;try{l.contentWindow&&(l.contentWindow.focus(),l.contentWindow.print(),setTimeout(()=>{l.parentNode&&document.body.removeChild(l),t()},1e3))}catch(e){l.parentNode&&document.body.removeChild(l),s(e)}}},500)}catch(e){console.error("Print error:",e),s(e)}})}async function n(e){let{htmlContent:t,thermalContent:s,isThermalPrinter:n=!1,labelData:l,copies:r=1,useBackendPrint:i=!1,printerName:o,storeName:c}=e;if(i&&l&&l.length>0)try{let e="http://127.0.0.1:8080".replace(/\/+$/g,""),t={labelData:l.map(e=>{let t=e.selling_price;return void 0===t&&void 0!==e.sellingPrice&&(t=e.sellingPrice),{id:e.id,name:e.name,barcode:e.barcode,selling_price:null!=t?t:0,batchNumber:e.batchNumber||""}}),copies:r};o&&(t.printerName=o),c&&(t.storeName=c),console.log("\uD83D\uDCE4 Sending backend print request (selling_price only):",t);let s=await fetch("".concat(e,"/api/print-label"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await s.json().catch(()=>({}));if(s.ok&&"success"===a.status)return void console.log("✅ Backend print succeeded:",a.message||"");console.warn("⚠️ Backend print returned non-success, falling back to browser print",a)}catch(e){console.error("❌ Error sending backend print request, falling back to browser print:",e)}if(t){console.log("\uD83D\uDDA8️ Using browser-based HTML printing"),await a(t);return}if(s){console.log("\uD83D\uDDA8️ Using browser-based thermal content printing");let e='<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>Print</title>\n  <style>\n    body {\n      font-family: monospace;\n      white-space: pre-wrap;\n      margin: 0;\n      padding: 10mm;\n    }\n  </style>\n</head>\n<body><pre>'.concat(String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),"</pre></body>\n</html>");await a(e);return}throw Error("No printable content provided.")}s.d(t,{G:()=>n}),s(68267)},83209:(e,t,s)=>{"use strict";s.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>r,aR:()=>i});var a=s(95155),n=s(12115),l=s(25016);let r=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});r.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...n})});i.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});o.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...n})});d.displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter"},84916:(e,t,s)=>{"use strict";s.d(t,{S:()=>o});var a=s(95155),n=s(12115),l=s(38162),r=s(5917),i=s(25016);let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.bL,{ref:t,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:(0,a.jsx)(l.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(r.A,{className:"h-4 w-4"})})})});o.displayName=l.bL.displayName},90235:(e,t,s)=>{"use strict";s.d(t,{J:()=>c});var a=s(95155),n=s(12115),l=s(32894),r=s(83101),i=s(25016);let o=(0,r.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.b,{ref:t,className:(0,i.cn)(o(),s),...n})});c.displayName=l.b.displayName},90923:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>c,av:()=>d,j7:()=>o,tU:()=>i});var a=s(95155),n=s(12115),l=s(25667),r=s(25016);let i=l.bL,o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.B8,{ref:t,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...n})});o.displayName=l.B8.displayName;let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.l9,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...n})});c.displayName=l.l9.displayName;let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.UC,{ref:t,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...n})});d.displayName=l.UC.displayName},96633:(e,t,s)=>{"use strict";s.d(t,{A0:()=>i,BF:()=>o,Gg:()=>c,Hj:()=>d,XI:()=>r,nA:()=>u,nd:()=>m});var a=s(95155),n=s(12115),l=s(25016);let r=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",s),...n})})});r.displayName="Table";let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",s),...n})});i.displayName="TableHeader";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...n})});o.displayName="TableBody";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...n})});c.displayName="TableFooter";let d=n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e;return(0,a.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r,children:n})});d.displayName="TableRow";let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...n})});m.displayName="TableHead";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...n})});u.displayName="TableCell",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...n})}).displayName="TableCaption"}},e=>{e.O(0,[9206,6445,5239,5584,9648,6840,1020,832,8441,1255,7358],()=>e(e.s=18728)),_N_E=e.O()}]);