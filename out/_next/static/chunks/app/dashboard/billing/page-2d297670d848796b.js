(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3613],{18728:(e,t,s)=>{Promise.resolve().then(s.bind(s,63289))},28171:(e,t,s)=>{"use strict";s.d(t,{oR:()=>c}),s(12115);let n=0,a=new Map,l=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},r=[],i={toasts:[]};function o(e){i=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?l(s):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(i,e),r.forEach(e=>{e(i)})}function c(e){let{...t}=e,s=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>o({type:"DISMISS_TOAST",toastId:s});return o({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:s}})}}},47507:(e,t,s)=>{"use strict";s.d(t,{bq:()=>u,eb:()=>f,gC:()=>p,l6:()=>d,yv:()=>m});var n=s(95155),a=s(12115),l=s(4729),r=s(24033),i=s(12108),o=s(5917),c=s(25016);let d=l.bL;l.YJ;let m=l.WT,u=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,n.jsxs)(l.l9,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[a,(0,n.jsx)(l.In,{asChild:!0,children:(0,n.jsx)(r.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.PP,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,n.jsx)(i.A,{className:"h-4 w-4"})})});x.displayName=l.PP.displayName;let h=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.wn,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,n.jsx)(r.A,{className:"h-4 w-4"})})});h.displayName=l.wn.displayName;let p=a.forwardRef((e,t)=>{let{className:s,children:a,position:r="popper",...i}=e;return(0,n.jsx)(l.ZL,{children:(0,n.jsxs)(l.UC,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...i,children:[(0,n.jsx)(x,{}),(0,n.jsx)(l.LM,{className:(0,c.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,n.jsx)(h,{})]})})});p.displayName=l.UC.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.JU,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=l.JU.displayName;let f=a.forwardRef((e,t)=>{let{className:s,children:a,...r}=e;return(0,n.jsxs)(l.q7,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(l.VF,{children:(0,n.jsx)(o.A,{className:"h-4 w-4"})})}),(0,n.jsx)(l.p4,{children:a})]})});f.displayName=l.q7.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=l.wv.displayName},54679:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>h,L3:()=>p,c7:()=>x,lG:()=>o,rr:()=>f,zM:()=>c});var n=s(95155),a=s(12115),l=s(93409),r=s(65229),i=s(25016);let o=l.bL,c=l.l9,d=l.ZL;l.bm;let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a})});m.displayName=l.hJ.displayName;let u=a.forwardRef((e,t)=>{let{className:s,children:a,...o}=e;return(0,n.jsxs)(d,{children:[(0,n.jsx)(m,{}),(0,n.jsxs)(l.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...o,children:[a,(0,n.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(r.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=l.UC.displayName;let x=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};x.displayName="DialogHeader";let h=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="DialogFooter";let p=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...a})});p.displayName=l.hE.displayName;let f=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...a})});f.displayName=l.VY.displayName},62217:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var n=s(95155),a=s(12115),l=s(28171);function r(){let[e,t]=(0,a.useState)(!0),[s,r]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e=()=>{t(!0),s&&(0,l.oR)({title:"You are back online!",description:"All features are now available.",variant:"default"})},n=()=>{t(!1),s&&(0,l.oR)({title:"You are currently offline.",description:"Some features may not be available.",variant:"destructive"})};return window.addEventListener("online",e),window.addEventListener("offline",n),void 0!==navigator.onLine&&t(navigator.onLine),r(!0),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}},[s]),e)?null:(0,n.jsx)("div",{className:"bg-yellow-500 text-white text-center p-2",children:"You are currently offline. Some features may not be available."})}},63289:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>D});var n=s(95155),a=s(12115),l=s(20063),r=s(10832),i=s(62217),o=s(97003);let c=(e,t)=>{let{interval:s=5e3,enabled:n=!0}=t||{},[l,r]=(0,a.useState)(void 0),[i,o]=(0,a.useState)(!0),[c,d]=(0,a.useState)(void 0),m=(0,a.useRef)(e);return(0,a.useEffect)(()=>{m.current=e},[e]),(0,a.useEffect)(()=>{if(!n)return void o(!1);let e=async()=>{o(!0);try{let e=await m.current();r(e),d(void 0)}catch(e){d(e),r(void 0)}finally{o(!1)}};e();let t=setInterval(()=>{e()},s);return()=>clearInterval(t)},[s,n]),{data:l,loading:i,error:c,refetch:()=>{(async()=>{o(!0);try{let e=await m.current();r(e),d(void 0)}catch(e){d(e),r(void 0)}finally{o(!1)}})()}}},d=s(95125).A.create({baseURL:"http://localhost:8080",withCredentials:!0});d.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&(console.log("401 Unauthorized: Redirecting to login page."),localStorage.removeItem("adminLoggedIn"),localStorage.removeItem("adminUser"),window.location.href="/"),Promise.reject(e)));var m=s(33789),u=s(90235),x=s(83209),h=s(96633),p=s(54679),f=s(47507),g=s(67812),j=s(84916),v=s(89559),b=s(6191),y=s(71360),N=s(19204),w=s(86651),A=s(93341),C=s(57828),S=s(309),P=s(53409),k=s(54664),E=s(21786),F=s(76577),I=s(90923);let T="CUST-1754821420265",B="Walk-in Customer",R={id:T,name:B,email:"",phone:"",address:""};function D(){var e;let t=(0,l.useRouter)(),[s,D]=(0,a.useState)(!0),[L,_]=(0,a.useState)(!1),[z,O]=(0,a.useState)(!1),[U,$]=(0,a.useState)(null),[M,H]=(0,a.useState)(""),[q,J]=(0,a.useState)(""),[W,V]=(0,a.useState)(!1),[G,X]=(0,a.useState)(null),[Z,Y]=(0,a.useState)(!1),[Q,K]=(0,a.useState)(null),[ee,et]=(0,a.useState)(!1),[es,en]=(0,a.useState)([]),[ea,el]=(0,a.useState)([]),[er,ei]=(0,a.useState)(!1),[eo,ec]=(0,a.useState)("date"),[ed,em]=(0,a.useState)("desc"),[eu,ex]=(0,a.useState)(B),[eh,ep]=(0,a.useState)(""),[ef,eg]=(0,a.useState)(""),[ej,ev]=(0,a.useState)(T),[eb,ey]=(0,a.useState)([]),[eN,ew]=(0,a.useState)(1),[eA,eC]=(0,a.useState)(""),[eS,eP]=(0,a.useState)("percent"),[ek,eE]=(0,a.useState)(0),[eF,eI]=(0,a.useState)(""),[eT,eB]=(0,a.useState)({gstin:"",taxPercentage:0,companyName:"",companyAddress:"",companyPhone:"",companyEmail:""}),[eR,eD]=(0,a.useState)({}),[eL,e_]=(0,a.useState)("A4");(0,a.useEffect)(()=>(console.log("BillingPage: Component mounting..."),localStorage.setItem("adminLoggedIn","true"),fetch("".concat("http://127.0.0.1:8080","/api/settings")).then(e=>e.json()).then(e=>{if(console.log("Settings: Loaded settings",e),e.systemSettings){let t=e.systemSettings,s={gstin:t.gstin||"",taxPercentage:t.taxPercentage||t.tax_percentage||0,companyName:t.companyName||t.company_name||"",companyAddress:t.companyAddress||t.company_address||"",companyPhone:t.companyPhone||t.company_phone||"",companyEmail:t.companyEmail||t.company_email||""};console.log("Settings: Normalized settings",s),eB(s)}e.billFormats&&eD(e.billFormats)}).catch(e=>console.error("Failed to load system settings and bill formats",e)),"true"!==localStorage.getItem("adminLoggedIn"))?void t.push("/"):(D(navigator.onLine),window.addEventListener("online",()=>D(!0)),window.addEventListener("offline",()=>D(!1)),()=>{window.removeEventListener("online",()=>D(!0)),window.removeEventListener("offline",()=>D(!1))}),[t]);let ez=(0,a.useCallback)(async(e,t,n,a)=>{if(console.log("fetchData: Fetching ".concat(a,"...")),s)try{console.log("fetchData: Fetching ".concat(a," from Supabase..."));let t=(await d.get(e)).data;console.log("fetchData: Raw ".concat(a," from API"),t);let s=t;return"products"===a?s=t.map(e=>({...e,stock:e.stock||0})):"customers"===a&&(s=t.map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone,address:e.address,createdAt:e.createdat||e.createdAt,updatedAt:e.updatedat||e.updatedAt}))),console.log("fetchData: Processed ".concat(a),s),d.post(n,s).catch(()=>{}),s}catch(s){console.warn("Failed to fetch ".concat(a," from Supabase, falling back to local"),s),console.log("fetchData: Falling back to local for ".concat(a));let e=await d.get(t);if(console.log("fetchData: Local ".concat(a," data"),e.data),"products"===a)return e.data.map(e=>({...e,stock:e.stock||0}));if("customers"===a)return e.data.map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone,address:e.address,createdAt:e.createdat||e.createdAt,updatedAt:e.updatedat||e.updatedAt}));return e.data}},[s]),eO=(0,a.useCallback)(()=>ez("/api/supabase/products","/api/local/products","/api/local/products/update","products"),[ez]),eU=(0,a.useCallback)(async()=>{if(console.log("fetchBills: Starting fetch..."),s)try{console.log("fetchBills: Fetching from Supabase...");let e=(await d.get("/api/supabase/bills-with-details")).data;console.log("fetchBills: Raw data from API",e),console.log("fetchBills: Number of bills",e.length),e.length>0&&e[0].items&&(console.log("fetchBills: First bill items",e[0].items),console.log("fetchBills: First item details",e[0].items[0]));let t=e.map(e=>{console.log("fetchBills: Processing bill ".concat(e.id));let t=e.discountpercentage||e.discountPercentage||0,s=e.discountamount||e.discountAmount||0,n=e.taxpercentage||e.taxPercentage||0,a=e.taxamount||e.taxAmount||e.tax||0;return{...e,date:e.timestamp||e.date,tax:a,taxPercentage:n,status:e.status||"Paid",items:"string"==typeof e.items?JSON.parse(e.items):e.items,discountPercentage:t,discountAmount:s}});return console.log("fetchBills: Final processed data",t),d.post("/api/local/bills/update",t).catch(()=>{}),t}catch(t){console.error("fetchBills: Error fetching from Supabase",t),console.log("fetchBills: Falling back to local storage");let e=await d.get("/api/local/bills");return console.log("fetchBills: Local data",e.data),e.data.map(e=>{let t=e.discountpercentage||e.discountPercentage||0,s=e.discountamount||e.discountAmount||0,n=e.taxpercentage||e.taxPercentage||0,a=e.taxamount||e.taxAmount||e.tax||0;return{...e,date:e.timestamp||e.date,tax:a,taxPercentage:n,status:e.status||"Paid",items:"string"==typeof e.items?JSON.parse(e.items):e.items,discountPercentage:t,discountAmount:s}})}},[s]),e$=(0,a.useCallback)(()=>ez("/api/supabase/customers","/api/local/customers","/api/local/customers/update","customers"),[ez]),{data:eM,loading:eH,error:eq,refetch:eJ}=c(eO,{interval:2e4}),{data:eW,loading:eV,error:eG,refetch:eX}=c(eU,{interval:2e4}),{data:eZ,loading:eY,error:eQ,refetch:eK}=c(e$,{interval:2e4}),e0=async()=>{console.log("handleManualRefresh: Manual refresh triggered."),et(!0);try{await Promise.all([eJ(),eX(),eK()])}finally{setTimeout(()=>et(!1),500)}};(0,a.useEffect)(()=>{eq&&console.error("Failed to load products",eq),eG&&console.error("Failed to load bills",eG),eQ&&console.error("Failed to load customers",eQ)},[eq,eG,eQ]);let e1=(0,a.useMemo)(()=>null!=eM?eM:[],[eM]),e2=(0,a.useMemo)(()=>null!=eW?eW:[],[eW]),e5=(0,a.useMemo)(()=>null!=eZ?eZ:[],[eZ]);(0,a.useEffect)(()=>{console.log("Products: Updated products data",eM)},[eM]),(0,a.useEffect)(()=>{console.log("Bills: Updated bills data",eW)},[eW]),(0,a.useEffect)(()=>{console.log("Customers: Updated customers data",eZ)},[eZ]),(0,a.useEffect)(()=>{if(!eZ)return;let e=eZ.find(e=>e.id===T||(e.name||"").toLowerCase()===B.toLowerCase())||R;ev(e.id||T),ex(e.name||B),ep(e.email||""),eg(e.phone||"")},[eZ]);let e4=e=>{var t,s;let n=null!=(s=null!=(t=e.barcodes)?t:e.barcode)?s:"";return Array.isArray(n)?n.map(e=>"".concat(e).trim()).filter(Boolean):"string"==typeof n?n.split(",").map(e=>e.trim()).filter(Boolean):[]},e3=(e,t)=>{if(!e)return;let s=Math.max(1,null!=t?t:eN);console.log("addItemToBill: Adding product to bill",e,"Quantity:",s);let n=void 0!==e.price&&null!==e.price?e.price:0,a=void 0!==e.stock&&null!==e.stock?e.stock:1/0,l=eb.findIndex(t=>t.productId===e.id),r=s;if(l>=0&&(r=eb[l].quantity+s),r>a)return void alert("Cannot add ".concat(s," more units of ").concat(e.name,". Only ").concat(a-(l>=0?eb[l].quantity:0)," units available."));if(l>=0){let e=[...eb];e[l].quantity=r,e[l].total=e[l].quantity*n,ey(e)}else ey([...eb,{productId:e.id,productName:e.name,price:n,quantity:s,total:n*s}]);ew(1),eC("")},e6=()=>{let e=eb.reduce((e,t)=>e+t.total,0),t=Number.isFinite(eT.taxPercentage)?eT.taxPercentage:0,s="percent"===eS?e*ek/100:ek;s=Math.max(0,Math.min(s,e));let n=Math.max(0,e-s),a=n*t/100,l=e>0?s/e*100:0;return{subtotal:e,tax:a,discountAmount:s,total:n+a,effectiveDiscountPct:l,taxRate:t}},e9=e=>{eE(Math.max(0,e))},e8=(0,a.useMemo)(()=>{if(!eA)return e1.slice(0,12);let e=eA.toLowerCase();return e1.filter(t=>{let s=(t.name||"").toLowerCase().includes(e),n=e4(t).some(t=>t.toLowerCase().includes(e));return s||n}).slice(0,20)},[e1,eA]),e7=()=>{if(!eA)return;let e=eA.trim(),t=e1.find(t=>e4(t).some(t=>t===e));if(t){e3(t),eI(e);return}let s=e8[0];s&&(e3(s),eI(e))},te=async()=>{if(!eu||0===eb.length)return;console.log("createBill: Attempting to create bill...");let{subtotal:e,tax:t,discountAmount:s,total:n,effectiveDiscountPct:a,taxRate:l}=e6(),r=(null==eZ?void 0:eZ.find(e=>e.id===ej))||R,i={id:Date.now().toString(),customerId:ej||T,customerName:eu,customerEmail:eh,customerPhone:ef,customerAddress:null==r?void 0:r.address,items:eb,subtotal:e,tax:t,taxPercentage:l,discountPercentage:a,discountAmount:s,total:n,date:new Date().toISOString(),status:"Paid",companyName:eT.companyName,companyAddress:eT.companyAddress,companyPhone:eT.companyPhone,companyEmail:eT.companyEmail,gstin:eT.gstin,billFormat:eL};console.log("createBill: Bill payload",i);try{let e=await d.post("/api/bills",i);if(console.log("createBill: API response",e),!e.status.toString().startsWith("2"))throw Error("Failed to create bill");ex((null==r?void 0:r.name)||B),ep((null==r?void 0:r.email)||""),eg((null==r?void 0:r.phone)||""),ev((null==r?void 0:r.id)||T),ey([]),eE(0),eP("percent"),eC(""),_(!1),eX()}catch(e){console.error("Error creating bill",e),alert("Failed to create bill.")}},tt=async e=>{if(0!==e.length)try{if((await Promise.all(e.map(e=>d.delete("/api/bills/".concat(e))))).some(e=>!e.status.toString().startsWith("2")))throw Error("Failed to delete bill");en(t=>t.filter(t=>!e.includes(t))),el([]),ei(!1),eX()}catch(e){console.error("Error deleting bills",e)}},ts=async e=>{console.log("handlePrintBill: Printing bill",e),console.log("handlePrintBill: System settings",eT),console.log("handlePrintBill: Bill items",e.items);let t=eR[e.billFormat||eL]||eR.A4||{width:210,height:297,margins:{top:10,bottom:10,left:10,right:10},unit:"mm"};console.log("handlePrintBill: Using bill format",t);let s=((e,t)=>{console.log("generateReceiptHtml: Bill data",e),console.log("generateReceiptHtml: System settings",eT);let s=216===t.width&&279===t.height,n=210===t.width&&297===t.height,a=80===t.width,l=a?"80mm":s?"216mm":n?"210mm":"".concat(t.width,"mm"),r=e.companyName||eT.companyName||eT.company_name||"UNDEFINED",i=e.companyAddress||eT.companyAddress||eT.company_address||void 0,o=e.companyPhone||eT.companyPhone||eT.company_phone||void 0,c=e.companyEmail||eT.companyEmail||eT.company_email||void 0,d=e.gstin||eT.gstin||eT.gstin||"",m=e.taxPercentage||eT.taxPercentage||eT.tax_percentage||0;console.log("generateReceiptHtml: Using company info",{companyName:r,companyAddress:i,companyPhone:o,companyEmail:c,gstin:d,taxPercentage:m});let u=a?"11px":"13px";return"<!DOCTYPE html>\n<html>\n<head>\n  <title>Invoice - ".concat(e.id,"</title>\n  <style>\n    @page {\n      size: ").concat(s?"letter":n?"A4":"".concat(t.width,"mm ").concat("auto"===t.height?"auto":t.height+"mm"),";\n      margin: ").concat(t.margins.top,"mm ").concat(t.margins.right,"mm ").concat(t.margins.bottom,"mm ").concat(t.margins.left,"mm;\n    }\n    body {\n      font-family: Arial, sans-serif;\n      max-width: ").concat(l,";\n      margin: 0 auto;\n      font-size: ").concat(u,";\n      color: #000;\n      padding: ").concat(a?"5px 0":"0",";\n    }\n    .header, .footer {\n      text-align: center;\n      padding: ").concat(a?"5px 0":"10px 0",";\n    }\n    .company-name {\n      font-size: ").concat(a?"14px":"18px",";\n      font-weight: bold;\n      text-transform: uppercase;\n      margin-bottom: 3px;\n    }\n    .company-details {\n      font-size: ").concat(a?"10px":"12px",";\n      line-height: 1.4;\n    }\n    .invoice-title {\n      font-size: ").concat(a?"13px":"16px",";\n      font-weight: bold;\n      margin-top: ").concat(a?"5px":"10px",";\n      border-top: 1px solid #000;\n      border-bottom: 1px solid #000;\n      padding: ").concat(a?"3px 0":"5px 0",";\n    }\n    .section {\n      margin: ").concat(a?"10px 0":"15px 0",";\n    }\n    .section-title {\n      font-weight: bold;\n      border-bottom: 1px dashed #000;\n      margin-bottom: 5px;\n      padding-bottom: 2px;\n    }\n    .row {\n      display: flex;\n      justify-content: space-between;\n      margin-bottom: ").concat(a?"3px":"5px",";\n      font-size: ").concat(a?"10px":"12px",";\n    }\n    .items-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin-top: ").concat(a?"5px":"10px",";\n      font-size: ").concat(a?"10px":u,";\n    }\n    .items-table th, .items-table td {\n      border: 1px solid #000;\n      padding: ").concat(a?"3px 4px":"6px 8px",";\n      text-align: left;\n    }\n    .items-table th {\n      background-color: #f2f2f2;\n      font-weight: bold;\n    }\n    .items-table td.number {\n      text-align: right;\n    }\n    .totals {\n      margin-top: ").concat(a?"10px":"15px",";\n      border-top: 1px dashed #000;\n      padding-top: ").concat(a?"5px":"10px",";\n    }\n    .totals-row {\n      display: flex;\n      justify-content: space-between;\n      margin-bottom: ").concat(a?"3px":"5px",";\n      font-size: ").concat(a?"11px":"13px",";\n    }\n    .totals-row.total {\n      font-weight: bold;\n      font-size: ").concat(a?"13px":"15px",";\n      border-top: 2px solid #000;\n      padding-top: 5px;\n      margin-top: 5px;\n    }\n    .footer {\n      margin-top: ").concat(a?"10px":"20px",";\n      font-size: ").concat(a?"10px":"12px",';\n      border-top: 1px dashed #000;\n      padding-top: 10px;\n    }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <div class="company-name">').concat(r,'</div>\n    <div class="company-details">\n      ').concat(i,"<br>\n      Phone: ").concat(o,"<br>\n      Email: ").concat(c,"\n      ").concat(d?"<br>GSTIN: ".concat(d):"",'\n    </div>\n  </div>\n\n  <div class="invoice-title">INVOICE</div>\n\n  <div class="section">\n    <div class="row">\n      <span><strong>Invoice:</strong> ').concat(e.id.substring(5,17),"</span>\n      <span><strong>Date:</strong> ").concat(new Date(e.date).toLocaleDateString(),"</span>\n    </div>\n    ").concat(e.customerName||e.customerPhone?'\n    <div class="row">\n      <span><strong>Customer:</strong> '.concat(e.customerName||"Walk-in","</span>\n      ").concat(e.customerPhone?"<span>".concat(e.customerPhone,"</span>"):"","\n    </div>"):"",'\n  </div>\n\n  <table class="items-table">\n    <thead>\n      <tr>\n        <th style="width: ').concat(a?"10%":"8%",'">#</th>\n        <th style="width: ').concat(a?"40%":"45%",'">Item</th>\n        <th style="width: ').concat(a?"15%":"12%",'" class="number">Qty</th>\n        <th style="width: ').concat("17%",'" class="number">Rate</th>\n        <th style="width: ').concat("18%",'" class="number">Total</th>\n      </tr>\n    </thead>\n    <tbody>\n      ').concat(e.items.map((e,t)=>{let s=e.productName||e.product_name||e.productname||"Item";return"\n        <tr>\n          <td>".concat(t+1,"</td>\n          <td>").concat(s,'</td>\n          <td class="number">').concat(e.quantity,'</td>\n          <td class="number">₹').concat(e.price.toFixed(2),'</td>\n          <td class="number">₹').concat(e.total.toFixed(2),"</td>\n        </tr>")}).join(""),'\n    </tbody>\n  </table>\n\n  <div class="totals">\n    <div class="totals-row">\n      <span>Subtotal</span>\n      <span>₹').concat(e.subtotal.toFixed(2),"</span>\n    </div>\n    ").concat(e.discountAmount&&e.discountAmount>0?'\n    <div class="totals-row" style="color: #c00">\n      <span>Discount ('.concat(e.discountPercentage.toFixed(1),"%)</span>\n      <span>-₹").concat(e.discountAmount.toFixed(2),"</span>\n    </div>"):"",'\n    <div class="totals-row">\n      <span>Tax (').concat(m.toFixed(1),"%)</span>\n      <span>₹").concat(e.tax.toFixed(2),'</span>\n    </div>\n    <div class="totals-row total">\n      <span>TOTAL</span>\n      <span>₹').concat(e.total.toFixed(2),'</span>\n    </div>\n  </div>\n\n  <div class="footer">\n    <p style="margin: 5px 0;">Thank you for your business!</p>\n    ').concat(a?'<p style="margin: 5px 0; font-size: 9px;">Powered by SIRI Billing System</p>':"","\n  </div>\n</body>\n</html>")})(e,t);try{await (0,F.G)({htmlContent:s})}catch(e){console.error("Failed to send print job",e),alert("Failed to print bill. Please check console for details.")}},tn=(0,a.useMemo)(()=>{let e=M.toLowerCase(),t=e2.filter(t=>{let s=t.customerName||"",n=t.id||"";return s.toLowerCase().includes(e)||n.includes(e)}),s=e=>{switch(eo){case"total":return e.total||0;case"discount":return e.discountAmount||0;case"customer":return(e.customerName||"").toLowerCase();case"items":var t;return(null==(t=e.items)?void 0:t.length)||0;default:return new Date(e.date).getTime()}};return[...t].sort((e,t)=>{let n=s(e),a=s(t);if("string"==typeof n&&"string"==typeof a){let e=n.localeCompare(a);return"asc"===ed?e:-e}let l=Number(n)-Number(a);return"asc"===ed?l:-l})},[e2,M,ed,eo]),ta=tn.length>0&&tn.every(e=>es.includes(e.id)),tl=!ta&&tn.some(e=>es.includes(e.id)),tr=e5.filter(e=>{let t=e.name||"",s=e.email||"",n=e.phone||"",a=q.toLowerCase();return t.toLowerCase().includes(a)||s.toLowerCase().includes(a)||n.toLowerCase().includes(a)});(0,a.useEffect)(()=>{let e=new Set(e2.map(e=>e.id));en(t=>{let s=t.filter(t=>e.has(t));return s.length===t.length&&s.every((e,s)=>e===t[s])?t:s})},[e2]);let{subtotal:ti,tax:to,discountAmount:tc,total:td,effectiveDiscountPct:tm,taxRate:tu}=e6(),tx=async()=>{if(!G)return;console.log("handleImportBills: Importing bills from file",G.name);let e=new FileReader;e.onload=async e=>{try{var t;let s=JSON.parse(null==(t=e.target)?void 0:t.result);console.log("handleImportBills: Parsed bills for import",s);let n=await d.post("/api/bills/import",s);if(console.log("handleImportBills: Import API response",n),!n.status.toString().startsWith("2"))throw Error("Failed to import bills");console.log("Bills imported successfully"),V(!1),X(null),eX()}catch(e){console.error("Error parsing or importing bills",e)}},e.readAsText(G)};return(0,n.jsx)(r.default,{children:(0,n.jsxs)("div",{className:"space-y-6 max-w-full overflow-x-auto",children:[!s&&(0,n.jsx)(i.A,{}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"Billing System"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Create and manage bills with discount adjustments"}),(eH||eV||eY)&&(0,n.jsx)("p",{className:"text-sm text-blue-500",children:"Loading data..."}),(eq||eG||eQ)&&(0,n.jsx)("p",{className:"text-sm text-red-500",children:"Error loading data."})]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsxs)(o.$,{variant:"outline",onClick:e0,disabled:ee||!s,children:[(0,n.jsx)(v.A,{className:"h-4 w-4 mr-2 ".concat(ee?"animate-spin":"")}),ee?"Refreshing...":"Refresh"]}),(0,n.jsxs)(p.lG,{open:W,onOpenChange:V,children:[(0,n.jsx)(p.zM,{asChild:!0,children:(0,n.jsxs)(o.$,{variant:"outline",disabled:!s,children:[(0,n.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Import Bills"]})}),(0,n.jsxs)(p.Cf,{children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Import Bills from JSON"}),(0,n.jsx)(p.rr,{children:"Upload a JSON file containing bill data."})]}),(0,n.jsx)("div",{className:"grid gap-4 py-4",children:(0,n.jsx)(m.p,{id:"billFile",type:"file",accept:".json",onChange:e=>X(e.target.files?e.target.files[0]:null)})}),(0,n.jsxs)(p.Es,{children:[(0,n.jsx)(o.$,{variant:"outline",onClick:()=>V(!1),children:"Cancel"}),(0,n.jsx)(o.$,{onClick:tx,disabled:!G,children:"Import"})]})]})]}),(0,n.jsxs)(p.lG,{open:L,onOpenChange:_,children:[(0,n.jsx)(p.zM,{asChild:!0,children:(0,n.jsxs)(o.$,{children:[(0,n.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Create Bill"]})}),(0,n.jsxs)(p.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Create New Bill"}),(0,n.jsx)(p.rr,{children:"Enter customer details and add products to create a bill"})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:"Customer Information"}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"customerSelect",children:"Select Customer"}),(0,n.jsxs)(f.l6,{value:ej||"custom",onValueChange:e=>{if("custom"===e)return void ev(null);let t=(null==eZ?void 0:eZ.find(t=>t.id===e))||R;ev(e),ex(t.name||""),ep(t.email||""),eg(t.phone||"")},children:[(0,n.jsx)(f.bq,{id:"customerSelect",children:(0,n.jsx)(f.yv,{placeholder:"Choose customer (default Walk-in)"})}),(0,n.jsxs)(f.gC,{children:[(0,n.jsxs)(f.eb,{value:T,children:[B," (default)"]}),(eZ||[]).filter(e=>e.id!==T).slice(0,15).map(e=>(0,n.jsxs)(f.eb,{value:e.id,children:[e.name||"Unnamed"," ",e.phone?"• ".concat(e.phone):""]},e.id)),(0,n.jsx)(f.eb,{value:"custom",children:"Custom"})]})]})]})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"customerName",children:"Customer Name"}),(0,n.jsx)(m.p,{id:"customerName",value:eu,onChange:e=>{ex(e.target.value),ev(null)},required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"customerEmail",children:"Email (optional)"}),(0,n.jsx)(m.p,{id:"customerEmail",type:"email",value:eh,onChange:e=>{ep(e.target.value),ev(null)}})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"customerPhone",children:"Phone (optional)"}),(0,n.jsx)(m.p,{id:"customerPhone",value:ef,onChange:e=>{eg(e.target.value),ev(null)}})]})]})]}),(0,n.jsx)(k.w,{}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:"Add Products"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[(0,n.jsxs)("div",{className:"md:col-span-3 space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"productSearch",children:"Search by name or scan barcode"}),(0,n.jsx)(m.p,{id:"productSearch",placeholder:"Scan a barcode and press Enter, or type product name",value:eA,onChange:e=>eC(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e7())}}),eF&&(0,n.jsxs)("p",{className:"text-xs text-green-600",children:["Last scanned: ",eF]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.J,{htmlFor:"quantity",children:"Quantity"}),(0,n.jsx)(m.p,{id:"quantity",type:"number",min:"1",value:eN,onChange:e=>ew(Number.parseInt(e.target.value)||1)}),(0,n.jsx)(o.$,{className:"w-full",onClick:e7,disabled:""===eA.trim(),children:"Add Item"})]})]}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-3",children:[e8.map(e=>{var t,s;let a=e4(e);return(0,n.jsx)(x.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>e3(e),children:(0,n.jsx)(x.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium",children:e.name}),a.length>0&&(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:a.join(", ")})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsxs)("div",{className:"font-semibold",children:["₹",(null!=(t=e.price)?t:0).toFixed(2)]}),(0,n.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Stock: ",null!=(s=e.stock)?s:"∞"]})]})]})})},e.id)}),0===e8.length&&(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:"No matching products. Try a different name or barcode."})]})]}),eb.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:"Bill Items"}),(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{children:"Product"}),(0,n.jsx)(h.nd,{children:"Price"}),(0,n.jsx)(h.nd,{children:"Quantity"}),(0,n.jsx)(h.nd,{children:"Total"}),(0,n.jsx)(h.nd,{children:"Actions"})]})}),(0,n.jsx)(h.BF,{children:eb.map(e=>(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{children:e.productName}),(0,n.jsxs)(h.nA,{children:["₹",e.price.toFixed(2)]}),(0,n.jsx)(h.nA,{children:e.quantity}),(0,n.jsxs)(h.nA,{children:["₹",e.total.toFixed(2)]}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{var t;console.log("removeItemFromBill: Removing product ID from bill",t=e.productId),ey(eb.filter(e=>e.productId!==t))},children:(0,n.jsx)(y.A,{className:"h-4 w-4"})})})]},e.productId))})]}),(0,n.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between text-base",children:[(0,n.jsx)("span",{children:"Subtotal"}),(0,n.jsxs)("span",{className:"font-medium",children:["₹",ti.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between text-base",children:[(0,n.jsxs)("span",{children:["Tax (",tu.toFixed(1),"%)"]}),(0,n.jsxs)("span",{className:"font-medium",children:["₹",to.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)(u.J,{className:"flex items-center text-base",children:[(0,n.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Discount"]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsxs)(f.l6,{value:eS,onValueChange:e=>eP(e),children:[(0,n.jsx)(f.bq,{className:"w-28",children:(0,n.jsx)(f.yv,{})}),(0,n.jsxs)(f.gC,{children:[(0,n.jsx)(f.eb,{value:"percent",children:"Percent"}),(0,n.jsx)(f.eb,{value:"amount",children:"Amount"})]})]}),(0,n.jsx)(m.p,{type:"number",min:"0",step:"0.1",value:ek,onChange:e=>e9(Number.parseFloat(e.target.value)||0),className:"w-24 text-right"}),(0,n.jsx)("span",{className:"text-sm",children:"percent"===eS?"%":"₹"})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600 mr-2",children:"Quick:"}),"percent"===eS?[5,10,15,20,25].map(e=>(0,n.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>e9(e),className:"text-xs h-7",children:[e,"%"]},e)):[50,100,200,500].map(e=>(0,n.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>e9(e),className:"text-xs h-7",children:["₹",e]},e)),(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>e9(0),className:"text-xs h-7",children:"Clear"})]}),tc>0&&(0,n.jsxs)("div",{className:"flex justify-between text-base text-red-600",children:[(0,n.jsxs)("span",{children:["Discount (",("percent"===eS?ek:tc/Math.max(ti,1e-4)*100).toFixed(1),"%)"]}),(0,n.jsxs)("span",{className:"font-medium",children:["-₹",tc.toFixed(2)]})]})]}),(0,n.jsx)(k.w,{}),(0,n.jsxs)("div",{className:"flex justify-between items-center text-xl font-bold",children:[(0,n.jsx)("span",{children:"Total"}),(0,n.jsxs)("span",{children:["₹",td.toFixed(2)]})]}),tc>0&&(0,n.jsx)("div",{className:"text-center",children:(0,n.jsxs)("p",{className:"text-sm text-green-600 font-medium",children:["Customer saves ₹",tc.toFixed(2)," (",tm.toFixed(1),"% discount)"]})})]})]})]}),(0,n.jsxs)(p.Es,{children:[(0,n.jsx)(o.$,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),(0,n.jsx)(o.$,{onClick:te,disabled:!eu||0===eb.length,children:"Create Bill"})]})]})]})]})]}),(0,n.jsxs)(I.tU,{defaultValue:"bills",className:"w-full",children:[(0,n.jsxs)(I.j7,{className:"grid w-full grid-cols-2",children:[(0,n.jsx)(I.Xi,{value:"bills",children:"Bills History"}),(0,n.jsx)(I.Xi,{value:"customers",children:"Customers Info"})]}),(0,n.jsx)(I.av,{value:"bills",children:(0,n.jsxs)(x.Zp,{children:[(0,n.jsxs)(x.aR,{children:[(0,n.jsx)(x.ZB,{children:"Bills History"}),(0,n.jsxs)(x.BT,{children:[e2.length," bills created"]}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(w.A,{className:"h-4 w-4 text-muted-foreground"}),(0,n.jsx)(m.p,{placeholder:"Search bills...",value:M,onChange:e=>H(e.target.value),className:"max-w-sm"})]}),(0,n.jsxs)(f.l6,{value:eo,onValueChange:e=>ec(e),children:[(0,n.jsx)(f.bq,{className:"w-[180px]",children:(0,n.jsx)(f.yv,{placeholder:"Sort by"})}),(0,n.jsxs)(f.gC,{children:[(0,n.jsx)(f.eb,{value:"date",children:"Date"}),(0,n.jsx)(f.eb,{value:"total",children:"Total"}),(0,n.jsx)(f.eb,{value:"discount",children:"Discount Amount"}),(0,n.jsx)(f.eb,{value:"items",children:"Items Count"}),(0,n.jsx)(f.eb,{value:"customer",children:"Customer Name"})]})]}),(0,n.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>{em(e=>"asc"===e?"desc":"asc")},children:[(0,n.jsx)(A.A,{className:"h-4 w-4 mr-1"}),"asc"===ed?"Ascending":"Descending"]}),es.length>0&&(0,n.jsxs)(o.$,{variant:"destructive",size:"sm",onClick:()=>{0!==es.length&&(el(es),ei(!0))},children:[(0,n.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Delete Selected (",es.length,")"]})]})]}),(0,n.jsx)(x.Wu,{children:tn.length>0?(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{className:"w-12",children:(0,n.jsx)(j.S,{checked:ta||!!tl&&"indeterminate",onCheckedChange:e=>(e=>{let t=tn.map(e=>e.id);if(!e)return void en(e=>e.filter(e=>!t.includes(e)));en(e=>Array.from(new Set([...e,...t])))})(!0===e),"aria-label":"Select all bills"})}),(0,n.jsx)(h.nd,{children:"Bill ID"}),(0,n.jsx)(h.nd,{children:"Customer"}),(0,n.jsx)(h.nd,{children:"Date"}),(0,n.jsx)(h.nd,{children:"Items"}),(0,n.jsx)(h.nd,{children:"Discount"}),(0,n.jsx)(h.nd,{children:"Total"}),(0,n.jsx)(h.nd,{children:"Status"}),(0,n.jsx)(h.nd,{children:"Actions"})]})}),(0,n.jsx)(h.BF,{children:tn.map(e=>{var t;return(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{children:(0,n.jsx)(j.S,{checked:es.includes(e.id),onCheckedChange:t=>{var s,n;return s=e.id,n=!0===t,void en(e=>n?e.includes(s)?e:[...e,s]:e.filter(e=>e!==s))},"aria-label":"Select bill ".concat(e.id)})}),(0,n.jsx)(h.nA,{className:"font-mono",children:e.id}),(0,n.jsx)(h.nA,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium",children:e.customerName||"Walk-in Customer"}),e.customerEmail&&(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:e.customerEmail})]})}),(0,n.jsx)(h.nA,{children:new Date(e.date).toLocaleDateString()}),(0,n.jsxs)(h.nA,{children:[(null==(t=e.items)?void 0:t.length)||0," items"]}),(0,n.jsx)(h.nA,{children:e.discountAmount>0?(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsxs)("div",{className:"text-red-600 font-medium",children:["-",e.discountPercentage.toFixed(1),"%"]}),(0,n.jsxs)("div",{className:"text-xs text-red-600",children:["-₹",e.discountAmount.toFixed(2)]})]}):(0,n.jsx)("span",{className:"text-gray-400",children:"No discount"})}),(0,n.jsxs)(h.nA,{className:"font-bold",children:["₹",e.total.toFixed(2)]}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(g.E,{variant:"default",children:e.status})}),(0,n.jsx)(h.nA,{children:(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{console.log("viewBill: Viewing bill",e),$(e),O(!0)},children:(0,n.jsx)(C.A,{className:"h-4 w-4"})}),(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>ts(e),children:(0,n.jsx)(S.A,{className:"h-4 w-4"})}),(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{el([e.id]),ei(!0)},children:(0,n.jsx)(y.A,{className:"h-4 w-4"})})]})})]},e.id)})})]}):(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(P.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-medium",children:"No bills found"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:M?"Try adjusting your search terms":"Create your first bill to get started"})]})})]})}),(0,n.jsx)(I.av,{value:"customers",children:(0,n.jsxs)(x.Zp,{children:[(0,n.jsxs)(x.aR,{children:[(0,n.jsx)(x.ZB,{children:"Customers Information"}),(0,n.jsxs)(x.BT,{children:[e5.length," registered customers"]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(w.A,{className:"h-4 w-4 text-muted-foreground"}),(0,n.jsx)(m.p,{placeholder:"Search customers...",value:q,onChange:e=>J(e.target.value),className:"max-w-sm"})]})]}),(0,n.jsx)(x.Wu,{children:tr.length>0?(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{children:"Name"}),(0,n.jsx)(h.nd,{children:"Email"}),(0,n.jsx)(h.nd,{children:"Phone"}),(0,n.jsx)(h.nd,{children:"Address"}),(0,n.jsx)(h.nd,{children:"Total Bills"}),(0,n.jsx)(h.nd,{children:"Total Spent"}),(0,n.jsx)(h.nd,{children:"Actions"})]})}),(0,n.jsx)(h.BF,{children:tr.map(e=>{let t=e2.filter(t=>(t.customerId||t.customerid)===e.id),s=t.reduce((e,t)=>e+(t.total||0),0);return(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{className:"font-medium",children:e.name||"N/A"}),(0,n.jsx)(h.nA,{children:e.email||"N/A"}),(0,n.jsx)(h.nA,{children:e.phone||"N/A"}),(0,n.jsx)(h.nA,{children:e.address||"N/A"}),(0,n.jsx)(h.nA,{children:t.length}),(0,n.jsxs)(h.nA,{children:["₹",s.toFixed(2)]}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{console.log("viewCustomer: Viewing customer",e),K(e),Y(!0)},children:(0,n.jsx)(C.A,{className:"h-4 w-4"})})})]},e.id)})})]}):(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:"No customers found"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:q?"Try adjusting your search terms":"Customers will appear here once they have bills"})]})})]})})]}),(0,n.jsx)(p.lG,{open:z,onOpenChange:O,children:(0,n.jsxs)(p.Cf,{className:"max-w-2xl",children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Bill Details"}),(0,n.jsxs)(p.rr,{children:["Bill: ",null==U?void 0:U.id]})]}),U&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Customer Information"}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[(0,n.jsx)("div",{children:U.customerName||"Walk-in Customer"}),U.customerEmail&&(0,n.jsx)("div",{children:U.customerEmail}),U.customerPhone&&(0,n.jsx)("div",{children:U.customerPhone})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Bill Information"}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[(0,n.jsxs)("div",{children:["Date: ",new Date(U.date).toLocaleString()]}),(0,n.jsxs)("div",{children:["Status: ",U.status]}),void 0!==U.taxPercentage&&U.taxPercentage>0&&(0,n.jsxs)("div",{children:["Tax Rate: ",U.taxPercentage,"%"]})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"Items"}),(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{children:"Product"}),(0,n.jsx)(h.nd,{children:"Price"}),(0,n.jsx)(h.nd,{children:"Qty"}),(0,n.jsx)(h.nd,{children:"Total"})]})}),(0,n.jsx)(h.BF,{children:null==(e=U.items)?void 0:e.map((e,t)=>{let s=e.productName||e.product_name||e.productname||"Unknown Product",a=e.price||0,l=e.quantity||0,r=e.total||0;return(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{children:s}),(0,n.jsxs)(h.nA,{children:["₹",a.toFixed(2)]}),(0,n.jsx)(h.nA,{children:l}),(0,n.jsxs)(h.nA,{children:["₹",r.toFixed(2)]})]},t)})})]})]}),(0,n.jsxs)("div",{className:"space-y-2 text-right bg-gray-50 p-4 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Subtotal"}),(0,n.jsxs)("span",{children:["₹",U.subtotal.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{children:["Tax ",void 0!==U.taxPercentage&&U.taxPercentage>0&&"(".concat(U.taxPercentage,"%)")]}),(0,n.jsxs)("span",{children:["₹",(U.tax||0).toFixed(2)]})]}),U.discountPercentage>0&&(0,n.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,n.jsxs)("span",{children:["Discount (",U.discountPercentage.toFixed(1),"%)"]}),(0,n.jsxs)("span",{children:["-₹",U.discountAmount.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,n.jsx)("span",{children:"Total"}),(0,n.jsxs)("span",{children:["₹",U.total.toFixed(2)]})]})]})]}),(0,n.jsxs)(p.Es,{children:[(0,n.jsx)(o.$,{variant:"outline",onClick:()=>O(!1),children:"Close"}),U&&(0,n.jsxs)(o.$,{onClick:()=>ts(U),className:"bg-blue-600 hover:bg-blue-700",children:[(0,n.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Print Bill"]})]})]})}),(0,n.jsx)(p.lG,{open:er,onOpenChange:e=>{ei(e),e||el([])},children:(0,n.jsxs)(p.Cf,{children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Are you sure?"}),(0,n.jsxs)(p.rr,{children:["This action cannot be undone. This will permanently delete"," ",ea.length>1?"".concat(ea.length," selected bills"):"bill ".concat(ea[0]||""),"."]})]}),(0,n.jsxs)(p.Es,{children:[(0,n.jsx)(o.$,{variant:"outline",onClick:()=>{ei(!1),el([])},children:"Cancel"}),(0,n.jsx)(o.$,{variant:"destructive",onClick:()=>tt(ea),children:"Delete"})]})]})}),(0,n.jsx)(p.lG,{open:Z,onOpenChange:Y,children:(0,n.jsxs)(p.Cf,{className:"max-w-2xl max-h-[85vh] flex flex-col",children:[(0,n.jsxs)(p.c7,{children:[(0,n.jsx)(p.L3,{children:"Customer Details"}),(0,n.jsx)(p.rr,{children:null==Q?void 0:Q.name})]}),Q&&(0,n.jsxs)("div",{className:"space-y-6 overflow-y-auto pr-2",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Contact Information"}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[(0,n.jsxs)("div",{children:["Email: ",Q.email||"N/A"]}),(0,n.jsxs)("div",{children:["Phone: ",Q.phone||"N/A"]}),(0,n.jsxs)("div",{children:["Address: ",Q.address||"N/A"]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:"Spending Overview"}),(0,n.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:(()=>{let e=e2.filter(e=>(e.customerId||e.customerid)===Q.id),t=e.reduce((e,t)=>e+(t.total||0),0);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:["Total Bills: ",e.length]}),(0,n.jsxs)("div",{children:["Total Spent: ₹",t.toFixed(2)]})]})})()})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"font-medium mb-2",children:["Bills by ",Q.name]}),(0,n.jsx)("div",{className:"max-h-[360px] overflow-y-auto border rounded-md",children:(0,n.jsxs)(h.XI,{children:[(0,n.jsx)(h.A0,{className:"sticky top-0 bg-white z-10",children:(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nd,{children:"Bill ID"}),(0,n.jsx)(h.nd,{children:"Date"}),(0,n.jsx)(h.nd,{children:"Total"}),(0,n.jsx)(h.nd,{children:"Status"}),(0,n.jsx)(h.nd,{children:"Actions"})]})}),(0,n.jsx)(h.BF,{children:e2.filter(e=>(e.customerId||e.customerid)===Q.id).map(e=>(0,n.jsxs)(h.Hj,{children:[(0,n.jsx)(h.nA,{className:"font-mono",children:e.id}),(0,n.jsx)(h.nA,{children:new Date(e.date).toLocaleDateString()}),(0,n.jsxs)(h.nA,{children:["₹",e.total.toFixed(2)]}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(g.E,{children:e.status})}),(0,n.jsx)(h.nA,{children:(0,n.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{$(e),O(!0),Y(!1)},children:(0,n.jsx)(C.A,{className:"h-4 w-4"})})})]},e.id))})]})})]})]}),(0,n.jsx)(p.Es,{children:(0,n.jsx)(o.$,{variant:"outline",onClick:()=>Y(!1),children:"Close"})})]})})]})})}},76577:(e,t,s)=>{"use strict";async function n(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((s,n)=>{try{var a;if(t){let t=window.open("","_blank","width=800,height=900");if(!t)return void n(Error("Failed to open print window"));t.document.open(),t.document.write(e),t.document.close(),t.focus(),t.print(),setTimeout(()=>{t.close(),s()},500);return}let l=!1,r=document.createElement("iframe");r.style.position="fixed",r.style.right="0",r.style.bottom="0",r.style.width="0",r.style.height="0",r.style.border="none",document.body.appendChild(r);let i=null==(a=r.contentWindow)?void 0:a.document;if(!i){document.body.removeChild(r),n(Error("Failed to access iframe document"));return}i.open(),i.write(e),i.close(),r.onload=()=>{if(!l){l=!0;try{var e,t;null==(e=r.contentWindow)||e.focus(),null==(t=r.contentWindow)||t.print(),setTimeout(()=>{r.parentNode&&document.body.removeChild(r),s()},1e3)}catch(e){r.parentNode&&document.body.removeChild(r),n(e)}}},setTimeout(()=>{if(!l){l=!0;try{r.contentWindow&&(r.contentWindow.focus(),r.contentWindow.print(),setTimeout(()=>{r.parentNode&&document.body.removeChild(r),s()},1e3))}catch(e){r.parentNode&&document.body.removeChild(r),n(e)}}},500)}catch(e){console.error("Print error:",e),n(e)}})}async function a(e){let{htmlContent:t,thermalContent:s,isThermalPrinter:a=!1,labelData:l,copies:r=1,useBackendPrint:i=!1,printerName:o,storeName:c,labelProfile:d,labelDimensions:m}=e;if(i&&l&&l.length>0)try{let e="http://127.0.0.1:8080".replace(/\/+$/g,""),t={labelData:l.map(e=>{let t=e.selling_price;return void 0===t&&void 0!==e.sellingPrice&&(t=e.sellingPrice),{id:e.id,name:e.name,barcode:e.barcode,selling_price:null!=t?t:0,batchNumber:e.batchNumber||""}}),copies:r};o&&(t.printerName=o),c&&(t.storeName=c),d&&(t.labelProfile=d),m&&(t.labelDimensions=m),console.log("\uD83D\uDCE4 Sending backend print request (selling_price only):",t);let s=await fetch("".concat(e,"/api/print-label"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await s.json().catch(()=>({}));if(s.ok&&"success"===n.status)return void console.log("✅ Backend print succeeded:",n.message||"");console.warn("⚠️ Backend print returned non-success, falling back to browser print",n)}catch(e){console.error("❌ Error sending backend print request, falling back to browser print:",e)}if(t){console.log("\uD83D\uDDA8️ Using browser-based HTML printing");let e=!!window.__TAURI__;await n(t,e);return}if(s){console.log("\uD83D\uDDA8️ Using browser-based thermal content printing");let e='<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>Print</title>\n  <style>\n    body {\n      font-family: monospace;\n      white-space: pre-wrap;\n      margin: 0;\n      padding: 10mm;\n    }\n  </style>\n</head>\n<body><pre>'.concat(String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),"</pre></body>\n</html>"),t=!!window.__TAURI__;await n(e,t);return}throw Error("No printable content provided.")}s.d(t,{G:()=>a}),s(68267)},83209:(e,t,s)=>{"use strict";s.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>r,aR:()=>i});var n=s(95155),a=s(12115),l=s(25016);let r=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});r.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...a})});i.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});o.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter"},84916:(e,t,s)=>{"use strict";s.d(t,{S:()=>o});var n=s(95155),a=s(12115),l=s(38162),r=s(5917),i=s(25016);let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.bL,{ref:t,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:(0,n.jsx)(l.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,n.jsx)(r.A,{className:"h-4 w-4"})})})});o.displayName=l.bL.displayName},90235:(e,t,s)=>{"use strict";s.d(t,{J:()=>c});var n=s(95155),a=s(12115),l=s(32894),r=s(83101),i=s(25016);let o=(0,r.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.b,{ref:t,className:(0,i.cn)(o(),s),...a})});c.displayName=l.b.displayName},90923:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>c,av:()=>d,j7:()=>o,tU:()=>i});var n=s(95155),a=s(12115),l=s(25667),r=s(25016);let i=l.bL,o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.B8,{ref:t,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a})});o.displayName=l.B8.displayName;let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.l9,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a})});c.displayName=l.l9.displayName;let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(l.UC,{ref:t,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a})});d.displayName=l.UC.displayName},96633:(e,t,s)=>{"use strict";s.d(t,{A0:()=>i,BF:()=>o,Gg:()=>c,Hj:()=>d,XI:()=>r,nA:()=>u,nd:()=>m});var n=s(95155),a=s(12115),l=s(25016);let r=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("div",{className:"relative w-full overflow-auto",children:(0,n.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",s),...a})})});r.displayName="Table";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",s),...a})});i.displayName="TableHeader";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...a})});o.displayName="TableBody";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a})});c.displayName="TableFooter";let d=a.forwardRef((e,t)=>{let{className:s,children:a,...r}=e;return(0,n.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r,children:a})});d.displayName="TableRow";let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a})});m.displayName="TableHead";let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a})});u.displayName="TableCell",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...a})}).displayName="TableCaption"}},e=>{e.O(0,[9206,6445,5239,5584,9648,6840,1020,832,8441,1255,7358],()=>e(e.s=18728)),_N_E=e.O()}]);