(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[754],{12140:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var r=s(12115);let a=(e,t)=>{let{interval:s=5e3,enabled:a=!0}=t||{},[l,n]=(0,r.useState)(void 0),[o,i]=(0,r.useState)(!0),[d,c]=(0,r.useState)(void 0),u=(0,r.useRef)(e);return(0,r.useEffect)(()=>{u.current=e},[e]),(0,r.useEffect)(()=>{if(!a)return void i(!1);let e=async()=>{i(!0);try{let e=await u.current();n(e),c(void 0)}catch(e){c(e),n(void 0)}finally{i(!1)}};e();let t=setInterval(()=>{e()},s);return()=>clearInterval(t)},[s,a]),{data:l,loading:o,error:d}}},47507:(e,t,s)=>{"use strict";s.d(t,{bq:()=>m,eb:()=>y,gC:()=>p,l6:()=>c,yv:()=>u});var r=s(95155),a=s(12115),l=s(4729),n=s(24033),o=s(12108),i=s(5917),d=s(25016);let c=l.bL;l.YJ;let u=l.WT,m=a.forwardRef((e,t)=>{let{className:s,children:a,...o}=e;return(0,r.jsxs)(l.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...o,children:[a,(0,r.jsx)(l.In,{asChild:!0,children:(0,r.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=l.l9.displayName;let h=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.PP,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(o.A,{className:"h-4 w-4"})})});h.displayName=l.PP.displayName;let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.wn,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})});x.displayName=l.wn.displayName;let p=a.forwardRef((e,t)=>{let{className:s,children:a,position:n="popper",...o}=e;return(0,r.jsx)(l.ZL,{children:(0,r.jsxs)(l.UC,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...o,children:[(0,r.jsx)(h,{}),(0,r.jsx)(l.LM,{className:(0,d.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(x,{})]})})});p.displayName=l.UC.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.JU,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=l.JU.displayName;let y=a.forwardRef((e,t)=>{let{className:s,children:a,...n}=e;return(0,r.jsxs)(l.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.VF,{children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})}),(0,r.jsx)(l.p4,{children:a})]})});y.displayName=l.q7.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=l.wv.displayName},52179:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let r=s(95125).A.create({baseURL:"http://localhost:8080",withCredentials:!0});r.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&(console.log("401 Unauthorized: Redirecting to login page."),localStorage.removeItem("adminLoggedIn"),localStorage.removeItem("adminUser"),window.location.href="/"),Promise.reject(e)));let a=r},63290:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>U});var r=s(95155),a=s(12115),l=s(20063),n=s(10832),o=s(12140),i=s(52179),d=s(83209),c=s(67812),u=s(97003),m=s(90235),h=s(47507),x=s(96633),p=s(90923),y=s(26265),v=s(80019),g=s(68425),f=s(47734),j=s(73697),b=s(10232),A=s(18187),N=s(12723),w=s(4035),S=s(69386),B=s(98128),R=s(55556),F=s(89559),C=s(39867),D=s(52056),E=s(63581),_=s(91761),k=s(1524),T=s(26921),P=s(10512),I=s(26617),M=s(71163),G=s(79956),O=s(82192),V=s(51321),W=s(78674),Z=s(16485);let q=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D","#FFC658","#FF7C7C"];function U(){var e,t,U,z,H,L;let Q=(0,l.useRouter)(),[K,Y]=(0,a.useState)([]),[J,X]=(0,a.useState)([]),[$,ee]=(0,a.useState)([]),[et,es]=(0,a.useState)([]),[er,ea]=(0,a.useState)(!1),[el,en]=(0,a.useState)("all"),[eo,ei]=(0,a.useState)("all"),[ed,ec]=(0,a.useState)("30"),[eu,em]=(0,a.useState)("daily"),[eh,ex]=(0,a.useState)(void 0),[ep,ey]=(0,a.useState)(!1),[ev,eg]=(0,a.useState)(new Date),ef="http://127.0.0.1:8080",ej=(0,a.useCallback)(async()=>(await i.A.get("/api/bills")).data,[]),eb=(0,a.useCallback)(async()=>(await i.A.get("/api/stores")).data,[]),eA=(0,a.useCallback)(async()=>(await i.A.get("/api/products")).data,[]),eN=(0,a.useCallback)(async()=>(await i.A.get("/api/users")).data,[]),ew=(0,a.useCallback)(async()=>(await i.A.get("/api/analytics/users/online?windowMinutes=5")).data,[]),eS=(0,a.useCallback)(async()=>{let e=new Date().toISOString().slice(0,10);return(await i.A.get("/api/analytics/users/sessions?from=".concat(e,"&to=").concat(e))).data},[]),eB=(0,a.useCallback)(async()=>(await i.A.get("".concat(ef,"/api/analytics/dashboard?days=").concat(ed))).data,[ed,ef]),eR=(0,a.useCallback)(async()=>(await i.A.get("".concat(ef,"/api/analytics/revenue/trends?period=").concat(eu,"&days=").concat(ed))).data.data||[],[eu,ed,ef]),eF=(0,a.useCallback)(async()=>(await i.A.get("".concat(ef,"/api/analytics/products/top?limit=10&days=").concat(ed,"&sortBy=revenue"))).data.data||[],[ed,ef]),eC=(0,a.useCallback)(async()=>(await i.A.get("".concat(ef,"/api/analytics/inventory/health?days=").concat(ed))).data,[ed,ef]),eD=(0,a.useCallback)(async()=>(await i.A.get("".concat(ef,"/api/analytics/stores/performance?days=").concat(ed))).data.data||[],[ed,ef]),eE=(0,a.useCallback)(async()=>(await i.A.get("".concat(ef,"/api/analytics/category/breakdown?days=").concat(ed))).data.data||[],[ed,ef]),e_=(0,a.useCallback)(async()=>(await i.A.get("".concat(ef,"/api/analytics/alerts"))).data.alerts||[],[ef]),ek=(0,a.useCallback)(async()=>(await i.A.get("".concat(ef,"/api/returns"))).data||[],[ef]),eT=(0,a.useCallback)(async()=>{let[e,t,s,r,a,l,n,o,i,d,c,u,m,h]=await Promise.all([ej(),eb(),eA(),eN(),ew(),eS(),eB(),eR(),eF(),eC(),eD(),eE(),e_(),ek()]);return{bills:e,stores:t,products:s,users:r,onlineUsers:a,sessions:l,dashboardMetrics:n,revenueTrends:o,topProducts:i,inventoryHealth:d,storePerformance:c,categoryBreakdown:u,businessAlerts:m,returns:h}},[ej,eb,eA,eN,ew,eS,eB,eR,eF,eC,eD,eE,e_,ek]),{data:eP,loading:eI,error:eM}=(0,o.A)(eT,{interval:3e4}),[eG,eO]=(0,a.useState)([]),[eV,eW]=(0,a.useState)([]),[eZ,eq]=(0,a.useState)([]),[eU,ez]=(0,a.useState)([]),[eH,eL]=(0,a.useState)(null),[eQ,eK]=(0,a.useState)(null),[eY,eJ]=(0,a.useState)(null),[eX,e$]=(0,a.useState)([]),[e0,e1]=(0,a.useState)([]),[e2,e5]=(0,a.useState)(null),[e8,e4]=(0,a.useState)([]),[e3,e6]=(0,a.useState)([]),[e9,e7]=(0,a.useState)([]),[te,tt]=(0,a.useState)([]);(0,a.useEffect)(()=>{eP&&(eO(eP.bills),eW(eP.stores),eq(eP.products),ez(eP.users),eL(eP.onlineUsers),eK(eP.sessions),eJ(eP.dashboardMetrics),e$(eP.revenueTrends),e1(eP.topProducts),e5(eP.inventoryHealth),e4(eP.storePerformance),e6(eP.categoryBreakdown),e7(eP.businessAlerts),tt(eP.returns))},[eP]),(0,a.useEffect)(()=>{eM&&console.error("Error fetching analytics data:",eM)},[eM]),(0,a.useEffect)(()=>{let e=localStorage.getItem("adminLoggedIn"),t=localStorage.getItem("adminUser");return"true"===e&&t?"super_admin"!==JSON.parse(t).role?void Q.push("/dashboard"):void 0:void Q.push("/")},[Q]);let ts=(0,a.useCallback)(e=>{if(console.log("filterBillsByDate: selectedDate",eh),console.log("filterBillsByDate: input bills count",e.length),!eh)return console.log("filterBillsByDate: No selectedDate, returning all bills."),e;let t=td(eh),s=tc(eh),r=e.filter(e=>{let r=new Date(e.timestamp||e.createdAt);return r>=t&&r<=s});return console.log("filterBillsByDate: filtered bills count",r.length),r},[eh]),tr=e=>"store_1"===e?"STR-1722255700000":e.startsWith("STR-")?e:e.startsWith("store_")?"STR-".concat(e.replace("store_",""),"000000"):e,ta=(0,a.useCallback)(()=>{let e=ts(eG),t=tl(te);e.reduce((e,t)=>e+t.total,0),e.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.quantity,0),0);let s=0,r=0;t.forEach(e=>{("approved"===e.status||"completed"===e.status)&&(s+=e.return_amount,r+=1)});let a=new Map;eV.forEach(e=>{a.set(e.id,{storeId:e.id,storeName:e.name,totalRevenue:0,totalBills:0,totalItems:0,averageBillValue:0,topProducts:[],monthlyTrend:[],revenueGrowth:0,billsGrowth:0,totalRefundAmount:0,totalReturnedItems:0})}),e.forEach(e=>{let t=tr(e.storeId);if(a.has(t)){let s=a.get(t);s.totalRevenue+=e.total,s.totalBills+=1,e.items.forEach(e=>{s.totalItems+=e.quantity;let t=s.topProducts.find(t=>t.productId===e.productId);t?(t.quantity+=e.quantity,t.revenue+=e.total):s.topProducts.push({productId:e.productId,productName:e.productName,quantity:e.quantity,revenue:e.total})})}}),t.forEach(e=>{if("approved"===e.status||"completed"===e.status){var t;let s=tr((null==(t=eG.find(t=>t.id===e.bill_id))?void 0:t.storeId)||"");if(a.has(s)){let t=a.get(s);t.totalRefundAmount+=e.return_amount,t.totalReturnedItems+=1}}}),Y(Array.from(a.values()).map(e=>(e.totalRevenue-=e.totalRefundAmount,e.totalItems-=e.totalReturnedItems,e.averageBillValue=e.totalBills>0?e.totalRevenue/e.totalBills:0,e.topProducts.sort((e,t)=>t.revenue-e.revenue),e.monthlyTrend=[{month:"Jan",revenue:.8*e.totalRevenue,bills:.8*e.totalBills},{month:"Feb",revenue:e.totalRevenue,bills:e.totalBills}],e.revenueGrowth=20,e.billsGrowth=20,e)));let l=new Map;eZ.forEach(e=>{l.set(e.id,{productId:e.id,productName:e.name,totalQuantitySold:0,totalRevenue:0,averagePrice:0,totalBills:0,topStores:[],monthlyTrend:[],quantityGrowth:0,revenueGrowth:0,totalReturnedQuantity:0,totalRefundAmount:0})}),e.forEach(e=>{e.items.forEach(t=>{if(l.has(t.productId)){let s=l.get(t.productId);s.totalQuantitySold+=t.quantity,s.totalRevenue+=t.total,s.totalBills+=1;let r=s.topStores.find(t=>t.storeId===tr(e.storeId));r?(r.quantity+=t.quantity,r.revenue+=t.total):s.topStores.push({storeId:tr(e.storeId),storeName:e.storeName,quantity:t.quantity,revenue:t.total})}})}),t.forEach(e=>{if(("approved"===e.status||"completed"===e.status)&&l.has(e.product_id)){let t=l.get(e.product_id);t.totalRefundAmount+=e.return_amount,t.totalReturnedQuantity+=1}}),X(Array.from(l.values()).map(e=>(e.totalRevenue-=e.totalRefundAmount,e.totalQuantitySold-=e.totalReturnedQuantity,e.averagePrice=e.totalQuantitySold>0?e.totalRevenue/e.totalQuantitySold:0,e.topStores.sort((e,t)=>t.revenue-e.revenue),e.monthlyTrend=[{month:"Jan",quantity:.8*e.totalQuantitySold,revenue:.8*e.totalRevenue},{month:"Feb",quantity:e.totalQuantitySold,revenue:e.totalRevenue}],e.quantityGrowth=20,e.revenueGrowth=20,e)))},[eG,eV,eZ,eh,te]),tl=(0,a.useCallback)(e=>{if(!eh)return e;let t=td(eh),s=tc(eh);return e.filter(e=>{let r=new Date(e.created_at);return r>=t&&r<=s})},[eh]),tn=(0,a.useCallback)(()=>{let e=eU.filter(e=>{if(!eh)return!0;let t=new Date(e.lastLogged),s=td(eh),r=tc(eh);return t>=s&&t<=r}),t={};e.forEach(e=>{let s=new Date(e.lastLogged),r=new Date(e.lastLogout);if(isNaN(s.getTime())||isNaN(r.getTime())||r<s)return;let a=r.getTime()-s.getTime(),l=(0,M.GP)(s,"yyyy-MM-dd");t[l]||(t[l]={totalSessions:0,totalDuration:0,count:0}),t[l].totalSessions+=1,t[l].totalDuration+=a/6e4,t[l].count+=1}),ee(Object.entries(t).map(e=>{let[t,s]=e;return{date:t,totalSessions:s.totalSessions,averageSessionDuration:s.count>0?Number((s.totalDuration/s.count).toFixed(2)):0}}).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()))},[eU,eh]),to=(0,a.useCallback)(()=>{let e=tl(te),t=new Map;eG.forEach(e=>{let s=new Date(e.timestamp||e.createdAt);e.items.forEach(e=>{(!t.has(e.productId)||s<t.get(e.productId))&&t.set(e.productId,s)})});let s={};t.forEach((t,r)=>{if(eh){let a=td(eh),l=tc(eh),n=(0,M.GP)(t,"yyyy-MM-dd");t>=a&&t<=l&&(s[n]||(s[n]={productsAdded:new Set,totalValueAdded:0}),s[n].productsAdded.add(r),eG.filter(e=>(0,M.GP)(new Date(e.timestamp||e.createdAt),"yyyy-MM-dd")===n&&e.items.some(e=>e.productId===r)).forEach(e=>{e.items.filter(e=>e.productId===r).forEach(e=>{s[n].totalValueAdded+=e.total})}),e.filter(e=>(0,M.GP)(new Date(e.created_at),"yyyy-MM-dd")===n&&e.product_id===r&&("approved"===e.status||"completed"===e.status)).forEach(e=>{s[n].totalValueAdded-=e.return_amount}))}}),es(Object.entries(s).map(e=>{let[t,s]=e;return{date:t,productsAdded:s.productsAdded.size,totalValueAdded:Number(s.totalValueAdded.toFixed(2))}}).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()))},[eG,eh,te,tl]),ti=(0,a.useCallback)(()=>{eG.length>0&&eV.length>0&&eZ.length>0&&(ta(),to()),eU.length>0&&tn()},[eG,eV,eZ,eU,te,eh,ta,to,tn]);(0,a.useEffect)(()=>{ti()},[ed,el,eo,eh,eG,eV,eZ,eU,te,ti]);let td=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),tc=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59),tu=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),tm=e=>{let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(r)},th=e=>{let t=new Date(e.timestamp||e.createdAt);return{date:t,day:(0,M.GP)(t,"yyyy-MM-dd"),week:"".concat((0,M.GP)((0,O.k)(t),"yyyy-MM-dd")," to ").concat((0,M.GP)((0,V.$)(t),"yyyy-MM-dd")),month:(0,M.GP)(t,"yyyy-MM"),quarter:"Q".concat(Math.floor(t.getMonth()/3)+1," ").concat(t.getFullYear()),year:t.getFullYear().toString(),dayOfWeek:(0,M.GP)(t,"EEEE"),weekNumber:(0,M.GP)(t,"w"),monthName:(0,M.GP)(t,"MMMM yyyy")}},tx=(e,t,s,r)=>{let a=new Map,l=tl(r);return e.forEach(e=>{let r=th(e),l=r[t];a.has(l)||a.set(l,{period:l,displayName:"day"===t?(0,M.GP)(r.date,"EEEE, MMM dd, yyyy"):"month"===t?r.monthName:"week"===t?"Week ".concat(r.weekNumber,", ").concat(r.year):l,grossRevenue:0,returnAmount:0,netRevenue:0,bills:0,revenue:0,items:0,returnedItems:0,customers:new Set,avgBillValue:0,avgItemsPerBill:0,products:new Map,stores:new Map,categories:new Map,hourlyData:Array(24).fill(0).map(()=>({revenue:0,bills:0,returns:0})),paymentMethods:new Map});let n=a.get(l);if(n.grossRevenue+=e.total,n.revenue+=e.total,n.bills+=1,n.items+=e.items.reduce((e,t)=>e+t.quantity,0),e.customerPhone&&n.customers.add(e.customerPhone),"day"===t){let t=r.date.getHours();n.hourlyData[t].revenue+=e.total,n.hourlyData[t].bills+=1}e.items.forEach(e=>{let t=s.find(t=>t.id===e.productId),r=e.productName;n.products.has(r)||n.products.set(r,{name:r,quantity:0,revenue:0,returns:0,returnRevenue:0,category:(null==t?void 0:t.category)||"Uncategorized"});let a=n.products.get(r);a.quantity+=e.quantity,a.revenue+=e.total;let l=(null==t?void 0:t.category)||"Uncategorized";n.categories.has(l)||n.categories.set(l,{name:l,revenue:0,quantity:0,returns:0,returnRevenue:0});let o=n.categories.get(l);o.revenue+=e.total,o.quantity+=e.quantity}),n.stores.has(e.storeName)||n.stores.set(e.storeName,{name:e.storeName,revenue:0,bills:0,items:0,returns:0,returnAmount:0});let o=n.stores.get(e.storeName);o.revenue+=e.total,o.bills+=1,o.items+=e.items.reduce((e,t)=>e+t.quantity,0);let i=e.paymentMethod||"Cash";n.paymentMethods.set(i,(n.paymentMethods.get(i)||0)+e.total)}),l.forEach(r=>{if("approved"===r.status||"completed"===r.status){let l=new Date(r.created_at),n=th({timestamp:l.toISOString()})[t];if(a.has(n)){let o=a.get(n);o.returnAmount+=r.return_amount,o.returnedItems+=1,o.revenue-=r.return_amount;let i=r.product_name;if(o.products.has(i)){let e=o.products.get(i);e.returns+=1,e.returnRevenue+=r.return_amount,e.revenue-=r.return_amount}let d=s.find(e=>e.id===r.product_id),c=(null==d?void 0:d.category)||"Uncategorized";if(o.categories.has(c)){let e=o.categories.get(c);e.returns+=1,e.returnRevenue+=r.return_amount,e.revenue-=r.return_amount}let u=e.find(e=>e.id===r.bill_id);if(u&&o.stores.has(u.storeName)){let e=o.stores.get(u.storeName);e.returns+=1,e.returnAmount+=r.return_amount,e.revenue-=r.return_amount}if("day"===t){let e=l.getHours();o.hourlyData[e].returns+=r.return_amount,o.hourlyData[e].revenue-=r.return_amount}}}}),Array.from(a.values()).map(e=>({...e,netRevenue:e.revenue,returnRate:e.grossRevenue>0?e.returnAmount/e.grossRevenue*100:0,customers:e.customers.size,avgBillValue:e.bills>0?e.revenue/e.bills:0,avgItemsPerBill:e.bills>0?e.items/e.bills:0,products:Array.from(e.products.values()).map(e=>({...e,returnRate:e.quantity>0?e.returns/e.quantity*100:0})),stores:Array.from(e.stores.values()).map(e=>({name:e.name,revenue:e.revenue,bills:e.bills,items:e.items,returns:e.returns,returnAmount:e.returnAmount,returnRate:e.revenue+e.returnAmount>0?e.returnAmount/(e.revenue+e.returnAmount)*100:0})),categories:Array.from(e.categories.values()).map(e=>({name:e.name,revenue:e.revenue,quantity:e.quantity,returns:e.returns,returnRevenue:e.returnRevenue,returnRate:e.revenue+e.returnRevenue>0?e.returnRevenue/(e.revenue+e.returnRevenue)*100:0})),paymentMethods:Array.from(e.paymentMethods.entries()).map(e=>{let[t,s]=e;return{method:t,amount:s}})}))},tp=async e=>{ea(!0);try{var t,r,a,l,n,o;let i=await Promise.all([s.e(3524),s.e(8436)]).then(s.bind(s,4246)),d=null!=(r=i.default)?r:i;if(!K.length&&!J.length)throw Error("No analytics data available to export");let c=Number(K.reduce((e,t)=>e+t.totalRevenue,0).toFixed(2)),u=K.reduce((e,t)=>e+t.totalBills,0),m=K.reduce((e,t)=>e+t.totalItems,0),h=u>0?Number((c/u).toFixed(2)):0,x=eX.map(e=>({month:e.period,revenue:e.revenue,bills:e.bills})),p={summary:!0,storeAnalytics:!0,productAnalytics:!0,topProducts:!0,monthlyTrends:!0,billDetails:!0,productCatalog:!0,inventoryValuation:!0,productStoreMatrix:!0,categoryAnalysis:!0,slowMovingInventory:!0,stockAlerts:!0,productSalesHistory:!0,customerAnalytics:!0,returnDetails:!0,dailyAnalysis:!0,weeklyAnalysis:!0,monthlyComparison:!0,quarterlyAnalysis:!0,yearlyOverview:!0,dayOfWeekAnalysis:!0,comparativeTrends:!0},y=(null==e?void 0:e.sheets)?Object.fromEntries(Object.entries(p).filter(t=>{let[s]=t;return e.sheets.includes(s)})):p,v=(e,t)=>{for(let s=t.s.c;s<=t.e.c;++s){let r=d.utils.encode_cell({r:t.s.r,c:s});e[r]&&(e[r].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"4B0082"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}})}},g=(e,t)=>{let s=t.reduce((e,t)=>(Object.keys(t).forEach((s,r)=>{let a=t[s]?t[s].toString():"";e[r]=Math.max(e[r]||10,a.length+2)}),e),[]);e["!cols"]=s.map(e=>({wch:Math.min(e,40)}))},f=(e,t,s,r)=>{for(let a=t.s.r+1;a<=t.e.r;++a){for(let t of s){let s=d.utils.encode_cell({r:a,c:t-1});e[s]&&(e[s].z="₹#,##0.00")}for(let t of r){let s=d.utils.encode_cell({r:a,c:t-1});e[s]&&(e[s].z="0.00%")}}},j=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let r=t.s.r;r<=t.e.r;++r)for(let a=t.s.c;a<=t.e.c;++a){let t=d.utils.encode_cell({r:r,c:a});if(e[t])if(e[t].s||(e[t].s={}),r===s)e[t].s={font:{bold:!0,color:{rgb:"FFFFFF"},sz:11},fill:{fgColor:{rgb:"4F46E5"}},alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}};else{let s=r%2==0?"FFFFFF":"F9FAFB";e[t].s.fill={fgColor:{rgb:s}},e[t].s.border={top:{style:"thin",color:{rgb:"E5E7EB"}},bottom:{style:"thin",color:{rgb:"E5E7EB"}},left:{style:"thin",color:{rgb:"E5E7EB"}},right:{style:"thin",color:{rgb:"E5E7EB"}}}}}},b=d.utils.book_new();if(y.summary){let e=[{A:"═══════════════════════════════════════════════════════════════════════",B:"",C:"",D:""},{A:"COMPREHENSIVE ANALYTICS REPORT",B:"",C:"",D:""},{A:"Store and Product Performance Dashboard",B:"",C:"",D:""},{A:"═══════════════════════════════════════════════════════════════════════",B:"",C:"",D:""},{A:"",B:"",C:"",D:""},{A:"\uD83D\uDCCA REPORT INFORMATION",B:"",C:"",D:""},{A:"─────────────────────────────────────────────────────────────────────",B:"",C:"",D:""},{A:"Generated On:",B:(0,M.GP)(new Date,"EEEE, MMMM dd, yyyy"),C:"Time:",D:(0,M.GP)(new Date,"hh:mm:ss a")},{A:"Report Date:",B:eh?(0,M.GP)(eh,"MMMM dd, yyyy"):"All Time",C:"Day:",D:eh?(0,M.GP)(eh,"EEEE"):"N/A"},{A:"Selected Store:",B:"all"===el?"\uD83C\uDFEA All Stores":"\uD83C\uDFEA ".concat((null==(a=eV.find(e=>e.id===el))?void 0:a.name)||"All Stores"),C:"Store Count:",D:K.length},{A:"Selected Product:",B:"all"===eo?"\uD83D\uDCE6 All Products":"\uD83D\uDCE6 ".concat((null==(l=eZ.find(e=>e.id===eo))?void 0:l.name)||"All Products"),C:"Product Count:",D:J.length},{A:"",B:"",C:"",D:""},{A:"\uD83D\uDCB0 KEY PERFORMANCE INDICATORS",B:"",C:"",D:""},{A:"─────────────────────────────────────────────────────────────────────",B:"",C:"",D:""},{A:"Metric",B:"Value",C:"Metric",D:"Value"}],t=u>0?Number((m/u).toFixed(2)):0,s=K.length>0?Number((c/K.length).toFixed(2)):0,r=J.length>0?Number((c/J.length).toFixed(2)):0,i=eZ.reduce((e,t)=>e+(t.stock||0),0),p=eZ.reduce((e,t)=>e+(t.stock||0)*(t.price||0),0),v=eZ.filter(e=>0===(e.stock||0)).length,g=eZ.filter(e=>(e.stock||0)>0&&10>(e.stock||0)).length,f=K.length>0?K.reduce((e,t)=>t.totalRevenue>e.totalRevenue?t:e):null,j=J.length>0?J.reduce((e,t)=>t.totalRevenue>e.totalRevenue?t:e):null;if(e.push({A:"\uD83D\uDCB5 Total Revenue",B:c,C:"\uD83E\uDDFE Total Bills",D:u},{A:"\uD83D\uDCCA Average Bill Value",B:h,C:"\uD83D\uDCE6 Total Items Sold",D:m},{A:"\uD83C\uDFEA Total Stores",B:K.length,C:"\uD83D\uDCCB Products Available",D:J.length},{A:"\uD83D\uDCC8 Avg Items/Bill",B:t,C:"\uD83D\uDCB0 Avg Revenue/Store",D:s},{A:"\uD83D\uDCE6 Avg Revenue/Product",B:r,C:"",D:""},{A:"↩️ Total Refund Amount",B:tb.toFixed(2),C:"\uD83D\uDCE6 Total Returned Items",D:tA},{A:"",B:"",C:"",D:""},{A:"\uD83D\uDCE6 INVENTORY STATUS",B:"",C:"",D:""},{A:"─────────────────────────────────────────────────────────────────────",B:"",C:"",D:""},{A:"Metric",B:"Value",C:"Metric",D:"Value"},{A:"\uD83D\uDCCA Total Stock Units",B:i,C:"\uD83D\uDCB0 Total Stock Value",D:p.toFixed(2)},{A:"❌ Out of Stock",B:v,C:"⚠️ Low Stock Alert",D:g},{A:"✅ In Stock Products",B:eZ.length-v,C:"\uD83D\uDCE6 Active Products",D:eZ.filter(e=>(e.stock||0)>0).length},{A:"",B:"",C:"",D:""}),f||j){if(e.push({A:"\uD83C\uDFC6 TOP PERFORMERS",B:"",C:"",D:""},{A:"─────────────────────────────────────────────────────────────────────",B:"",C:"",D:""}),f){let t=(null==(n=eV.find(e=>e.id===f.storeId))?void 0:n.name)||"Unknown";e.push({A:"\uD83E\uDD47 Best Performing Store",B:t,C:"Revenue",D:f.totalRevenue.toFixed(2)},{A:"",B:"Bills: ".concat(f.totalBills),C:"Items Sold",D:f.totalItems})}if(j){let t=(null==(o=eZ.find(e=>e.id===j.productId))?void 0:o.name)||"Unknown";e.push({A:"\uD83E\uDD47 Best Selling Product",B:t,C:"Revenue",D:j.totalRevenue.toFixed(2)},{A:"",B:"Quantity Sold: ".concat(j.totalQuantitySold),C:"Bills",D:j.totalBills})}e.push({A:"",B:"",C:"",D:""})}if(e3.length>0&&(e.push({A:"\uD83D\uDCC2 CATEGORY BREAKDOWN",B:"",C:"",D:""},{A:"─────────────────────────────────────────────────────────────────────",B:"",C:"",D:""},{A:"Category",B:"Revenue",C:"Quantity",D:"Revenue %"}),e3.slice(0,5).forEach(t=>{e.push({A:"\uD83D\uDCC1 ".concat(t.category),B:t.revenue.toFixed(2),C:t.quantity,D:"".concat(t.revenuePercentage.toFixed(1),"%")})}),e.push({A:"",B:"",C:"",D:""})),x.length>0){let t=x[x.length-1],s=x.length>1?x[x.length-2]:null;if(e.push({A:"\uD83D\uDCC8 SALES TRENDS",B:"",C:"",D:""},{A:"─────────────────────────────────────────────────────────────────────",B:"",C:"",D:""}),t&&e.push({A:"Current Period Revenue",B:t.revenue.toFixed(2),C:"Bills",D:t.bills}),s&&t){let r=s.revenue>0?((t.revenue-s.revenue)/s.revenue*100).toFixed(2):"0.00",a=Number(r)>=0?"\uD83D\uDCC8":"\uD83D\uDCC9";e.push({A:"Previous Period Revenue",B:s.revenue.toFixed(2),C:"Bills",D:s.bills},{A:"".concat(a," Growth Rate"),B:"".concat(r,"%"),C:"Status",D:Number(r)>=0?"✅ Positive":"⚠️ Negative"})}e.push({A:"",B:"",C:"",D:""})}e.push({A:"─────────────────────────────────────────────────────────────────────",B:"",C:"",D:""},{A:"\uD83D\uDCCB Report Contains:",B:"".concat(Object.keys(y).length," Detailed Sheets"),C:"Data Source:",D:"Store Billing System"},{A:"\uD83D\uDD12 Confidential",B:"Internal Use Only",C:"Version:",D:"2.0"},{A:"─────────────────────────────────────────────────────────────────────",B:"",C:"",D:""});let A=d.utils.aoa_to_sheet(e.map(e=>[e.A,e.B,e.C,e.D]));A["!cols"]=[{wch:30},{wch:25},{wch:20},{wch:20}],A["!merges"]||(A["!merges"]=[]),A["!merges"].push({s:{r:1,c:0},e:{r:1,c:3}},{s:{r:2,c:0},e:{r:2,c:3}},{s:{r:5,c:0},e:{r:5,c:3}},{s:{r:12,c:0},e:{r:12,c:3}},{s:{r:20,c:0},e:{r:20,c:3}});let N=d.utils.decode_range(A["!ref"]||"A1:D50");for(let e=N.s.r;e<=N.e.r;++e)for(let t=N.s.c;t<=N.e.c;++t){let s=d.utils.encode_cell({r:e,c:t});A[s]&&(A[s].s||(A[s].s={}),1===e&&(A[s].s={font:{bold:!0,sz:18,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"1E3A8A"}},alignment:{horizontal:"center",vertical:"center"}}),2===e&&(A[s].s={font:{bold:!0,sz:12,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"3B82F6"}},alignment:{horizontal:"center",vertical:"center"}}),A[s].v&&"string"==typeof A[s].v&&(A[s].v.includes("\uD83D\uDCCA")||A[s].v.includes("\uD83D\uDCB0")||A[s].v.includes("\uD83D\uDCE6")||A[s].v.includes("\uD83C\uDFC6")||A[s].v.includes("\uD83D\uDCC2")||A[s].v.includes("\uD83D\uDCC8"))&&(A[s].s={font:{bold:!0,sz:14,color:{rgb:"1E3A8A"}},fill:{fgColor:{rgb:"DBEAFE"}},alignment:{horizontal:"left",vertical:"center"}}),(14===e||22===e)&&("Metric"===A[s].v||"Value"===A[s].v)&&(A[s].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"6366F1"}},alignment:{horizontal:"center",vertical:"center"}}),(1===t||3===t)&&e>14&&"number"==typeof A[s].v&&(A[s].z="₹#,##0.00"),e>5&&e<N.e.r-3&&(A[s].s||(A[s].s={}),A[s].s.border={top:{style:"thin",color:{rgb:"E5E7EB"}},bottom:{style:"thin",color:{rgb:"E5E7EB"}},left:{style:"thin",color:{rgb:"E5E7EB"}},right:{style:"thin",color:{rgb:"E5E7EB"}}}))}A["!rows"]=Array(e.length).fill({hpt:20}),A["!rows"][1]={hpt:35},A["!rows"][2]={hpt:25},d.utils.book_append_sheet(b,A,"Summary")}if(y.storeAnalytics){let e=K.map(e=>({"Store Name":e.storeName,"Total Revenue":Number(e.totalRevenue.toFixed(2)),"Total Bills":e.totalBills,"Total Items Sold":e.totalItems,"Average Bill Value":Number(e.averageBillValue.toFixed(2)),"Revenue Growth %":e.revenueGrowth/100,"Bills Growth %":e.billsGrowth/100,"Total Refund Amount":Number(e.totalRefundAmount.toFixed(2)),"Total Returned Items":e.totalReturnedItems,Status:0===e.totalBills?"No Activity":"Active"})),t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:J1")),f(t,d.utils.decode_range(t["!ref"]||"A1:J1"),[2,5,8],[6,7]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Store Analytics")}if(y.productAnalytics){let e=J.map(e=>{var t;return{"Product Name":e.productName,"Total Quantity Sold":e.totalQuantitySold,"Total Revenue":Number(e.totalRevenue.toFixed(2)),"Average Price":Number(e.averagePrice.toFixed(2)),"Total Bills":e.totalBills,"Quantity Growth %":e.quantityGrowth/100,"Revenue Growth %":e.revenueGrowth/100,"Total Returned Quantity":e.totalReturnedQuantity,"Total Refund Amount":Number(e.totalRefundAmount.toFixed(2)),"Top Store":(null==(t=e.topStores[0])?void 0:t.storeName)||"N/A"}}),t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:J1")),f(t,d.utils.decode_range(t["!ref"]||"A1:J1"),[3,4,9],[6,7]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Product Analytics")}if(y.topProducts){let e=[];K.forEach(t=>{t.topProducts.forEach((s,r)=>{e.push({"Store Name":t.storeName,Rank:r+1,"Product Name":s.productName,"Quantity Sold":s.quantity,Revenue:Number(s.revenue.toFixed(2))})})});let t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:E1")),f(t,d.utils.decode_range(t["!ref"]||"A1:E1"),[5],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Top Products by Store")}if(y.monthlyTrends){let e=[];K.forEach(t=>{t.monthlyTrend.forEach(s=>{e.push({"Store Name":t.storeName,Month:s.month,Revenue:Number(s.revenue.toFixed(2)),Bills:s.bills})})});let t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:D1")),f(t,d.utils.decode_range(t["!ref"]||"A1:D1"),[3],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Monthly Trends")}if(y.billDetails){let e=ts(eG).map(e=>({"Bill ID":e.id,"Store Name":e.storeName,"Customer Name":e.customerName||"N/A",Date:(0,M.GP)(new Date(e.timestamp||e.createdAt),"yyyy-MM-dd HH:mm:ss"),Items:e.items.map(e=>"".concat(e.productName," (Qty: ").concat(e.quantity,")")).join(", "),Subtotal:Number((e.subtotal||0).toFixed(2)),Tax:Number((e.taxAmount||0).toFixed(2)),Discount:Number((e.discountAmount||0).toFixed(2)),Total:Number((e.total||0).toFixed(2)),"Created By":e.createdBy})),t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:J1")),f(t,d.utils.decode_range(t["!ref"]||"A1:J1"),[6,7,8,9],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Bill Details")}if(y.productCatalog){let e=eZ.map(e=>{var t;let s=J.find(t=>t.productId===e.id);return{"Product ID":e.id,"Product Name":e.name,Category:e.category||"Uncategorized",Price:Number(e.price||0).toFixed(2),"Current Stock":e.stock||0,"Stock Value":Number((e.price||0)*(e.stock||0)).toFixed(2),"Assigned Store":(null==(t=eV.find(t=>t.id===e.assignedStoreId))?void 0:t.name)||"Unassigned","Total Sold":(null==s?void 0:s.totalQuantitySold)||0,"Total Revenue":Number((null==s?void 0:s.totalRevenue)||0).toFixed(2),"Total Bills":(null==s?void 0:s.totalBills)||0,"Avg Price":Number((null==s?void 0:s.averagePrice)||e.price||0).toFixed(2),"Stock Status":0===(e.stock||0)?"Out of Stock":10>(e.stock||0)?"Low Stock":"In Stock"}}),t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:L1")),f(t,d.utils.decode_range(t["!ref"]||"A1:L1"),[4,6,9,11],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Product Catalog")}if(y.inventoryValuation&&e2){let e=[{Metric:"Total Products",Value:e2.summary.totalProducts},{Metric:"Total Inventory Value",Value:e2.summary.totalInventoryValue.toFixed(2)},{Metric:"Average Turnover Ratio",Value:e2.summary.averageTurnover.toFixed(2)},{Metric:"Slow Moving Items",Value:e2.summary.slowMovingCount},{Metric:"Out of Stock Items",Value:e2.summary.outOfStockCount},{Metric:"",Value:""},...eZ.map(e=>{var t;return{"Product Name":e.name,Category:e.category||"Uncategorized","Current Stock":e.stock||0,"Unit Price":Number(e.price||0).toFixed(2),"Stock Value":Number((e.price||0)*(e.stock||0)).toFixed(2),Store:(null==(t=eV.find(t=>t.id===e.assignedStoreId))?void 0:t.name)||"Unassigned"}})],t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range("A1:F1")),f(t,d.utils.decode_range(t["!ref"]||"A1:F1"),[4,5],[]),t["!freeze"]={xSplit:0,ySplit:6},d.utils.book_append_sheet(b,t,"Inventory Valuation")}if(y.productStoreMatrix){let e=[];eV.forEach(t=>{let s=eZ.filter(e=>e.assignedStoreId===t.id);K.find(e=>e.storeId===t.id),s.forEach(s=>{let r=J.find(e=>e.productId===s.id),a=null==r?void 0:r.topStores.find(e=>e.storeId===t.id);e.push({"Store Name":t.name,"Product Name":s.name,Category:s.category||"Uncategorized","Current Stock":s.stock||0,Price:Number(s.price||0).toFixed(2),"Quantity Sold":(null==a?void 0:a.quantity)||0,"Revenue Generated":Number((null==a?void 0:a.revenue)||0).toFixed(2),"Stock Value":Number((s.price||0)*(s.stock||0)).toFixed(2)})})});let t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:H1")),f(t,d.utils.decode_range(t["!ref"]||"A1:H1"),[5,7,8],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Product-Store Matrix")}if(y.categoryAnalysis&&e3.length>0){let e=e3.map(e=>({Category:e.category,"Total Revenue":Number(e.revenue).toFixed(2),"Quantity Sold":e.quantity,"Bills Count":e.billsCount,"Average Price":Number(e.averagePrice).toFixed(2),"Revenue %":Number(e.revenuePercentage).toFixed(2)+"%","Product Count":eZ.filter(t=>t.category===e.category).length})),t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:G1")),f(t,d.utils.decode_range(t["!ref"]||"A1:G1"),[2,5],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Category Analysis")}if(y.slowMovingInventory&&e2){let e=e2.slowMoving.map(e=>({"Product Name":e.productName,Barcode:e.barcode||"N/A","Current Stock":e.currentStock,"Stock Value":Number(e.stockValue).toFixed(2),"Quantity Sold":e.soldQuantity,"Turnover Ratio":Number(e.turnoverRatio).toFixed(2),"Days of Stock":999===e.daysOfStock?"Infinite":e.daysOfStock.toString(),Recommendation:e.turnoverRatio<.1?"Consider Discount":"Monitor Closely"})),t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:H1")),f(t,d.utils.decode_range(t["!ref"]||"A1:H1"),[4],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Slow Moving Inventory")}if(y.stockAlerts){let e=[];eZ.filter(e=>0===(e.stock||0)).forEach(t=>{var s;e.push({"Alert Type":"OUT OF STOCK","Product Name":t.name,Category:t.category||"Uncategorized","Current Stock":0,Price:Number(t.price||0).toFixed(2),"Assigned Store":(null==(s=eV.find(e=>e.id===t.assignedStoreId))?void 0:s.name)||"Unassigned",Priority:"CRITICAL"})}),eZ.filter(e=>(e.stock||0)>0&&10>(e.stock||0)).forEach(t=>{var s;e.push({"Alert Type":"LOW STOCK","Product Name":t.name,Category:t.category||"Uncategorized","Current Stock":t.stock,Price:Number(t.price||0).toFixed(2),"Assigned Store":(null==(s=eV.find(e=>e.id===t.assignedStoreId))?void 0:s.name)||"Unassigned",Priority:"HIGH"})});let t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:G1")),f(t,d.utils.decode_range(t["!ref"]||"A1:G1"),[5],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Stock Alerts")}if(y.productSalesHistory){let e=[];ts(eG).forEach(t=>{t.items.forEach(s=>{let r=eZ.find(e=>e.id===s.productId);e.push({Date:(0,M.GP)(new Date(t.timestamp||t.createdAt),"yyyy-MM-dd HH:mm:ss"),"Bill ID":t.id,"Product Name":s.productName,Category:(null==r?void 0:r.category)||"Unknown",Quantity:s.quantity,"Unit Price":Number(s.price).toFixed(2),Total:Number(s.total).toFixed(2),Store:t.storeName,Customer:t.customerName||"Walk-in","Created By":t.createdBy})})});let t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:J1")),f(t,d.utils.decode_range(t["!ref"]||"A1:J1"),[6,7],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Product Sales History")}if(y.customerAnalytics){let e=new Map;ts(eG).forEach(t=>{let s=t.customerPhone||"Walk-in",r=t.customerName||"Walk-in Customer";e.has(s)||e.set(s,{name:r,phone:s,totalBills:0,totalSpent:0,totalItems:0,firstPurchase:t.timestamp||t.createdAt,lastPurchase:t.timestamp||t.createdAt});let a=e.get(s);a.totalBills+=1,a.totalSpent+=t.total,a.totalItems+=t.items.reduce((e,t)=>e+t.quantity,0),a.lastPurchase=t.timestamp||t.createdAt});let t=Array.from(e.values()).map(e=>({"Customer Name":e.name,Phone:e.phone,"Total Bills":e.totalBills,"Total Spent":Number(e.totalSpent).toFixed(2),"Total Items":e.totalItems,"Avg Bill Value":Number(e.totalSpent/e.totalBills).toFixed(2),"First Purchase":(0,M.GP)(new Date(e.firstPurchase),"yyyy-MM-dd"),"Last Purchase":(0,M.GP)(new Date(e.lastPurchase),"yyyy-MM-dd"),"Customer Type":e.totalBills>5?"Loyal":e.totalBills>2?"Regular":"New"}));t.sort((e,t)=>Number(t["Total Spent"])-Number(e["Total Spent"]));let s=d.utils.json_to_sheet(t);g(s,t),j(s,d.utils.decode_range(s["!ref"]||"A1:I1")),f(s,d.utils.decode_range(s["!ref"]||"A1:I1"),[4,6],[]),s["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,s,"Customer Analytics")}if(y.returnDetails){let e=te.map(e=>({"Return ID":e.return_id,"Bill ID":e.bill_id,"Product Name":e.product_name,"Product ID":e.product_id,"Customer Name":e.customer_name,"Customer Phone":e.customer_phone_number,"Return Amount":Number(e.return_amount).toFixed(2),"Refund Method":e.refund_method,Status:e.status,Message:e.message,"Created By":e.created_by,"Created At":(0,M.GP)(new Date(e.created_at),"yyyy-MM-dd HH:mm:ss")})),t=d.utils.json_to_sheet(e);g(t,e),j(t,d.utils.decode_range(t["!ref"]||"A1:L1")),f(t,d.utils.decode_range(t["!ref"]||"A1:L1"),[7],[]),t["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,t,"Return Details")}if(!1!==y.dailyAnalysis){let e=tx(ts(eG),"day",eZ,te),t=[];e.sort((e,t)=>new Date(e.period).getTime()-new Date(t.period).getTime()).forEach(e=>{t.push({A:"\uD83D\uDCC5 ".concat(e.displayName),B:"",C:"",D:"",E:"",F:"",G:""}),t.push({A:"Revenue",B:e.revenue.toFixed(2),C:"Bills",D:e.bills,E:"Items Sold",F:e.items,G:""}),t.push({A:"Avg Bill Value",B:e.avgBillValue.toFixed(2),C:"Avg Items/Bill",D:e.avgItemsPerBill.toFixed(2),E:"Unique Customers",F:e.customers,G:""}),t.push({A:"",B:"",C:"",D:"",E:"",F:"",G:""}),t.push({A:"⏰ Hourly Breakdown",B:"Revenue",C:"Bills",D:"Avg Bill",E:"",F:"",G:""}),e.hourlyData.forEach((e,s)=>{e.bills>0&&t.push({A:"".concat(s.toString().padStart(2,"0"),":00 - ").concat((s+1).toString().padStart(2,"0"),":00"),B:e.revenue.toFixed(2),C:e.bills,D:(e.revenue/e.bills).toFixed(2),E:"",F:"",G:""})}),t.push({A:"",B:"",C:"",D:"",E:"",F:"",G:""}),t.push({A:"\uD83C\uDFC6 Top Products",B:"Quantity",C:"Revenue",D:"Category",E:"",F:"",G:""}),Array.from(e.products.values()).sort((e,t)=>t.revenue-e.revenue).slice(0,5).forEach(e=>{t.push({A:e.name,B:e.quantity,C:e.revenue.toFixed(2),D:e.category,E:"",F:"",G:""})}),t.push({A:"",B:"",C:"",D:"",E:"",F:"",G:""}),t.push({A:"\uD83C\uDFEA Store Performance",B:"Revenue",C:"Bills",D:"Items",E:"Avg Bill",F:"",G:""}),Array.from(e.stores.values()).forEach(e=>{t.push({A:e.name,B:e.revenue.toFixed(2),C:e.bills,D:e.items,E:(e.revenue/e.bills).toFixed(2),F:"",G:""})}),t.push({A:"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━",B:"",C:"",D:"",E:"",F:"",G:""}),t.push({A:"",B:"",C:"",D:"",E:"",F:"",G:""})});let s=d.utils.aoa_to_sheet(t.map(e=>[e.A,e.B,e.C,e.D,e.E,e.F,e.G]));s["!cols"]=[{wch:35},{wch:15},{wch:12},{wch:15},{wch:15},{wch:12},{wch:12}],f(s,d.utils.decode_range(s["!ref"]||"A1:G1"),[2,3,5],[]),d.utils.book_append_sheet(b,s,"Daily Analysis")}if(!1!==y.weeklyAnalysis){let e=tx(ts(eG),"week",eZ,te),t=e.map((t,s)=>{var r,a;let l=s>0?e[s-1]:null,n=l?(t.revenue-l.revenue)/l.revenue*100:0;return{"Week Period":t.period,Revenue:t.revenue.toFixed(2),Bills:t.bills,"Items Sold":t.items,Customers:t.customers,"Avg Bill":t.avgBillValue.toFixed(2),"Growth %":n.toFixed(2),"Top Product":(null==(r=Array.from(t.products.values()).sort((e,t)=>t.revenue-e.revenue)[0])?void 0:r.name)||"N/A","Top Category":(null==(a=Array.from(t.categories.values()).sort((e,t)=>t.revenue-e.revenue)[0])?void 0:a.name)||"N/A"}}),s=d.utils.json_to_sheet(t);g(s,t),v(s,d.utils.decode_range(s["!ref"]||"A1:I1")),f(s,d.utils.decode_range(s["!ref"]||"A1:I1"),[2,6],[7]),s["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,s,"Weekly Analysis")}if(!1!==y.monthlyComparison){let e=tx(ts(eG),"month",eZ,te),t=[{A:"\uD83D\uDCCA MONTHLY PERFORMANCE COMPARISON",B:"",C:"",D:"",E:"",F:"",G:"",H:""},{A:"",B:"",C:"",D:"",E:"",F:"",G:"",H:""},{A:"Month",B:"Revenue",C:"Bills",D:"Items",E:"Customers",F:"Avg Bill",G:"MoM Growth",H:"Status"}];e.sort((e,t)=>e.period.localeCompare(t.period)).forEach((s,r)=>{let a=r>0?e[r-1]:null,l=a?(s.revenue-a.revenue)/a.revenue*100:0,n=l>=0?"\uD83D\uDCC8 Up":"\uD83D\uDCC9 Down";t.push({A:s.displayName,B:s.revenue.toFixed(2),C:s.bills,D:s.items,E:s.customers,F:s.avgBillValue.toFixed(2),G:"".concat(l.toFixed(2),"%"),H:n}),t.push({A:"  Top 3 Products:",B:"",C:"",D:"",E:"",F:"",G:"",H:""}),Array.from(s.products.values()).sort((e,t)=>t.revenue-e.revenue).slice(0,3).forEach((e,s)=>{t.push({A:"    ".concat(s+1,". ").concat(e.name),B:e.revenue.toFixed(2),C:"Qty: ".concat(e.quantity),D:e.category,E:"",F:"",G:"",H:""})}),t.push({A:"  Store Performance:",B:"",C:"",D:"",E:"",F:"",G:"",H:""}),Array.from(s.stores.values()).forEach(e=>{t.push({A:"    ".concat(e.name),B:e.revenue.toFixed(2),C:e.bills,D:e.items,E:"",F:"",G:"",H:""})}),t.push({A:"─────────────────────────────────────────────────",B:"",C:"",D:"",E:"",F:"",G:"",H:""})}),t.push({A:"",B:"",C:"",D:"",E:"",F:"",G:"",H:""}),t.push({A:"\uD83D\uDCC8 SUMMARY STATISTICS",B:"",C:"",D:"",E:"",F:"",G:"",H:""});let s=e.reduce((e,t)=>e+t.revenue,0),r=s/e.length,a=e.reduce((e,t)=>t.revenue>e.revenue?t:e),l=e.reduce((e,t)=>t.revenue<e.revenue?t:e);t.push({A:"Total Revenue (All Months)",B:s.toFixed(2),C:"",D:"",E:"",F:"",G:"",H:""},{A:"Average Monthly Revenue",B:r.toFixed(2),C:"",D:"",E:"",F:"",G:"",H:""},{A:"Best Month",B:a.displayName,C:a.revenue.toFixed(2),D:"",E:"",F:"",G:"",H:""},{A:"Worst Month",B:l.displayName,C:l.revenue.toFixed(2),D:"",E:"",F:"",G:"",H:""});let n=d.utils.aoa_to_sheet(t.map(e=>[e.A,e.B,e.C,e.D,e.E,e.F,e.G,e.H]));n["!cols"]=[{wch:35},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12}],n["!merges"]||(n["!merges"]=[]),n["!merges"].push({s:{r:0,c:0},e:{r:0,c:7}}),f(n,d.utils.decode_range(n["!ref"]||"A1:H1"),[2,6],[]),d.utils.book_append_sheet(b,n,"Monthly Comparison")}if(!1!==y.quarterlyAnalysis){let e=tx(ts(eG),"quarter",eZ,te),t=e.map((t,s)=>{var r,a;let l=s>0?e[s-1]:null,n=l?(t.revenue-l.revenue)/l.revenue*100:0;return{Quarter:t.period,Revenue:t.revenue.toFixed(2),Bills:t.bills,"Items Sold":t.items,"Unique Customers":t.customers,"Avg Bill Value":t.avgBillValue.toFixed(2),"Avg Items/Bill":t.avgItemsPerBill.toFixed(2),"QoQ Growth %":n.toFixed(2),"Top Product":(null==(r=Array.from(t.products.values()).sort((e,t)=>t.revenue-e.revenue)[0])?void 0:r.name)||"N/A","Top Store":(null==(a=Array.from(t.stores.values()).sort((e,t)=>t.revenue-e.revenue)[0])?void 0:a.name)||"N/A"}}),s=d.utils.json_to_sheet(t);g(s,t),v(s,d.utils.decode_range(s["!ref"]||"A1:J1")),f(s,d.utils.decode_range(s["!ref"]||"A1:J1"),[2,6,7],[8]),s["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,s,"Quarterly Analysis")}if(!1!==y.yearlyOverview){let e=tx(ts(eG),"year",eZ,te),t=[{A:"\uD83D\uDCC5 YEARLY PERFORMANCE OVERVIEW",B:"",C:"",D:"",E:"",F:""},{A:"",B:"",C:"",D:"",E:"",F:""}];e.sort((e,t)=>e.period.localeCompare(t.period)).forEach((s,r)=>{let a=r>0?e[r-1]:null,l=a?(s.revenue-a.revenue)/a.revenue*100:0;t.push({A:"\uD83D\uDDD3️ YEAR ".concat(s.period),B:"",C:"",D:"",E:"",F:""},{A:"═══════════════════════════════════════════════════════════════════════",B:"",C:"",D:"",E:"",F:""},{A:"",B:"",C:"",D:"",E:"",F:""},{A:"\uD83D\uDCB0 FINANCIAL METRICS",B:"",C:"",D:"",E:"",F:""},{A:"Total Revenue",B:s.revenue.toFixed(2),C:"Avg Monthly",D:(s.revenue/12).toFixed(2),E:"",F:""},{A:"Total Bills",B:s.bills,C:"Avg Daily",D:(s.bills/365).toFixed(0),E:"",F:""},{A:"Total Items Sold",B:s.items,C:"YoY Growth",D:"".concat(l.toFixed(2),"%"),E:"",F:""},{A:"",B:"",C:"",D:"",E:"",F:""},{A:"\uD83D\uDC65 CUSTOMER METRICS",B:"",C:"",D:"",E:"",F:""},{A:"Unique Customers",B:s.customers,C:"Avg Bill Value",D:s.avgBillValue.toFixed(2),E:"",F:""},{A:"Avg Items per Bill",B:s.avgItemsPerBill.toFixed(2),C:"Bills per Customer",D:(s.bills/s.customers).toFixed(2),E:"",F:""},{A:"",B:"",C:"",D:"",E:"",F:""}),t.push({A:"\uD83C\uDFC6 TOP 5 PRODUCTS",B:"Revenue",C:"Quantity",D:"Category",E:"",F:""}),Array.from(s.products.values()).sort((e,t)=>t.revenue-e.revenue).slice(0,5).forEach((e,s)=>{t.push({A:"".concat(s+1,". ").concat(e.name),B:e.revenue.toFixed(2),C:e.quantity,D:e.category,E:"",F:""})}),t.push({A:"",B:"",C:"",D:"",E:"",F:""}),t.push({A:"\uD83D\uDCC2 CATEGORY BREAKDOWN",B:"Revenue",C:"Quantity",D:"% of Total",E:"",F:""}),Array.from(s.categories.values()).sort((e,t)=>t.revenue-e.revenue).forEach(e=>{let r=(e.revenue/s.revenue*100).toFixed(2);t.push({A:e.name,B:e.revenue.toFixed(2),C:e.quantity,D:"".concat(r,"%"),E:"",F:""})}),t.push({A:"",B:"",C:"",D:"",E:"",F:""}),t.push({A:"\uD83C\uDFEA STORE PERFORMANCE",B:"Revenue",C:"Bills",D:"Items",E:"Avg Bill",F:"% Share"}),Array.from(s.stores.values()).sort((e,t)=>t.revenue-e.revenue).forEach(e=>{let r=(e.revenue/s.revenue*100).toFixed(2);t.push({A:e.name,B:e.revenue.toFixed(2),C:e.bills,D:e.items,E:(e.revenue/e.bills).toFixed(2),F:"".concat(r,"%")})}),t.push({A:"",B:"",C:"",D:"",E:"",F:""},{A:"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━",B:"",C:"",D:"",E:"",F:""},{A:"",B:"",C:"",D:"",E:"",F:""})});let s=d.utils.aoa_to_sheet(t.map(e=>[e.A,e.B,e.C,e.D,e.E,e.F]));s["!cols"]=[{wch:35},{wch:18},{wch:15},{wch:18},{wch:15},{wch:12}],f(s,d.utils.decode_range(s["!ref"]||"A1:F1"),[2,5],[]),d.utils.book_append_sheet(b,s,"Yearly Overview")}if(!1!==y.dayOfWeekAnalysis){let e=new Map,t=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];t.forEach(t=>{e.set(t,{day:t,revenue:0,bills:0,items:0,occurrences:0})}),ts(eG).forEach(t=>{let s=(0,M.GP)(new Date(t.timestamp||t.createdAt),"EEEE"),r=e.get(s);r.revenue+=t.total,r.bills+=1,r.items+=t.items.reduce((e,t)=>e+t.quantity,0),r.occurrences+=1});let s=t.map(t=>{let s=e.get(t);return{Day:t,"Total Revenue":s.revenue.toFixed(2),"Total Bills":s.bills,"Total Items":s.items,Occurrences:s.occurrences,"Avg Revenue/Day":s.occurrences>0?(s.revenue/s.occurrences).toFixed(2):"0.00","Avg Bills/Day":s.occurrences>0?(s.bills/s.occurrences).toFixed(1):"0.0","Avg Bill Value":s.bills>0?(s.revenue/s.bills).toFixed(2):"0.00",Performance:s.revenue>Array.from(e.values()).reduce((e,t)=>e+t.revenue,0)/7?"\uD83D\uDD25 Above Avg":"\uD83D\uDCCA Below Avg"}}),r=d.utils.json_to_sheet(s);g(r,s),v(r,d.utils.decode_range(r["!ref"]||"A1:I1")),f(r,d.utils.decode_range(r["!ref"]||"A1:I1"),[2,6,7,8],[]),r["!freeze"]={xSplit:0,ySplit:1},d.utils.book_append_sheet(b,r,"Day of Week Analysis")}if(!1!==y.comparativeTrends){let e=tx(ts(eG),"month",eZ,te),t=[{A:"\uD83D\uDCC8 COMPARATIVE TRENDS ANALYSIS",B:"",C:"",D:"",E:"",F:"",G:""},{A:"",B:"",C:"",D:"",E:"",F:"",G:""},{A:"Month",B:"Revenue",C:"MoM Change",D:"Bills",E:"Bills Change",F:"Avg Bill",G:"Trend"}];e.sort((e,t)=>e.period.localeCompare(t.period)).forEach((s,r)=>{let a=r>0?e[r-1]:null,l=a?s.revenue-a.revenue:0,n=a?(s.revenue-a.revenue)/a.revenue*100:0,o=a?s.bills-a.bills:0,i=n>5?"\uD83D\uDE80 Strong Growth":n>0?"\uD83D\uDCC8 Growth":n>-5?"➡️ Stable":"\uD83D\uDCC9 Decline";t.push({A:s.displayName,B:s.revenue.toFixed(2),C:"".concat(l>=0?"+":"").concat(l.toFixed(2)," (").concat(n.toFixed(1),"%)"),D:s.bills,E:a?"".concat(o>=0?"+":"").concat(o):"N/A",F:s.avgBillValue.toFixed(2),G:i})});let s=d.utils.aoa_to_sheet(t.map(e=>[e.A,e.B,e.C,e.D,e.E,e.F,e.G]));s["!cols"]=[{wch:25},{wch:15},{wch:20},{wch:12},{wch:15},{wch:12},{wch:18}],s["!merges"]||(s["!merges"]=[]),s["!merges"].push({s:{r:0,c:0},e:{r:0,c:6}}),f(s,d.utils.decode_range(s["!ref"]||"A1:G1"),[2,6],[]),d.utils.book_append_sheet(b,s,"Comparative Trends")}let A=eh?(0,M.GP)(eh,"yyyy-MM-dd"):(0,M.GP)(new Date,"yyyy-MM-dd"),N="all"===el?"":"-".concat((null==(t=eV.find(e=>e.id===el))?void 0:t.name.replace(/\s/g,"-"))||"store"),w="Analytics-Report".concat(N,"-").concat(A,".xlsx"),S=d.write(b,{bookType:"xlsx",type:"array"}),B=new Blob([S],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),R=URL.createObjectURL(B),F=document.createElement("a");F.href=R,F.download=w,document.body.appendChild(F),F.click(),F.remove(),URL.revokeObjectURL(R),alert("Analytics report exported successfully!")}catch(t){console.error("Error exporting analytics:",t);let e="Failed to export analytics. Please try again.";t.message.includes("No analytics data")?e="No data available to export. Please ensure data is loaded.":t.message.includes("SheetJS")&&(e="Failed to load export library. Please check your connection."),alert(e)}finally{ea(!1)}},ty="all"===el?K:K.filter(e=>e.storeId===el),tv="all"===eo?J:J.filter(e=>e.productId===eo),tg=K.reduce((e,t)=>e+t.totalRevenue,0),tf=K.reduce((e,t)=>e+t.totalBills,0),tj=K.reduce((e,t)=>e+t.totalItems,0),tb=K.reduce((e,t)=>e+t.totalRefundAmount,0),tA=K.reduce((e,t)=>e+t.totalReturnedItems,0),tN=tf>0?tg/tf:0;return eI?(0,r.jsx)(n.default,{children:(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)(F.A,{className:"h-8 w-8 animate-spin"})})}):(0,r.jsx)(n.default,{children:(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Analytics Dashboard"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"Comprehensive insights into store and product performance"})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsxs)(u.$,{onClick:()=>tp(),variant:"outline",className:"bg-green-50 hover:bg-green-100",disabled:er,children:[(0,r.jsx)(C.A,{className:"h-4 w-4 mr-2"}),er?"Exporting...":"Export Report"]}),(0,r.jsxs)(u.$,{onClick:ti,variant:"outline",className:"bg-blue-50 hover:bg-blue-100",disabled:eI,children:[(0,r.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Refresh Analytics"]})]})]}),e9.length>0&&(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsxs)(d.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(D.A,{className:"h-5 w-5 text-orange-500"}),"Business Alerts"]})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)("div",{className:"space-y-2",children:e9.map((e,t)=>(0,r.jsx)("div",{className:"p-3 rounded-lg border ".concat("error"===e.type?"bg-red-50 border-red-200":"warning"===e.type?"bg-orange-50 border-orange-200":"bg-blue-50 border-blue-200"),children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.message})]}),(0,r.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat("critical"===e.priority?"bg-red-100 text-red-800":"high"===e.priority?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800"),children:e.priority})]})},t))})})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsxs)(d.ZB,{className:"flex items-center",children:[(0,r.jsx)(E.A,{className:"h-5 w-5 mr-2"}),"Filters & Date Selection"]})}),(0,r.jsx)(d.Wu,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(m.J,{children:"Selected Date"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)(u.$,{variant:"outline",className:"w-full justify-start text-left font-normal",onClick:()=>ey(e=>!e),children:[(0,r.jsx)(Z.A,{className:"mr-2 h-4 w-4"}),eh?(0,M.GP)(eh,"LLL dd, y"):(0,r.jsx)("span",{children:"Pick a date"})]}),ep&&(0,r.jsxs)("div",{className:"absolute left-0 z-50 mt-2 bg-white border rounded shadow-lg p-3 w-80",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>eg(e=>new Date(e.getFullYear(),e.getMonth()-1,1)),children:"◀"}),(0,r.jsx)("div",{className:"text-sm font-medium",children:ev.toLocaleString(void 0,{month:"long",year:"numeric"})}),(0,r.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>eg(e=>new Date(e.getFullYear(),e.getMonth()+1,1)),children:"▶"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-7 text-[11px] text-gray-500 mb-1",children:[(0,r.jsx)("div",{className:"text-center",children:"Su"}),(0,r.jsx)("div",{className:"text-center",children:"Mo"}),(0,r.jsx)("div",{className:"text-center",children:"Tu"}),(0,r.jsx)("div",{className:"text-center",children:"We"}),(0,r.jsx)("div",{className:"text-center",children:"Th"}),(0,r.jsx)("div",{className:"text-center",children:"Fr"}),(0,r.jsx)("div",{className:"text-center",children:"Sa"})]}),(0,r.jsx)("div",{className:"grid grid-cols-7 gap-1",children:(()=>{let e=(0,W.w)(ev).getDay(),t=new Date(ev.getFullYear(),ev.getMonth()+1,0).getDate(),s=[];for(let t=0;t<e;t++)s.push((0,r.jsx)("div",{className:"h-8"},"b-".concat(t)));for(let e=1;e<=t;e++){let t=new Date(ev.getFullYear(),ev.getMonth(),e),a=tu(t,new Date),l=eh&&tu(t,eh),n="h-8 w-8 mx-auto flex items-center justify-center rounded-full cursor-pointer select-none ";a&&(n+="border-2 border-red-500 text-red-600 "),l?n+="bg-blue-600 text-white ":n+="text-gray-700 hover:bg-gray-100 ",s.push((0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:n,onClick:()=>{ex(t),ey(!1)},children:e})},tm(t)))}return s})()}),(0,r.jsx)("div",{className:"mt-3 border-t pt-3 text-right",children:(0,r.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>ey(!1),children:"Close"})})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(m.J,{children:"Quick Dates"}),(0,r.jsxs)(h.l6,{onValueChange:e=>{let t,s=new Date;switch(e){case"today":t=s;break;case"yesterday":t=(0,G.e)(s,1);break;case"all":t=void 0;break;default:return}ex(t)},children:[(0,r.jsx)(h.bq,{children:(0,r.jsx)(h.yv,{placeholder:"Select date"})}),(0,r.jsxs)(h.gC,{children:[(0,r.jsx)(h.eb,{value:"all",children:"All Dates"}),(0,r.jsx)(h.eb,{value:"today",children:"Today"}),(0,r.jsx)(h.eb,{value:"yesterday",children:"Yesterday"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(m.J,{children:"Analysis Period"}),(0,r.jsxs)(h.l6,{value:ed,onValueChange:ec,children:[(0,r.jsx)(h.bq,{children:(0,r.jsx)(h.yv,{})}),(0,r.jsxs)(h.gC,{children:[(0,r.jsx)(h.eb,{value:"7",children:"Last 7 Days"}),(0,r.jsx)(h.eb,{value:"30",children:"Last 30 Days"}),(0,r.jsx)(h.eb,{value:"60",children:"Last 60 Days"}),(0,r.jsx)(h.eb,{value:"90",children:"Last 90 Days"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(m.J,{children:"Filter by Store"}),(0,r.jsxs)(h.l6,{value:el,onValueChange:en,children:[(0,r.jsx)(h.bq,{children:(0,r.jsx)(h.yv,{})}),(0,r.jsxs)(h.gC,{children:[(0,r.jsx)(h.eb,{value:"all",children:"All Stores"}),eV.map(e=>(0,r.jsx)(h.eb,{value:e.id,children:e.name},e.id))]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(m.J,{children:"Filter by Product"}),(0,r.jsxs)(h.l6,{value:eo,onValueChange:ei,children:[(0,r.jsx)(h.bq,{children:(0,r.jsx)(h.yv,{})}),(0,r.jsxs)(h.gC,{children:[(0,r.jsx)(h.eb,{value:"all",children:"All Products"}),eZ.map(e=>(0,r.jsx)(h.eb,{value:e.id,children:e.name},e.id))]})]})]})]})})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(d.ZB,{className:"text-sm font-medium",children:"Total Revenue"}),(0,r.jsx)(_.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(d.Wu,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:["₹",tg.toFixed(2)]}),(0,r.jsxs)("div",{className:"flex items-center mt-2",children:[((null==eY||null==(e=eY.revenue)?void 0:e.growth)||0)>=0?(0,r.jsx)(k.A,{className:"w-4 h-4 text-green-600 mr-1"}):(0,r.jsx)(T.A,{className:"w-4 h-4 text-red-600 mr-1"}),(0,r.jsxs)("span",{className:"text-sm font-medium ".concat(((null==eY||null==(t=eY.revenue)?void 0:t.growth)||0)>=0?"text-green-600":"text-red-600"),children:[Math.abs((null==eY||null==(U=eY.revenue)?void 0:U.growth)||0).toFixed(1),"%"]}),(0,r.jsx)("span",{className:"text-xs text-gray-500 ml-1",children:"vs previous"})]})]})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(d.ZB,{className:"text-sm font-medium",children:"Total Bills"}),(0,r.jsx)(P.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(d.Wu,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:tf}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Avg: ₹",tN.toFixed(2)]})]})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(d.ZB,{className:"text-sm font-medium",children:"Items Sold"}),(0,r.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(d.Wu,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:tj}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(tj/tf).toFixed(1)," per transaction"]})]})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(d.ZB,{className:"text-sm font-medium",children:"Total Refunds"}),(0,r.jsx)(_.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(d.Wu,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:["₹",tb.toFixed(2)]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[tA," items returned"]})]})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(d.ZB,{className:"text-sm font-medium",children:"Return Rate"}),(0,r.jsx)(D.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(d.Wu,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-orange-600",children:[(tb/(tg+tb)*100).toFixed(2),"%"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Of total revenue returned"})]})]})]}),eX.length>0&&(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(d.ZB,{children:"Revenue Trends with Returns"}),(0,r.jsxs)(h.l6,{value:eu,onValueChange:em,children:[(0,r.jsx)(h.bq,{className:"w-[180px]",children:(0,r.jsx)(h.yv,{})}),(0,r.jsxs)(h.gC,{children:[(0,r.jsx)(h.eb,{value:"daily",children:"Daily"}),(0,r.jsx)(h.eb,{value:"weekly",children:"Weekly"}),(0,r.jsx)(h.eb,{value:"monthly",children:"Monthly"})]})]})]})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:400,children:(0,r.jsxs)(v.b,{data:eX.map((e,t)=>{let s=tl(te).filter(t=>{let s=new Date(t.created_at),r=new Date(e.period);return(0,M.GP)(s,"daily"===eu?"yyyy-MM-dd":"yyyy-MM")===(0,M.GP)(r,"daily"===eu?"yyyy-MM-dd":"yyyy-MM")}).reduce((e,t)=>e+("approved"===t.status||"completed"===t.status?t.return_amount:0),0);return{...e,returnAmount:s,netRevenue:e.revenue-s,grossRevenue:e.revenue}}),children:[(0,r.jsx)(g.d,{strokeDasharray:"3 3"}),(0,r.jsx)(f.W,{dataKey:"period"}),(0,r.jsx)(j.h,{}),(0,r.jsx)(b.m,{formatter:(e,t)=>["₹".concat(Number(e).toFixed(2)),{grossRevenue:"Gross Revenue",returnAmount:"Returns",netRevenue:"Net Revenue"}[t]||t]}),(0,r.jsx)(A.N,{type:"monotone",dataKey:"grossRevenue",stroke:"#8884d8",strokeWidth:2,name:"Gross Revenue"}),(0,r.jsx)(A.N,{type:"monotone",dataKey:"returnAmount",stroke:"#ff4444",strokeWidth:2,name:"Returns",strokeDasharray:"5 5"}),(0,r.jsx)(A.N,{type:"monotone",dataKey:"netRevenue",stroke:"#22c55e",strokeWidth:2,name:"Net Revenue"})]})})})]}),e0.length>0&&(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsxs)(d.ZB,{children:["Top Selling Products (Last ",ed," Days)"]})}),(0,r.jsx)(d.Wu,{children:(0,r.jsxs)(x.XI,{children:[(0,r.jsx)(x.A0,{children:(0,r.jsxs)(x.Hj,{children:[(0,r.jsx)(x.nd,{children:"Product"}),(0,r.jsx)(x.nd,{children:"Category"}),(0,r.jsx)(x.nd,{className:"text-right",children:"Revenue"}),(0,r.jsx)(x.nd,{className:"text-right",children:"Qty Sold"}),(0,r.jsx)(x.nd,{className:"text-right",children:"Stock"})]})}),(0,r.jsx)(x.BF,{children:e0.map(e=>(0,r.jsxs)(x.Hj,{children:[(0,r.jsx)(x.nA,{className:"font-medium",children:e.productName}),(0,r.jsx)(x.nA,{children:e.category}),(0,r.jsxs)(x.nA,{className:"text-right font-semibold",children:["₹",e.revenue.toFixed(2)]}),(0,r.jsx)(x.nA,{className:"text-right",children:e.quantitySold}),(0,r.jsx)(x.nA,{className:"text-right",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(e.currentStock<10?"bg-red-100 text-red-800":e.currentStock<50?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.currentStock})})]},e.productId))})]})})]}),e2&&(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{className:"text-sm font-medium",children:"Total Inventory Value"})}),(0,r.jsxs)(d.Wu,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:["₹",e2.summary.totalInventoryValue.toFixed(2)]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e2.summary.totalProducts," products"]})]})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{className:"text-sm font-medium",children:"Slow Moving Items"})}),(0,r.jsxs)(d.Wu,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:e2.summary.slowMovingCount}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Low turnover ratio"})]})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{className:"text-sm font-medium",children:"Out of Stock"})}),(0,r.jsxs)(d.Wu,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-red-600",children:e2.summary.outOfStockCount}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Needs restocking"})]})]})]}),e3.length>0&&(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{children:"Sales by Category"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:300,children:(0,r.jsxs)(N.r,{children:[(0,r.jsx)(w.F,{data:e3,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{payload:t}=e;return"".concat(t.category," ").concat(t.revenuePercentage.toFixed(1),"%")},outerRadius:100,fill:"#8884d8",dataKey:"revenue",children:e3.map((e,t)=>(0,r.jsx)(S.f,{fill:q[t%q.length]},"cell-".concat(t)))}),(0,r.jsx)(b.m,{formatter:e=>["₹".concat(Number(e).toFixed(2)),"Revenue"]})]})})})]}),(0,r.jsxs)(p.tU,{defaultValue:"stores",className:"space-y-4",children:[(0,r.jsxs)(p.j7,{children:[(0,r.jsx)(p.Xi,{value:"stores",children:"Store Analytics"}),(0,r.jsx)(p.Xi,{value:"products",children:"Product Analytics"}),(0,r.jsx)(p.Xi,{value:"trends",children:"Trends & Insights"}),(0,r.jsx)(p.Xi,{value:"userSessions",children:"User Sessions"}),(0,r.jsx)(p.Xi,{value:"returns",children:"Returns Analytics"})]}),(0,r.jsxs)(p.av,{value:"stores",className:"space-y-6",children:[(0,r.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:ty.map(e=>{let t=te.filter(t=>{var s;return(null==(s=eG.find(e=>e.id===t.bill_id))?void 0:s.storeId)===e.storeId&&("approved"===t.status||"completed"===t.status)}),s=t.reduce((e,t)=>e+t.return_amount,0),a=(s/(e.totalRevenue+s)*100).toFixed(2);return(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"font-semibold text-lg",children:e.storeName}),(0,r.jsxs)(c.E,{variant:Number(a)>10?"destructive":"secondary",children:[a,"% Returns"]})]})}),(0,r.jsx)(d.Wu,{className:"space-y-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Gross Revenue"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-blue-600",children:["₹",(e.totalRevenue+s).toFixed(2)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Returns"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-red-600",children:["₹",s.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Net Revenue"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-green-600",children:["₹",e.totalRevenue.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Returned Items"}),(0,r.jsx)("p",{className:"text-xl font-bold text-orange-600",children:t.length})]})]})})]},e.storeId)})}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{children:"Store Revenue Comparison"}),(0,r.jsx)(d.BT,{children:"Revenue performance across all stores"})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:400,children:(0,r.jsxs)(B.E,{data:ty,children:[(0,r.jsx)(g.d,{strokeDasharray:"3 3"}),(0,r.jsx)(f.W,{dataKey:"storeName"}),(0,r.jsx)(j.h,{}),(0,r.jsx)(b.m,{formatter:e=>["₹".concat(Number(e).toFixed(2)),"Revenue"]}),(0,r.jsx)(R.y,{dataKey:"totalRevenue",fill:"#8884d8"})]})})})]})]}),(0,r.jsxs)(p.av,{value:"products",className:"space-y-6",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{children:"Product Performance"}),(0,r.jsx)(d.BT,{children:"Detailed analytics for each product"})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,r.jsxs)(x.XI,{children:[(0,r.jsx)(x.A0,{children:(0,r.jsxs)(x.Hj,{className:"bg-gray-50",children:[(0,r.jsx)(x.nd,{children:"Product Name"}),(0,r.jsx)(x.nd,{children:"Qty Sold"}),(0,r.jsx)(x.nd,{children:"Revenue"}),(0,r.jsx)(x.nd,{children:"Avg Price"}),(0,r.jsx)(x.nd,{children:"Bills"}),(0,r.jsx)(x.nd,{children:"Growth"}),(0,r.jsx)(x.nd,{children:"Top Store"})]})}),(0,r.jsx)(x.BF,{children:tv.sort((e,t)=>t.totalRevenue-e.totalRevenue).map(e=>{var t;return(0,r.jsxs)(x.Hj,{children:[(0,r.jsx)(x.nA,{className:"font-medium",children:e.productName}),(0,r.jsx)(x.nA,{children:e.totalQuantitySold}),(0,r.jsxs)(x.nA,{className:"font-medium",children:["₹",e.totalRevenue.toFixed(2)]}),(0,r.jsxs)(x.nA,{children:["₹",e.averagePrice.toFixed(2)]}),(0,r.jsx)(x.nA,{children:e.totalBills}),(0,r.jsx)(x.nA,{children:e.revenueGrowth>0?(0,r.jsxs)(c.E,{className:"bg-green-100 text-green-800",children:[(0,r.jsx)(k.A,{className:"h-3 w-3 mr-1"}),"+",e.revenueGrowth.toFixed(1),"%"]}):(0,r.jsxs)(c.E,{variant:"secondary",children:[(0,r.jsx)(T.A,{className:"h-3 w-3 mr-1"}),e.revenueGrowth.toFixed(1),"%"]})}),(0,r.jsx)(x.nA,{children:(null==(t=e.topStores[0])?void 0:t.storeName)||"N/A"})]},e.productId)})})]})})})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{children:"Products Added & Value Over Time"}),(0,r.jsx)(d.BT,{children:"Number of unique products first sold and their total revenue per day"})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:400,children:(0,r.jsxs)(v.b,{data:et,margin:{top:5,right:30,left:20,bottom:5},children:[(0,r.jsx)(g.d,{strokeDasharray:"3 3"}),(0,r.jsx)(f.W,{dataKey:"date"}),(0,r.jsx)(j.h,{yAxisId:"left",label:{value:"Products Added",angle:-90,position:"insideLeft"}}),(0,r.jsx)(j.h,{yAxisId:"right",orientation:"right",label:{value:"Total Value (₹)",angle:90,position:"insideRight"}}),(0,r.jsx)(b.m,{formatter:(e,t)=>"productsAdded"===t?["".concat(e," products"),"Products Added"]:"totalValueAdded"===t?["₹".concat(Number(e).toFixed(2)),"Total Value Added"]:e}),(0,r.jsx)(A.N,{yAxisId:"left",type:"monotone",dataKey:"productsAdded",stroke:"#8884d8",activeDot:{r:8},name:"productsAdded"}),(0,r.jsx)(A.N,{yAxisId:"right",type:"monotone",dataKey:"totalValueAdded",stroke:"#82ca9d",activeDot:{r:8},name:"totalValueAdded"})]})})})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{children:"Top Products by Revenue"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:300,children:(0,r.jsxs)(N.r,{children:[(0,r.jsx)(w.F,{data:tv.slice(0,8).map(e=>({name:e.productName,value:e.totalRevenue,...e})),cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percent:s}=e;return"".concat(t||""," ").concat(s?(100*s).toFixed(0):0,"%")},outerRadius:80,fill:"#8884d8",dataKey:"value",children:tv.slice(0,8).map((e,t)=>(0,r.jsx)(S.f,{fill:q[t%q.length]},e.productName))}),(0,r.jsx)(b.m,{formatter:e=>["₹".concat(Number(e).toFixed(2)),"Revenue"]})]})})})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{children:"Top Products by Quantity"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:300,children:(0,r.jsxs)(B.E,{data:tv.slice(0,10),children:[(0,r.jsx)(g.d,{strokeDasharray:"3 3"}),(0,r.jsx)(f.W,{dataKey:"productName",angle:-45,textAnchor:"end",height:100}),(0,r.jsx)(j.h,{}),(0,r.jsx)(b.m,{}),(0,r.jsx)(R.y,{dataKey:"totalQuantitySold",fill:"#82ca9d"})]})})})]})]})]}),(0,r.jsxs)(p.av,{value:"trends",className:"space-y-6",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{children:"Revenue Trend Over Time"}),(0,r.jsx)(d.BT,{children:"Monthly revenue comparison across all stores"})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:400,children:(0,r.jsxs)(v.b,{data:(null==(z=K[0])?void 0:z.monthlyTrend)||[],children:[(0,r.jsx)(g.d,{strokeDasharray:"3 3"}),(0,r.jsx)(f.W,{dataKey:"month"}),(0,r.jsx)(j.h,{}),(0,r.jsx)(b.m,{formatter:e=>["₹".concat(Number(e).toFixed(2)),"Revenue"]}),K.map((e,t)=>(0,r.jsx)(A.N,{type:"monotone",dataKey:"revenue",stroke:q[t%q.length],strokeWidth:2,data:e.monthlyTrend},e.storeId))]})})})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{children:"Top Performing Store"})}),(0,r.jsx)(d.Wu,{children:K.length>0&&(0,r.jsx)("div",{className:"space-y-4",children:[...K].sort((e,t)=>t.totalRevenue-e.totalRevenue).slice(0,1).map(e=>{var t;return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-lg",children:e.storeName}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Revenue"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-green-600",children:["₹",e.totalRevenue.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Growth"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-blue-600",children:["+",e.revenueGrowth.toFixed(1),"%"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Best Selling Product"}),(0,r.jsx)("p",{className:"font-medium",children:(null==(t=e.topProducts[0])?void 0:t.productName)||"N/A"})]})]},e.storeId)})})})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{children:"Best Selling Product"})}),(0,r.jsx)(d.Wu,{children:J.length>0&&(0,r.jsx)("div",{className:"space-y-4",children:J.sort((e,t)=>t.totalQuantitySold-e.totalQuantitySold).slice(0,1).map(e=>{var t;return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-lg",children:e.productName}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Quantity Sold"}),(0,r.jsx)("p",{className:"text-xl font-bold text-green-600",children:e.totalQuantitySold})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Revenue"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-blue-600",children:["₹",e.totalRevenue.toFixed(2)]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Top Store"}),(0,r.jsx)("p",{className:"font-medium",children:(null==(t=e.topStores[0])?void 0:t.storeName)||"N/A"})]})]},e.productId)})})})]})]})]}),(0,r.jsxs)(p.av,{value:"userSessions",className:"space-y-6",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{children:"User Session Duration Trend"}),(0,r.jsx)(d.BT,{children:"Average session duration over time"})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:400,children:(0,r.jsxs)(v.b,{data:$,margin:{top:5,right:30,left:20,bottom:5},children:[(0,r.jsx)(g.d,{strokeDasharray:"3 3"}),(0,r.jsx)(f.W,{dataKey:"date"}),(0,r.jsx)(j.h,{label:{value:"Avg Duration (minutes)",angle:-90,position:"insideLeft"}}),(0,r.jsx)(b.m,{formatter:e=>["".concat(Number(e).toFixed(2)," minutes"),"Average Session Duration"]}),(0,r.jsx)(A.N,{type:"monotone",dataKey:"averageSessionDuration",stroke:"#8884d8",activeDot:{r:8}})]})})})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{children:"Total User Sessions Over Time"}),(0,r.jsx)(d.BT,{children:"Number of user sessions per day"})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:400,children:(0,r.jsxs)(B.E,{data:$,margin:{top:5,right:30,left:20,bottom:5},children:[(0,r.jsx)(g.d,{strokeDasharray:"3 3"}),(0,r.jsx)(f.W,{dataKey:"date"}),(0,r.jsx)(j.h,{label:{value:"Total Sessions",angle:-90,position:"insideLeft"}}),(0,r.jsx)(b.m,{formatter:e=>["".concat(e," sessions"),"Total Sessions"]}),(0,r.jsx)(R.y,{dataKey:"totalSessions",fill:"#82ca9d"})]})})})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{className:"text-sm",children:"Active Users (5 min)"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)("div",{className:"text-2xl font-bold",children:null!=(H=null==eH?void 0:eH.onlineCount)?H:0})})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{className:"text-sm",children:"Sessions Today"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)("div",{className:"text-2xl font-bold",children:null!=(L=null==eQ?void 0:eQ.totalSessions)?L:0})})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{className:"text-sm",children:"Avg Session Today"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[eQ?Math.round((eQ.avgSessionSec||0)/60):0," min"]})})]})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{children:"Online Users Now"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)("div",{className:"space-y-2",children:(null==eH?void 0:eH.online)&&eH.online.length>0?eH.online.map(e=>(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b last:border-0",children:[(0,r.jsx)("span",{className:"font-medium",children:e.userId}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["Last seen: ",new Date(e.lastSeen).toLocaleTimeString()]})]},e.userId)):(0,r.jsx)("p",{className:"text-gray-500",children:"No users currently online"})})})]})]}),(0,r.jsxs)(p.av,{value:"returns",className:"space-y-6",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{children:"Return Metrics Overview"}),(0,r.jsx)(d.BT,{children:"Analysis of product returns and refunds"})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Total Returns"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:tA})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Total Refund Amount"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-red-600",children:["₹",tb.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Return Rate"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-orange-600",children:[(tA/tj*100).toFixed(2),"%"]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Avg Return Value"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:["₹",tA>0?(tb/tA).toFixed(2):"0.00"]})]})]})})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{children:"Top Returned Products"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:300,children:(0,r.jsxs)(B.E,{data:Object.entries(te.filter(e=>"approved"===e.status||"completed"===e.status).reduce((e,t)=>(e[t.product_name]||(e[t.product_name]={count:0,amount:0}),e[t.product_name].count+=1,e[t.product_name].amount+=t.return_amount,e),{})).map(e=>{let[t,s]=e;return{product:t,count:s.count,amount:s.amount}}).sort((e,t)=>t.count-e.count).slice(0,10),children:[(0,r.jsx)(g.d,{strokeDasharray:"3 3"}),(0,r.jsx)(f.W,{dataKey:"product",angle:-45,textAnchor:"end",height:100}),(0,r.jsx)(j.h,{}),(0,r.jsx)(b.m,{formatter:(e,t)=>"amount"===t?"₹".concat(e.toFixed(2)):e}),(0,r.jsx)(R.y,{dataKey:"count",fill:"#ff6b6b",name:"Return Count"}),(0,r.jsx)(R.y,{dataKey:"amount",fill:"#ee5a6f",name:"Return Amount"})]})})})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{children:"Returns by Status"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)(y.u,{width:"100%",height:300,children:(0,r.jsxs)(N.r,{children:[(0,r.jsx)(w.F,{data:Object.entries(te.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{})).map(e=>{let[t,s]=e;return{name:t.charAt(0).toUpperCase()+t.slice(1),value:s}}),cx:"50%",cy:"50%",labelLine:!1,label:e=>"".concat(e.name,": ").concat(e.value),outerRadius:100,fill:"#8884d8",dataKey:"value",children:Object.keys(te.reduce((e,t)=>(e[t.status]=1,e),{})).map((e,t)=>(0,r.jsx)(S.f,{fill:q[t%q.length]},"cell-".concat(t)))}),(0,r.jsx)(b.m,{})]})})})]})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{children:"Recent Returns"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsxs)(x.XI,{children:[(0,r.jsx)(x.A0,{children:(0,r.jsxs)(x.Hj,{children:[(0,r.jsx)(x.nd,{children:"Date"}),(0,r.jsx)(x.nd,{children:"Product"}),(0,r.jsx)(x.nd,{children:"Customer"}),(0,r.jsx)(x.nd,{children:"Amount"}),(0,r.jsx)(x.nd,{children:"Status"}),(0,r.jsx)(x.nd,{children:"Reason"})]})}),(0,r.jsx)(x.BF,{children:te.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,10).map(e=>(0,r.jsxs)(x.Hj,{children:[(0,r.jsx)(x.nA,{children:(0,M.GP)(new Date(e.created_at),"MMM dd, yyyy")}),(0,r.jsx)(x.nA,{className:"font-medium",children:e.product_name}),(0,r.jsx)(x.nA,{children:e.customer_name}),(0,r.jsxs)(x.nA,{className:"font-semibold text-red-600",children:["₹",e.return_amount.toFixed(2)]}),(0,r.jsx)(x.nA,{children:(0,r.jsx)(c.E,{variant:"completed"===e.status?"default":"approved"===e.status?"secondary":"rejected"===e.status?"destructive":"outline",children:e.status})}),(0,r.jsx)(x.nA,{className:"max-w-xs truncate",children:e.message})]},e.return_id))})]})})]})]})]})]})})}},81955:(e,t,s)=>{Promise.resolve().then(s.bind(s,63290))},83209:(e,t,s)=>{"use strict";s.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>i,Zp:()=>n,aR:()=>o});var r=s(95155),a=s(12115),l=s(25016);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});n.displayName="Card";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...a})});o.displayName="CardHeader";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});i.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});d.displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...a})});c.displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter"},90235:(e,t,s)=>{"use strict";s.d(t,{J:()=>d});var r=s(95155),a=s(12115),l=s(32894),n=s(83101),o=s(25016);let i=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.b,{ref:t,className:(0,o.cn)(i(),s),...a})});d.displayName=l.b.displayName},90923:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>d,av:()=>c,j7:()=>i,tU:()=>o});var r=s(95155),a=s(12115),l=s(25667),n=s(25016);let o=l.bL,i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.B8,{ref:t,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a})});i.displayName=l.B8.displayName;let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.l9,{ref:t,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a})});d.displayName=l.l9.displayName;let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.UC,{ref:t,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a})});c.displayName=l.UC.displayName},96633:(e,t,s)=>{"use strict";s.d(t,{A0:()=>o,BF:()=>i,Gg:()=>d,Hj:()=>c,XI:()=>n,nA:()=>m,nd:()=>u});var r=s(95155),a=s(12115),l=s(25016);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",s),...a})})});n.displayName="Table";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",s),...a})});o.displayName="TableHeader";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...a})});i.displayName="TableBody";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a})});d.displayName="TableFooter";let c=a.forwardRef((e,t)=>{let{className:s,children:a,...n}=e;return(0,r.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...n,children:a})});c.displayName="TableRow";let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a})});u.displayName="TableHead";let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a})});m.displayName="TableCell",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...a})}).displayName="TableCaption"}},e=>{e.O(0,[3194,6445,939,9553,5125,7150,1569,832,8441,1255,7358],()=>e(e.s=81955)),_N_E=e.O()}]);