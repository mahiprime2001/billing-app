(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9926],{20120:(e,t,a)=>{"use strict";a.d(t,{$v:()=>g,EO:()=>m,Lt:()=>c,Rx:()=>f,Zr:()=>j,ck:()=>x,r7:()=>p,tv:()=>d,wd:()=>u});var s=a(95155),l=a(12115),r=a(52498),n=a(25016),i=a(97003);let c=r.bL,d=r.l9,o=r.ZL,h=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.hJ,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...l,ref:t})});h.displayName=r.hJ.displayName;let m=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(h,{}),(0,s.jsx)(r.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l})]})});m.displayName=r.UC.displayName;let u=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};u.displayName="AlertDialogHeader";let x=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};x.displayName="AlertDialogFooter";let p=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold",a),...l})});p.displayName=r.hE.displayName;let g=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...l})});g.displayName=r.VY.displayName;let f=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.rc,{ref:t,className:(0,n.cn)((0,i.r)(),a),...l})});f.displayName=r.rc.displayName;let j=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.ZD,{ref:t,className:(0,n.cn)((0,i.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...l})});j.displayName=r.ZD.displayName},32457:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>H});var s=a(95155),l=a(12115),r=a(73609),n=a(20063),i=a(85400),c=a(10832),d=a(97003),o=a(33789),h=a(90235),m=a(83209),u=a(67812),x=a(54679),p=a(47507),g=a(54664),f=a(20120),j=a(78874),b=a(6132),N=a(42529),v=a(16485),y=a(21786),w=a(39867),C=a(63581),S=a(6191),k=a(71360),P=a(26617),A=a(86651),F=a(309),E=a(11010),D=a(95261),T=a.n(D),L=a(76577);function B(e){let{products:t,isOpen:a,onClose:n,onPrintSuccess:i,storeName:c,forceBackendPrint:m=!1,batches:u=[]}=e,[g,f]=(0,l.useState)(1),[j,b]=(0,l.useState)(!1),[N,v]=(0,l.useState)({}),[y,w]=(0,l.useState)([]),[C,S]=(0,l.useState)(""),[k,P]=(0,l.useState)(!1),[A,E]=(0,l.useState)(81),[D,B]=(0,l.useState)(12),[O,z]=(0,l.useState)(2),[R,J]=(0,l.useState)(35),[$,I]=(0,l.useState)(!1),M=e=>{let a=t.find(t=>t.id===e);if(console.log("\uD83D\uDD0D Looking for batch info for product ".concat(e)),console.log("\uD83D\uDCE6 Product found:",a),console.log("\uD83C\uDD94 Product batchid:",null==a?void 0:a.batchid),console.log("\uD83D\uDCE6 All batches:",u),!(null==a?void 0:a.batchid))return console.log("❌ No batchid found for product ".concat(e)),null;let s=u.find(e=>e.id===a.batchid);if(console.log("\uD83D\uDD0D Looking for batch with id: ".concat(a.batchid)),console.log("\uD83D\uDCE6 Found batch:",s),!s)return console.log("❌ No batch found for id: ".concat(a.batchid)),null;let l={batchNumber:s.batchNumber,place:s.place};return console.log("✅ Batch info found:",l),l};(0,l.useEffect)(()=>{if(!a)return;let e="http://127.0.0.1:8080".trim().replace(/\/+$/,""),t="".concat(e,"/api/printers");(async()=>{try{let e=await fetch(t,{method:"GET"}),a=await e.json();if(e.ok&&"success"===a.status&&Array.isArray(a.printers)&&(w(a.printers),a.printers.length>0)){let e="SNBC TVSE LP46 Dlite BPLE";S(a.printers.includes(e)?e:a.printers[0])}}catch(e){console.error("Error fetching printers:",e)}})()},[a]);let H=e=>{try{let t=document.createElement("canvas");return t.width=3.779528*A,t.height=3.779528*D,T()(t,e,{format:"CODE128",width:O,height:R,displayValue:$,margin:1,background:"#ffffff",lineColor:"#000000"}),t.toDataURL("image/png")}catch(t){return console.error("Failed to create barcode for ".concat(e,":"),t),null}};(0,l.useEffect)(()=>{if(a&&t.length>0){let a={};for(let s of t){var e;let t=null!=(e=(0,r.n)(s))?e:"NO-BARCODE";a[s.id]=H(t)}v(a)}else a||v({})},[a,t,A,D,O,R,$]);let W=async()=>{if(0===t.length)return void alert("No products selected");b(!0);try{if(m||k){let e=t.map(e=>{var t,a;let s=M(e.id);return{id:e.id,name:e.name,selling_price:null!=(t=e.sellingPrice)?t:0,barcode:null!=(a=(0,r.n)(e))?a:"NO-BARCODE",batchNumber:(null==s?void 0:s.batchNumber)||""}});await (0,L.G)({useBackendPrint:!0,labelData:e,copies:g,printerName:C||void 0,storeName:c}),alert("Print job sent to backend."),i(),n();return}let l=[];for(let n of t){var e,a,s;let t=null!=(e=(0,r.n)(n))?e:"NO-BARCODE",i=N[n.id];for(let e=0;e<Math.max(1,g);e++)l.push('\n            <div class="label" style="\n              display: inline-block;\n              vertical-align: top;\n              width: '.concat(A,"mm;\n              height: ").concat(D,'mm;\n              box-sizing: border-box;\n              padding: 4px;\n              margin: 4px;\n              border: 0;\n            ">\n              <div style="\n                display: flex;\n                flex-direction: row;\n                height: 100%;\n                font-family: Arial, Helvetica, sans-serif;\n              ">\n                <div style="\n                  width: 50%;\n                  display: flex;\n                  flex-direction: column;\n                  align-items: center;\n                  justify-content: center;\n                  padding-top: 2mm;\n                ">\n                  ').concat(i?'<img src="'.concat(i,'" style="max-width: 90%; height: auto; display: block; margin-bottom: 2px;" />'):"","\n                  ").concat($?'<div style="font-size: 7px; font-weight: bold; text-align: center;">'.concat(V(t),"</div>"):"",'\n                </div>\n                <div style="\n                  width: 50%;\n                  padding-left: 2mm;\n                  display: flex;\n                  flex-direction: column;\n                  justify-content: center;\n                  align-items: flex-start;\n                ">\n                  <div style="\n                    font-size: 6px;\n                    font-weight: bold;\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                  ">').concat(V(c),'</div>\n                  <div style="\n                    font-size: 7px;\n                    font-weight: bold;\n                    margin-top: 2px;\n                    line-height: 1.1;\n                    max-height: 6mm;\n                    overflow: hidden;\n                  ">Product Name: ').concat(V(n.name),'</div>\n                  <div style="\n                    font-size: 7px;\n                    font-weight: bold;\n                    white-space: nowrap;\n                    margin-top: 2px;\n                  ">Batch: ').concat(V((null==(a=M(n.id))?void 0:a.batchNumber)||"N/A"),'</div>\n                  <div style="\n                    font-size: 7px;\n                    font-weight: bold;\n                    white-space: nowrap;\n                    margin-top: 2px;\n                  ">Price: ').concat((null!=(s=n.price)?s:0).toFixed(2),"</div>\n                </div>\n              </div>\n            </div>\n          "))}let d='<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>Labels</title>\n  <style>\n    body { margin: 8mm; font-family: Arial, Helvetica, sans-serif; }\n    @media print {\n      page-size: auto;\n      margin: 0;\n      body { margin: 0; }\n      .label { page-break-inside: avoid; }\n    }\n  </style>\n</head>\n<body>\n  '.concat(l.join(""),"\n  <script>\n    window.onload = function() {\n      window.print();\n      setTimeout(window.close, 300);\n    }\n  <\/script>\n</body>\n</html>");await (0,L.G)({htmlContent:d}),alert("Print dialog opened."),i(),n()}catch(e){alert("Error printing labels."),console.error(e)}finally{b(!1)}};function V(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}return(0,s.jsx)(x.lG,{open:a,onOpenChange:n,children:(0,s.jsxs)(x.Cf,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsxs)(x.L3,{className:"flex items-center",children:[(0,s.jsx)(F.A,{className:"h-5 w-5 mr-2"}),"Print Labels"]}),(0,s.jsx)(x.rr,{children:"Configure and preview labels for the selected products."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(h.J,{htmlFor:"copies",className:"text-base font-medium",children:"Copies per Product"}),(0,s.jsx)(o.p,{id:"copies",type:"number",min:1,max:100,value:g,onChange:e=>f(Number.parseInt(e.target.value)||1),className:"w-32"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(h.J,{className:"text-base font-medium",children:"Label Dimensions (mm)"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(o.p,{type:"number",min:1,value:A,onChange:e=>E(Number.parseInt(e.target.value)||1),placeholder:"Width"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Width"})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(o.p,{type:"number",min:1,value:D,onChange:e=>B(Number.parseInt(e.target.value)||1),placeholder:"Height"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Height"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(h.J,{htmlFor:"printer-select",className:"text-base font-medium",children:"Select Printer"}),(0,s.jsxs)(p.l6,{value:C,onValueChange:S,children:[(0,s.jsx)(p.bq,{id:"printer-select",children:(0,s.jsx)(p.yv,{placeholder:"Select a printer"})}),(0,s.jsx)(p.gC,{children:y.map(e=>(0,s.jsx)(p.eb,{value:e,children:e},e))})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,s.jsx)("input",{id:"direct-print",type:"checkbox",checked:k,onChange:e=>P(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),(0,s.jsx)(h.J,{htmlFor:"direct-print",className:"text-sm font-medium",children:"Direct print (no browser dialog)"})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[(0,s.jsx)("h4",{className:"font-medium text-sm",children:"Total Labels"}),(0,s.jsx)("div",{className:"text-2xl font-bold",children:t.length*g})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(h.J,{className:"text-base font-medium mb-2",children:"Label Preview"}),(0,s.jsx)("div",{className:"max-h-[500px] overflow-y-auto border rounded-lg p-3 bg-gray-50",children:0===t.length?(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No products selected."}):t.map(e=>{var t,a,l;return(0,s.jsx)("div",{className:"mb-4 p-2 border rounded-md bg-white shadow-sm",style:{width:"".concat(A,"mm"),height:"".concat(D,"mm"),overflow:"hidden"},children:(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"row",height:"100%",fontSize:"6px",lineHeight:1},children:[(0,s.jsxs)("div",{style:{width:"50%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:"2mm"},children:[N[e.id]&&(0,s.jsx)("img",{src:N[e.id],alt:"Barcode for ".concat(e.name),style:{maxWidth:"90%",height:"auto",marginBottom:"2px"}}),$&&(0,s.jsx)("div",{style:{fontSize:"7px",fontWeight:"bold",textAlign:"center"},children:null!=(a=(0,r.n)(e))?a:"NO-BARCODE"})]}),(0,s.jsxs)("div",{style:{width:"50%",paddingLeft:"2mm",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start"},children:[(0,s.jsx)("div",{style:{fontSize:"6px",fontWeight:"bold"},children:c}),(0,s.jsxs)("div",{style:{fontSize:"7px",fontWeight:"bold",marginTop:"2px",lineHeight:1.1,maxHeight:"6mm",overflow:"hidden"},children:["Product Name: ",e.name]}),(0,s.jsxs)("div",{style:{fontSize:"7px",fontWeight:"bold",marginTop:"2px"},children:["Batch: ",(null==(t=M(e.id))?void 0:t.batchNumber)||"N/A"]}),(0,s.jsxs)("div",{style:{fontSize:"7px",fontWeight:"bold",marginTop:"2px"},children:["Price: ",(null!=(l=e.price)?l:0).toFixed(2)]})]})]})},e.id)})})]})]}),(0,s.jsxs)(x.Es,{children:[(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:n,disabled:j,children:"Cancel"}),(0,s.jsx)(d.$,{type:"button",onClick:W,disabled:j,className:"bg-blue-600 hover:bg-blue-700",children:j?"Printing...":"Print"})]})]})})}var O=a(8803);let z=e=>{let{onClick:t}=e;return(0,s.jsx)(d.$,{onClick:t,className:"fixed bottom-8 right-8 p-3 rounded-full shadow-lg bg-blue-600 hover:bg-blue-700 text-white z-50",size:"icon",children:(0,s.jsx)(O.A,{className:"h-6 w-6"})})};var R=a(20562);function J(e){let{onClick:t}=e;return(0,s.jsxs)(d.$,{variant:"outline",size:"sm",onClick:t,className:"flex items-center space-x-1",children:[(0,s.jsx)(R.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Scroll to Top"})]})}let $=e=>fetch("".concat("http://127.0.0.1:8080").concat(e)).then(e=>e.json()),I=e=>{let{isOpen:t,onOpenChange:a}=e,{mutate:r}=(0,i.Ay)("/api/batches",$),[n,c]=(0,l.useState)(""),[m,u]=(0,l.useState)(""),p=async()=>{if(n&&m)try{if(!(await fetch("".concat("http://127.0.0.1:8080","/api/batches"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({batchNumber:n,place:m})})).ok)throw Error("Failed to add batch");r(),c(""),u(""),a(!1)}catch(e){console.error("Error adding batch:",e),alert("Failed to add batch.")}else alert("Please fill in both batch number and place.")};return(0,s.jsx)(x.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(x.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsx)(x.L3,{children:"Add New Batch"}),(0,s.jsx)(x.rr,{children:"Enter the batch number and place for the new batch."})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"batch-number",children:"Batch Number"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(o.p,{id:"batch-number",value:n,onChange:e=>c(e.target.value),placeholder:"e.g., btch-12dhei",className:"flex-1"}),(0,s.jsxs)(d.$,{type:"button",variant:"outline",onClick:()=>{let e=Math.random().toString(36).substring(2,8);c("btch-".concat(e))},children:[" ","Generate"]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"place",children:"Place"}),(0,s.jsx)(o.p,{id:"place",value:m,onChange:e=>u(e.target.value),placeholder:"e.g., Warehouse A"})]})]}),(0,s.jsxs)(x.Es,{children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),(0,s.jsx)(d.$,{onClick:p,children:"Save Batch"})]})]})})},M=async e=>{try{let t=await fetch("".concat("http://127.0.0.1:8080").concat(e));if(!t.ok){let a=await t.json();throw console.error("API Error for ".concat(e,":"),a),Error("API request failed with status ".concat(t.status))}return t.json()}catch(t){throw console.error("Error fetching ".concat(e,":"),t),t}};function H(){var e,t,a,D,T,O;(0,n.useRouter)();let{data:R=[],error:$,isLoading:H,mutate:W}=(0,i.Ay)("/api/products",M,{revalidateOnFocus:!1,revalidateOnReconnect:!1,dedupingInterval:5e3,refreshInterval:0}),{data:V=[],error:U,isLoading:G,mutate:Y}=(0,i.Ay)("/api/batches",M,{revalidateOnFocus:!1,revalidateOnReconnect:!1,dedupingInterval:5e3,refreshInterval:0}),{data:Z=[],error:q,isLoading:_}=(0,i.Ay)("/api/hsn-codes",M,{revalidateOnFocus:!1,revalidateOnReconnect:!1,dedupingInterval:1e4,refreshInterval:0}),Q=(0,l.useMemo)(()=>R&&0!==R.length?R.map(e=>{var t,a,s,l;return{...e,barcodes:"string"==typeof e.barcode&&""!==e.barcode.trim()?e.barcode.split(","):[],price:"number"==typeof e.price?e.price:Number(null!=(t=e.price)?t:0),displayPrice:null!=(l=null!=(s=null!=(a=e.sellingPrice)?a:e.selling_price)?s:e.price)?l:0,createdAt:e.createdAt||e.createdat||e.created_at}}).filter(e=>!e._deleted):[],[R]);(0,l.useEffect)(()=>{if(console.log("=== SWR Data Debug ==="),console.log("Products Data:",Q),console.log("Products Count:",Q.length),$&&console.error("SWR Products Error:",$),console.log("Batches Data:",V),console.log("Batches Count:",V.length),console.log("Batches:",JSON.stringify(V,null,2)),U&&console.error("SWR Batches Error:",U),Q.length>0&&V.length>0){let e=Q[0];console.log("First Product:",e),console.log("First Product batchid:",e.batchid),console.log("Found Batch for first product:",V.find(t=>t.id===e.batchid))}console.log("======================")},[Q,$,V,U]);let K=(0,l.useRef)(null),X=(0,l.useRef)(null),ee=(0,l.useRef)(null),[et,ea]=(0,l.useState)(null),[es,el]=(0,l.useState)([]),[er,en]=(0,l.useState)(""),[ei,ec]=(0,l.useState)("all"),[ed,eo]=(0,l.useState)({min:"",max:""}),[eh,em]=(0,l.useState)("all"),[eu,ex]=(0,l.useState)({min:"",max:""}),[ep,eg]=(0,l.useState)({from:"",to:""}),[ef,ej]=(0,l.useState)(!1),[eb,eN]=(0,l.useState)(!1),[ev,ey]=(0,l.useState)(!1),[ew,eC]=(0,l.useState)(null),[eS,ek]=(0,l.useState)(!1),[eP,eA]=(0,l.useState)([]),[eF,eE]=(0,l.useState)([]),[eD,eT]=(0,l.useState)(!1),[eL,eB]=(0,l.useState)(""),[eO,ez]=(0,l.useState)(!1),[eR,eJ]=(0,l.useState)(new Date),[e$,eI]=(0,l.useState)(null),[eM,eH]=(0,l.useState)(!1),[eW,eV]=(0,l.useState)(!1),[eU,eG]=(0,l.useState)(null),[eY,eZ]=(0,l.useState)([]),[eq,e_]=(0,l.useState)([]),[eQ,eK]=(0,l.useState)(!1),[eX,e0]=(0,l.useState)(null),[e1,e2]=(0,l.useState)(!1),[e4,e5]=(0,l.useState)([]);(0,l.useEffect)(()=>{eO&&eJ(new Date)},[eO]);let e6=e=>{eI(e);let t=tv[tN(e)]||[],a=t.filter(e=>e.batchid),s=t.filter(e=>!e.batchid),l=[...new Set(a.map(e=>e.batchid).filter(Boolean))],r=V.filter(e=>l.includes(e.id));eZ(r),e_(s),0===r.length&&s.length>0?(e5(s),eH(!0)):r.length>0||s.length>0?eK(!0):(eK(!1),eH(!1),eI(null),e5([]))},[e8,e3]=(0,l.useState)({name:"",price:"",stock:"",sellingPrice:"",barcodes:[""],batchid:"",hsnCode:""}),[e7,e9]=(0,l.useState)([]),te=e=>{e3(t=>({...t,hsnCode:e}))};(0,l.useEffect)(()=>{let e=localStorage.getItem("adminUser");if(e){let t=JSON.parse(e);if(ea(t),"billing_user"===t.role&&t.assignedStores){let e=localStorage.getItem("stores");e&&el(JSON.parse(e).filter(e=>{var a;return(null==(a=t.assignedStores)?void 0:a.includes(e.id))&&"active"===e.status}))}}},[]);let tt=()=>{e3({name:"",price:"",stock:"",sellingPrice:"",barcodes:[""],batchid:"",hsnCode:""})},ta=()=>{e3(e=>({...e,barcodes:[...e.barcodes,""]}))},ts=(e,t)=>{e3(a=>{let s=[...a.barcodes];return s[e]=t,{...a,barcodes:s}})},tl=e=>{e3(t=>{let a=t.barcodes.filter((t,a)=>a!==e);return{...t,barcodes:a.length>0?a:[""]}})},tr=()=>{let e=new Date,t=e.getFullYear().toString(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),l="".concat(t).concat(a).concat(s),r=Math.floor(1e5*Math.random()).toString().padStart(5,"0");return"".concat(l).concat(r)},tn=e=>!!e&&""!==e.trim()&&e.length>=1&&e.length<=80,ti=async()=>{if(!e8.name||!e8.price||!e8.stock)return void alert("Please fill in all required fields");let e=e8.barcodes.filter(e=>""!==e.trim());if(0===e.length)return void alert("Please add at least one barcode.");for(let t of e){if(!tn(t))return void alert("Please enter a valid barcode (1-80 characters) for: ".concat(t));let e=Q.find(e=>{var a;return null==(a=e.barcodes)?void 0:a.includes(t)});if(e)return void alert("Barcode already exists: ".concat(t," (Product: ").concat(e.name,")"))}let t={name:e8.name,price:Number.parseFloat(e8.price),stock:Number.parseInt(e8.stock),sellingPrice:Number.parseFloat(e8.sellingPrice),barcode:e.join(","),batchid:e8.batchid,hsnCode:(e=>{if(null==e)return;let t=String(e).trim();return""===t?void 0:t})(e8.hsnCode)};try{if(!(await fetch("".concat("http://127.0.0.1:8080","/api/products"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw Error("Failed to add product");W(),tt(),eN(!1)}catch(e){console.error("Error adding product:",e),alert("Failed to add product.")}},tc=async()=>{if(!ew||!e8.name||!e8.price||!e8.stock)return void alert("Please fill in all required fields");let e=e8.barcodes.filter(e=>""!==e.trim());if(0===e.length)return void alert("Please add at least one barcode.");for(let t of e){if(!tn(t))return void alert("Please enter a valid barcode (1-80 characters) for: ".concat(t));let e=Q.filter(e=>e.id!==ew.id).find(e=>{var a;return null==(a=e.barcodes)?void 0:a.includes(t)});if(e)return void alert("Barcode already exists: ".concat(t," (Product: ").concat(e.name,")"))}let t={name:e8.name,price:Number.parseFloat(e8.price),stock:Number.parseInt(e8.stock),sellingPrice:Number.parseFloat(e8.sellingPrice),barcode:e.join(","),batchid:""===e8.batchid?void 0:e8.batchid,hsnCode:(e=>{if(null==e)return;let t=String(e).trim();return""===t?void 0:t})(e8.hsnCode)};try{if(!(await fetch("".concat("http://127.0.0.1:8080","/api/products/").concat(ew.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw Error("Failed to update product");W(),tt(),eC(null),ey(!1)}catch(e){console.error("Error updating product:",e),alert("Failed to update product.")}},td=async e=>{W(R.filter(t=>t.id!==e),!1);try{if(!(await fetch("".concat("http://127.0.0.1:8080","/api/products/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw Error("Failed to delete product");await W()}catch(e){console.error("Error deleting product:",e),alert("Failed to delete product."),W()}},to=async()=>{if(0===eP.length)return;let e=[...eP];if(!window.confirm("Are you sure you want to delete ".concat(e.length," selected product(s)? This action cannot be undone.")))return;let t=new Set(e);W(R.filter(e=>!t.has(e.id)),!1),eA([]);try{let t=(await Promise.allSettled(e.map(e=>fetch("".concat("http://127.0.0.1:8080","/api/products/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}})))).filter(e=>"rejected"===e.status||"fulfilled"===e.status&&!e.value.ok);if(t.length>0)throw Error("Failed to delete ".concat(t.length," product(s)"));await W(),alert("Successfully deleted ".concat(e.length," product(s)"))}catch(e){console.error("Error deleting products in bulk:",e),alert("Failed to delete some products. Please try again."),W()}},th=async()=>{if(!eL||0===eP.length)return void alert("Please enter an HSN code value and select products");let e=eL.trim();if(!e)return void alert("Please enter a valid HSN code");try{let t=eP.map(t=>fetch("".concat("http://127.0.0.1:8080","/api/products/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({hsnCode:e})}));await Promise.all(t),W(),eA([]),eB(""),eT(!1),alert("Successfully updated HSN code for ".concat(eP.length," products"))}catch(e){console.error("Error updating HSN code:",e),alert("Failed to update HSN code for some products")}},tm=e=>{eE(Q.filter(t=>e.includes(t.id)).map(e=>({...e,barcodes:"string"==typeof e.barcode&&""!==e.barcode.trim()?e.barcode.split(","):[]}))),ek(!0)},tu=async e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(!a)return;let s=new FileReader;s.onload=async e=>{try{var t;let a=JSON.parse(null==(t=e.target)?void 0:t.result);if(Array.isArray(a)){for(let e of a)await fetch("".concat("http://127.0.0.1:8080","/api/products"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});W(),alert("Successfully imported ".concat(a.length," products"))}else alert("Invalid file format")}catch(e){alert("Error reading file")}},s.readAsText(a)};(0,l.useEffect)(()=>{let e=X.current,t=K.current,a=ee.current;if(!e||!t||!a)return;let s=e.firstElementChild;if(!s)return;let l=!1,r=()=>{s.style.width="".concat(a.scrollWidth,"px")},n=()=>{l||(l=!0,t.scrollLeft=e.scrollLeft,l=!1)},i=()=>{l||(l=!0,e.scrollLeft=t.scrollLeft,l=!1)};r(),e.addEventListener("scroll",n,{passive:!0}),t.addEventListener("scroll",i,{passive:!0});let c="undefined"!=typeof ResizeObserver?new ResizeObserver(r):null;return c&&c.observe(a),window.addEventListener("resize",r),()=>{e.removeEventListener("scroll",n),t.removeEventListener("scroll",i),null==c||c.disconnect(),window.removeEventListener("resize",r)}},[Q.length,H]);let tx=(0,l.useMemo)(()=>Q.filter(e=>{var t,a,s,l,n,i;let c=er.toLowerCase(),d=""===er||e.name.toLowerCase().includes(c)||(()=>{let t=(0,r.n)(e);return!!t&&t.toLowerCase().includes(c)})(),o=Number(null!=(t=e.stock)?t:0),h="all"===ei||"low"===ei&&o>0&&o<=5||"out"===ei&&0===o||"available"===ei&&o>5,m=Number(e.price)||0,u=""!==ed.min?parseFloat(ed.min):-1/0,x=""!==ed.max?parseFloat(ed.max):1/0,p=void 0!==e.batchid&&null!==e.batchid?String(e.batchid):"",g="all"===eh||p===String(eh),f=""!==eu.min?parseFloat(eu.min):-1/0,j=""!==eu.max?parseFloat(eu.max):1/0,b=Number(null!=(s=null!=(a=e.sellingPrice)?a:e.price)?s:0),N=!0;if(ep.from||ep.to){let t=null!=(i=null!=(n=null!=(l=e.createdAt)?l:e.createdat)?n:e.created_at)?i:null,a=null===t?null:new Date("number"==typeof t?t:String(t));if(a&&!isNaN(a.getTime())){let e=ep.from?new Date("".concat(ep.from,"T00:00:00.000")):null,t=ep.to?new Date("".concat(ep.to,"T23:59:59.999")):null;e&&(N=N&&a>=e),t&&(N=N&&a<=t)}else N=!1}return d&&h&&m>=u&&m<=x&&g&&b>=f&&b<=j&&N}).sort((e,t)=>{let a=e.createdAt?new Date(e.createdAt).getTime():0;return(t.createdAt?new Date(t.createdAt).getTime():0)-a}),[Q,er,ei,ed,eh,eu,ep]),tp=(0,l.useMemo)(()=>{let e=tx.reduce((e,t)=>{var a,s,l;let r=Number(null!=(a=t.stock)?a:0),n=Number(null!=(l=null!=(s=t.sellingPrice)?s:t.price)?l:0);return isNaN(r)||isNaN(n)?(console.warn("Invalid stock or selling price for product ".concat(t.id,": stock=").concat(t.stock,", sellingPrice=").concat(n)),e):e+r*n},0);return console.log("Calculated Total Selling Value:",e.toFixed(2)),e.toFixed(2)},[tx]),tg=(0,l.useMemo)(()=>{let e=tx.reduce((e,t)=>{var a,s;let l=Number(null!=(a=t.stock)?a:0),r=Number(null!=(s=t.price)?s:0);return isNaN(l)||isNaN(r)?(console.warn("Invalid stock or cost price for product ".concat(t.id,": stock=").concat(t.stock,", costPrice=").concat(r)),e):e+l*r},0);return console.log("Calculated Total Cost Value:",e.toFixed(2)),e.toFixed(2)},[tx]),tf=(0,l.useMemo)(()=>tx.reduce((e,t)=>{var a;return e+Number(null!=(a=t.stock)?a:0)},0),[tx]),tj=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),tb=e=>{if(!e)return"";let t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear();return"".concat(t,"/").concat(a,"/").concat(s)},tN=e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(s)},tv=(0,l.useMemo)(()=>{let e={};for(let t of Q){let a=(null==t?void 0:t.createdAt)||(null==t?void 0:t.createdat);if(!a){console.log("Product missing createdAt:",t);continue}let s=new Date(a);if(Number.isNaN(s.getTime())){console.log("Invalid date for product:",t,"createdAt:",a);continue}let l=s.toISOString().slice(0,10);e[l]=[...e[l]||[],t]}return console.log("Final productsByDate map:",e),e},[Q]),ty=(0,l.useMemo)(()=>{let e={};for(let t in tv)e[t]=tv[t].length;return e},[tv]),tw=e$?tN(e$):"",tC=(e,t,a,s)=>{var l;let r=0,n=0,i=e.map(e=>{var t,a;let s=null!=(t=e.stock)?t:0,l=Number(null!=(a=e.price)?a:0),i=s*l;r+=s,n+=i;let c=e.barcode&&""!==e.barcode.trim()?e.barcode.split(",").map(e=>'<span style="display:block;">'.concat(e,"</span>")).join(""):"N/A";return'\n        <tr>\n          <td style="padding:6px;border:1px solid #ddd;">'.concat(c,'</td>\n          <td style="padding:6px;border:1px solid #ddd;">').concat(e.name,'</td>\n          <td style="padding:6px;border:1px solid #ddd; text-align:right;">').concat(s,'</td>\n          <td style="padding:6px;border:1px solid #ddd; text-align:right;">₹').concat(l.toFixed(2),'</td>\n          <td style="padding:6px;border:1px solid #ddd; text-align:right;">₹').concat(i.toFixed(2),"</td>\n        </tr>")}).join(""),c=(null!=(l=null==s?void 0:s.printedAt)?l:new Date).toLocaleString(),d='\n      <div style="font-size:8px; margin-bottom:8px; border:1px solid #ddd; padding:6px;">\n        <div><strong>Batch ID:</strong> '.concat((null==s?void 0:s.batchId)||"N/A","</div>\n        <div><strong>Batch Name:</strong> ").concat((null==s?void 0:s.batchName)||"N/A","</div>\n        <div><strong>Batch Place:</strong> ").concat((null==s?void 0:s.batchPlace)||"N/A","</div>\n        <div><strong>Date:</strong> ").concat(tb(t),"</div>\n        <div><strong>Printed At:</strong> ").concat(c,"</div>\n      </div>\n    ");return'\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset="utf-8" />\n          <title>Products on '.concat(tb(t),'</title>\n          <style>\n            @media print {\n              @page { margin: 12mm; }\n              body { font-family: ui-sans-serif, system-ui, Arial, sans-serif; font-size: 8px; line-height: 1.25; }\n              h1 { font-size: 10px; margin-bottom: 8px; }\n              table { width: 100%; border-collapse: collapse; }\n              th, td { font-size: 8px; padding: 4px !important; }\n              th { background:#f3f4f6; }\n              tfoot { font-weight: bold; }\n              tfoot { display: table-footer-group; }\n              @page {\n                @bottom-right {\n                  content: "Page " counter(page) " of " counter(pages);\n                }\n              }\n            }\n            @media print {\n              tfoot {\n                display: table-row-group;\n              }\n            }\n          </style>\n        </head>\n        <body>\n      <h1>Products on ').concat(tb(t),"</h1>\n          ").concat(a?'<p style="font-size: 8px; margin-bottom: 6px;">Store: '.concat(a,"</p>"):"","\n          ").concat(d,'\n          <table>\n            <thead>\n              <tr>\n                <th style="padding:6px;border:1px solid #ddd; text-align:left;">Product Barcode Number</th>\n                <th style="padding:6px;border:1px solid #ddd; text-align:left;">Product Name</th>\n                <th style="padding:6px;border:1px solid #ddd; text-align:right;">Stock</th>\n                <th style="padding:6px;border:1px solid #ddd; text-align:right;">Price</th>\n                <th style="padding:6px;border:1px solid #ddd; text-align:right;">Value (Total Value)</th>\n              </tr>\n            </thead>\n            <tbody>').concat(i,'</tbody>\n            <tfoot>\n              <tr>\n                <td colspan="2" style="padding:6px;border:1px solid #ddd; text-align:right;">Total:</td>\n                <td style="padding:6px;border:1px solid #ddd; text-align:right;">').concat(r,'</td>\n                <td style="padding:6px;border:1px solid #ddd; text-align:right;"></td>\n                <td style="padding:6px;border:1px solid #ddd; text-align:right;">₹').concat(n.toFixed(2),"</td>\n              </tr>\n            </tfoot>\n          </table>\n          <script>\n            // window.onload = function() { // Not needed for unifiedPrint\n            //   window.print();\n            //   setTimeout(function(){ window.close(); }, 300);\n            // };\n          <\/script>\n        </body>\n      </html>\n    ")};return(0,s.jsx)(c.default,{children:(0,s.jsxs)("div",{className:"w-full min-w-0 space-y-8",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Product Management"}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Manage your inventory and product catalog"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)(d.$,{variant:"outline",onClick:()=>ez(e=>!e),children:[(0,s.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Calendar"]}),eO&&(0,s.jsxs)("div",{className:"absolute right-0 z-50 mt-2 bg-white border rounded shadow-lg p-3 w-80",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>eJ(e=>new Date(e.getFullYear(),e.getMonth()-1,1)),children:"◀"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:eR.toLocaleString(void 0,{month:"long",year:"numeric"})}),(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>eJ(e=>new Date(e.getFullYear(),e.getMonth()+1,1)),children:"▶"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-7 text-[11px] text-gray-500 mb-1",children:[(0,s.jsx)("div",{className:"text-center",children:"Su"}),(0,s.jsx)("div",{className:"text-center",children:"Mo"}),(0,s.jsx)("div",{className:"text-center",children:"Tu"}),(0,s.jsx)("div",{className:"text-center",children:"We"}),(0,s.jsx)("div",{className:"text-center",children:"Th"}),(0,s.jsx)("div",{className:"text-center",children:"Fr"}),(0,s.jsx)("div",{className:"text-center",children:"Sa"})]}),(0,s.jsx)("div",{className:"grid grid-cols-7 gap-1",children:(()=>{let e=new Date(eR.getFullYear(),eR.getMonth(),1).getDay(),t=new Date(eR.getFullYear(),eR.getMonth()+1,0).getDate(),a=[];for(let t=0;t<e;t++)a.push((0,s.jsx)("div",{className:"h-8"},"b-".concat(t)));for(let e=1;e<=t;e++){var l;let t=new Date(eR.getFullYear(),eR.getMonth(),e),r=tN(t),n=null!=(l=ty[r])?l:0,i=tj(t,new Date),c="h-8 w-8 mx-auto flex items-center justify-center rounded-full cursor-pointer select-none ";i?c+="border-2 border-red-500 text-red-600 ":n>0?c+="bg-blue-100 text-blue-700 ":c+="text-gray-400 ",a.push((0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)("div",{className:c,title:n>0?"".concat(n," products"):"No products",onClick:()=>e6(t),children:e})},r))}return a})()}),e$&&(0,s.jsx)("div",{className:"mt-3 border-t pt-3",children:(0,s.jsxs)("div",{className:"text-sm mb-2",children:[(null!=(D=ty[tw])?D:0).toString()," products on ",tb(e$)]})}),(0,s.jsx)("div",{className:"mt-3 border-t pt-3 text-right",children:(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>ez(!1),children:"Close"})})]})]}),(0,s.jsx)("input",{type:"file",accept:".json",onChange:tu,className:"hidden",id:"import-products"}),(0,s.jsxs)(d.$,{variant:"outline",onClick:()=>{var e;return null==(e=document.getElementById("import-products"))?void 0:e.click()},children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Import"]}),(0,s.jsxs)(d.$,{variant:"outline",onClick:()=>{let e="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(Q,null,2)),t="products_".concat(new Date().toISOString().split("T")[0],".json"),a=document.createElement("a");a.setAttribute("href",e),a.setAttribute("download",t),a.click()},children:[(0,s.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,s.jsxs)(d.$,{variant:"outline",onClick:()=>ej(!0),children:[(0,s.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Filters"]}),(0,s.jsxs)(x.lG,{open:eb,onOpenChange:e=>{eN(e),tt(),eG(null)},children:[(0,s.jsx)(x.zM,{asChild:!0,children:(0,s.jsxs)(d.$,{className:"bg-blue-600 hover:bg-blue-700",children:[(0,s.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Add Product"]})}),(0,s.jsxs)(x.Cf,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsx)(x.L3,{children:"Add New Product"}),(0,s.jsx)(x.rr,{children:"Create a new product with barcode information"})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"name",children:"Product Name *"}),(0,s.jsx)(o.p,{id:"name",value:e8.name,onChange:e=>{e3({...e8,name:e.target.value});let t=e.target.value.toLowerCase();e9(Q.map(e=>e.name).filter(e=>e.toLowerCase().includes(t)&&e.toLowerCase()!==t).slice(0,5))},placeholder:"Enter product name",list:"product-name-suggestions"}),(0,s.jsx)("datalist",{id:"product-name-suggestions",children:e7.map((e,t)=>(0,s.jsx)("option",{value:e},"".concat(e,"-").concat(t)))})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"price",children:"Price (₹) *"}),(0,s.jsx)(o.p,{id:"price",type:"number",min:"0",step:"0.01",value:e8.price,onChange:e=>e3({...e8,price:e.target.value}),placeholder:"0.00"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"stock",children:"Stock Quantity *"}),(0,s.jsx)(o.p,{id:"stock",type:"number",min:"0",value:e8.stock,onChange:e=>e3({...e8,stock:e.target.value}),placeholder:"0"})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"sellingPrice",children:"Selling Price (₹)"}),(0,s.jsx)(o.p,{id:"sellingPrice",type:"number",min:"0",step:"0.01",value:e8.sellingPrice,onChange:e=>e3({...e8,sellingPrice:e.target.value}),placeholder:"0.00"})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"hsnCode",children:"HSN Code"}),(0,s.jsxs)(p.l6,{value:e8.hsnCode||"none",onValueChange:e=>te("none"===e?"":e),children:[(0,s.jsx)(p.bq,{id:"hsnCode",children:(0,s.jsx)(p.yv,{placeholder:"Select HSN Code"})}),(0,s.jsxs)(p.gC,{children:[(0,s.jsx)(p.eb,{value:"none",children:"None"}),Z.map(e=>(0,s.jsx)(p.eb,{value:e.id,children:e.hsnCode},e.id))]})]}),e8.hsnCode&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Tax: ",Number(null!=(T=null==(e=Z.find(e=>String(e.id)===String(e8.hsnCode)))?void 0:e.tax)?T:0).toFixed(2),"%"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"batch",children:"Batch (Optional)"}),(0,s.jsxs)(p.l6,{value:e8.batchid||"",onValueChange:e=>{e3({...e8,batchid:"no-batch-selected"===e?"":e})},children:[(0,s.jsx)(p.bq,{id:"batch",children:(0,s.jsx)(p.yv,{placeholder:"Select a batch"})}),(0,s.jsxs)(p.gC,{children:[(0,s.jsx)(p.eb,{value:"no-batch-selected",children:"No Batch"})," ",V.map((e,t)=>(0,s.jsx)(p.eb,{value:e.id,children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{children:e.place}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.batchNumber})]})},"".concat(e.id,"-").concat(t))),(0,s.jsx)(g.w,{className:"my-2"}),(0,s.jsxs)(d.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>eV(!0),children:[(0,s.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"New Batch"]})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(h.J,{children:"Barcodes *"}),(0,s.jsxs)(d.$,{type:"button",variant:"outline",size:"sm",onClick:ta,children:[(0,s.jsx)(S.A,{className:"h-3 w-3 mr-1"}),"Add Barcode"]})]}),(0,s.jsx)("div",{className:"space-y-2",children:e8.barcodes.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(o.p,{value:e,onChange:e=>ts(t,e.target.value),placeholder:"Enter barcode or click generate",className:"flex-1"}),(0,s.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>ts(t,tr()),children:"Generate"}),e8.barcodes.length>1&&(0,s.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>tl(t),className:"text-red-600 hover:text-red-700",children:(0,s.jsx)(k.A,{className:"h-3 w-3"})})]},t))})]})]}),(0,s.jsxs)(x.Es,{children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>{eN(!1),tt()},children:"Cancel"}),(0,s.jsx)(d.$,{onClick:ti,children:"Add Product"})]})]})]}),(0,s.jsx)(I,{isOpen:eW,onOpenChange:eV})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,s.jsx)(m.Zp,{children:(0,s.jsx)(m.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(P.A,{className:"h-8 w-8 text-blue-600"}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Products"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:tx.length})]})]})})}),(0,s.jsx)(m.Zp,{children:(0,s.jsx)(m.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(N.A,{className:"h-8 w-8 text-green-600"}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Stock"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:tf})]})]})})}),(0,s.jsx)(m.Zp,{children:(0,s.jsx)(m.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(b.A,{className:"h-8 w-8 text-yellow-600"}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Value of Selling Price"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["₹",tp]})]})]})})}),(0,s.jsx)(m.Zp,{children:(0,s.jsx)(m.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(P.A,{className:"h-8 w-8 text-blue-600"}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Inventory Price Value"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["₹",tg]})]})]})})})]}),(0,s.jsxs)(m.Zp,{children:[(0,s.jsx)(m.aR,{children:(0,s.jsx)(m.ZB,{children:"Product Catalog"})}),(0,s.jsxs)(m.Wu,{children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(A.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,s.jsx)(o.p,{placeholder:"Search products or barcodes...",value:er,onChange:e=>en(e.target.value),className:"pl-10"})]})}),(0,s.jsxs)(p.l6,{value:ei,onValueChange:ec,children:[(0,s.jsx)(p.bq,{className:"w-full md:w-48",children:(0,s.jsx)(p.yv,{placeholder:"Filter by stock"})}),(0,s.jsxs)(p.gC,{children:[(0,s.jsx)(p.eb,{value:"all",children:"All Stock Levels"}),(0,s.jsx)(p.eb,{value:"available",children:"In Stock"}),(0,s.jsx)(p.eb,{value:"low",children:"Low Stock"}),(0,s.jsx)(p.eb,{value:"out",children:"Out of Stock"})]})]})]}),eP.length>0&&(0,s.jsx)("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-sm font-medium text-blue-700",children:[eP.length," product(s) selected"]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>eT(!0),children:"Update HSN Code"}),(0,s.jsxs)(d.$,{variant:"outline",size:"sm",onClick:to,className:"text-red-600 hover:text-red-700",children:[(0,s.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Delete Selected"]}),(0,s.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>tm(eP),children:[(0,s.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Print Labels"]}),(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>eA([]),children:"Clear Selection"})]})]})}),(0,s.jsx)("div",{ref:X,className:"overflow-x-auto overflow-y-hidden mb-2",children:(0,s.jsx)("div",{className:"h-px"})}),(0,s.jsxs)("div",{className:"overflow-x-auto max-h-[500px] overflow-y-auto relative",ref:K,children:[(0,s.jsxs)("table",{ref:ee,className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left p-4",children:(0,s.jsx)("input",{type:"checkbox",checked:eP.length===tx.length&&tx.length>0,onChange:()=>{eP.length===tx.length?eA([]):eA(tx.map(e=>e.id))},className:"rounded"})}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"Product"}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"Batch"}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"Price"}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"Selling Price"}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"Tax (%)"}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"HSN Code"}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"Stock"}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"Barcodes"}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"Status"}),(0,s.jsx)("th",{className:"text-left p-4 font-medium",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:tx.map(e=>{var t,a,l,r;let n=0===(r=e.stock)?{label:"Out of Stock",variant:"destructive",icon:j.A}:r<=5?{label:"Low Stock",variant:"secondary",icon:b.A}:{label:"In Stock",variant:"default",icon:N.A},i=n.icon,c=V.find(t=>t.id===e.batchid);return(0,s.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"p-4",children:(0,s.jsx)("input",{type:"checkbox",checked:eP.includes(e.id),onChange:()=>{var t;return t=e.id,void eA(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"rounded"})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():""})]})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium",children:["Batch: ",(null==c?void 0:c.batchNumber)||"N/A"]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Place: ",(null==c?void 0:c.place)||"N/A"]})]})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)("span",{className:"font-medium",children:["₹",Number(null!=(t=e.price)?t:0).toFixed(2)]})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)("span",{className:"font-medium",children:["₹",Number(null!=(l=null!=(a=e.sellingPrice)?a:e.selling_price)?l:0).toFixed(2)]})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)("span",{className:"font-medium",children:[(()=>{var t,a;let s=e.hsnCode,l=null==(t=Z.find(e=>String(e.id)===String(s)))?void 0:t.tax;return Number(null!=(a=null!=l?l:e.tax)?a:0).toFixed(2)})(),"%"]})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsx)("span",{className:"font-medium",children:(()=>{let t=e.hsnCode;if(!t||"null"===t||null===t)return(0,s.jsx)("span",{className:"font-medium text-gray-400",children:"N/A"});let a=Z.find(e=>String(e.id)===String(t));return a?(0,s.jsx)("span",{className:"font-medium",children:a.hsnCode}):(0,s.jsx)("span",{className:"font-medium text-gray-500",children:String(t)})})()})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsx)("span",{className:"font-medium",children:e.stock})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsx)("div",{className:"space-y-1",children:e.barcodes&&e.barcodes.length>0?e.barcodes.map((e,t)=>(0,s.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded block",children:e},t)):(0,s.jsx)("code",{className:"text-xs text-muted-foreground px-2 py-1 rounded block",children:"N/A"})})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)(u.E,{variant:n.variant,className:"flex items-center w-fit",children:[(0,s.jsx)(i,{className:"h-3 w-3 mr-1"}),n.label]})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>{eC(e),e3({name:e.name,price:e.price.toString(),stock:e.stock.toString(),sellingPrice:null!=e.sellingPrice?e.sellingPrice.toString():"",barcodes:"string"==typeof e.barcode&&""!==e.barcode.trim()?e.barcode.split(","):[""],batchid:e.batchid||"",hsnCode:null!=e.hsnCode?String(e.hsnCode):""}),ey(!0)},children:(0,s.jsx)(E.A,{className:"h-3 w-3"})}),(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>tm([e.id]),children:(0,s.jsx)(F.A,{className:"h-3 w-3"})}),(0,s.jsxs)(f.Lt,{children:[(0,s.jsx)(f.tv,{asChild:!0,children:(0,s.jsx)(d.$,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 bg-transparent",children:(0,s.jsx)(k.A,{className:"h-3 w-3"})})}),(0,s.jsxs)(f.EO,{children:[(0,s.jsxs)(f.wd,{children:[(0,s.jsx)(f.r7,{children:"Delete Product"}),(0,s.jsxs)(f.$v,{children:['Are you sure you want to delete "',e.name,'"? This action cannot be undone.']})]}),(0,s.jsxs)(f.ck,{children:[(0,s.jsx)(f.Zr,{children:"Cancel"}),(0,s.jsx)(f.Rx,{onClick:()=>td(e.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})})]},e.id)})})]}),0===tx.length&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(P.A,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"No products found"}),(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:er||"all"!==ei||""!==ed.min||""!==ed.max||"all"!==eh||""!==eu.min||""!==eu.max||""!==ep.from||""!==ep.to?"Try adjusting your search or filters":"Get started by adding your first product"}),!er&&"all"===ei&&(0,s.jsxs)(d.$,{onClick:()=>eN(!0),type:"button",children:[(0,s.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Add Your First Product"]})]})]}),tx.length>15&&(0,s.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,s.jsx)(J,{onClick:()=>{var e;return null==(e=K.current)?void 0:e.scrollTo({top:0,behavior:"smooth"})}}),(0,s.jsx)(z,{onClick:()=>{var e;return null==(e=K.current)?void 0:e.scrollTo({top:K.current.scrollHeight,behavior:"smooth"})}})]})]})]}),(0,s.jsx)(x.lG,{open:ef,onOpenChange:ej,children:(0,s.jsxs)(x.Cf,{className:"sm:max-w-[500px]",children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsx)(x.L3,{children:"Advanced Filters"}),(0,s.jsx)(x.rr,{children:"Refine your product search with additional criteria."})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{children:"Price Range (₹)"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)(o.p,{type:"number",placeholder:"Min",value:ed.min,onChange:e=>eo({...ed,min:e.target.value})}),(0,s.jsx)(o.p,{type:"number",placeholder:"Max",value:ed.max,onChange:e=>eo({...ed,max:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{children:"Batch"}),(0,s.jsxs)(p.l6,{value:eh,onValueChange:em,children:[(0,s.jsx)(p.bq,{children:(0,s.jsx)(p.yv,{placeholder:"Select batch"})}),(0,s.jsxs)(p.gC,{children:[(0,s.jsx)(p.eb,{value:"all",children:"All Batches"}),V.map(e=>(0,s.jsxs)(p.eb,{value:e.id,children:[e.batchNumber," (",e.place,")"]},e.id))]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{children:"Selling Price Range (₹)"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)(o.p,{type:"number",step:"0.01",placeholder:"Min",value:eu.min,onChange:e=>ex({...eu,min:e.target.value})}),(0,s.jsx)(o.p,{type:"number",step:"0.01",placeholder:"Max",value:eu.max,onChange:e=>ex({...eu,max:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{children:"Date Added"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)(o.p,{type:"date",value:ep.from,onChange:e=>eg({...ep,from:e.target.value})}),(0,s.jsx)(o.p,{type:"date",value:ep.to,onChange:e=>eg({...ep,to:e.target.value})})]})]})]}),(0,s.jsxs)(x.Es,{children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>{eo({min:"",max:""}),em("all"),ex({min:"",max:""}),eg({from:"",to:""})},children:"Reset All"}),(0,s.jsx)(d.$,{onClick:()=>ej(!1),children:"Apply Filters"})]})]})}),(0,s.jsx)(x.lG,{open:eQ,onOpenChange:eK,children:(0,s.jsxs)(x.Cf,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsxs)(x.L3,{children:["Batches on ",e$?tb(e$):""]}),(0,s.jsx)(x.rr,{children:"Select a batch to view its products."})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[eq.length>0&&(0,s.jsx)(m.Zp,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>{e5(eq),eK(!1),eH(!0)},children:(0,s.jsxs)(m.aR,{children:[(0,s.jsx)(m.ZB,{children:"Un-Batched Products"}),(0,s.jsxs)(m.BT,{children:[eq.length," products not assigned to a batch"]})]})}),eY.length>0&&(0,s.jsxs)(s.Fragment,{children:[eq.length>0&&(0,s.jsx)(g.w,{className:"my-2"}),eY.map(e=>(0,s.jsx)(m.Zp,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>{e0(e),e2(!0)},children:(0,s.jsxs)(m.aR,{children:[(0,s.jsx)(m.ZB,{children:e.batchNumber}),(0,s.jsx)(m.BT,{children:e.place})]})},e.id))]}),0===eY.length&&0===eq.length&&(0,s.jsx)("p",{className:"text-center text-muted-foreground",children:"No products found for this date."})]}),(0,s.jsx)(x.Es,{className:"mt-4 flex justify-end items-center space-x-2",children:(0,s.jsx)(d.$,{variant:"outline",onClick:()=>eK(!1),children:"Close"})})]})}),(0,s.jsx)(x.lG,{open:e1,onOpenChange:e2,children:(0,s.jsxs)(x.Cf,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsxs)(x.L3,{children:["Products in Batch ",null==eX?void 0:eX.batchNumber," on ",e$?tb(e$):""]}),(0,s.jsx)(x.rr,{children:"Listed by product id, name, stock, and price."})]}),(()=>{let e=0,t=0,a=(tv[tw]||[]).filter(e=>e.batchid===(null==eX?void 0:eX.id)).map(a=>{let l=V.find(e=>e.id===a.batchid),r=Number(a.stock)||0,n=Number(a.price)||0,i=r*n;e+=r,t+=i;let c=a.barcode&&""!==a.barcode.trim()?a.barcode.split(",").map(e=>e.trim()).filter(e=>""!==e):[];return(0,s.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"p-2",children:c.length>0?(0,s.jsx)("div",{className:"space-y-1",children:c.map((e,t)=>(0,s.jsx)("div",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:e},t))}):"N/A"}),(0,s.jsx)("td",{className:"p-2",children:a.name}),(0,s.jsxs)("td",{className:"p-2",children:[(null==l?void 0:l.batchNumber)||"N/A"," (",(null==l?void 0:l.place)||"N/A",")"]}),(0,s.jsx)("td",{className:"p-2 text-right",children:r}),(0,s.jsxs)("td",{className:"p-2 text-right",children:["₹",n.toFixed(2)]}),(0,s.jsxs)("td",{className:"p-2 text-right",children:["₹",i.toFixed(2)]})]},a.id)});return(0,s.jsx)("div",{className:"overflow-x-auto max-h-[calc(90vh-180px)] relative",ref:K,children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left p-2",children:"Product Barcode Number"}),(0,s.jsx)("th",{className:"text-left p-2",children:"Product Name"}),(0,s.jsx)("th",{className:"text-left p-2",children:"Product Batch Number"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Stock"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Price"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Value (Total Value)"})]})}),(0,s.jsxs)("tbody",{children:[a,(0,s.jsxs)("tr",{className:"font-bold border-t",children:[(0,s.jsx)("td",{colSpan:3,className:"p-2 text-right",children:"Total:"}),(0,s.jsx)("td",{className:"p-2 text-right",children:e}),(0,s.jsx)("td",{className:"p-2 text-right"}),(0,s.jsxs)("td",{className:"p-2 text-right",children:["₹",t.toFixed(2)]})]})]})]})})})(),(0,s.jsxs)(x.Es,{className:"mt-4 flex justify-end items-center space-x-2",children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>e2(!1),children:"Close"}),(0,s.jsxs)(d.$,{onClick:()=>{var e,t;if(!e$||!eX)return;let a=(tv[tw]||[]).filter(e=>e.batchid===eX.id);a.map(e=>e.id);let s=tC(a,e$,(null==es||null==(e=es[0])?void 0:e.name)||"Siri Art Jewellers",{batchId:eX.id,batchName:eX.batchNumber,batchPlace:eX.place});(0,L.G)({htmlContent:s,useBackendPrint:!0,storeName:(null==es||null==(t=es[0])?void 0:t.name)||"Siri Art Jewellers"})},children:[(0,s.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Print"]})]})]})}),(0,s.jsx)(x.lG,{open:eM,onOpenChange:eH,children:(0,s.jsxs)(x.Cf,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsxs)(x.L3,{children:["Products on ",e$?tb(e$):""]}),(0,s.jsx)(x.rr,{children:"Listed by product id, name, stock, and price."})]}),(()=>{let e=0,t=0,a=e4.map(a=>{let l=V.find(e=>e.id===a.batchid),r=Number(a.stock)||0,n=Number(a.price)||0,i=r*n;e+=r,t+=i;let c=a.barcode&&""!==a.barcode.trim()?a.barcode.split(",").map(e=>e.trim()).filter(e=>""!==e):[];return(0,s.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"p-2",children:c.length>0?(0,s.jsx)("div",{className:"space-y-1",children:c.map((e,t)=>(0,s.jsx)("div",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:e},t))}):"N/A"}),(0,s.jsx)("td",{className:"p-2",children:a.name}),(0,s.jsxs)("td",{className:"p-2",children:[(null==l?void 0:l.batchNumber)||"N/A"," (",(null==l?void 0:l.place)||"N/A",")"]}),(0,s.jsx)("td",{className:"p-2 text-right",children:r}),(0,s.jsxs)("td",{className:"p-2 text-right",children:["₹",n.toFixed(2)]}),(0,s.jsxs)("td",{className:"p-2 text-right",children:["₹",i.toFixed(2)]})]},a.id)});return(0,s.jsx)("div",{className:"overflow-x-auto max-h-[calc(90vh-180px)] relative",ref:K,children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left p-2",children:"Product Barcode Number"}),(0,s.jsx)("th",{className:"text-left p-2",children:"Product Name"}),(0,s.jsx)("th",{className:"text-left p-2",children:"Product Batch"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Stock"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Price"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Value (Total Value)"})]})}),(0,s.jsxs)("tbody",{children:[a,(0,s.jsxs)("tr",{className:"font-bold border-t",children:[(0,s.jsx)("td",{colSpan:3,className:"p-2 text-right",children:"Total:"}),(0,s.jsx)("td",{className:"p-2 text-right",children:e}),(0,s.jsx)("td",{className:"p-2 text-right"}),(0,s.jsxs)("td",{className:"p-2 text-right",children:["₹$",t.toFixed(2)]})]})]})]})})})(),(0,s.jsxs)(x.Es,{className:"mt-4 flex justify-end items-center space-x-2",children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>eH(!1),children:"Close"}),(0,s.jsxs)(d.$,{onClick:()=>{var e,t;if(!e$)return;e4.map(e=>e.id);let a=tC(e4,e$,(null==es||null==(e=es[0])?void 0:e.name)||"Siri Art Jewellers",{batchId:"N/A",batchName:"Un-batched / Mixed"});(0,L.G)({htmlContent:a,useBackendPrint:!0,storeName:(null==es||null==(t=es[0])?void 0:t.name)||"Siri Art Jewellers"})},children:[(0,s.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Print"]})]})]})}),(0,s.jsx)(B,{products:eF,isOpen:eS,onClose:()=>ek(!1),onPrintSuccess:()=>{eA([]),eE([])},storeName:(null==es||null==(t=es[0])?void 0:t.name)||"Siri Art Jewellers",forceBackendPrint:!0,batches:V}),(0,s.jsx)(x.lG,{open:ev,onOpenChange:e=>{ey(e),e||(tt(),eC(null),eG(null))},children:(0,s.jsxs)(x.Cf,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsx)(x.L3,{children:"Edit Product"}),(0,s.jsx)(x.rr,{children:"Update product information and barcode details"})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"edit-name",children:"Product Name *"}),(0,s.jsx)(o.p,{id:"edit-name",value:e8.name,onChange:e=>{e3({...e8,name:e.target.value});let t=e.target.value.toLowerCase();e9(Q.map(e=>e.name).filter(e=>e.toLowerCase().includes(t)&&e.toLowerCase()!==t).slice(0,5))},placeholder:"Enter product name",list:"product-name-suggestions-edit"}),(0,s.jsx)("datalist",{id:"product-name-suggestions-edit",children:e7.map((e,t)=>(0,s.jsx)("option",{value:e},"".concat(e,"-").concat(t)))})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"edit-price",children:"Price (₹) *"}),(0,s.jsx)(o.p,{id:"edit-price",type:"number",min:"0",step:"0.01",value:e8.price,onChange:e=>e3({...e8,price:e.target.value}),placeholder:"0.00"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"edit-stock",children:"Stock Quantity *"}),(0,s.jsx)(o.p,{id:"edit-stock",type:"number",min:"0",value:e8.stock,onChange:e=>e3({...e8,stock:e.target.value}),placeholder:"0"})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"edit-sellingPrice",children:"Selling Price (₹)"}),(0,s.jsx)(o.p,{id:"edit-sellingPrice",type:"number",min:"0",step:"0.01",value:e8.sellingPrice,onChange:e=>e3({...e8,sellingPrice:e.target.value}),placeholder:"0.00"})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"edit-hsnCode",children:"HSN Code"}),(0,s.jsxs)(p.l6,{value:e8.hsnCode||"none",onValueChange:e=>te("none"===e?"":e),children:[(0,s.jsx)(p.bq,{id:"edit-hsnCode",children:(0,s.jsx)(p.yv,{placeholder:"Select HSN Code"})}),(0,s.jsxs)(p.gC,{children:[(0,s.jsx)(p.eb,{value:"none",children:"None"}),Z.map(e=>(0,s.jsx)(p.eb,{value:e.id,children:e.hsnCode},e.id))]})]}),e8.hsnCode&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Tax: ",Number(null!=(O=null==(a=Z.find(e=>String(e.id)===String(e8.hsnCode)))?void 0:a.tax)?O:0).toFixed(2),"%"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"edit-batch",children:"Batch (Optional)"}),(0,s.jsxs)(p.l6,{value:e8.batchid||"",onValueChange:e=>{e3({...e8,batchid:"no-batch-selected"===e?"":e})},children:[(0,s.jsx)(p.bq,{id:"edit-batch",children:(0,s.jsx)(p.yv,{placeholder:"Select a batch"})}),(0,s.jsxs)(p.gC,{children:[(0,s.jsx)(p.eb,{value:"no-batch-selected",children:"No Batch"})," ",V.map((e,t)=>(0,s.jsx)(p.eb,{value:e.id,children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{children:e.place}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.batchNumber})]})},"".concat(e.id,"-").concat(t))),(0,s.jsx)(g.w,{className:"my-2"}),(0,s.jsxs)(d.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>eV(!0),children:[(0,s.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"New Batch"]})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(h.J,{children:"Barcodes *"}),(0,s.jsxs)(d.$,{type:"button",variant:"outline",size:"sm",onClick:ta,children:[(0,s.jsx)(S.A,{className:"h-3 w-3 mr-1"}),"Add Barcode"]})]}),(0,s.jsx)("div",{className:"space-y-2",children:e8.barcodes.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(o.p,{value:e,onChange:e=>ts(t,e.target.value),placeholder:"Enter barcode or click generate",className:"flex-1"}),(0,s.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>ts(t,tr()),children:"Generate"}),e8.barcodes.length>1&&(0,s.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>tl(t),className:"text-red-600 hover:text-red-700",children:(0,s.jsx)(k.A,{className:"h-3 w-3"})})]},t))})]})]}),(0,s.jsxs)(x.Es,{children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>{ey(!1),tt(),eC(null)},children:"Cancel"}),(0,s.jsx)(d.$,{onClick:tc,children:"Update Product"})]})]})}),(0,s.jsx)(x.lG,{open:eD,onOpenChange:eT,children:(0,s.jsxs)(x.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsx)(x.L3,{children:"Update HSN Code for Selected Products"}),(0,s.jsxs)(x.rr,{children:["Set HSN code for ",eP.length," selected product(s)"]})]}),(0,s.jsx)("div",{className:"grid gap-4 py-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"bulk-hsn",children:"HSN Code"}),(0,s.jsxs)(p.l6,{value:eL||"none",onValueChange:e=>eB("none"===e?"":e),children:[(0,s.jsx)(p.bq,{id:"bulk-hsn",children:(0,s.jsx)(p.yv,{placeholder:"Select HSN Code"})}),(0,s.jsxs)(p.gC,{children:[(0,s.jsx)(p.eb,{value:"none",children:"None"}),Z.map(e=>(0,s.jsx)(p.eb,{value:e.id,children:e.hsnCode},e.id))]})]})]})}),(0,s.jsxs)(x.Es,{children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>{eT(!1),eB("")},children:"Cancel"}),(0,s.jsx)(d.$,{onClick:th,children:"Update HSN Code"})]})]})})]})})}},47507:(e,t,a)=>{"use strict";a.d(t,{bq:()=>m,eb:()=>g,gC:()=>p,l6:()=>o,yv:()=>h});var s=a(95155),l=a(12115),r=a(4729),n=a(24033),i=a(12108),c=a(5917),d=a(25016);let o=r.bL;r.YJ;let h=r.WT,m=l.forwardRef((e,t)=>{let{className:a,children:l,...i}=e;return(0,s.jsxs)(r.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[l,(0,s.jsx)(r.In,{asChild:!0,children:(0,s.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=r.l9.displayName;let u=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.PP,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})});u.displayName=r.PP.displayName;let x=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.wn,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,s.jsx)(n.A,{className:"h-4 w-4"})})});x.displayName=r.wn.displayName;let p=l.forwardRef((e,t)=>{let{className:a,children:l,position:n="popper",...i}=e;return(0,s.jsx)(r.ZL,{children:(0,s.jsxs)(r.UC,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...i,children:[(0,s.jsx)(u,{}),(0,s.jsx)(r.LM,{className:(0,d.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,s.jsx)(x,{})]})})});p.displayName=r.UC.displayName,l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.JU,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...l})}).displayName=r.JU.displayName;let g=l.forwardRef((e,t)=>{let{className:a,children:l,...n}=e;return(0,s.jsxs)(r.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(r.VF,{children:(0,s.jsx)(c.A,{className:"h-4 w-4"})})}),(0,s.jsx)(r.p4,{children:l})]})});g.displayName=r.q7.displayName,l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...l})}).displayName=r.wv.displayName},52319:(e,t,a)=>{Promise.resolve().then(a.bind(a,32457))},54679:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>m,Es:()=>x,L3:()=>p,c7:()=>u,lG:()=>c,rr:()=>g,zM:()=>d});var s=a(95155),l=a(12115),r=a(93409),n=a(65229),i=a(25016);let c=r.bL,d=r.l9,o=r.ZL;r.bm;let h=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...l})});h.displayName=r.hJ.displayName;let m=l.forwardRef((e,t)=>{let{className:a,children:l,...c}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(h,{}),(0,s.jsxs)(r.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...c,children:[l,(0,s.jsxs)(r.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(n.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=r.UC.displayName;let u=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};u.displayName="DialogHeader";let x=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};x.displayName="DialogFooter";let p=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...l})});p.displayName=r.hE.displayName;let g=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...l})});g.displayName=r.VY.displayName},73609:(e,t,a)=>{"use strict";function s(e){if(e){if(Array.isArray(e.barcodes)&&e.barcodes.length>0){let t=e.barcodes.find(e=>"string"==typeof e&&""!==e.trim());if(t)return t}if("string"==typeof e.barcode&&""!==e.barcode.trim())return e.barcode}}a.d(t,{n:()=>s})},76577:(e,t,a)=>{"use strict";async function s(e){return new Promise((t,a)=>{try{var s;let l=!1,r=document.createElement("iframe");r.style.position="fixed",r.style.right="0",r.style.bottom="0",r.style.width="0",r.style.height="0",r.style.border="none",document.body.appendChild(r);let n=null==(s=r.contentWindow)?void 0:s.document;if(!n){document.body.removeChild(r),a(Error("Failed to access iframe document"));return}n.open(),n.write(e),n.close(),r.onload=()=>{if(!l){l=!0;try{var e,s;null==(e=r.contentWindow)||e.focus(),null==(s=r.contentWindow)||s.print(),setTimeout(()=>{r.parentNode&&document.body.removeChild(r),t()},1e3)}catch(e){r.parentNode&&document.body.removeChild(r),a(e)}}},setTimeout(()=>{if(!l){l=!0;try{r.contentWindow&&(r.contentWindow.focus(),r.contentWindow.print(),setTimeout(()=>{r.parentNode&&document.body.removeChild(r),t()},1e3))}catch(e){r.parentNode&&document.body.removeChild(r),a(e)}}},500)}catch(e){console.error("Print error:",e),a(e)}})}async function l(e){let{htmlContent:t,thermalContent:a,isThermalPrinter:l=!1,labelData:r,copies:n=1,useBackendPrint:i=!1,printerName:c,storeName:d}=e;if(i&&r&&r.length>0)try{let e="http://127.0.0.1:8080".replace(/\/+$/g,""),t={labelData:r.map(e=>{let t=e.selling_price;return void 0===t&&void 0!==e.sellingPrice&&(t=e.sellingPrice),{id:e.id,name:e.name,barcode:e.barcode,selling_price:null!=t?t:0,batchNumber:e.batchNumber||""}}),copies:n};c&&(t.printerName=c),d&&(t.storeName=d),console.log("\uD83D\uDCE4 Sending backend print request (selling_price only):",t);let a=await fetch("".concat(e,"/api/print-label"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await a.json().catch(()=>({}));if(a.ok&&"success"===s.status)return void console.log("✅ Backend print succeeded:",s.message||"");console.warn("⚠️ Backend print returned non-success, falling back to browser print",s)}catch(e){console.error("❌ Error sending backend print request, falling back to browser print:",e)}if(t){console.log("\uD83D\uDDA8️ Using browser-based HTML printing"),await s(t);return}if(a){console.log("\uD83D\uDDA8️ Using browser-based thermal content printing");let e='<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>Print</title>\n  <style>\n    body {\n      font-family: monospace;\n      white-space: pre-wrap;\n      margin: 0;\n      padding: 10mm;\n    }\n  </style>\n</head>\n<body><pre>'.concat(String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),"</pre></body>\n</html>");await s(e);return}throw Error("No printable content provided.")}a.d(t,{G:()=>l}),a(68267)},83209:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>o,ZB:()=>c,Zp:()=>n,aR:()=>i});var s=a(95155),l=a(12115),r=a(25016);let n=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...l})});n.displayName="Card";let i=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",a),...l})});i.displayName="CardHeader";let c=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",a),...l})});c.displayName="CardTitle";let d=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",a),...l})});d.displayName="CardDescription";let o=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",a),...l})});o.displayName="CardContent",l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",a),...l})}).displayName="CardFooter"},90235:(e,t,a)=>{"use strict";a.d(t,{J:()=>d});var s=a(95155),l=a(12115),r=a(32894),n=a(83101),i=a(25016);let c=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.b,{ref:t,className:(0,i.cn)(c(),a),...l})});d.displayName=r.b.displayName}},e=>{e.O(0,[9206,6445,5239,5584,9648,7318,5973,832,8441,1255,7358],()=>e(e.s=52319)),_N_E=e.O()}]);