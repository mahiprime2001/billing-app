"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7],{12007:(e,s,t)=>{t.r(s),t.d(s,{default:()=>h});var r=t(95155),a=t(12115),n=t(54679),l=t(33789),i=t(90235),c=t(97003),o=t(47507),d=t(309),u=t(95261),m=t.n(u);function h(e){let{products:s,isOpen:t,onClose:u,onPrintSuccess:h,storeName:x}=e,[p,g]=(0,a.useState)(1),[f,j]=(0,a.useState)(!1),[b,N]=(0,a.useState)({}),[v,w]=(0,a.useState)([]),[y,P]=(0,a.useState)(""),[C,D]=(0,a.useState)(81),[k,E]=(0,a.useState)(12),[S,T]=(0,a.useState)(2),[F,L]=(0,a.useState)(35),[J,U]=(0,a.useState)(!1),B="http://localhost:8000/api";(0,a.useEffect)(()=>{t&&O()},[t]);let O=async()=>{try{let e=await fetch("".concat(B,"/printers"),{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){let s=await e.json();if("success"===s.status&&s.printers){if(w(s.printers),s.printers.length>0){let e="SNBC TVSE LP46 Dlite BPLE";s.printers.includes(e)?P(e):P(s.printers[0])}}else alert("Failed to get printers: ".concat(s.message))}else throw await e.text(),Error("HTTP ".concat(e.status,": ").concat(e.statusText))}catch(e){alert("Failed to get printers list. Error: ".concat(e instanceof Error?e.message:"Unknown error"))}},_=async()=>{try{let e={productIds:s.map(e=>e.id),copies:p,printerName:y,storeName:x},t=await fetch("".concat(B,"/send-tspl-to-tauri"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)return{status:"error",message:r.message||"Flask API error: ".concat(t.status," ").concat(t.statusText)};if("success"===r.status)return{status:"success",message:r.message||"Print job sent successfully"};return{status:"error",message:r.message||"Print job failed"}}catch(e){return{status:"error",message:e instanceof Error?e.message:"Unknown error during print request"}}},q=e=>{try{let s=document.createElement("canvas");return s.width=3.779528*C,s.height=3.779528*k,m()(s,e,{format:"CODE128",width:S,height:F,displayValue:J,margin:1,background:"#ffffff",lineColor:"#000000"}),s.toDataURL("image/png")}catch(e){return null}};a.useEffect(()=>{if(t&&s.length>0){let e={};for(let t of s){let s=t.barcodes&&t.barcodes.length>0?t.barcodes[0]:t.id;e[t.id]=q(s)}N(e)}else t||N({})},[t,s,C,k,S,F,J]);let A=async()=>{if(0===s.length)return void alert("❌ No products selected");if(!y)return void alert("❌ Please select a printer");j(!0);try{let e=await _();"success"===e.status?(alert("✅ Print success: ".concat(e.message)),h(),u()):alert("❌ Print failed: ".concat(e.message||"Unknown error"))}catch(e){alert("❌ Print failed: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{j(!1)}};return(0,r.jsx)(n.lG,{open:t,onOpenChange:u,children:(0,r.jsxs)(n.Cf,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(n.c7,{children:[(0,r.jsxs)(n.L3,{className:"flex items-center gap-2",children:[(0,r.jsx)(d.A,{className:"h-5 w-5"}),"Print Labels"]}),(0,r.jsx)(n.rr,{children:"Configure and preview labels. Data flow: Next.js → Flask → Tauri → Printer"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.J,{htmlFor:"copies",children:"Copies per Product"}),(0,r.jsx)(l.p,{id:"copies",type:"number",min:"1",max:"10",value:p,onChange:e=>g(Number.parseInt(e.target.value)||1),className:"w-32"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Number of labels to print for each selected product."})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.J,{children:"Select Printer"}),(0,r.jsxs)(o.l6,{value:y,onValueChange:P,children:[(0,r.jsx)(o.bq,{children:(0,r.jsx)(o.yv,{placeholder:"Choose a printer"})}),(0,r.jsx)(o.gC,{children:v.map(e=>(0,r.jsx)(o.eb,{value:e,children:e},e))})]}),0===v.length&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:"❌ No printers found."})]}),(0,r.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,r.jsx)(i.J,{className:"font-semibold text-blue-800",children:"Data Flow"}),(0,r.jsxs)("div",{className:"mt-2 space-y-1 text-sm text-blue-700",children:[(0,r.jsx)("div",{children:"1. \uD83D\uDCE1 Next.js sends print request to Flask"}),(0,r.jsx)("div",{children:"2. \uD83D\uDD27 Flask generates TSPL commands"}),(0,r.jsx)("div",{children:"3. \uD83D\uDE80 Flask sends TSPL to Tauri server"}),(0,r.jsx)("div",{children:"4. \uD83D\uDDA8️ Tauri prints to selected printer"}),(0,r.jsxs)("div",{className:"mt-2 font-medium",children:["Total Labels: ",s.length*p]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(i.J,{className:"text-lg font-semibold",children:"Label Preview"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-4 max-h-[400px] overflow-y-auto p-2 border rounded-lg bg-gray-50",children:s.map(e=>(0,r.jsxs)("div",{className:"flex flex-col items-center p-2 border rounded-md bg-white shadow-sm",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700",children:e.name}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["₹",e.price.toFixed(2)]}),b[e.id]?(0,r.jsx)("img",{src:b[e.id],alt:"Barcode for ".concat(e.name),className:"mt-1"}):(0,r.jsx)("p",{className:"text-xs text-red-500 mt-1",children:"Barcode error"})]},e.id))})]})]}),(0,r.jsxs)(n.Es,{children:[(0,r.jsx)(c.$,{variant:"outline",onClick:u,children:"Cancel"}),(0,r.jsx)(c.$,{onClick:A,disabled:f||!y||0===v.length,children:f?"\uD83D\uDD04 Printing...":"\uD83D\uDDA8️ Print"})]})]})})}}}]);