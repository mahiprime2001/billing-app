(()=>{var e={};e.id=170,e.ids=[170],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79748:e=>{"use strict";e.exports=require("fs/promises")},94841:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>R,routeModule:()=>w,serverHooks:()=>j,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{DELETE:()=>h,GET:()=>x,PUT:()=>g});var n=r(96559),i=r(48088),a=r(37719),o=r(32190),c=r(79748),u=r.n(c),l=r(33873);let p=r.n(l)().join(process.cwd(),"app","data","json","notifications.json");async function d(){try{let e=await u().readFile(p,"utf-8");return JSON.parse(e)}catch{return[]}}async function f(e){await u().writeFile(p,JSON.stringify(e,null,2))}async function x(e){try{let{searchParams:t}=new URL(e.url),r="true"===t.get("unreadOnly"),s=parseInt(t.get("limit")||"50"),n=await d(),i=r?n.filter(e=>!e.isRead):n;i=i.slice(0,s);let a=n.filter(e=>!e.isRead).length;return o.NextResponse.json({success:!0,notifications:i,unreadCount:a,total:n.length})}catch(e){return console.error("Error fetching notifications:",e),o.NextResponse.json({success:!1,error:"Failed to fetch notifications"},{status:500})}}async function g(e){try{let{action:t}=await e.json();if("markAllRead"===t){let e=(await d()).map(e=>({...e,isRead:!0}));return await f(e),o.NextResponse.json({success:!0,message:"All notifications marked as read"})}return o.NextResponse.json({success:!1,error:"Invalid action"},{status:400})}catch(e){return console.error("Error updating notifications:",e),o.NextResponse.json({success:!1,error:"Failed to update notifications"},{status:500})}}async function h(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("olderThanDays")||"30"),s=await d(),n=new Date;n.setDate(n.getDate()-r);let i=s.filter(e=>new Date(e.createdAt)>n);await f(i);let a=s.length-i.length;return o.NextResponse.json({success:!0,message:`Deleted ${a} old notifications`,deletedCount:a})}catch(e){return console.error("Error deleting notifications:",e),o.NextResponse.json({success:!1,error:"Failed to delete notifications"},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/notifications/route",pathname:"/api/notifications",filename:"route",bundlePath:"app/api/notifications/route"},resolvedPagePath:"/Users/mahendrareddy/developer/billing_system/billing-app/app/api/notifications/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:m,serverHooks:j}=w;function R(){return(0,a.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:m})}},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580],()=>r(94841));module.exports=s})();