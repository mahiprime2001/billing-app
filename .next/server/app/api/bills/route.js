(()=>{var e={};e.id=392,e.ids=[392],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15942:(e,t,r)=>{"use strict";r.d(t,{B:()=>u,h:()=>c});var s=r(29021),o=r.n(s),i=r(33873),n=r.n(i);let a=n().join(process.cwd(),"app","data","logs");o().existsSync(a)||o().mkdirSync(a,{recursive:!0});let u=(e,t)=>{let r=n().join(a,`${e}.log`),s=new Date().toISOString(),i=`${s} - ${t}
`;o().appendFileSync(r,i)},c=async(e,t)=>{await o().promises.writeFile(e,t,"utf-8")}},19771:e=>{"use strict";e.exports=require("process")},22398:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>S,routeModule:()=>b,serverHooks:()=>N,workAsyncStorage:()=>E,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>g,POST:()=>q});var o=r(96559),i=r(48088),n=r(37719),a=r(32190),u=r(79748),c=r.n(u),l=r(33873),d=r.n(l),p=r(15942),m=r(42996);let x=d().resolve(process.cwd(),"app/data/json/bills.json"),y=d().resolve(process.cwd(),"app/data/json/products.json");async function w(){try{let e=await c().readFile(x,"utf-8");return JSON.parse(e)}catch(e){if("ENOENT"===e.code)return[];throw e}}async function f(e){let t=await w();t.push(e),await c().writeFile(x,JSON.stringify(t,null,2))}async function g(){let e=await w();return a.NextResponse.json(e)}async function q(e){let t=await e.json();await f(t),(0,p.B)("bills.json",`New bill created: (ID: ${t.id})`);try{let e=await c().readFile(y,"utf-8"),r=JSON.parse(e);for(let e of t.items){let t=r.findIndex(t=>t.id===e.productId);-1!==t&&(r[t].stock-=e.quantity,(0,p.B)("products.json",`Stock updated for product ${e.productId}: new stock ${r[t].stock}`))}await c().writeFile(y,JSON.stringify(r,null,2))}catch(e){console.error("Error updating stock in products.json:",e)}let r=await m.A.getConnection();try{if(await r.beginTransaction(),t.createdBy&&"prime"!==t.createdBy){let[e]=await r.execute("SELECT id FROM Users WHERE id = ?",[t.createdBy]);if(0===e.length)return console.error(`User with id ${t.createdBy} not found. Skipping bill insertion.`),await r.rollback(),r.release(),a.NextResponse.json({message:"User not found"},{status:400})}for(let e of(await r.execute(`INSERT INTO Bills (id, storeId, storeName, storeAddress, customerName, customerPhone, customerEmail, customerAddress, customerId, subtotal, taxPercentage, taxAmount, discountPercentage, discountAmount, total, paymentMethod, timestamp, notes, gstin, companyName, companyAddress, companyPhone, companyEmail, billFormat, createdBy)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[t.id,t.storeId??null,t.storeName??null,t.storeAddress??null,t.customerName??null,t.customerPhone??null,t.customerEmail??null,t.customerAddress??null,t.customerId??null,t.subtotal??0,t.taxPercentage??0,t.taxAmount??0,t.discountPercentage??0,t.discountAmount??0,t.total??0,t.paymentMethod??null,t.timestamp,t.notes??null,t.gstin??null,t.companyName??null,t.companyAddress??null,t.companyPhone??null,t.companyEmail??null,t.billFormat??null,t.createdBy??null]),t.items))await r.execute("INSERT INTO BillItems (billId, productId, name, quantity, price, total, tax, gstRate, barcodes) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)",[t.id,e.productId,e.name,e.quantity,e.price,e.total,e.tax,e.gstRate,e.barcodes]),e.productId&&await r.execute("UPDATE Products SET stock = stock - ? WHERE id = ?",[e.quantity,e.productId]);await r.commit()}catch(e){await r.rollback(),console.error("Error inserting bill into MySQL:",e)}finally{r.release()}return a.NextResponse.json(t,{status:201})}let b=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/bills/route",pathname:"/api/bills",filename:"route",bundlePath:"app/api/bills/route"},resolvedPagePath:"E:\\billing-app\\app\\api\\bills\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:E,workUnitAsyncStorage:h,serverHooks:N}=b;function S(){return(0,n.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:h})}},27910:e=>{"use strict";e.exports=require("stream")},28303:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=28303,e.exports=t},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},41204:e=>{"use strict";e.exports=require("string_decoder")},42996:(e,t,r)=>{"use strict";r.d(t,{$:()=>o,A:()=>i});let s=r(46101).createPool({host:"86.38.243.155",user:"u408450631_siri",password:"Siriart@2025",database:"u408450631_siri",waitForConnections:!0,connectionLimit:10,queueLimit:0});async function o(){return await s.getConnection()}let i=s},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{"use strict";e.exports=require("timers")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79748:e=>{"use strict";e.exports=require("fs/promises")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,101],()=>r(22398));module.exports=s})();