(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7522],{25543:(e,t,s)=>{Promise.resolve().then(s.bind(s,72226))},72226:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>O});var a=s(95155),n=s(12115),l=s(35695),c=s(60838),r=s(73331),i=s(97168),o=s(89852),d=s(82714),m=s(88482),x=s(88145),h=s(99474),u=s(99840),p=s(95784),j=s(76037),g=s(47655),v=s(53999);let f=n.forwardRef((e,t)=>{let{className:s,children:n,...l}=e;return(0,a.jsxs)(g.bL,{ref:t,className:(0,v.cn)("relative overflow-hidden",s),...l,children:[(0,a.jsx)(g.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,a.jsx)(N,{}),(0,a.jsx)(g.OK,{})]})});f.displayName=g.bL.displayName;let N=n.forwardRef((e,t)=>{let{className:s,orientation:n="vertical",...l}=e;return(0,a.jsx)(g.VM,{ref:t,orientation:n,className:(0,v.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,a.jsx)(g.lr,{className:"relative flex-1 rounded-full bg-border"})})});N.displayName=g.VM.displayName;var b=s(57434),y=s(54416),w=s(84616),A=s(47924),P=s(27809),C=s(71007),k=s(46308),S=s(19420),F=s(87712),I=s(62525),E=s(81586),T=s(27414),D=s(46767),M=s(85339);let q=e=>fetch(e).then(e=>e.json());function O(){let e=(0,l.useRouter)(),{data:t=[]}=(0,c.Ay)("/api/products",q),[s,g]=(0,n.useState)(null),[v,N]=(0,n.useState)(""),[O,L]=(0,n.useState)([]),[U,$]=(0,n.useState)([]),[z,J]=(0,n.useState)(""),[B,V]=(0,n.useState)([]),[_,R]=(0,n.useState)(!1),[W,Z]=(0,n.useState)(!1),[G,K]=(0,n.useState)(!1),[Q,Y]=(0,n.useState)(""),[H,X]=(0,n.useState)({gstin:"",taxPercentage:0,companyName:"",companyAddress:"",companyPhone:"",companyEmail:""}),[ee,et]=(0,n.useState)([]),[es,ea]=(0,n.useState)(null),[en,el]=(0,n.useState)({}),[ec,er]=(0,n.useState)({}),[ei,eo]=(0,n.useState)("A4");(0,n.useEffect)(()=>{let t=localStorage.getItem("adminLoggedIn"),s=localStorage.getItem("adminUser");if("true"!==t||!s){e.push("/");return}let a=JSON.parse(s);g(a),fetch("/api/settings").then(e=>e.json()).then(e=>{e.systemSettings&&X(e.systemSettings),e.billFormats&&el(e.billFormats),e.storeFormats&&er(e.storeFormats)}),fetch("/api/bills").then(t=>{if(401===t.status)return e.push("/"),null;if(!t.ok)throw Error("Failed to fetch bills");return t.json()}).then(e=>{e&&V(e.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()))}).catch(e=>{console.error("Failed to load bills:",e)}),fetch("/api/stores").then(e=>e.json()).then(e=>{let t=e.filter(e=>"active"===e.status);if(et(t),"billing_user"===a.role&&a.assignedStores){let e=t.filter(e=>{var t;return null===(t=a.assignedStores)||void 0===t?void 0:t.includes(e.id)});e.length>0&&ea(e[0])}else t.length>0&&ea(t[0])})},[e]),(0,n.useEffect)(()=>{v?L(t.filter(e=>e.name.toLowerCase().includes(v.toLowerCase())||e.category&&e.category.toLowerCase().includes(v.toLowerCase())||e.barcodes&&e.barcodes.some(e=>e.includes(v)))):L(t.slice(0,20))},[v,t]),(0,n.useEffect)(()=>{H.taxPercentage>0&&$(e=>0!==e.length&&e.some(e=>e.taxPercentage!==H.taxPercentage)?e.map(e=>{if(e.taxPercentage!==H.taxPercentage){let t=e.subtotal,s=t*e.discountPercentage/100,a=t-s,n=a*H.taxPercentage/100;return{...e,taxPercentage:H.taxPercentage,taxAmount:n,total:a+n}}return e}):e)},[H.taxPercentage]),(0,n.useEffect)(()=>{if(0===U.length&&H.companyName){let e={id:"tab-1",name:"Bill #1",cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxPercentage:H.taxPercentage,taxAmount:0,total:0,paymentMethod:"cash",notes:"",hasUnsavedChanges:!1};$([e]),J(e.id)}},[U.length,H]);let ed=e=>{let t=U.find(t=>t.id===e);if(null==t?void 0:t.hasUnsavedChanges){Y(e),K(!0);return}if(1===U.length){em(e);return}let s=U.filter(t=>t.id!==e);if($(s),z===e){let t=U.findIndex(t=>t.id===e);J((s[t]||s[t-1]||s[0]).id)}},em=e=>{$(U.map(t=>t.id===e?{...t,cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxAmount:0,total:0,notes:"",hasUnsavedChanges:!1}:t))},ex=(e,t)=>{$(U.map(s=>s.id===e?{...s,...t,hasUnsavedChanges:!0}:s))},eh=()=>U.find(e=>e.id===z),eu=e=>{let t;let s=eh();if(!s)return;if(e.stock<=0){alert("Product is out of stock");return}let a=s.cart.find(t=>t.productId===e.id);if(a){if(a.quantity>=e.stock){alert("Cannot add more. Maximum available: ".concat(e.stock));return}t=s.cart.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1,total:(t.quantity+1)*t.price}:t)}else t=[...s.cart,{productId:e.id,productName:e.name,quantity:1,price:e.price,total:e.price}];let n=t.reduce((e,t)=>e+t.total,0),l=n*s.discountPercentage/100,c=n-l,r=c*s.taxPercentage/100;ex(z,{cart:t,subtotal:n,discountAmount:l,taxAmount:r,total:c+r})},ep=(e,s)=>{let a=eh();if(!a)return;if(s<=0){ej(e);return}let n=t.find(t=>t.id===e);if(n&&s>n.stock){alert("Cannot exceed available stock: ".concat(n.stock));return}let l=a.cart.map(t=>t.productId===e?{...t,quantity:s,total:s*t.price}:t),c=l.reduce((e,t)=>e+t.total,0),r=c*a.discountPercentage/100,i=c-r,o=i*a.taxPercentage/100;ex(z,{cart:l,subtotal:c,discountAmount:r,taxAmount:o,total:i+o})},ej=e=>{let t=eh();if(!t)return;let s=t.cart.filter(t=>t.productId!==e),a=s.reduce((e,t)=>e+t.total,0),n=a*t.discountPercentage/100,l=a-n,c=l*t.taxPercentage/100;ex(z,{cart:s,subtotal:a,discountAmount:n,taxAmount:c,total:l+c})},eg=e=>{let t=eh();if(!t)return;let s=Math.max(0,Math.min(100,e)),a=t.subtotal*s/100,n=t.subtotal-a,l=n*t.taxPercentage/100;ex(z,{discountPercentage:s,discountAmount:a,taxAmount:l,total:n+l})},ev=e=>{let t=eh();if(!t||0===t.subtotal)return;let s=Math.max(0,t.subtotal+t.taxAmount-e),a=t.subtotal>0?s/t.subtotal*100:0;ex(z,{total:e,discountAmount:s,discountPercentage:a})},ef=e=>{eh()&&(ex(z,{customer:e}),Z(!1))},eN=async()=>{let e=eh();if(!e||0===e.cart.length||!es)return;let a=ec[es.id]||ei,n=en[a]||en.A4,l={id:"INV-".concat(Date.now()),storeId:es.id,storeName:es.name,storeAddress:es.address,storePhone:es.phone,customerName:e.customer.name||"",customerPhone:e.customer.phone||"",customerEmail:e.customer.email||"",customerAddress:e.customer.address||"",items:e.cart,subtotal:e.subtotal,taxPercentage:e.taxPercentage,taxAmount:e.taxAmount,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount,total:e.total,paymentMethod:e.paymentMethod,timestamp:new Date().toISOString(),notes:e.notes,gstin:H.gstin,companyName:H.companyName,companyAddress:H.companyAddress,companyPhone:H.companyPhone,companyEmail:H.companyEmail,billFormat:a,createdBy:(null==s?void 0:s.id)||"Unknown"};try{await fetch("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}catch(e){console.error("Failed to save bill:",e)}for(let s of e.cart){let e=t.find(e=>e.id===s.productId);if(e){let t=e.stock-s.quantity;try{await fetch("/api/products/".concat(s.productId),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({stock:t})})}catch(e){console.error("Failed to update stock for product ".concat(s.productId,":"),e)}}}eb(l,n),em(z),R(!1)},eb=(e,t)=>{let s=window.open("","_blank");if(!s)return;let a=216===t.width&&279===t.height,n=210===t.width&&297===t.height,l=t.width<=80?"80mm":a?"216mm":n?"210mm":"".concat(t.width,"mm"),c="\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title>Invoice - ".concat(e.id,"</title>\n        <style>\n          @page {\n            size: ").concat(a?"letter":n?"A4":"".concat(t.width,"mm ").concat("auto"===t.height?"auto":"".concat(t.height,"mm")),";\n            margin: ").concat(t.margins.top,"mm ").concat(t.margins.right,"mm ").concat(t.margins.bottom,"mm ").concat(t.margins.left,"mm;\n          }\n          body {\n            font-family: 'Arial', sans-serif;\n            max-width: ").concat(l,';\n            margin: 0 auto;\n            font-size: 13px;\n            color: #000;\n          }\n          .header, .footer {\n            text-align: center;\n            padding: 10px 0;\n          }\n          .company-name {\n            font-size: 18px;\n            font-weight: bold;\n            text-transform: uppercase;\n          }\n          .invoice-title {\n            font-size: 16px;\n            font-weight: bold;\n            margin-top: 10px;\n          }\n          .section {\n            margin: 20px 0;\n          }\n          .section-title {\n            font-weight: bold;\n            border-bottom: 1px solid #ccc;\n            margin-bottom: 5px;\n          }\n          .row {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 6px;\n          }\n          .items-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 15px;\n          }\n          .items-table th, .items-table td {\n            border: 1px solid #ccc;\n            padding: 6px 8px;\n            text-align: left;\n          }\n          .items-table th {\n            background-color: #f2f2f2;\n          }\n          .totals {\n            margin-top: 10px;\n            width: 100%;\n          }\n          .totals td {\n            padding: 6px;\n          }\n          .totals .label {\n            text-align: right;\n            font-weight: bold;\n          }\n          .totals .value {\n            text-align: right;\n            width: 100px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="company-name">').concat(e.companyName,"</div>\n          <div>").concat(e.companyAddress,"</div>\n          <div>Phone: ").concat(e.companyPhone,"</div>\n          <div>Email: ").concat(e.companyEmail,'</div>\n          <div class="invoice-title">INVOICE</div>\n        </div>\n\n        <div class="section">\n          <div class="row">\n            <div><strong>Invoice ID:</strong> ').concat(e.id,"</div>\n            <div><strong>Date:</strong> ").concat(new Date(e.timestamp).toLocaleString(),"</div>\n          </div>\n          ").concat(e.gstin?"<div><strong>GSTIN:</strong> ".concat(e.gstin,"</div>"):"","\n        </div>\n\n        ").concat(e.customerName||e.customerPhone?'\n        <div class="section">\n          <div class="section-title">Customer Details</div>\n          '.concat(e.customerName?"<div>Name: ".concat(e.customerName,"</div>"):"","\n          ").concat(e.customerPhone?"<div>Phone: ".concat(e.customerPhone,"</div>"):"","\n          ").concat(e.customerEmail?"<div>Email: ".concat(e.customerEmail,"</div>"):"","\n          ").concat(e.customerAddress?"<div>Address: ".concat(e.customerAddress,"</div>"):"","\n        </div>"):"",'\n\n        <div class="section">\n          <table class="items-table">\n            <thead>\n              <tr>\n                <th>#</th>\n                <th>Item</th>\n                <th>Qty</th>\n                <th>Rate</th>\n                <th>Total</th>\n              </tr>\n            </thead>\n            <tbody>\n              ').concat(e.items.map((e,t)=>"\n                <tr>\n                  <td>".concat(t+1,"</td>\n                  <td>").concat(e.productName,"</td>\n                  <td>").concat(e.quantity,"</td>\n                  <td>₹").concat(e.price.toFixed(2),"</td>\n                  <td>₹").concat(e.total.toFixed(2),"</td>\n                </tr>\n              ")).join(""),'\n            </tbody>\n          </table>\n        </div>\n\n        <div class="section">\n          <table class="totals">\n            <tr>\n              <td class="label">Subtotal:</td>\n              <td class="value">₹').concat(e.subtotal.toFixed(2),"</td>\n            </tr>\n            ").concat(e.discountAmount>0?'<tr>\n                    <td class="label">Discount ('.concat(e.discountPercentage.toFixed(1),'%):</td>\n                    <td class="value">-₹').concat(e.discountAmount.toFixed(2),"</td>\n                  </tr>"):"",'\n            <tr>\n              <td class="label">Tax (').concat(e.taxPercentage,'%):</td>\n              <td class="value">₹').concat(e.taxAmount.toFixed(2),'</td>\n            </tr>\n            <tr>\n              <td class="label">Total:</td>\n              <td class="value"><strong>₹').concat(e.total.toFixed(2),'</strong></td>\n            </tr>\n            <tr>\n              <td class="label">Payment:</td>\n              <td class="value">').concat(e.paymentMethod.toUpperCase(),"</td>\n            </tr>\n          </table>\n        </div>\n\n        ").concat(e.notes?'<div class="section">\n                <div class="section-title">Notes</div>\n                <div>'.concat(e.notes,"</div>\n              </div>"):"",'\n\n        <div class="footer">\n          <p>Thank you for your business!</p>\n        </div>\n      </body>\n    </html>\n  ');s.document.write(c),s.document.close(),s.print()},ey=eh(),ew=(0,n.useMemo)(()=>B.slice(0,10),[B]);return(0,a.jsx)(r.A,{children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center bg-gray-100 border-b border-gray-200 px-2 py-1",children:[(0,a.jsx)("div",{className:"flex items-center space-x-1 flex-1 overflow-x-auto",children:U.map(e=>(0,a.jsxs)("div",{className:"\n                  relative flex items-center px-4 py-2 min-w-0 max-w-48 cursor-pointer group\n                  ".concat(z===e.id?"bg-white border-t-2 border-blue-500 text-blue-600":"bg-gray-200 hover:bg-gray-300 text-gray-700","\n                  rounded-t-lg border-l border-r border-gray-300 mr-1\n                  transition-all duration-200\n                "),style:{clipPath:z===e.id?"polygon(8px 100%, 0 0, calc(100% - 8px) 0, 100% 100%)":"polygon(4px 100%, 0 0, calc(100% - 4px) 0, 100% 100%)"},onClick:()=>J(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate text-sm font-medium",children:e.name}),e.cart.length>0&&(0,a.jsx)(x.E,{variant:"secondary",className:"h-5 text-xs",children:e.cart.length}),e.hasUnsavedChanges&&(0,a.jsx)("div",{className:"h-2 w-2 bg-orange-500 rounded-full flex-shrink-0",title:"Unsaved changes"})]}),U.length>1&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 ml-2 opacity-0 group-hover:opacity-100 hover:bg-red-100 hover:text-red-600 flex-shrink-0",onClick:t=>{t.stopPropagation(),ed(e.id)},children:(0,a.jsx)(y.A,{className:"h-3 w-3"})})]},e.id))}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>{let e=U.length+1,t={id:"tab-".concat(Date.now()),name:"Bill #".concat(e),cart:[],customer:{},subtotal:0,discountPercentage:0,discountAmount:0,taxPercentage:H.taxPercentage,taxAmount:0,total:0,paymentMethod:"cash",notes:"",hasUnsavedChanges:!1};$([...U,t]),J(t.id)},className:"ml-2 h-8 w-8 p-0 bg-gray-200 hover:bg-gray-300 rounded-full",title:"New Tab",children:(0,a.jsx)(w.A,{className:"h-4 w-4"})})]}),ey&&(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsxs)("div",{className:"w-1/2 border-r border-gray-200 flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(A.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(o.p,{placeholder:"Search products by name, category, or barcode...",value:v,onChange:e=>N(e.target.value),className:"pl-10"})]})}),(0,a.jsx)(f,{className:"flex-1",children:(0,a.jsxs)("div",{className:"p-4 space-y-2",children:[O.map(e=>(0,a.jsx)(m.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>eu(e),children:(0,a.jsx)(m.Wu,{className:"p-3",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium text-sm",children:e.name}),e.category&&(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.category}),e.barcodes&&e.barcodes.length>0&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Barcode: ",e.barcodes[0]]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-bold text-green-600",children:["₹",e.price.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Stock: ",e.stock]})]})]})})},e.id)),0===O.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(A.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No products found"}),(0,a.jsx)("p",{className:"text-sm",children:"Try adjusting your search terms"})]})]})})]}),(0,a.jsxs)("div",{className:"w-1/2 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold flex items-center",children:[(0,a.jsx)(P.A,{className:"h-5 w-5 mr-2"}),ey.name]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>Z(!0),children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-1"}),"Customer"]}),ey.cart.length>0&&(0,a.jsxs)(i.$,{size:"sm",onClick:()=>R(!0),children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-1"}),"Checkout"]})]})]}),(ey.customer.name||ey.customer.phone)&&(0,a.jsx)("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)(C.A,{className:"h-4 w-4 text-blue-600"}),(0,a.jsx)("span",{className:"font-medium",children:ey.customer.name||"Customer"}),ey.customer.phone&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.A,{className:"h-3 w-3 text-gray-500"}),(0,a.jsx)("span",{className:"text-gray-600",children:ey.customer.phone})]})]})})]}),(0,a.jsx)(f,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4",children:ey.cart.length>0?(0,a.jsx)("div",{className:"space-y-3",children:ey.cart.map(e=>(0,a.jsx)(m.Zp,{children:(0,a.jsxs)(m.Wu,{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:e.productName}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:["₹",e.price.toFixed(2)," each"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>ep(e.productId,e.quantity-1),className:"h-8 w-8 p-0",children:(0,a.jsx)(F.A,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"w-8 text-center text-sm font-medium",children:e.quantity}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>ep(e.productId,e.quantity+1),className:"h-8 w-8 p-0",children:(0,a.jsx)(w.A,{className:"h-3 w-3"})}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>ej(e.productId),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50",children:(0,a.jsx)(I.A,{className:"h-3 w-3"})})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Total:"}),(0,a.jsxs)("span",{className:"font-bold",children:["₹",e.total.toFixed(2)]})]})]})},e.productId))}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(P.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"Cart is empty"}),(0,a.jsx)("p",{className:"text-sm",children:"Add products from the left panel"})]})})}),ey.cart.length>0?(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(d.J,{className:"text-sm",children:"Discount %:"}),(0,a.jsx)(o.p,{type:"number",value:ey.discountPercentage,onChange:e=>eg(Number(e.target.value)),className:"w-20 h-8",min:"0",max:"100"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["(-₹",ey.discountAmount.toFixed(2),")"]})]}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{children:["₹",ey.subtotal.toFixed(2)]})]}),ey.discountAmount>0&&(0,a.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,a.jsx)("span",{children:"Discount:"}),(0,a.jsxs)("span",{children:["-₹",ey.discountAmount.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Tax (",ey.taxPercentage,"%):"]}),(0,a.jsxs)("span",{children:["₹",ey.taxAmount.toFixed(2)]})]}),(0,a.jsx)(j.w,{}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"₹"}),(0,a.jsx)(o.p,{type:"number",value:ey.total.toFixed(2),onChange:e=>ev(Number(e.target.value)),className:"w-24 h-8 text-right font-bold",step:"0.01"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{className:"text-sm",children:"Notes:"}),(0,a.jsx)(h.T,{value:ey.notes,onChange:e=>ex(z,{notes:e.target.value}),placeholder:"Add notes for this bill...",className:"mt-1 h-16 text-sm"})]})]})}):(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Recent Bills"}),(0,a.jsx)(f,{className:"h-64",children:(0,a.jsx)("div",{className:"space-y-2",children:ew.map(e=>(0,a.jsx)(m.Zp,{children:(0,a.jsxs)(m.Wu,{className:"p-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"font-medium",children:e.id}),(0,a.jsxs)("span",{className:"font-bold",children:["₹",e.total.toFixed(2)]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:new Date(e.timestamp).toLocaleString()})]})},e.id))})})]})]})]}),(0,a.jsx)(u.lG,{open:W,onOpenChange:Z,children:(0,a.jsxs)(u.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(u.c7,{children:[(0,a.jsxs)(u.L3,{className:"flex items-center",children:[(0,a.jsx)(C.A,{className:"h-5 w-5 mr-2"}),"Customer Information"]}),(0,a.jsx)(u.rr,{children:"Add customer details for this bill"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"customerName",children:"Name"}),(0,a.jsx)(o.p,{id:"customerName",defaultValue:(null==ey?void 0:ey.customer.name)||"",placeholder:"Customer name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"customerPhone",children:"Phone"}),(0,a.jsx)(o.p,{id:"customerPhone",defaultValue:(null==ey?void 0:ey.customer.phone)||"",placeholder:"Phone number"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"customerEmail",children:"Email"}),(0,a.jsx)(o.p,{id:"customerEmail",defaultValue:(null==ey?void 0:ey.customer.email)||"",placeholder:"Email address"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"customerAddress",children:"Address"}),(0,a.jsx)(h.T,{id:"customerAddress",defaultValue:(null==ey?void 0:ey.customer.address)||"",placeholder:"Customer address",className:"h-20"})]})]}),(0,a.jsxs)(u.Es,{children:[(0,a.jsx)(i.$,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),(0,a.jsx)(i.$,{onClick:()=>{var e,t,s,a;let n=null===(e=document.getElementById("customerName"))||void 0===e?void 0:e.value,l=null===(t=document.getElementById("customerPhone"))||void 0===t?void 0:t.value;ef({name:n,phone:l,email:null===(s=document.getElementById("customerEmail"))||void 0===s?void 0:s.value,address:null===(a=document.getElementById("customerAddress"))||void 0===a?void 0:a.value})},children:"Save Customer"})]})]})}),(0,a.jsx)(u.lG,{open:_,onOpenChange:R,children:(0,a.jsxs)(u.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(u.c7,{children:[(0,a.jsxs)(u.L3,{className:"flex items-center",children:[(0,a.jsx)(E.A,{className:"h-5 w-5 mr-2"}),"Process Payment"]}),(0,a.jsx)(u.rr,{children:"Complete the transaction and select bill format"})]}),ey&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{className:"text-sm font-medium",children:"Bill Format"}),(0,a.jsxs)(p.l6,{value:ei,onValueChange:eo,children:[(0,a.jsx)(p.bq,{className:"mt-1",children:(0,a.jsx)(p.yv,{})}),(0,a.jsx)(p.gC,{children:Object.entries(en).map(e=>{let[t,s]=e;return(0,a.jsxs)(p.eb,{value:t,children:[t.replace("_"," ")," (",s.width,"\xd7","auto"===s.height?"Auto":s.height,"mm)"]},t)})})]})]}),(0,a.jsx)(m.Zp,{children:(0,a.jsx)(m.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Items:"}),(0,a.jsxs)("span",{children:[ey.cart.length," (",ey.cart.reduce((e,t)=>e+t.quantity,0)," qty)"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{children:["₹",ey.subtotal.toFixed(2)]})]}),ey.discountAmount>0&&(0,a.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,a.jsxs)("span",{children:["Discount (",ey.discountPercentage.toFixed(1),"%):"]}),(0,a.jsxs)("span",{children:["-₹",ey.discountAmount.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Tax (",ey.taxPercentage,"%):"]}),(0,a.jsxs)("span",{children:["₹",ey.taxAmount.toFixed(2)]})]}),(0,a.jsx)(j.w,{}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("span",{children:["₹",ey.total.toFixed(2)]})]})]})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{className:"text-sm font-medium",children:"Payment Method"}),(0,a.jsxs)(p.l6,{value:ey.paymentMethod,onValueChange:e=>ex(z,{paymentMethod:e}),children:[(0,a.jsx)(p.bq,{className:"mt-1",children:(0,a.jsx)(p.yv,{})}),(0,a.jsxs)(p.gC,{children:[(0,a.jsx)(p.eb,{value:"cash",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 mr-2"}),"Cash"]})}),(0,a.jsx)(p.eb,{value:"card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Card"]})}),(0,a.jsx)(p.eb,{value:"upi",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(D.A,{className:"h-4 w-4 mr-2"}),"UPI"]})})]})]})]}),es&&(0,a.jsx)(m.Zp,{children:(0,a.jsx)(m.Wu,{className:"p-3",children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{className:"font-medium",children:["Store: ",es.name]}),(0,a.jsx)("div",{className:"text-gray-600 mt-1",children:es.address}),es.phone&&(0,a.jsxs)("div",{className:"text-gray-600",children:["Phone: ",es.phone]}),(0,a.jsxs)("div",{className:"text-gray-600",children:["GSTIN: ",H.gstin]}),(0,a.jsxs)("div",{className:"text-gray-600",children:["Tax Rate: ",H.taxPercentage,"%"]})]})})}),(ey.customer.name||ey.customer.phone)&&(0,a.jsx)(m.Zp,{children:(0,a.jsx)(m.Wu,{className:"p-3",children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{className:"font-medium flex items-center",children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Customer Details"]}),(0,a.jsxs)("div",{className:"mt-2 space-y-1 text-gray-600",children:[ey.customer.name&&(0,a.jsxs)("div",{children:["Name: ",ey.customer.name]}),ey.customer.phone&&(0,a.jsxs)("div",{children:["Phone: ",ey.customer.phone]}),ey.customer.email&&(0,a.jsxs)("div",{children:["Email: ",ey.customer.email]})]})]})})})]}),(0,a.jsxs)(u.Es,{children:[(0,a.jsx)(i.$,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),(0,a.jsxs)(i.$,{onClick:eN,className:"bg-green-600 hover:bg-green-700",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Complete Payment"]})]})]})}),(0,a.jsx)(u.lG,{open:G,onOpenChange:K,children:(0,a.jsxs)(u.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(u.c7,{children:[(0,a.jsxs)(u.L3,{className:"flex items-center",children:[(0,a.jsx)(M.A,{className:"h-5 w-5 mr-2 text-orange-500"}),"Unsaved Changes"]}),(0,a.jsx)(u.rr,{children:"This tab has unsaved changes. Are you sure you want to close it?"})]}),(0,a.jsxs)(u.Es,{children:[(0,a.jsx)(i.$,{variant:"outline",onClick:()=>K(!1),children:"Cancel"}),(0,a.jsx)(i.$,{variant:"destructive",onClick:()=>{if(1===U.length)em(Q);else{let e=U.filter(e=>e.id!==Q);if($(e),z===Q){let t=U.findIndex(e=>e.id===Q);J((e[t]||e[t-1]||e[0]).id)}}K(!1),Y("")},children:"Close Tab"})]})]})})]})})}},99474:(e,t,s)=>{"use strict";s.d(t,{T:()=>c});var a=s(95155),n=s(12115),l=s(53999);let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});c.displayName="Textarea"}},e=>{var t=t=>e(e.s=t);e.O(0,[5347,5398,9328,6524,1511,1634,8441,1684,7358],()=>t(25543)),_N_E=e.O()}]);