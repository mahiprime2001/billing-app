(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{1243:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(19946).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},30966:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>N});var l=t(95155),a=t(12115),r=t(35695),c=t(8601),i=t(88482),d=t(88145),n=t(55868),o=t(46308),x=t(37108),m=t(5937),h=t(1243),u=t(69074),j=t(33109),p=t(17580),f=t(72713);function N(){let e=(0,r.useRouter)(),[s,t]=(0,a.useState)(null),[N,y]=(0,a.useState)(!0),[g,w]=(0,a.useState)(null),[v,b]=(0,a.useState)({totalRevenue:0,totalBills:0,totalProducts:0,totalStores:0,totalUsers:0,lowStockProducts:0,recentBills:[],topProducts:[]});(0,a.useEffect)(()=>{let s=localStorage.getItem("adminLoggedIn"),l=localStorage.getItem("adminUser");if("true"!==s||!l){e.push("/");return}t(JSON.parse(l)),(async()=>{try{y(!0),w(null),await k()}catch(e){console.error("Error loading dashboard data:",e),w("Failed to load dashboard data. Please try again later.")}finally{y(!1)}})()},[e]);let k=async()=>{try{let[e,s,t,l]=await Promise.all([fetch("/api/bills"),fetch("/api/products"),fetch("/api/stores"),fetch("/api/users")]);if(!e.ok||!s.ok||!t.ok||!l.ok)throw Error("Failed to fetch data");let[a,r,c,i]=await Promise.all([e.json(),s.json(),t.json(),l.json()]),d=a.reduce((e,s)=>e+s.total,0),n=a.length,o=r.length,x=c.filter(e=>"active"===e.status).length,m=i.filter(e=>e.isActive).length,h=r.filter(e=>e.stock<=e.minStock).length,u=[...a].sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime()).slice(0,5),j={};a.forEach(e=>{e.items.forEach(e=>{j[e.productId]?(j[e.productId].quantity+=e.quantity,j[e.productId].revenue+=e.total):j[e.productId]={name:e.productName,quantity:e.quantity,revenue:e.total}})});let p=Object.values(j).sort((e,s)=>s.quantity-e.quantity).slice(0,5);b({totalRevenue:d,totalBills:n,totalProducts:o,totalStores:x,totalUsers:m,lowStockProducts:h,recentBills:u,topProducts:p})}catch(e){throw console.error("Error loading dashboard data:",e),e}};return s?(0,l.jsx)(c.default,{children:(0,l.jsxs)("div",{className:"space-y-8",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h1",{className:"text-4xl font-bold text-gray-900",children:["Welcome back, ",s.name,"!"]}),(0,l.jsx)("p",{className:"text-gray-600 mt-2",children:"Here's what's happening with your jewelry business today."})]}),(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,l.jsxs)(i.Zp,{children:[(0,l.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(i.ZB,{className:"text-sm font-medium",children:"Total Revenue"}),(0,l.jsx)(n.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsxs)(i.Wu,{children:[(0,l.jsxs)("div",{className:"text-2xl font-bold",children:["₹",v.totalRevenue.toFixed(2)]}),(0,l.jsxs)("p",{className:"text-xs text-muted-foreground",children:["From ",v.totalBills," bills"]})]})]}),(0,l.jsxs)(i.Zp,{children:[(0,l.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(i.ZB,{className:"text-sm font-medium",children:"Total Bills"}),(0,l.jsx)(o.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsxs)(i.Wu,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:v.totalBills}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"Bills generated"})]})]}),(0,l.jsxs)(i.Zp,{children:[(0,l.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(i.ZB,{className:"text-sm font-medium",children:"Products"}),(0,l.jsx)(x.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsxs)(i.Wu,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:v.totalProducts}),(0,l.jsxs)("p",{className:"text-xs text-muted-foreground",children:[v.lowStockProducts>0&&(0,l.jsxs)("span",{className:"text-yellow-600",children:[v.lowStockProducts," low stock"]}),0===v.lowStockProducts&&"All in stock"]})]})]}),"super_admin"===s.role&&(0,l.jsxs)(i.Zp,{children:[(0,l.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(i.ZB,{className:"text-sm font-medium",children:"Active Stores"}),(0,l.jsx)(m.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsxs)(i.Wu,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:v.totalStores}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"Store locations"})]})]})]}),v.lowStockProducts>0&&(0,l.jsxs)(i.Zp,{className:"border-yellow-200 bg-yellow-50",children:[(0,l.jsx)(i.aR,{children:(0,l.jsxs)(i.ZB,{className:"text-yellow-800 flex items-center",children:[(0,l.jsx)(h.A,{className:"h-5 w-5 mr-2"}),"Stock Alert"]})}),(0,l.jsx)(i.Wu,{children:(0,l.jsxs)("p",{className:"text-yellow-700",children:["You have ",v.lowStockProducts," products with low stock levels. Consider restocking these items soon."]})})]}),(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,l.jsxs)(i.Zp,{children:[(0,l.jsxs)(i.aR,{children:[(0,l.jsxs)(i.ZB,{className:"flex items-center",children:[(0,l.jsx)(o.A,{className:"h-5 w-5 mr-2"}),"Recent Bills"]}),(0,l.jsx)(i.BT,{children:"Latest billing activity"})]}),(0,l.jsx)(i.Wu,{children:v.recentBills.length>0?(0,l.jsx)("div",{className:"space-y-4",children:v.recentBills.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"font-medium",children:["#",e.id]}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:e.customerName}),(0,l.jsxs)("p",{className:"text-xs text-gray-400 flex items-center",children:[(0,l.jsx)(u.A,{className:"h-3 w-3 mr-1"}),new Date(e.date).toLocaleDateString()]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("p",{className:"font-bold",children:["₹",e.total.toFixed(2)]}),(0,l.jsxs)(d.E,{variant:"secondary",children:[e.items.length," items"]})]})]},e.id))}):(0,l.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No bills created yet"})})]}),(0,l.jsxs)(i.Zp,{children:[(0,l.jsxs)(i.aR,{children:[(0,l.jsxs)(i.ZB,{className:"flex items-center",children:[(0,l.jsx)(j.A,{className:"h-5 w-5 mr-2"}),"Top Selling Products"]}),(0,l.jsx)(i.BT,{children:"Best performing jewelry items"})]}),(0,l.jsx)(i.Wu,{children:v.topProducts.length>0?(0,l.jsx)("div",{className:"space-y-4",children:v.topProducts.map((e,s)=>(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:e.name}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:[e.quantity," units sold"]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("p",{className:"font-bold",children:["₹",e.revenue.toFixed(2)]}),(0,l.jsxs)(d.E,{variant:"outline",children:["#",s+1]})]})]},s))}):(0,l.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No sales data available"})})]})]}),"super_admin"===s.role&&(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,l.jsxs)(i.Zp,{children:[(0,l.jsx)(i.aR,{children:(0,l.jsxs)(i.ZB,{className:"flex items-center",children:[(0,l.jsx)(p.A,{className:"h-5 w-5 mr-2"}),"System Users"]})}),(0,l.jsxs)(i.Wu,{children:[(0,l.jsx)("div",{className:"text-2xl font-bold",children:v.totalUsers}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"Active users in system"})]})]}),(0,l.jsxs)(i.Zp,{children:[(0,l.jsx)(i.aR,{children:(0,l.jsxs)(i.ZB,{className:"flex items-center",children:[(0,l.jsx)(m.A,{className:"h-5 w-5 mr-2"}),"Store Performance"]})}),(0,l.jsxs)(i.Wu,{children:[(0,l.jsxs)("div",{className:"text-2xl font-bold",children:["₹",v.totalStores>0?(v.totalRevenue/v.totalStores).toFixed(2):"0.00"]}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"Average revenue per store"})]})]}),(0,l.jsxs)(i.Zp,{children:[(0,l.jsx)(i.aR,{children:(0,l.jsxs)(i.ZB,{className:"flex items-center",children:[(0,l.jsx)(f.A,{className:"h-5 w-5 mr-2"}),"Analytics"]})}),(0,l.jsxs)(i.Wu,{children:[(0,l.jsxs)("div",{className:"text-2xl font-bold",children:["₹",v.totalBills>0?(v.totalRevenue/v.totalBills).toFixed(2):"0.00"]}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"Average bill value"})]})]})]})]})}):(0,l.jsx)("div",{children:"Loading..."})}},33109:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(19946).A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},49794:(e,s,t)=>{Promise.resolve().then(t.bind(t,30966))},55868:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(19946).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},69074:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(19946).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},88482:(e,s,t)=>{"use strict";t.d(s,{BT:()=>n,Wu:()=>o,ZB:()=>d,Zp:()=>c,aR:()=>i});var l=t(95155),a=t(12115),r=t(53999);let c=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});c.displayName="Card";let i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",t),...a})});i.displayName="CardHeader";let d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});d.displayName="CardTitle";let n=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",t),...a})});n.displayName="CardDescription";let o=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",t),...a})});o.displayName="CardContent",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",t),...a})}).displayName="CardFooter"}},e=>{var s=s=>e(e.s=s);e.O(0,[5347,2167,5260,8601,8441,1684,7358],()=>s(49794)),_N_E=e.O()}]);